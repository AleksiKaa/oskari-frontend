/* This is a packed Oskari bundle (bundle script version Mon Feb 27 2012 09:45:18 GMT+0200 (Suomen normaaliaika)) */ 
Oskari.clazz.define("Oskari.mapframework.solsol.SolSolPlayer",function(){this.dropZoneMoves=[];this.sol=null;this.timer=null;this.alerted=-1;this.paused=true;this.stepper=0;this.el=null;this.dlg={success:null,failure:null};this.cards={}},{getCardDiv:function(a){return this.cards[a]},calcCardPos:function(b,a){if(a<7){return{lpos:a*64+a,tpos:128+b*24}}else{if(a<9){return{lpos:(a-7)*64+a,tpos:b}}else{return{lpos:3*64+(a-9)*64+a,tpos:b}}}},createCardDiv:function(b,a){var c=document.createElement("div");c.id=b;c.setAttribute("cardNum",a);c.className="card";return c},toHtml:function(b){var k=this.sol;var a=k.getRoState();var o=8;for(var j=0;j<52;j++){var h=a.stacks.elementAt(o);var m=h.elementAt(j);if(m<0){var g=2*-57.15384+" "+4*-83}else{if(o==8||j<=a.firstHidden.elementAt(o)){var g=2*-57.15384+" "+4*-83;var l=this.calcCardPos(j,o);var e="card_"+m;var d=this.cards[e];if(!d){d=this.createCardDiv(e,m);b.appendChild(d);this.cards[d.id]=d}d.style.left=l.lpos;d.style.top=l.tpos;d.style.zIndex=j;d.style.backgroundPosition=g}else{var i=Math.floor(m/16);var f=Math.floor(m%16);var g=f*-57.15384+" "+i*-83;var l=this.calcCardPos(j,o);var e="card_"+m;var d=this.cards[e];if(!d){d=this.createCardDiv(e,m);b.appendChild(d);this.cards[d.id]=d}d.style.left=l.lpos;d.style.top=l.tpos;d.style.zIndex=j;d.style.backgroundPosition=g}}}},render:function(b){this.toHtml(b);var h=this.sol;var a=h.getRoState();var k=8;for(var g=0;g<52;g++){var e=a.stacks.elementAt(k);var i=e.elementAt(g);if(i<0){continue}var d="card_"+i;var f=this.getCardDiv(d);if(g<=a.firstHidden.elementAt(k)){}else{var j=this;var h=this.sol;$(f).draggable({cardNum:i,start:function(c,l){j.resetDropZoneMoves();h.prepareMovesForCard(Number(l.helper.attr("cardNum")),j.dropZoneMoves);j.visualiseDropZones(j.dropZoneMoves)},helper:"clone",zIndex:2700})}}},renderMove:function(d,f){for(var a=0;a<24;a++){var k=d.cards.elementAt(a);if(k==-1){break}var b="card_"+k;var h=this.getCardDiv(b);var j=this.calcCardPos(d.toPos+a,d.toStack);h.style.zIndex=d.toPos+a;var c=Math.floor(k%16);var g=Math.floor(k/16);if(d.toStack==7||(d.toStack<7&&d.toPos==d.toStack)){var e=c*-57.15384+" "+g*-83;h.style.backgroundPosition=e}if(f){$(h).animate({left:j.lpos,top:j.tpos},"slow")}else{h.style.top=j.tpos;h.style.left=j.lpos}}if(d.unfold!=-1){var a=d.unfold;var b="card_"+a;var h=this.getCardDiv(b);var c=Math.floor(d.unfold%16);var g=Math.floor(d.unfold/16);if(d.fromStack!=8){var e=c*-57.15384+" "+g*-83;h.style.backgroundPosition=e}var l=this;var i=this.sol;$(h).draggable({cardNum:a,start:function(m,o){l.resetDropZoneMoves();i.prepareMovesForCard(Number(o.helper.attr("cardNum")),l.dropZoneMoves);l.visualiseDropZones(l.dropZoneMoves)},helper:"clone",zIndex:2700})}},applyDropZoneMove:function(e,c,d){var b=this.sol;for(var f=0;f<this.dropZoneMoves.length;f++){var a=this.dropZoneMoves[f];if(!(a.toStack==c&&a.toPos==d&&a.cards.elementAt(0)==e)){continue}b.m=a;this.step(false);break}},resetDropZoneMoves:function(){var a=this.dropZoneMoves.shift();while(a!=null){a.destroy();delete a;a=this.dropZoneMoves.shift()}},visualiseDropZones:function(b){var e=this.sol;var d=this.el;$(d).find(".dropZone").remove();$(d).find(".dropZone").droppable("destroy");for(var g=0;g<b.length;g++){var a=b[g];var f=this.calcCardPos(a.toPos,a.toStack);if(a.toStack!=7){$(d).append("<div id='droppable' toStack='"+a.toStack+"' toPos='"+a.toPos+"' class='dropZone' style='z-index:"+(a.toPos+1)+"; left:"+(f.lpos)+"; top:"+(f.tpos)+";'></div>")}else{$(d).append("<div id='droppable' toStack='"+a.toStack+"' toPos='"+a.toPos+"' class='dropZone' style='z-index:"+(a.toPos+1)+"; left:"+(f.lpos)+"; top:"+(f.tpos+24)+";'></div>")}}var c=this;$(".dropZone").droppable({accept:".card",hoverClass:"ui-state-active",drop:function(h,i){$(this).addClass("ui-state-highlight");c.applyDropZoneMove(Number(i.draggable.attr("cardNum")),Number($(this).attr("toStack")),Number($(this).attr("toPos")))}})},step:function(c){var b=this.sol;var a=b.getMove();if(a.ok){b.applyMove(a);this.renderMove(a,c)}else{if(b.detectSuccess(a)!=1&&b.getRoState().state>=1){this.paused=true;this.alerted=10;
this.report({state:"failure"})}}a=b.stepSimulation();if(b.detectSuccess(a)==1){this.paused=true;this.alerted=10;this.report({state:"success"})}if(a.ok){}if(b.getRoState().state!=0){this.resetDropZoneMoves();b.prepareMovesForPos(-1,-1,this.dropZoneMoves);this.visualiseDropZones(this.dropZoneMoves)}},bd:function(a,c,b){},startup:function(c){this.el=c;var b=this.sol;b.bouncerDebugger=this.bd;b.newGame(true);this.render(c);this.paused=false;var a=this;this.func=function(){a.autoStep()};this.timer=window.setInterval(this.func,250)},report:function(a){},shutdown:function(){if(this.timer){window.clearInterval(this.timer)}var a=this.sol;this.sol=null;a.destroy();delete a},solNewGame:function(){this.paused=true;this.stepper=0;var a=this.sol;a.newGame(true);this.render(this.el)},solStep:function(){var a=this.sol;a.stepSimulation();this.step(true)},solStart:function(){this.paused=!this.paused},solHint:function(){var a=this.sol;this.resetDropZoneMoves();a.prepareMovesForPos(-1,-1,this.dropZoneMoves);this.visualiseDropZones(this.dropZoneMoves)},autoStep:function(){var a=this.sol;if(a.state.state==0){this.step(true)}else{if(!this.paused){this.stepper++;if(this.stepper%2==0){this.step(true)}}else{if(this.alerted>0){this.alerted--;if(this.alerted==0){this.solNewGame();this.solStart()}}}}},createAI:function(){function a(f){this.arr=new Array(f);this.length=0;this.capacity=f}a.prototype={add:function(f){this.arr[this.length]=f;this.length++},elementAt:function(f){return this.arr[f]},assignAt:function(g,f){this.arr[g]=f},isEmpty:function(){return this.length==0},size:function(){return this.length},clear:function(){this.length=0;for(n=0;n<this.capacity;n++){this.arr[n]=-1}},begin:function(){return 0},end:function(){return this.capacity},fill:function(f,h,g){for(var i=f;i<h;i++){this.arr[i]=g}},assignCopy:function(f,h,i){this.clear();var g=0;for(var j=f;j<h;j++){this.arr[g++]=i.arr[j]}}};function d(){this.deck=new a(52);var f=0;for(var h=0;h<4;h++){for(var g=0;g<13;g++){this.deck.assignAt(f,h*16+g);f++}}}d.prototype.assignCopy=function(f){this.deck.assignCopy(f.deck.begin(),f.deck.end(),f.deck)};d.prototype.randomShuffle=function(){var h=this.deck.arr;var i=h.length;while(i>1){i--;var f=Math.floor(Math.random()*(i+1));var g=h[f];h[f]=h[i];h[i]=g}};function b(){this.state=-1;this.bouncerIndex=0;this.bouncerCount=0;this.stacks=new a(16);for(n=0;n<16;n++){var f=new a(n==8?52:24);this.stacks.assignAt(n,f);f.fill(f.begin(),f.end(),-1)}this.firstHidden=new a(16);this.tops=new a(16);this.dealerIndex=-1;this.restartLooped=-1;this.firstHidden.fill(this.firstHidden.begin(),this.firstHidden.end(),-1);this.tops.fill(this.tops.begin(),this.tops.end(),-1)}b.prototype={assignCopy:function(g){for(n=0;n<16;n++){var f=g.stacks.elementAt(n);this.stacks.elementAt(n).assignCopy(f.begin(),f.end(),f)}this.firstHidden.assignCopy(g.firstHidden.begin(),g.firstHidden.end(),g.firstHidden);this.tops.assignCopy(g.tops.begin(),g.tops.end(),g.tops);this.dealerIndex=g.dealerIndex;this.restartLooped=g.restartLooped;this.state=g.state}};function e(){this.ok=false;this.fromStack=-1;this.fromPos=-1;this.toStack=-1;this.toPos=-1;this.cards=new a(24);this.unfold=-1;this.restartLooped=-1;this.msg="";this.cards.fill(this.cards.begin(),this.cards.end(),-1)}e.prototype={destroy:function(){var f=this.cards;this.cards=null;delete f},assign:function(k,f,i,j,h,g){this.ok=k;this.fromStack=f;this.fromPos=i;this.toStack=j;this.toPos=h;this.unfold=g;this.restartLooped=0;this.msg="";this.cards.fill(this.cards.begin(),this.cards.end(),-1)},reset:function(){this.assign(false,-1,-1,-1,-1,-1)},assignCopy:function(f){this.assign(f.ok,f.fromStack,f.fromPos,f.toStack,f.toPos,f.unfold);this.restartLooped=f.restartLooped;this.cards.assignCopy(f.cards.begin(),f.cards.end(),f.cards);this.msg=f.msg}};function c(){this.deck=new d();this.state=new b();this.ms=[];this.m=new e();this.bouncerDebugger=function(){}}c.prototype={destroy:function(){var h=this.deck;var g=this.state;var f=this.m;this.deck=null;this.state=null;this.m=null;delete h;delete g;delete f},getRoState:function(){return this.state},getRwState:function(){return this.state
},newGame:function(g){this.ms=[];this.m.reset();var j=new d();j.assignCopy(this.deck);if(g){j.randomShuffle()}var h=this.getRwState();h.restartLooped=-1;h.bouncerCount=0;h.bouncerIndex=0;h.firstHidden.fill(h.firstHidden.begin(),h.firstHidden.end(),-2);h.tops.fill(h.tops.begin(),h.tops.end(),-1);for(var l=0;l<16;l++){var f=h.stacks.elementAt(l);f.fill(f.begin(),f.end(),-1)}var i=0;h.dealerIndex=0;var k=h.stacks.elementAt(8);for(;i<52;i++){k.assignAt(h.dealerIndex++,j.deck.elementAt(i))}h.firstHidden.assignAt(8,50);h.tops.assignAt(8,51);h.state=0},applyMove:function(f){if(!f.ok){return}var h=this.getRwState();h.restartLooped=f.restartLooped;var j=h.stacks.elementAt(f.fromStack);var g=h.stacks.elementAt(f.toStack);for(var i=0;i<24;i++){if(f.cards.elementAt(i)==-1){break}g.assignAt(f.toPos+i,j.elementAt(f.fromPos+i));h.tops.assignAt(f.toStack,h.tops.elementAt(f.toStack)+1);if(h.state==0&&f.fromStack==8){h.firstHidden.assignAt(f.toStack,h.firstHidden.elementAt(f.toStack)+1)}if(f.toStack==7){h.firstHidden.assignAt(f.toStack,h.tops.elementAt(f.toStack)-1);j.assignAt(f.fromPos+i,-1);h.tops.assignAt(f.fromStack,h.tops.elementAt(f.fromStack)-1)}else{j.assignAt(f.fromPos+i,-1);h.tops.assignAt(f.fromStack,h.tops.elementAt(f.fromStack)-1)}}if(f.unfold!=-1){h.firstHidden.assignAt(f.fromStack,h.firstHidden.elementAt(f.fromStack)-1)}},render:function(f){},detectSuccess:function(f){var h=0;var i=this.getRoState();for(var j=0;j<9;j++){h+=i.tops.elementAt(j)}var g=0;for(var j=9;j<13;j++){g+=i.tops.elementAt(j)}return h==-9&&g==48?1:(f.restartLooped>0?-1:0)},getMove:function(){return this.m},getMoves:function(){return this.ms},prepareMovesForPos:function(g,h,f){},stepSimulation:function(){this.ms=[];this.m.reset();this.m.restartLooped=this.getRoState().restartLooped;var f=this.ms;var h=this.getRwState();if(h.state==0){h.state=this.prepareMovesForDeal(f)?0:1}if(h.state==1||h.state==2){this.prepareOrganiseVisibleCardsMove(f,false);this.preparePullKingsToEmptyStacksMove(f);this.preparePullCardsToFinalisationMove(f);this.preparePullCardsFromDealerDeckMove(f);this.prepareRestartDealerDeckMove(f);this.prepareOrganiseRoomForDealerDeckPull(f);if(f.length==0&&h.state!=2){this.prepareOrganiseVisibleCardsMove(f,true);this.bouncerDebugger(f,h.bouncerCount,h.bouncerIndex);if(h.bouncerCount>16){h.state=2}else{if(f.length>1){h.bouncerCount++;if(h.bouncerIndex>f.length-1){h.bouncerIndex=0}var g=f;f=[];f.push(g[h.bouncerIndex++])}else{h.state=2}}}else{if(f.length!=0&&h.state==2){h.state=1}}}if(f.length!=0){this.m=f[0]}else{this.m.reset()}return this.m},prepareOrganiseVisibleCardsMove:function(z,y){var r=new e();var o=false;var k=this.getRoState();for(var p=0;p<7;p++){var j=k.tops.elementAt(p);if(j==-1){continue}var l=k.stacks.elementAt(p);var u=Math.floor(l.elementAt(j)/16);var s=Math.floor(l.elementAt(j)%16);for(var w=0;w<8;w++){if(p==w){continue}var m=k.tops.elementAt(w);if(m==-1){continue}var x=k.firstHidden.elementAt(w);var q=k.stacks.elementAt(w);for(var v=x+1;v<=m;v++){var h=Math.floor(q.elementAt(v)/16);var g=Math.floor(q.elementAt(v)%16);if(!y&&(v>0&&v>x+1)){var i=Math.floor(q.elementAt(v-1)%16);if(i==g+1){continue}}if(s!=g+1){continue}if(((u==0&&(h==1||h==2)))||((u==1&&(h==0||h==3)))||((u==2&&(h==0||h==3)))||((u==3&&(h==1||h==2)))){o=true;r.assign(true,w,v,p,j+1);r.cards.assignCopy(v,m+1,q);r.unfold=(x>=0&&x==v-1)?q.elementAt(x):-1;if(r.ok){r.restartLooped=-1}z.push(r);r=new e()}}}}},preparePullKingsToEmptyStacksMove:function(h){var j=new e();var u=false;var g=this.getRoState();for(var s=0;s<7;s++){var r=g.tops.elementAt(s);if(r!=-1){continue}for(var m=0;m<8;m++){if(s==m){continue}var q=g.tops.elementAt(m);if(q==-1&&m<7){continue}var i=g.firstHidden.elementAt(m);var o=g.stacks.elementAt(m);for(var p=i+1;p<=q;p++){var k=Math.floor(o.elementAt(p)%16);if((p>0||(p>=0&&m==7))&&p>i+1){var l=Math.floor(o.elementAt(p-1)%16);if(l==k+1){continue}}if(k!=12){continue}if(p==0){continue}u=true;j.assign(u,m,p,s,r+1);j.cards.assignCopy(p,q+1,o);j.unfold=(i>=0&&i==p-1)?o.elementAt(i):-1;if(j.ok){j.restartLooped=-1}h.push(j);j=new e()}}}},preparePullCardsToFinalisationMove:function(h){var k=new e();
var v=false;var g=this.getRoState();for(var s=9;s<13;s++){var r=g.tops.elementAt(s);var p=12-s;var j=r!=-1?Math.floor(g.stacks.elementAt(s).elementAt(r)%16):-1;for(var m=0;m<8;m++){var q=g.tops.elementAt(m);if(q==-1){continue}var o=g.stacks.elementAt(m);var u=Math.floor(o.elementAt(q)/16);var l=Math.floor(o.elementAt(q)%16);var i=g.firstHidden.elementAt(m);if(p!=u){continue}if(j!=l-1){continue}v=true;k.assign(v,m,q,s,r+1);k.cards.assignCopy(q,q+1,o);k.unfold=(i>=0&&i==q-1)?o.elementAt(i):-1;if(k.ok){k.restartLooped=-1}h.push(k);k=new e()}}},preparePullCardsFromDealerDeckMove:function(h){var j=new e();var g=this.getRoState();var q=7;var p=g.tops.elementAt(q);var k=8;for(var m=0;m<1;m++){var o=g.tops.elementAt(k);if(o==-1){continue}var i=g.firstHidden.elementAt(k);var l=g.stacks.elementAt(k);j.assign(true,k,o,q,p+1);j.cards.assignCopy(o,o+1,l);j.unfold=(i>=0&&i==o-1)?l.elementAt(i):-1;h.push(j)}},prepareOrganiseRoomForDealerDeckPull:function(f){},prepareRestartDealerDeckMove:function(f){},prepareMovesForPos:function(h,k,i){var g=[];this.prepareOrganiseVisibleCardsMove(g,true);this.preparePullKingsToEmptyStacksMove(g);this.preparePullCardsToFinalisationMove(g);this.preparePullCardsFromDealerDeckMove(g);this.prepareRestartDealerDeckMove(g);if(g.length==0){return false}if(h==-1&&k==-1){for(var j=0;j<g.length;j++){i.push(g[j])}return i.length>0}for(var j=0;j<g.length;j++){var f=g[j];if(f.fromStack==h&&f.fromPos==k){i.push(f)}}if(i.length==0){return false}return true},prepareMovesForCard:function(h,i){var g=[];this.prepareOrganiseVisibleCardsMove(g,true);this.preparePullKingsToEmptyStacksMove(g);this.preparePullCardsToFinalisationMove(g);this.preparePullCardsFromDealerDeckMove(g);this.prepareRestartDealerDeckMove(g);if(g.length==0){return false}for(var j=0;j<g.length;j++){var f=g[j];if(f.cards.elementAt(0)==h){i.push(f)}}if(i.length==0){return false}return true},prepareMovesForDeal:function(h){var j=new e();var g=this.getRoState();if(g.state!=0){return}var q=-1;var p=-1;for(q=0;q<7;q++){p=g.tops.elementAt(q);if(p<q){break}}if(q==7){return false}var k=8;for(var m=0;m<1;m++){var o=g.tops.elementAt(k);if(o==-1){continue}var i=g.firstHidden.elementAt(k);var l=g.stacks.elementAt(k);j.assign(true,k,o,q,p+1);j.cards.assignCopy(o,o+1,l);j.unfold=(i>=0&&i==o-1)?l.elementAt(i):-1;h.push(j);return true}},toHtmlTable:function(g){var j="";j+="<table><tbody>";var k=this.getRoState();for(var l=0;l<24;l++){j+="<tr>";for(var h=0;h<7;h++){var i=k.stacks.elementAt(h);var f=i.elementAt(l);if(f<0){j+="<td width='12%' />"}else{if(h==8||l<=k.firstHidden.elementAt(h)){if(l==k.tops.elementAt(h)){j+="<td width='12%' style='color: red;'>("+f+")</td>"}else{j+="<td width='12%' style='color: blue;'>("+f+")</td>"}}else{j+="<td width='12%'>"+f+"</td>"}}}j+="</tr>"}j+="</tbody></table>";g.innerHTML=j}};this.sol=new c()}});Oskari.clazz.define("Oskari.mapframework.bundle.SolSolBundleInstance",function(){},{start:function(){var g=this.mediator.manager;var c=this.mediator.bundle;var f=Oskari.clazz.create("Oskari.mapframework.solsol.SolSolPlayer");f.createAI();this.player=f;var e=Ext.create("Ext.panel.Panel",{"float":true,id:"solsol-win",iconCls:"tabs",shim:false,closable:false,animCollapse:false,border:false,layout:"fit",html:'<div class="solitaire" style="width:100%;height:100%" id="solitaire"></div>',bbar:[Ext.create("Ext.Action",{text:"Pys�yt�/Jatka",handler:function(){f.solStart()},iconCls:"solsol_play"}),Ext.create("Ext.Action",{text:"Jaa uudelleen",handler:function(){f.solNewGame()},iconCls:"solsol_new_game"})]});var a=this.mediator.clazz.global("Ext");var a=Oskari.$("Ext");var h=this;Ext.create("Ext.window.Window",{x:100,y:100,width:646,height:480,layout:"fit",items:[e],listeners:{close:function(){h.stop();var i=h.mediator.manager;var b=h.mediator.instanceid;h=null;i.destroyInstance(b)}}}).show();var d=document.getElementById("solitaire");f.startup(d)},update:function(){},stop:function(){this.player.shutdown();this.player=null}},{protocol:["Oskari.bundle.BundleInstance"]});