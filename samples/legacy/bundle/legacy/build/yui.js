/* This is a packed Oskari bundle (bundle script version Tue Jan 10 2012 13:14:39 GMT+0200 (Suomen normaaliaika)) */ 
Oskari.clazz.define("Oskari.mapframework.akp.Sample",function(){this._core=null;this.mapConfiguration=null;this.ui=null},{setMapConfiguration:function(a){this.mapConfiguration=a},getMapConfiguration:function(){return this.mapConfiguration},startFramework:function(){var b=this.getMapConfiguration();if(b.cancelStartup==true){return}var d=this;var a=Oskari.clazz.create("Oskari.mapframework.core.Core");this._core=a;var c=this.createServices(b);var f=this.createEnhancements(b);var e=this.createUserInterface(b);this.ui=e;this.createCoreQuirks(b,a);a.init(e,c,f,b.layers,b.organizationsTreeLayout,b.userInterfaceLanguage,b.mapPublisherWizardUrl)},getUserInterface:function(){return this.ui},createCoreQuirks:function(b,a){if(b.disableDevelopmentMode=="true"){var c=Oskari.clazz.create("Oskari.mapframework.enhancement.common.DisableDevelopmentModeEnhancement",true);c.enhance(a)}},createServices:function(a){var b=[];b.push(Oskari.clazz.create("Oskari.mapframework.service.GetFeatureInfoService",a.globalMapAjaxUrl));b.push(Oskari.clazz.create("Oskari.mapframework.service.LanguageService",a.userInterfaceLanguage));b.push(Oskari.clazz.create("Oskari.mapframework.service.UsageSnifferService",2,"/log/"));b.push(Oskari.clazz.create("Oskari.mapframework.service.MapLayerService",a.globalMapAjaxUrl));return b},createEnhancements:function(a){var b=[];b.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithConfigurationsEnhancement",a.preSelectedLayers,a.mapConfigurations));b.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement"));return b},createUserInterface:function(a){return Oskari.clazz.create("Oskari.mapframework.ui.manager.akp.MapPortalUiManager",a)}});Oskari.clazz.define("Oskari.mapframework.ui.manager.akp.MapPortalUiManager",function(a){this._sandbox;this._conf=a;this._uimodules=[];this._uimodulesByName={}},{createModulesAndUi:function(a){a.printDebug("Creating UI for Map full...");this._sandbox=a;var b=this._conf;this.setupExtensionModules(a);a.printDebug("All modules created, next build up EXTJs frame...");this.createUi(a);a.printDebug("Map full UI construction completed.")},setupExtensionModules:function(a){a.printDebug("setupExtensionModules...");for(var c=0;c<this._uimodules.length;c++){var b=this._uimodules[c];if(!b.module){continue}a.printDebug("#*+---- registering ----+*#"+b.identifier);b.component=a.register(b.module)}},addExtensionModule:function(c,b,d,f,a){var e={module:c,identifier:b,region:d,loc:f,component:a};this._uimodules.push(e);this._uimodulesByName[b]=e;return e},getExtensionModule:function(a){return this._uimodulesByName[a].module},getExtensionModuleDefinition:function(a){return this._uimodulesByName[a]},getExtensionModuleComponentsByRegion:function(d){var a=this._sandbox;var b=[];var f="";for(p in d){f+=p+"="+d[p]+" "}a.printDebug("getExtensionModulesByRegion called with "+f);for(var e=0;e<this._uimodules.length;e++){var c=this._uimodules[e];if(!c.component){continue}if(d[c.region]){b.push(c.component);a.printDebug("- module "+c.identifier+" matched")}}return b},getExtensionModuleDefinitionsByRegion:function(c){var a=[];for(var d=0;d<this._uimodules.length;d++){var b=this._uimodules[d];if(c[b.region]){a.push(b)}}return a},createUi:function(b){var C=b.getLanguage();var g=Oskari.$().startup.mapConfigurations;var k=300;var q=this.getExtensionModuleComponentsByRegion({S:true});var i=Ext.create("Ext.Panel",{region:"south",split:true,layout:"fit",region:"south",collapsed:true,collapsible:true,animCollapse:false,titleCollapse:false,collapseMode:"mini",id:"main-app-bottom",height:k,boxMinHeight:k,width:g.width,animCollapse:false,titleCollapse:false,frame:true,header:false,items:q});var c=this.getExtensionModuleDefinitionsByRegion({E:true});var B=[];for(var w=0;w<c.length;w++){var t=c[w];B.push({title:t.loc?t.loc[C].title:"?",height:256,items:t.component})}var l=Ext.create("Ext.app.PortalPanel",{xtype:"portalpanel",items:[{id:"col-2",items:B}]});var f=[l];var a=Ext.create("Ext.Panel",{region:"east",width:312,collapsible:true,collapsed:true,split:true,layout:"fit",items:f,collapseMode:"mini",animCollapse:false});var r=[];var j=this.getExtensionModuleDefinitionsByRegion({NW:true});var u=Ext.create("Ext.Panel",{height:256,layout:"fit",items:j});r.push(u);var A=this.getExtensionModuleDefinitionsByRegion({W:true});var e=[];for(var w=0;w<A.length;w++){var t=A[w];if(!t.component){continue}e.push({title:t.loc?t.loc[C].title:"?",height:512,items:t.component})}var o=Ext.create("Ext.app.PortalPanel",{flex:1,xtype:"portalpanel",items:[{id:"col-1",items:e}]});r.push(o);var y=Ext.create("Ext.panel.Panel",{region:"west",split:true,layout:{type:"vbox",align:"stretch",pack:"start"},items:r,id:"main-left-panel",collapseMode:"mini",collapsed:true,border:false,frame:false,region:"west",width:220,collapsible:true,animCollapse:false,split:true,animCollapse:false,titleCollapse:false,autoHeight:false,boxMaxWidth:600,boxMinWidth:220});var v=this.getExtensionModuleComponentsByRegion({Center:true});var s=Ext.create("Ext.Panel",{region:"center",split:true,items:v,id:"main-center",border:false,region:"center",layout:"fit",frame:false,header:false,collapsible:false,animCollapse:false,titleCollapse:false});var m=[];if(y){m.push(y)}m.push(s);if(a){m.push(a)}var h=[];h.push("-");var x=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom",items:h});var d=Ext.create("Ext.Panel",{layout:"border",region:"center",items:m,bbar:x});var z=Ext.create("Ext.Panel",{layout:"border",id:"main-app",width:g.width,height:g.height+k,split:true,items:[d,i],tbar:[{html:'<img src="logo.png" />'}]});Ext.create("Ext.container.Viewport",{style:{padding:"8px",overflow:"hidden"},layout:"fit",items:[z]});this._facade=Oskari.clazz.create("Oskari.mapframework.ui.manager.akp.Facade",b,this,{Portlet:{W:o,E:l},Drawer:{W:y,E:a},S:i,NW:u,Center:s,Viewport:z,ViewportCenter:d,StatusRegion:x});
Oskari.$("UI.facade",this._facade);this._uiReady=true},getFacade:function(){return this._facade}});Oskari.clazz.define("Oskari.mapframework.ui.manager.akp.Facade",function(a,b,c){this.sandbox=a;this.manager=b;this.parts=c;this.additionalComponents={}},{registerPart:function(a,b){this.parts[a]=b},getSandbox:function(){return this.sandbox},getManager:function(){return this.manager},getParts:function(){return this.parts},appendExtensionModule:function(d,j,a,g,e,i,h){var c=this.sandbox.getLanguage();var b=this.manager.addExtensionModule(d,j,e,i,h);b.bundleInstance=g;if(b.module){if(b.component){b.initialisedComponent=this.getSandbox().register(b.module)}else{b.component=this.getSandbox().register(b.module)}}if(b.component){var m=null;var f=true;if(typeof e=="string"){m=e}f=this.parts.Portlet[m];if(f){var n={border:false,title:b.loc[c].title,xtype:"portlet",layout:"fit",items:[b.component],tools:[{type:"gear",handler:function(s,r,q){b.bundleInstance.config()}}],listeners:{close:function(){b.bundleInstance.stop();var r=b.bundleInstance.mediator.manager;var q=b.bundleInstance.mediator.instanceid;r.destroyInstance(q);b.bundleInstance=null}}};var k=this.parts.Drawer[m];k.expand(false);var o=null;o=this.parts.Portlet[m].getComponent(0);var l=o.add(n);b.host=o;b.cmp=l}else{var o=this.parts[m];var l=o.add(b.component);b.host=o;b.cmp=l}b.component=null}for(p in a){this.sandbox.registerForEventByName(d,p)}return b},addUIComponent:function(b,a,d){this.parts[d].add(a);var c={ident:b,region:d,comp:a};this.additionalComponents[b]=c},removeUIComponent:function(a){var b=this.additionalComponents[identtifier];this.parts[b.region].remove(b.comp)},removeExtensionModule:function(b,a,e,d,c){for(p in e){this.sandbox.unregisterFromEventByName(b,p)}this.sandbox.unregister(b)},collapseDirections:{N:Ext.Component.DIRECTION_TOP,E:Ext.Component.DIRECTION_RIGHT,S:Ext.Component.DIRECTION_BOTTOM,W:Ext.Component.DIRECTION_LEFT},collapsePart:function(a){this.parts.Drawer[a].collapse(this.collapseDirections[a],false)},expandPart:function(a){this.parts.Drawer[a].expand(false)}},{protocol:["Oskari.mapframework.ui.manager.Facade"]});Oskari.clazz.define("Oskari.mapframework.bundle.AkpBundleInstance",function(){this.map=null;this.mapster=null;this.ui=null},{getUserInterface:function(){return this.getApp().getUserInterface()},getApp:function(){return this.app},start:function(){var a=null;if(document.location.search.length>1){a=Ext.urlDecode(document.location.search.substring(1))}else{a={}}var d=Oskari.clazz.create("Oskari.mapframework.akp.Sample");this.app=d;var c=Oskari.clazz.create("Oskari.mapframework.akp.NlsFiLayerConfig",{default_wms_url:"http://wms.a.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?,http://wms.b.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?,http://wms.c.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?,http://wms.d.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?"});var b=c.create();d.setMapConfiguration(b);Oskari.$("pageArgs",a);Oskari.$("startup",c.getMapConfiguration());Oskari.$("Ext",Ext)},update:function(){},stop:function(){alert("Stopped!")}},{protocol:["Oskari.bundle.BundleInstance"]});