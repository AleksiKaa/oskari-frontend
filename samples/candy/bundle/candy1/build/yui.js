/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 13:08:29 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.Candy1BundleInstance",function(){this.map=null},{getSandbox:function(){return this.sandbox},createModulesAndUi:function(h){var j=false;var g=true;var c=true;var d=true;var b=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Candy1",j,g,c,d);this.mapmodule=b;var a=h.register(b);a.render("map-div");if(this.conf.plugins){var e=this.conf.plugins;for(var f=0;f<e.length;f++){e[f].instance=Oskari.clazz.create(e[f].id,e[f].config);b.registerPlugin(e[f].instance);b.startPlugin(e[f].instance)}}this.map=a},start:function(){var f=this;var e=f.conf;var b=Oskari.clazz.create("Oskari.mapframework.core.Core");var j=b.getSandbox();this.sandbox=j;var h=[];h.push(Oskari.clazz.create("Oskari.mapframework.service.LanguageService",Oskari.getLang()));h.push(Oskari.clazz.create("Oskari.mapframework.service.MapLayerService",j));var k=[];b.init(h,k);var d=j.getService("Oskari.mapframework.service.MapLayerService");var a=e.layers;if(a){for(var c=0;c<a.length;c++){var g=d.createMapLayer(a[c]);d.addLayer(g,true)}}this.createModulesAndUi(b.getSandbox());j.registerAsStateful(this.mediator.bundleId,this);this.setState(this.state)},getSandbox:function(){return this.sandbox},update:function(){},stop:function(){this.sandbox.unregisterStateful(this.mediator.bundleId);alert("Stopped!")},setState:function(a){var h=this.mapmodule;if(a.selectedLayers){var f=this.sandbox.getRequestBuilder("AddMapLayerRequest");var j=this.sandbox.getRequestBuilder("ChangeMapLayerOpacityRequest");var c=this.sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest");var d=this.sandbox.getRequestBuilder("ChangeMapLayerStyleRequest");var g=a.selectedLayers.length;for(var b=0;b<g;++b){var e=a.selectedLayers[b];this.sandbox.request(h.getName(),f(e.id,true));if(e.hidden){this.sandbox.request(h.getName(),c(e.id,false))}if(e.style){this.sandbox.request(h.getName(),d(e.id,e.style))}if(e.opacity){this.sandbox.request(h.getName(),j(e.id,e.opacity))}}}if(a.east){this.sandbox.getMap().moveTo(a.east,a.north,a.zoom)}this.sandbox.syncMapState(true)},getState:function(){var b=this.sandbox.getMap();var d=this.sandbox.findAllSelectedMapLayers();var j=b.getZoom();var h=b.getX();var a=b.getY();var c={north:a,east:h,zoom:b.getZoom(),selectedLayers:[]};for(var f=0;f<d.length;f++){var g=d[f];var e={id:g.getId(),opacity:g.getOpacity()};if(!g.isVisible()){e.hidden=true}if(g.getCurrentStyle&&g.getCurrentStyle()&&g.getCurrentStyle().getName()&&g.getCurrentStyle().getName()!="!default!"){e.style=g.getCurrentStyle().getName()}c.selectedLayers.push(e)}return c}},{protocol:["Oskari.bundle.BundleInstance","Oskari.userinterface.Stateful"]});