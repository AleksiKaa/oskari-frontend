/* This is a packed Oskari bundle (bundle script version Thu Feb 23 2012 11:08:28 GMT+0200 (Suomen normaaliaika)) */ 
Oskari.clazz.define("Oskari.mapframework.oskari.ui.WmtsFacade",function(a,b,c){this.sandbox=a;this.manager=b;this.parts=c;this.additionalComponents=[]},{registerPart:function(a,b){this.parts[a]=b},getSandbox:function(){return this.sandbox},getManager:function(){return this.manager},getParts:function(){return this.parts},addUIComponent:function(b,a,d){this.parts[d].add(a);var c={ident:b,region:d,comp:a};this.additionalComponents[b]=c},showUIComponent:function(b,a,e){var c=this.findUIComponentIndex(b);if(c!=-1){var d=this.additionalComponents[c];this.expandPart(d.region);if("S"===d.region){this.parts[d.region].setActiveTab(d.comp)}else{if(d.comp.expand){d.comp.expand(false)}}}},removeUIComponent:function(a){var b=this.findUIComponentIndex(a);if(b!=-1){var c=this.additionalComponents[b];this.parts[c.region].remove(c.comp);this.additionalComponents.splice(b,1)}},findUIComponentIndex:function(a){var c=-1;for(var b=0;b<this.additionalComponents.length;++b){var d=this.additionalComponents[b];if(d.ident==a){return b}}return -1},appendExtensionModule:function(e,l,a,i,g,k,j){var d=this.sandbox.getLanguage();var c=this.manager.addExtensionModule(e,l,g,k,j);c.bundleInstance=i;if(c.module){if(c.component){c.initialisedComponent=this.getSandbox().register(c.module)}else{c.component=this.getSandbox().register(c.module)}}if(c.component){var n=null;var h=true;if(typeof g=="string"){n=g}var o=this.parts[n];var b=null;if(k&&k[d]){b=k[d].title}var f={title:b,layout:"fit",items:[c.component]};var m=o.add(f);c.host=o;c.cmp=m;c.component=null}for(p in a){this.sandbox.registerForEventByName(e,p)}return c},removeExtensionModule:function(b,a,e,d,c){for(p in e){this.sandbox.unregisterFromEventByName(b,p)}this.sandbox.unregister(b)},collapseDirections:{N:Ext.Component.DIRECTION_TOP,E:Ext.Component.DIRECTION_RIGHT,S:Ext.Component.DIRECTION_BOTTOM,W:Ext.Component.DIRECTION_LEFT},collapsePart:function(a){this.parts.Drawer[a].hide()},expandPart:function(a){this.parts.Drawer[a].show()}},{protocol:["Oskari.mapframework.ui.manager.Facade"]});Oskari.clazz.define("Oskari.mapframework.bundle.WmtsBundleInstance",function(){this.map=null;this.mapster=null;this.mapmodule=null;this.ui=null;this._uimodules=[];this._uimodulesByName={}},{addExtensionModule:function(c,b,d,f,a){var e={module:c,identifier:b,region:d,loc:f,component:a};this._uimodules.push(e);this._uimodulesByName[b]=e;return e},createModulesAndUi:function(l){var m=true;var k=true;var c=true;var e=true;var h=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",m,k,c,e);h.setOpts({createMap:true,createMapSketchLayer:false,createMapMarkersLayer:false,createMapVectorLayer:false,createMapMoveHandlers:true,addMapControls:true,registerVectorFormats:false,createMapPanel:true,createTilesGrid:false,WfsLayerPlugin:false,GetInfoPlugin:true});h.createMap=function(){var n=this._sandbox;var o=new OpenLayers.LonLat(n.getMap().getX(),n.getMap().getY());this._map=new OpenLayers.Map({projection:this._projectionCode,center:o,zoom:n.getMap().getZoom(),units:"m",controls:[new OpenLayers.Control()],resolutions:[2000,1000,500,200,100,50,20,10,4,2,1,0.5,0.25],maxExtent:new OpenLayers.Bounds(-548576,6291456,1548576,8388608),theme:null});return this._map};this.mapmodule=h;var b=l.register(h);this.map=b;var d=Ext.createWidget("nlsfimappanel",{olmap:b,layout:"absolute",flex:1});var g=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapControlsModule");var j=l.register(g);d.add(j);var f=Ext.create("Ext.panel.Panel",{layout:"fit",title:"Map",items:[d]});var a=Ext.create("Ext.panel.Panel",{region:"center",layout:"accordion",layoutConfig:{titleCollapse:false,animate:true,activeOnTop:true},defaults:{bodyStyle:"padding:15px;background-color: #bbeeff;"},items:[f,{title:"Another Panel",html:"Sample content"}],title:"Ext Window"});var i=Ext.create("Ext.window.Window",{style:{padding:"8px",overflow:"hidden"},layout:"fit",items:[a],width:1024,height:768,title:"ExtJS4 Window"});this.ui=i;this._facade=Oskari.clazz.create("Oskari.mapframework.oskari.ui.WmtsFacade",l,this,{Drawer:{},Center:a,E:a,W:a,NW:a});Oskari.$("UI.facade",this._facade)
},start:function(){var s=this;if(s.started){return}s.started=true;var r=Oskari.clazz.create("Oskari.mapframework.core.Core");this.core=r;var d=r.getSandbox();var j=Oskari.clazz.create("Oskari.mapframework.wmts.NlsFiLayerConfig");this.layers=j;var k=j.create();var h=k;Oskari.$("startup",k);var c="fi";var l=Oskari.clazz.create("Oskari.mapframework.service.MapLayerService",null,d);var a=[];a.push(Oskari.clazz.create("Oskari.mapframework.service.LanguageService",c));a.push(l);l.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var n=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");l.registerLayerModelBuilder("wmtslayer",n);var b=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",l);this.wmtsService=b;var g=[];var q=s;r.init(q,a,g,k.layers,c,null,false);this.ui.show();var e=d.findRegisteredModuleInstance("MainMapModule");var o=Oskari.clazz.create("Oskari.mapframework.wmts.mapmodule.plugin.WmtsLayerPlugin");e.registerPlugin(o);e.startPlugin(o);var m=this.mediator.manager;var i=m.stateForBundleDefinitions.wmts.bundlePath;var f=i+"/geowebcache-wmts-zoom-no-zoom.xml";b.readWMTSCapabilites("jkorhonen",f,"EPSG_3067_PTI");r.processRequest(r.getRequestBuilder("MapMoveRequest")(545108,6863352,5,false))},update:function(){},stop:function(){alert("Stopped!")}},{protocol:["Oskari.bundle.BundleInstance"]});