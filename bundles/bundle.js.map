{"version":3,"sources":["../libraries/requirejs/require-2.2.0.min.js","../libraries/requirejs/text-plugin-2.0.14.js","../libraries/mobile-detect/mobile-detect-1.3.2.js","../libraries/dompurify/purify_0.8.0.min.js","../src/polyfills.js","../src/oskari.js","../src/counter.js","../src/logger.js","../src/store.js","../src/events.js","../src/util.js","../src/i18n.js","../src/message_types.js","../src/O2ClassSystem.js","../src/bundle_manager.js","../src/user.js","../src/sandbox_factory.js","../src/sandbox/sandbox.js","../src/sandbox/sandbox-state-methods.js","../src/sandbox/sandbox-map-layer-methods.js","../src/sandbox/sandbox-map-methods.js","../src/sandbox/sandbox-abstraction-methods.js","../src/loader.js","../src/oskari.app.js","../src/deprecated/module_spec.js","../src/deprecated/builder_api.js","../src/deprecated/deprecated.core.js","../src/deprecated/deprecated.sandbox.js"],"names":["requirejs","require","define","ga","ka","b","c","d","g","K","Q","call","L","y","length","X","x","la","e","D","Y","RegExp","z","apply","arguments","ha","ia","split","F","Error","requireType","requireModules","originalError","ma","a","n","h","k","f","l","r","q","p","map","m","nodeIdCompat","U","test","replace","charAt","slice","concat","splice","join","pkgs","E","document","getElementsByTagName","getAttribute","contextName","parentNode","removeChild","paths","shift","undef","makeRequire","skipMap","indexOf","substring","name","v","normalize","nameToUrl","T","prefix","parentMap","unnormalized","url","originalName","isDefine","id","u","t","Module","w","defineEmitComplete","error","on","A","events","emit","onError","B","V","defQueueMap","G","push","C","Z","J","depMaps","depMatched","defineDep","check","H","waitSeconds","startTime","Date","getTime","aa","enabled","inited","fetched","ja","ba","setTimeout","I","init","O","currentTarget","srcElement","onScriptLoad","detachEvent","ca","removeEventListener","onScriptError","node","P","da","R","baseUrl","bundles","shim","config","ea","W","fa","exports","usingExports","module","uri","this","depExports","pluginMaps","depCount","prototype","factory","errback","ignore","enable","fetch","callPlugin","load","enableBuildCallback","deps","enabling","defining","defined","execCb","requireMap","onResourceLoad","normalizedMap","defineEmitted","M","fromText","S","exec","completeLoad","undefed","registry","urlFetched","defQueue","makeModuleMap","nextTick","configure","urlArgs","exportsFn","makeShimExports","packages","location","main","na","callback","__requireJsBuild","get","isBrowser","toUrl","lastIndexOf","specified","enforceDefine","jsExtRegExp","match","type","oa","readyState","N","pa","qa","ra","Object","toString","hasOwnProperty","window","navigator","importScripts","platform","opera","context","s","newContext","version","contexts","_","head","createNode","xhtml","createElementNS","createElement","scriptType","charset","async","setAttribute","attachEvent","addEventListener","src","onNodeCreated","insertBefore","appendChild","skipDataMain","pop","amd","jQuery","eval","text","fs","Cc","Ci","xpcIsWindows","progIds","xmlRegExp","bodyRegExp","hasLocation","href","defaultProtocol","protocol","defaultHostName","hostname","defaultPort","port","undefined","buildMap","masterConfig","strip","content","matches","jsEscape","createXhr","xhr","i","progId","XMLHttpRequest","ActiveXObject","parseName","modName","ext","temp","index","isRelative","moduleName","xdRegExp","useXhr","uProtocol","uHostName","uPort","toLowerCase","finishLoad","onLoad","isBuild","req","inlineText","parsed","nonStripName","err","write","pluginName","asModule","writeFile","extPart","fileName","value","textWrite","contents","env","process","versions","nodeRequire","file","readFileSync","headers","header","open","setRequestHeader","onXhr","onreadystatechange","evt","status","responseText","onXhrComplete","send","Packages","java","stringBuffer","line","encoding","io","File","lineSeparator","lang","System","getProperty","input","BufferedReader","InputStreamReader","FileInputStream","StringBuffer","readLine","append","String","close","Components","classes","interfaces","utils","inStream","convertStream","fileObj","readData","FileUtils","createInstance","nsIFileInputStream","nsIConverterInputStream","available","DEFAULT_REPLACEMENT_CHARACTER","readString","path","equalIC","containsIC","array","valueLC","len","convertPropsToRegExp","object","key","hasOwnProp","MobileDetect","userAgent","maxPhoneWidth","ua","_cache","impl","mobileDetectRules","phones","iPhone","BlackBerry","HTC","Nexus","Dell","Motorola","Samsung","LG","Sony","Asus","Micromax","Palm","Vertu","Pantech","Fly","Wiko","iMobile","SimValley","Wolfgang","Alcatel","Nintendo","Amoi","INQ","GenericPhone","tablets","iPad","NexusTablet","SamsungTablet","Kindle","SurfaceTablet","HPTablet","AsusTablet","BlackBerryTablet","HTCtablet","MotorolaTablet","NookTablet","AcerTablet","ToshibaTablet","LGTablet","FujitsuTablet","PrestigioTablet","LenovoTablet","DellTablet","YarvikTablet","MedionTablet","ArnovaTablet","IntensoTablet","IRUTablet","MegafonTablet","EbodaTablet","AllViewTablet","ArchosTablet","AinolTablet","SonyTablet","PhilipsTablet","CubeTablet","CobyTablet","MIDTablet","MSITablet","SMiTTablet","RockChipTablet","FlyTablet","bqTablet","HuaweiTablet","NecTablet","PantechTablet","BronchoTablet","VersusTablet","ZyncTablet","PositivoTablet","NabiTablet","KoboTablet","DanewTablet","TexetTablet","PlaystationTablet","TrekstorTablet","PyleAudioTablet","AdvanTablet","DanyTechTablet","GalapadTablet","MicromaxTablet","KarbonnTablet","AllFineTablet","PROSCANTablet","YONESTablet","ChangJiaTablet","GUTablet","PointOfViewTablet","OvermaxTablet","HCLTablet","DPSTablet","VistureTablet","CrestaTablet","MediatekTablet","ConcordeTablet","GoCleverTablet","ModecomTablet","VoninoTablet","ECSTablet","StorexTablet","VodafoneTablet","EssentielBTablet","RossMoorTablet","iMobileTablet","TolinoTablet","AudioSonicTablet","AMPETablet","SkkTablet","TecnoTablet","JXDTablet","iJoyTablet","FX2Tablet","XoroTablet","ViewsonicTablet","OdysTablet","CaptivaTablet","IconbitTablet","TeclastTablet","OndaTablet","JaytechTablet","BlaupunktTablet","DigmaTablet","EvolioTablet","LavaTablet","AocTablet","MpmanTablet","CelkonTablet","WolderTablet","MiTablet","NibiruTablet","NexoTablet","LeaderTablet","UbislateTablet","PocketBookTablet","Hudl","TelstraTablet","GenericTablet","oss","AndroidOS","BlackBerryOS","PalmOS","SymbianOS","WindowsMobileOS","WindowsPhoneOS","iOS","MeeGoOS","MaemoOS","JavaOS","webOS","badaOS","BREWOS","uas","Chrome","Dolfin","Opera","Skyfire","IE","Firefox","Bolt","TeaShark","Blazer","Safari","Tizen","UCBrowser","baiduboxapp","baidubrowser","DiigoBrowser","Puffin","Mercury","ObigoBrowser","NetFront","GenericBrowser","props","Mobile","Build","Version","VendorID","iPod","Coast","Fennec","NokiaBrowser","Opera Mini","Opera Mobi","UC Browser","MQQBrowser","MicroMessenger","Iron","Webkit","Gecko","Trident","Presto","Android","BREW","Java","Windows Phone OS","Windows Phone","Windows CE","Windows NT","Symbian","Bot","MobileBot","DesktopMode","TV","WebKit","Console","Watch","detectMobileBrowsers","fullPattern","shortPattern","tabletPattern","isArray","FALLBACK_PHONE","FALLBACK_TABLET","FALLBACK_MOBILE","Array","values","verPos","oss0","findMatch","rules","findMatches","result","getVersionStr","propertyName","patterns","getVersion","prepareVersionNo","NaN","numbers","Number","isMobileFallback","substr","isTabletFallback","prepareDetectionCache","cache","mobile","phone","tablet","phoneSized","isPhoneSized","mobileGrade","$isMobile","os","is","detectOS","getDeviceSmallerSide","screen","width","height","constructor","userAgents","versionStr","pattern","grade","_impl","DOMPurify","removed","nodeType","isSupported","DocumentFragment","o","HTMLTemplateElement","NodeFilter","NamedNodeMap","MozNamedAttrMap","Text","Comment","DOMParser","ownerDocument","implementation","createNodeIterator","createDocumentFragment","importNode","createHTMLDocument","documentMode","j","ALLOWED_TAGS","ALLOWED_ATTR","FORBID_TAGS","FORBID_ATTR","ALLOW_DATA_ATTR","ALLOW_UNKNOWN_PROTOCOLS","SAFE_FOR_JQUERY","SAFE_FOR_TEMPLATES","WHOLE_DOCUMENT","RETURN_DOM","RETURN_DOM_FRAGMENT","RETURN_DOM_IMPORT","SANITIZE_DOM","KEEP_CONTENT","ADD_TAGS","ADD_ATTR","freeze","element","outerHTML","attribute","getAttributeNode","from","removeAttribute","parseFromString","documentElement","body","firstElementChild","SHOW_ELEMENT","SHOW_COMMENT","SHOW_TEXT","FILTER_ACCEPT","nodeName","textContent","attributes","ne","tagName","insertAdjacentHTML","innerHTML","$","ee","te","attrName","attrValue","keepAttr","re","nextNode","forEach","sanitize","TypeError","toStaticHTML","firstChild","addHook","removeHook","removeHooks","removeAllHooks","endsWith","searchString","position","subjectString","isFinite","Math","floor","lastIndex","fn","arg","ret","each","el","fnRet","pass","inOrOut","wrap","parent","isFunction","children","unwrap","html","Oskari","isDebug","_markers","VERSION","setDebugMode","setMarkers","markers","getMarkers","getDefaultMarker","serials","count","seq","nextVal","hasConsole","console","inclTimestamp","_logMsg","args","level","_unshift","addToFirst","list","unshift","ts","date","toLocaleTimeString","getUTCMilliseconds","_doLogging","logName","logLevel","logMessages","includeCaller","callee","newArgs","caller","Logger","enableDebug","inclCaller","setInclCaller","bln","debug","info","warn","loggers","log","noop","setterGetter","collection","defaultValue","validator","currentValue","prop","Storage","methodName","options","_collection","_me","reset","createStore","EventBus","store","event","handlerFn","subscribers","off","currentSubs","success","trigger","data","sub","makeObservable","target","bus","util","isLeadingZero","isDecimal","isNumber","keepLeadingZero","reg","val","isNaN","decimals","maxDecimals","hexToRgb","hex","shorthandRegex","parseInt","rgbToHex","rgb","parts","keyExists","obj","keypath","tmpObj","cnt","splits","naturalSort","valueA","valueB","descending","oFxNcL","oFyNcL","sre","snre","dre","hre","ore","xN","yN","xD","parse","yD","normChunk","parseFloat","sortFunc","retValue","sortCompleted","cLoc","xNl","yNl","numS","max","getColorBrightness","color","brightness","isDarkColor","isLightColor","isMobile","md","mobileDefs","size","isSizeMobile","validCoordinates","point","coordChars","CHAR_DEG","CHAR_MIN","CHAR_SEC","CHAR_SEP","coordinateDMSDecode","getDecimalSeparator","DDMMSS.s","DDMM.mmm 1","DDMM.mmm 2","DD.ddddd","coordinateMetricToDegrees","roundToDecimals","dms1","p1","d1","m1","s1","toFixed","dms2","p2","d2","m2","s2","coordinateDegreesToMetric","dd1","matches1","dd2","matches2","coordinateIsDegrees","getRequestParam","query","search","part","item","decodeURIComponent","isNumberBetween","num","start","stop","arrayMove","to","abs","inc","current","oskariLang","localizations","supportedLocales","setSupportedLocales","locales","getSupportedLocales","setLang","getLang","getSupportedLanguages","locale","langs","supported","getDefaultLanguage","setLocalization","getLocalization","fallbackToDefault","defaultLang","registerLocalization","override","pp","loc","extend","decimalSeparator","setDecimalSeparator","separator","getLocalized","getClazzByNameAndType","typeNames","clazzes","allKnownClassesOfType","clazz","clazzName","clazzDefinition","requestName","_class","getName","requestBuilder","qname","getSandbox","hasHandler","builder","eventBuilder","O2ClassSystem","protocols","inheritance","aspects","classcache","globals","purge","protocolName","_getPackageDefinition","packageName","packageDefinition","_getClassQName","className","basePkg","pkg","sp","_getClassInfo","classInfo","classQName","_cloneProperties","propertyValue","toArray","_createEmptyClassDefinition","getMetadata","_metadata","_updateMetadata","classMeta","pt","meta","_super","supCat","supMet","me","_superCategory","classConstructor","metadata","classDefinition","composition","extnds","superClass","subClass","_constructor","_category","_composition","lookup","_pullDown","_pushDown","category","categoryName","prot","subClassName","superClassName","subName","pdefsub","classHierarchy","classMethods","classPrototype","superClassInfo","_constructors","_slicer","create","classInstance","constructors","instanceArguments","returned","createWithClassInfo","getBuilderFromClassInfo","_builder","_global","class_singleton","cs","Bundle_manager","serial","bundleDefinitions","sources","bundleInstances","bundleDefinitionStates","bundleSourceStates","bundleStates","loaderStateListeners","_getSerial","_purge","loader","_install","biid","bundleDefinition","srcFiles","bundleMetadata","defState","state","installBundleClass","bundle","installBundleClassInfo","sourceFiles","createBundle","bid","bundleDefinitionState","bundlImpl","alert","bundleInstance","bundleInstanceId","_destroyInstance","bundle_manager","userData","_loggedIn","_roles","_firstName","firstName","_lastName","lastName","_nickName","nickName","_email","email","loginName","_uuid","userUUID","roles","_apiKey","apikey","getFirstName","getLastName","getNickName","getLoginName","getEmail","getUuid","getAPIkey","isLoggedIn","getRoles","hasRole","idList","found","userRoles","role","defaultName","sandboxStore","sandboxName","sb","user","ajaxUrl","services","requestHandlers","isDebugMode","postFix","_map","handleMapLinkParams","_listeners","_modules","_modulesByName","_statefuls","requestEventLog","requestEventStack","maxGatheredRequestsAndEvents","requestAndEventGather","_eventLoopGuard","getLog","setDebug","setUser","getUser","setAjaxUrl","pUrl","getAjaxUrl","route","registerService","service","getQName","getService","registerAsStateful","pBundleId","pInstance","unregisterStateful","getStatefulComponents","register","unregister","remainingModules","registerForEventByName","eventName","oldListeners","unregisterFromEventByName","deleteIndex","request","creator","creatorComponent","creatorName","rv","findRegisteredModuleInstance","_creator","_pushRequestAndEventGather","_debugPushRequest","processRequest","_debugPopRequest","handlerClsInstance","requestHandler","handleRequest","requestByName","requestArgs","postMasterComponent","postRequestByName","_findModulesInterestedIn","currentListeners","notifyAll","retainEvent","modules","_debugPushEvent","onEvent","_debugPopEvent","getBrowserWindowSize","handler","reqLog","reqName","evtLog","evtName","popUpSeqDiagram","openedWindow","seq_html","seq_commands","getLocalizedProperty","property","language","createURL","prepQueryString","__constructUrl","__prepareQueryString","serverUrl","host","pathname","lastChar","getCurrentState","bundleid","components","getState","resetState","useState","app","getConfiguration","initialConf","bundleState","newStateConfig","setState","setSessionExpiring","minutes","milliSeconds","extendSession","errorCallback","currentUuid","successCallback","res","textStatus","jqXHR","resUuid","getResponseHeader","ajax","findMapLayerFromAllAvailable","findMapLayer","findAllSelectedMapLayers","layersList","getMap","getLayers","findAllHighlightedLayers","getActivatedLayers","findMapLayerFromSelectedMapLayers","layerId","getSelectedLayer","isLayerAlreadySelected","isLayerSelected","isMapLayerHighLighted","isLayerActivated","allowMultipleHighlightLayers","allow","allowMultipleActivatedLayers","removeMapLayer","removeLayer","syncMapState","blnInitialMove","mapModule","mapDomain","zoom","getZoom","maxZoom","getMaxZoomLevel","getX","getY","generateMapLinkParameters","iterator","component","optionsLinkParameterArray","componentLinkParameterArray","getStateParameters","params","showMarker","forceCache","noSavedState","domSelector","failure","complete","userIsLoggedIn","failureWrapper","beforeSend","overrideMimeType","getDefer","defer","_bundleRegistry","bundleId","linkFile","rel","importParentElement","linkElement","absolute","base","relative","stack","getPath","startupSequence","sequence","appConfig","globalExpose","errors","details","processSequence","done","seqToLoad","bundleToStart","bundlename","configId","bundleinstancename","bundlesToBeLoaded","bundlePath","basepath","startBundle","processBundleJS","instanceId","instance","mediator","loading","source","handleBundleLoad","basePath","files","expose","resources","scripts","links","ajaxSetup","Bundle_facade","appSetup","getBundleInstanceConfigurationByName","playBundle","recData","configName","tmp","loadAppSetup","errorCB","successCB","modifyCB","dataType","setup","setApplicationSetup","startApplication","configuration","setConfiguration","svgMarkers","getApplicationSetup","stopApplication","methods","orgmodspec","eventHandlers","requests","onRequest","_baseClassFor","extension","tile","flyout","view","cls","proto","metas","eventCls","requestCls","extensionCls","bundleCls","update","manifest","Bundle-Identifier","bm","___bundleIdentifier","properties","configProps","ip","flyoutCls","tileCls","viewCls","domMgr","warnMessagesSent","mode","dollarStore","_ctrlKeyDown","funcs","setLoaderMode","getLoaderMode","setPreloaded","getDomManager","setDomManager","dm","setSandbox","sandbox","ctrlKeyDown","isDown","attachWarning","extraInfo","addRequestHandler","removeRequestHandler","isCtrlKeyDown","getEventBuilder","getRequestBuilder","printDebug","printWarn","printError","coord","zoomLevel","splittedCoord","longitude","latitude","moveTo","handlerInstance"],"mappings":"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","file":"bundle.js.map","sourcesContent":["/*\r\n RequireJS 2.2.0 Copyright jQuery Foundation and other contributors.\r\n Released under MIT license, http://github.com/requirejs/requirejs/LICENSE\r\n*/\r\nvar requirejs,require,define;\r\n(function(ga){function ka(b,c,d,g){return g||\"\"}function K(b){return\"[object Function]\"===Q.call(b)}function L(b){return\"[object Array]\"===Q.call(b)}function y(b,c){if(b){var d;for(d=0;d<b.length&&(!b[d]||!c(b[d],d,b));d+=1);}}function X(b,c){if(b){var d;for(d=b.length-1;-1<d&&(!b[d]||!c(b[d],d,b));--d);}}function x(b,c){return la.call(b,c)}function e(b,c){return x(b,c)&&b[c]}function D(b,c){for(var d in b)if(x(b,d)&&c(b[d],d))break}function Y(b,c,d,g){c&&D(c,function(c,e){if(d||!x(b,e))!g||\"object\"!==\r\ntypeof c||!c||L(c)||K(c)||c instanceof RegExp?b[e]=c:(b[e]||(b[e]={}),Y(b[e],c,d,g))});return b}function z(b,c){return function(){return c.apply(b,arguments)}}function ha(b){throw b;}function ia(b){if(!b)return b;var c=ga;y(b.split(\".\"),function(b){c=c[b]});return c}function F(b,c,d,g){c=Error(c+\"\\nhttp://requirejs.org/docs/errors.html#\"+b);c.requireType=b;c.requireModules=g;d&&(c.originalError=d);return c}function ma(b){function c(a,n,b){var h,k,f,c,d,l,g,r;n=n&&n.split(\"/\");var q=p.map,m=q&&q[\"*\"];\r\nif(a){a=a.split(\"/\");k=a.length-1;p.nodeIdCompat&&U.test(a[k])&&(a[k]=a[k].replace(U,\"\"));\".\"===a[0].charAt(0)&&n&&(k=n.slice(0,n.length-1),a=k.concat(a));k=a;for(f=0;f<k.length;f++)c=k[f],\".\"===c?(k.splice(f,1),--f):\"..\"===c&&0!==f&&(1!==f||\"..\"!==k[2])&&\"..\"!==k[f-1]&&0<f&&(k.splice(f-1,2),f-=2);a=a.join(\"/\")}if(b&&q&&(n||m)){k=a.split(\"/\");f=k.length;a:for(;0<f;--f){d=k.slice(0,f).join(\"/\");if(n)for(c=n.length;0<c;--c)if(b=e(q,n.slice(0,c).join(\"/\")))if(b=e(b,d)){h=b;l=f;break a}!g&&m&&e(m,d)&&\r\n(g=e(m,d),r=f)}!h&&g&&(h=g,l=r);h&&(k.splice(0,l,h),a=k.join(\"/\"))}return(h=e(p.pkgs,a))?h:a}function d(a){E&&y(document.getElementsByTagName(\"script\"),function(n){if(n.getAttribute(\"data-requiremodule\")===a&&n.getAttribute(\"data-requirecontext\")===l.contextName)return n.parentNode.removeChild(n),!0})}function m(a){var n=e(p.paths,a);if(n&&L(n)&&1<n.length)return n.shift(),l.require.undef(a),l.makeRequire(null,{skipMap:!0})([a]),!0}function r(a){var n,b=a?a.indexOf(\"!\"):-1;-1<b&&(n=a.substring(0,\r\nb),a=a.substring(b+1,a.length));return[n,a]}function q(a,n,b,h){var k,f,d=null,g=n?n.name:null,p=a,q=!0,m=\"\";a||(q=!1,a=\"_@r\"+(Q+=1));a=r(a);d=a[0];a=a[1];d&&(d=c(d,g,h),f=e(v,d));a&&(d?m=f&&f.normalize?f.normalize(a,function(a){return c(a,g,h)}):-1===a.indexOf(\"!\")?c(a,g,h):a:(m=c(a,g,h),a=r(m),d=a[0],m=a[1],b=!0,k=l.nameToUrl(m)));b=!d||f||b?\"\":\"_unnormalized\"+(T+=1);return{prefix:d,name:m,parentMap:n,unnormalized:!!b,url:k,originalName:p,isDefine:q,id:(d?d+\"!\"+m:m)+b}}function u(a){var b=a.id,\r\nc=e(t,b);c||(c=t[b]=new l.Module(a));return c}function w(a,b,c){var h=a.id,k=e(t,h);if(!x(v,h)||k&&!k.defineEmitComplete)if(k=u(a),k.error&&\"error\"===b)c(k.error);else k.on(b,c);else\"defined\"===b&&c(v[h])}function A(a,b){var c=a.requireModules,h=!1;if(b)b(a);else if(y(c,function(b){if(b=e(t,b))b.error=a,b.events.error&&(h=!0,b.emit(\"error\",a))}),!h)g.onError(a)}function B(){V.length&&(y(V,function(a){var b=a[0];\"string\"===typeof b&&(l.defQueueMap[b]=!0);G.push(a)}),V=[])}function C(a){delete t[a];\r\ndelete Z[a]}function J(a,b,c){var h=a.map.id;a.error?a.emit(\"error\",a.error):(b[h]=!0,y(a.depMaps,function(h,f){var d=h.id,g=e(t,d);!g||a.depMatched[f]||c[d]||(e(b,d)?(a.defineDep(f,v[d]),a.check()):J(g,b,c))}),c[h]=!0)}function H(){var a,b,c=(a=1E3*p.waitSeconds)&&l.startTime+a<(new Date).getTime(),h=[],k=[],f=!1,g=!0;if(!aa){aa=!0;D(Z,function(a){var l=a.map,e=l.id;if(a.enabled&&(l.isDefine||k.push(a),!a.error))if(!a.inited&&c)m(e)?f=b=!0:(h.push(e),d(e));else if(!a.inited&&a.fetched&&l.isDefine&&\r\n(f=!0,!l.prefix))return g=!1});if(c&&h.length)return a=F(\"timeout\",\"Load timeout for modules: \"+h,null,h),a.contextName=l.contextName,A(a);g&&y(k,function(a){J(a,{},{})});c&&!b||!f||!E&&!ja||ba||(ba=setTimeout(function(){ba=0;H()},50));aa=!1}}function I(a){x(v,a[0])||u(q(a[0],null,!0)).init(a[1],a[2])}function O(a){a=a.currentTarget||a.srcElement;var b=l.onScriptLoad;a.detachEvent&&!ca?a.detachEvent(\"onreadystatechange\",b):a.removeEventListener(\"load\",b,!1);b=l.onScriptError;a.detachEvent&&!ca||a.removeEventListener(\"error\",\r\nb,!1);return{node:a,id:a&&a.getAttribute(\"data-requiremodule\")}}function P(){var a;for(B();G.length;){a=G.shift();if(null===a[0])return A(F(\"mismatch\",\"Mismatched anonymous define() module: \"+a[a.length-1]));I(a)}l.defQueueMap={}}var aa,da,l,R,ba,p={waitSeconds:7,baseUrl:\"./\",paths:{},bundles:{},pkgs:{},shim:{},config:{}},t={},Z={},ea={},G=[],v={},W={},fa={},Q=1,T=1;R={require:function(a){return a.require?a.require:a.require=l.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?\r\nv[a.map.id]=a.exports:a.exports=v[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return e(p.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}};da=function(a){this.events=e(ea,a.id)||{};this.map=a;this.shim=e(p.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};da.prototype={init:function(a,b,c,h){h=h||{};if(!this.inited){this.factory=b;if(c)this.on(\"error\",c);else this.events.error&&\r\n(c=z(this,function(a){this.emit(\"error\",a)}));this.depMaps=a&&a.slice(0);this.errback=c;this.inited=!0;this.ignore=h.ignore;h.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,--this.depCount,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;l.startTime=(new Date).getTime();var a=this.map;if(this.shim)l.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],z(this,function(){return a.prefix?this.callPlugin():\r\nthis.load()}));else return a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;W[a]||(W[a]=!0,l.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id;b=this.depExports;var h=this.exports,k=this.factory;if(!this.inited)x(l.defQueueMap,c)||this.fetch();else if(this.error)this.emit(\"error\",this.error);else if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(K(k)){if(this.events.error&&this.map.isDefine||g.onError!==\r\nha)try{h=l.execCb(c,k,b,h)}catch(d){a=d}else h=l.execCb(c,k,b,h);this.map.isDefine&&void 0===h&&((b=this.module)?h=b.exports:this.usingExports&&(h=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?\"define\":\"require\",A(this.error=a)}else h=k;this.exports=h;if(this.map.isDefine&&!this.ignore&&(v[c]=h,g.onResourceLoad)){var f=[];y(this.depMaps,function(a){f.push(a.normalizedMap||a)});g.onResourceLoad(l,this.map,f)}C(c);\r\nthis.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit(\"defined\",this.exports),this.defineEmitComplete=!0)}}},callPlugin:function(){var a=this.map,b=a.id,d=q(a.prefix);this.depMaps.push(d);w(d,\"defined\",z(this,function(h){var k,f,d=e(fa,this.map.id),M=this.map.name,r=this.map.parentMap?this.map.parentMap.name:null,m=l.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(h.normalize&&(M=h.normalize(M,function(a){return c(a,r,!0)})||\r\n\"\"),f=q(a.prefix+\"!\"+M,this.map.parentMap),w(f,\"defined\",z(this,function(a){this.map.normalizedMap=f;this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),h=e(t,f.id)){this.depMaps.push(f);if(this.events.error)h.on(\"error\",z(this,function(a){this.emit(\"error\",a)}));h.enable()}}else d?(this.map.url=l.nameToUrl(d),this.load()):(k=z(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),k.error=z(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];D(t,function(a){0===\r\na.map.id.indexOf(b+\"_unnormalized\")&&C(a.map.id)});A(a)}),k.fromText=z(this,function(h,c){var d=a.name,f=q(d),M=S;c&&(h=c);M&&(S=!1);u(f);x(p.config,b)&&(p.config[d]=p.config[b]);try{g.exec(h)}catch(e){return A(F(\"fromtexteval\",\"fromText eval for \"+b+\" failed: \"+e,e,[b]))}M&&(S=!0);this.depMaps.push(f);l.completeLoad(d);m([d],k)}),h.load(a.name,m,k,p))}));l.enable(d,this);this.pluginMaps[d.id]=d},enable:function(){Z[this.map.id]=this;this.enabling=this.enabled=!0;y(this.depMaps,z(this,function(a,\r\nb){var c,h;if(\"string\"===typeof a){a=q(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=e(R,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;w(a,\"defined\",z(this,function(a){this.undefed||(this.defineDep(b,a),this.check())}));this.errback?w(a,\"error\",z(this,this.errback)):this.events.error&&w(a,\"error\",z(this,function(a){this.emit(\"error\",a)}))}c=a.id;h=t[c];x(R,c)||!h||h.enabled||l.enable(a,this)}));D(this.pluginMaps,z(this,function(a){var b=e(t,a.id);\r\nb&&!b.enabled&&l.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){y(this.events[a],function(a){a(b)});\"error\"===a&&delete this.events[a]}};l={config:p,contextName:b,registry:t,defined:v,urlFetched:W,defQueue:G,defQueueMap:{},Module:da,makeModuleMap:q,nextTick:g.nextTick,onError:A,configure:function(a){a.baseUrl&&\"/\"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+=\"/\");if(\"string\"===typeof a.urlArgs){var b=\r\na.urlArgs;a.urlArgs=function(a,c){return(-1===c.indexOf(\"?\")?\"?\":\"&\")+b}}var c=p.shim,h={paths:!0,bundles:!0,config:!0,map:!0};D(a,function(a,b){h[b]?(p[b]||(p[b]={}),Y(p[b],a,!0,!0)):p[b]=a});a.bundles&&D(a.bundles,function(a,b){y(a,function(a){a!==b&&(fa[a]=b)})});a.shim&&(D(a.shim,function(a,b){L(a)&&(a={deps:a});!a.exports&&!a.init||a.exportsFn||(a.exportsFn=l.makeShimExports(a));c[b]=a}),p.shim=c);a.packages&&y(a.packages,function(a){var b;a=\"string\"===typeof a?{name:a}:a;b=a.name;a.location&&\r\n(p.paths[b]=a.location);p.pkgs[b]=a.name+\"/\"+(a.main||\"main\").replace(na,\"\").replace(U,\"\")});D(t,function(a,b){a.inited||a.map.unnormalized||(a.map=q(b,null,!0))});(a.deps||a.callback)&&l.require(a.deps||[],a.callback)},makeShimExports:function(a){return function(){var b;a.init&&(b=a.init.apply(ga,arguments));return b||a.exports&&ia(a.exports)}},makeRequire:function(a,n){function m(c,d,f){var e,r;n.enableBuildCallback&&d&&K(d)&&(d.__requireJsBuild=!0);if(\"string\"===typeof c){if(K(d))return A(F(\"requireargs\",\r\n\"Invalid require call\"),f);if(a&&x(R,c))return R[c](t[a.id]);if(g.get)return g.get(l,c,a,m);e=q(c,a,!1,!0);e=e.id;return x(v,e)?v[e]:A(F(\"notloaded\",'Module name \"'+e+'\" has not been loaded yet for context: '+b+(a?\"\":\". Use require([])\")))}P();l.nextTick(function(){P();r=u(q(null,a));r.skipMap=n.skipMap;r.init(c,d,f,{enabled:!0});H()});return m}n=n||{};Y(m,{isBrowser:E,toUrl:function(b){var d,f=b.lastIndexOf(\".\"),g=b.split(\"/\")[0];-1!==f&&(\".\"!==g&&\"..\"!==g||1<f)&&(d=b.substring(f,b.length),b=b.substring(0,\r\nf));return l.nameToUrl(c(b,a&&a.id,!0),d,!0)},defined:function(b){return x(v,q(b,a,!1,!0).id)},specified:function(b){b=q(b,a,!1,!0).id;return x(v,b)||x(t,b)}});a||(m.undef=function(b){B();var c=q(b,a,!0),f=e(t,b);f.undefed=!0;d(b);delete v[b];delete W[c.url];delete ea[b];X(G,function(a,c){a[0]===b&&G.splice(c,1)});delete l.defQueueMap[b];f&&(f.events.defined&&(ea[b]=f.events),C(b))});return m},enable:function(a){e(t,a.id)&&u(a).enable()},completeLoad:function(a){var b,c,d=e(p.shim,a)||{},g=d.exports;\r\nfor(B();G.length;){c=G.shift();if(null===c[0]){c[0]=a;if(b)break;b=!0}else c[0]===a&&(b=!0);I(c)}l.defQueueMap={};c=e(t,a);if(!b&&!x(v,a)&&c&&!c.inited)if(!p.enforceDefine||g&&ia(g))I([a,d.deps||[],d.exportsFn]);else return m(a)?void 0:A(F(\"nodefine\",\"No define call for \"+a,null,[a]));H()},nameToUrl:function(a,b,c){var d,k,f,m;(d=e(p.pkgs,a))&&(a=d);if(d=e(fa,a))return l.nameToUrl(d,b,c);if(g.jsExtRegExp.test(a))d=a+(b||\"\");else{d=p.paths;k=a.split(\"/\");for(f=k.length;0<f;--f)if(m=k.slice(0,f).join(\"/\"),\r\nm=e(d,m)){L(m)&&(m=m[0]);k.splice(0,f,m);break}d=k.join(\"/\");d+=b||(/^data\\:|^blob\\:|\\?/.test(d)||c?\"\":\".js\");d=(\"/\"===d.charAt(0)||d.match(/^[\\w\\+\\.\\-]+:/)?\"\":p.baseUrl)+d}return p.urlArgs&&!/^blob\\:/.test(d)?d+p.urlArgs(a,d):d},load:function(a,b){g.load(l,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if(\"load\"===a.type||oa.test((a.currentTarget||a.srcElement).readyState))N=null,a=O(a),l.completeLoad(a.id)},onScriptError:function(a){var b=O(a);if(!m(b.id)){var c=[];\r\nD(t,function(a,d){0!==d.indexOf(\"_@r\")&&y(a.depMaps,function(a){if(a.id===b.id)return c.push(d),!0})});return A(F(\"scripterror\",'Script error for \"'+b.id+(c.length?'\", needed by: '+c.join(\", \"):'\"'),a,[b.id]))}}};l.require=l.makeRequire();return l}function pa(){if(N&&\"interactive\"===N.readyState)return N;X(document.getElementsByTagName(\"script\"),function(b){if(\"interactive\"===b.readyState)return N=b});return N}var g,B,C,H,O,I,N,P,u,T,qa=/(\\/\\*([\\s\\S]*?)\\*\\/|([^:]|^)\\/\\/(.*)$)/mg,ra=/[^.]\\s*require\\s*\\(\\s*[\"']([^'\"\\s]+)[\"']\\s*\\)/g,\r\nU=/\\.js$/,na=/^\\.\\//;B=Object.prototype;var Q=B.toString,la=B.hasOwnProperty,E=!(\"undefined\"===typeof window||\"undefined\"===typeof navigator||!window.document),ja=!E&&\"undefined\"!==typeof importScripts,oa=E&&\"PLAYSTATION 3\"===navigator.platform?/^complete$/:/^(complete|loaded)$/,ca=\"undefined\"!==typeof opera&&\"[object Opera]\"===opera.toString(),J={},w={},V=[],S=!1;if(\"undefined\"===typeof define){if(\"undefined\"!==typeof requirejs){if(K(requirejs))return;w=requirejs;requirejs=void 0}\"undefined\"===typeof require||\r\nK(require)||(w=require,require=void 0);g=requirejs=function(b,c,d,m){var r,q=\"_\";L(b)||\"string\"===typeof b||(r=b,L(c)?(b=c,c=d,d=m):b=[]);r&&r.context&&(q=r.context);(m=e(J,q))||(m=J[q]=g.s.newContext(q));r&&m.configure(r);return m.require(b,c,d)};g.config=function(b){return g(b)};g.nextTick=\"undefined\"!==typeof setTimeout?function(b){setTimeout(b,4)}:function(b){b()};require||(require=g);g.version=\"2.2.0\";g.jsExtRegExp=/^\\/|:|\\?|\\.js$/;g.isBrowser=E;B=g.s={contexts:J,newContext:ma};g({});y([\"toUrl\",\r\n\"undef\",\"defined\",\"specified\"],function(b){g[b]=function(){var c=J._;return c.require[b].apply(c,arguments)}});E&&(C=B.head=document.getElementsByTagName(\"head\")[0],H=document.getElementsByTagName(\"base\")[0])&&(C=B.head=H.parentNode);g.onError=ha;g.createNode=function(b,c,d){c=b.xhtml?document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"html:script\"):document.createElement(\"script\");c.type=b.scriptType||\"text/javascript\";c.charset=\"utf-8\";c.async=!0;return c};g.load=function(b,c,d){var m=b&&b.config||\r\n{},e;if(E){e=g.createNode(m,c,d);e.setAttribute(\"data-requirecontext\",b.contextName);e.setAttribute(\"data-requiremodule\",c);!e.attachEvent||e.attachEvent.toString&&0>e.attachEvent.toString().indexOf(\"[native code\")||ca?(e.addEventListener(\"load\",b.onScriptLoad,!1),e.addEventListener(\"error\",b.onScriptError,!1)):(S=!0,e.attachEvent(\"onreadystatechange\",b.onScriptLoad));e.src=d;if(m.onNodeCreated)m.onNodeCreated(e,m,c,d);P=e;H?C.insertBefore(e,H):C.appendChild(e);P=null;return e}if(ja)try{setTimeout(function(){},\r\n0),importScripts(d),b.completeLoad(c)}catch(q){b.onError(F(\"importscripts\",\"importScripts failed for \"+c+\" at \"+d,q,[c]))}};E&&!w.skipDataMain&&X(document.getElementsByTagName(\"script\"),function(b){C||(C=b.parentNode);if(O=b.getAttribute(\"data-main\"))return u=O,w.baseUrl||-1!==u.indexOf(\"!\")||(I=u.split(\"/\"),u=I.pop(),T=I.length?I.join(\"/\")+\"/\":\"./\",w.baseUrl=T),u=u.replace(U,\"\"),g.jsExtRegExp.test(u)&&(u=O),w.deps=w.deps?w.deps.concat(u):[u],!0});define=function(b,c,d){var e,g;\"string\"!==typeof b&&\r\n(d=c,c=b,b=null);L(c)||(d=c,c=null);!c&&K(d)&&(c=[],d.length&&(d.toString().replace(qa,ka).replace(ra,function(b,d){c.push(d)}),c=(1===d.length?[\"require\"]:[\"require\",\"exports\",\"module\"]).concat(c)));S&&(e=P||pa())&&(b||(b=e.getAttribute(\"data-requiremodule\")),g=J[e.getAttribute(\"data-requirecontext\")]);g?(g.defQueue.push([b,c,d]),g.defQueueMap[b]=!0):V.push([b,c,d])};define.amd={jQuery:!0};g.exec=function(b){return eval(b)};g(w)}})(this);\r\n","/**\r\n * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.\r\n * Available via the MIT or new BSD license.\r\n * see: http://github.com/requirejs/text for details\r\n */\r\n/*jslint regexp: true */\r\n/*global require, XMLHttpRequest, ActiveXObject,\r\n  define, window, process, Packages,\r\n  java, location, Components, FileUtils */\r\n\r\ndefine('text', ['module'], function (module) {\r\n    'use strict';\r\n\r\n    var text, fs, Cc, Ci, xpcIsWindows,\r\n        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],\r\n        xmlRegExp = /^\\s*<\\?xml(\\s)+version=[\\'\\\"](\\d)*.(\\d)*[\\'\\\"](\\s)*\\?>/im,\r\n        bodyRegExp = /<body[^>]*>\\s*([\\s\\S]+)\\s*<\\/body>/im,\r\n        hasLocation = typeof location !== 'undefined' && location.href,\r\n        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\\:/, ''),\r\n        defaultHostName = hasLocation && location.hostname,\r\n        defaultPort = hasLocation && (location.port || undefined),\r\n        buildMap = {},\r\n        masterConfig = (module.config && module.config()) || {};\r\n\r\n    text = {\r\n        version: '2.0.14',\r\n\r\n        strip: function (content) {\r\n            //Strips <?xml ...?> declarations so that external SVG and XML\r\n            //documents can be added to a document without worry. Also, if the string\r\n            //is an HTML document, only the part inside the body tag is returned.\r\n            if (content) {\r\n                content = content.replace(xmlRegExp, \"\");\r\n                var matches = content.match(bodyRegExp);\r\n                if (matches) {\r\n                    content = matches[1];\r\n                }\r\n            } else {\r\n                content = \"\";\r\n            }\r\n            return content;\r\n        },\r\n\r\n        jsEscape: function (content) {\r\n            return content.replace(/(['\\\\])/g, '\\\\$1')\r\n                .replace(/[\\f]/g, \"\\\\f\")\r\n                .replace(/[\\b]/g, \"\\\\b\")\r\n                .replace(/[\\n]/g, \"\\\\n\")\r\n                .replace(/[\\t]/g, \"\\\\t\")\r\n                .replace(/[\\r]/g, \"\\\\r\")\r\n                .replace(/[\\u2028]/g, \"\\\\u2028\")\r\n                .replace(/[\\u2029]/g, \"\\\\u2029\");\r\n        },\r\n\r\n        createXhr: masterConfig.createXhr || function () {\r\n            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.\r\n            var xhr, i, progId;\r\n            if (typeof XMLHttpRequest !== \"undefined\") {\r\n                return new XMLHttpRequest();\r\n            } else if (typeof ActiveXObject !== \"undefined\") {\r\n                for (i = 0; i < 3; i += 1) {\r\n                    progId = progIds[i];\r\n                    try {\r\n                        xhr = new ActiveXObject(progId);\r\n                    } catch (e) {}\r\n\r\n                    if (xhr) {\r\n                        progIds = [progId];  // so faster next time\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return xhr;\r\n        },\r\n\r\n        /**\r\n         * Parses a resource name into its component parts. Resource names\r\n         * look like: module/name.ext!strip, where the !strip part is\r\n         * optional.\r\n         * @param {String} name the resource name\r\n         * @returns {Object} with properties \"moduleName\", \"ext\" and \"strip\"\r\n         * where strip is a boolean.\r\n         */\r\n        parseName: function (name) {\r\n            var modName, ext, temp,\r\n                strip = false,\r\n                index = name.lastIndexOf(\".\"),\r\n                isRelative = name.indexOf('./') === 0 ||\r\n                             name.indexOf('../') === 0;\r\n\r\n            if (index !== -1 && (!isRelative || index > 1)) {\r\n                modName = name.substring(0, index);\r\n                ext = name.substring(index + 1);\r\n            } else {\r\n                modName = name;\r\n            }\r\n\r\n            temp = ext || modName;\r\n            index = temp.indexOf(\"!\");\r\n            if (index !== -1) {\r\n                //Pull off the strip arg.\r\n                strip = temp.substring(index + 1) === \"strip\";\r\n                temp = temp.substring(0, index);\r\n                if (ext) {\r\n                    ext = temp;\r\n                } else {\r\n                    modName = temp;\r\n                }\r\n            }\r\n\r\n            return {\r\n                moduleName: modName,\r\n                ext: ext,\r\n                strip: strip\r\n            };\r\n        },\r\n\r\n        xdRegExp: /^((\\w+)\\:)?\\/\\/([^\\/\\\\]+)/,\r\n\r\n        /**\r\n         * Is an URL on another domain. Only works for browser use, returns\r\n         * false in non-browser environments. Only used to know if an\r\n         * optimized .js version of a text resource should be loaded\r\n         * instead.\r\n         * @param {String} url\r\n         * @returns Boolean\r\n         */\r\n        useXhr: function (url, protocol, hostname, port) {\r\n            var uProtocol, uHostName, uPort,\r\n                match = text.xdRegExp.exec(url);\r\n            if (!match) {\r\n                return true;\r\n            }\r\n            uProtocol = match[2];\r\n            uHostName = match[3];\r\n\r\n            uHostName = uHostName.split(':');\r\n            uPort = uHostName[1];\r\n            uHostName = uHostName[0];\r\n\r\n            return (!uProtocol || uProtocol === protocol) &&\r\n                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&\r\n                   ((!uPort && !uHostName) || uPort === port);\r\n        },\r\n\r\n        finishLoad: function (name, strip, content, onLoad) {\r\n            content = strip ? text.strip(content) : content;\r\n            if (masterConfig.isBuild) {\r\n                buildMap[name] = content;\r\n            }\r\n            onLoad(content);\r\n        },\r\n\r\n        load: function (name, req, onLoad, config) {\r\n            //Name has format: some.module.filext!strip\r\n            //The strip part is optional.\r\n            //if strip is present, then that means only get the string contents\r\n            //inside a body tag in an HTML string. For XML/SVG content it means\r\n            //removing the <?xml ...?> declarations so the content can be inserted\r\n            //into the current doc without problems.\r\n\r\n            // Do not bother with the work if a build and text will\r\n            // not be inlined.\r\n            if (config && config.isBuild && !config.inlineText) {\r\n                onLoad();\r\n                return;\r\n            }\r\n\r\n            masterConfig.isBuild = config && config.isBuild;\r\n\r\n            var parsed = text.parseName(name),\r\n                nonStripName = parsed.moduleName +\r\n                    (parsed.ext ? '.' + parsed.ext : ''),\r\n                url = req.toUrl(nonStripName),\r\n                useXhr = (masterConfig.useXhr) ||\r\n                         text.useXhr;\r\n\r\n            // Do not load if it is an empty: url\r\n            if (url.indexOf('empty:') === 0) {\r\n                onLoad();\r\n                return;\r\n            }\r\n\r\n            //Load the text. Use XHR if possible and in a browser.\r\n            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {\r\n                text.get(url, function (content) {\r\n                    text.finishLoad(name, parsed.strip, content, onLoad);\r\n                }, function (err) {\r\n                    if (onLoad.error) {\r\n                        onLoad.error(err);\r\n                    }\r\n                });\r\n            } else {\r\n                //Need to fetch the resource across domains. Assume\r\n                //the resource has been optimized into a JS module. Fetch\r\n                //by the module name + extension, but do not include the\r\n                //!strip part to avoid file system issues.\r\n                req([nonStripName], function (content) {\r\n                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,\r\n                                    parsed.strip, content, onLoad);\r\n                });\r\n            }\r\n        },\r\n\r\n        write: function (pluginName, moduleName, write, config) {\r\n            if (buildMap.hasOwnProperty(moduleName)) {\r\n                var content = text.jsEscape(buildMap[moduleName]);\r\n                write.asModule(pluginName + \"!\" + moduleName,\r\n                               \"define(function () { return '\" +\r\n                                   content +\r\n                               \"';});\\n\");\r\n            }\r\n        },\r\n\r\n        writeFile: function (pluginName, moduleName, req, write, config) {\r\n            var parsed = text.parseName(moduleName),\r\n                extPart = parsed.ext ? '.' + parsed.ext : '',\r\n                nonStripName = parsed.moduleName + extPart,\r\n                //Use a '.js' file name so that it indicates it is a\r\n                //script that can be loaded across domains.\r\n                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';\r\n\r\n            //Leverage own load() method to load plugin value, but only\r\n            //write out values that do not have the strip argument,\r\n            //to avoid any potential issues with ! in file names.\r\n            text.load(nonStripName, req, function (value) {\r\n                //Use own write() method to construct full module value.\r\n                //But need to create shell that translates writeFile's\r\n                //write() to the right interface.\r\n                var textWrite = function (contents) {\r\n                    return write(fileName, contents);\r\n                };\r\n                textWrite.asModule = function (moduleName, contents) {\r\n                    return write.asModule(moduleName, fileName, contents);\r\n                };\r\n\r\n                text.write(pluginName, nonStripName, textWrite, config);\r\n            }, config);\r\n        }\r\n    };\r\n\r\n    if (masterConfig.env === 'node' || (!masterConfig.env &&\r\n            typeof process !== \"undefined\" &&\r\n            process.versions &&\r\n            !!process.versions.node &&\r\n            !process.versions['node-webkit'] &&\r\n            !process.versions['atom-shell'])) {\r\n        //Using special require.nodeRequire, something added by r.js.\r\n        fs = require.nodeRequire('fs');\r\n\r\n        text.get = function (url, callback, errback) {\r\n            try {\r\n                var file = fs.readFileSync(url, 'utf8');\r\n                //Remove BOM (Byte Mark Order) from utf8 files if it is there.\r\n                if (file[0] === '\\uFEFF') {\r\n                    file = file.substring(1);\r\n                }\r\n                callback(file);\r\n            } catch (e) {\r\n                if (errback) {\r\n                    errback(e);\r\n                }\r\n            }\r\n        };\r\n    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&\r\n            text.createXhr())) {\r\n        text.get = function (url, callback, errback, headers) {\r\n            var xhr = text.createXhr(), header;\r\n            xhr.open('GET', url, true);\r\n\r\n            //Allow plugins direct access to xhr headers\r\n            if (headers) {\r\n                for (header in headers) {\r\n                    if (headers.hasOwnProperty(header)) {\r\n                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);\r\n                    }\r\n                }\r\n            }\r\n\r\n            //Allow overrides specified in config\r\n            if (masterConfig.onXhr) {\r\n                masterConfig.onXhr(xhr, url);\r\n            }\r\n\r\n            xhr.onreadystatechange = function (evt) {\r\n                var status, err;\r\n                //Do not explicitly handle errors, those should be\r\n                //visible via console output in the browser.\r\n                if (xhr.readyState === 4) {\r\n                    status = xhr.status || 0;\r\n                    if (status > 399 && status < 600) {\r\n                        //An http 4xx or 5xx error. Signal an error.\r\n                        err = new Error(url + ' HTTP status: ' + status);\r\n                        err.xhr = xhr;\r\n                        if (errback) {\r\n                            errback(err);\r\n                        }\r\n                    } else {\r\n                        callback(xhr.responseText);\r\n                    }\r\n\r\n                    if (masterConfig.onXhrComplete) {\r\n                        masterConfig.onXhrComplete(xhr, url);\r\n                    }\r\n                }\r\n            };\r\n            xhr.send(null);\r\n        };\r\n    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&\r\n            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {\r\n        //Why Java, why is this so awkward?\r\n        text.get = function (url, callback) {\r\n            var stringBuffer, line,\r\n                encoding = \"utf-8\",\r\n                file = new java.io.File(url),\r\n                lineSeparator = java.lang.System.getProperty(\"line.separator\"),\r\n                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),\r\n                content = '';\r\n            try {\r\n                stringBuffer = new java.lang.StringBuffer();\r\n                line = input.readLine();\r\n\r\n                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324\r\n                // http://www.unicode.org/faq/utf_bom.html\r\n\r\n                // Note that when we use utf-8, the BOM should appear as \"EF BB BF\", but it doesn't due to this bug in the JDK:\r\n                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058\r\n                if (line && line.length() && line.charAt(0) === 0xfeff) {\r\n                    // Eat the BOM, since we've already found the encoding on this file,\r\n                    // and we plan to concatenating this buffer with others; the BOM should\r\n                    // only appear at the top of a file.\r\n                    line = line.substring(1);\r\n                }\r\n\r\n                if (line !== null) {\r\n                    stringBuffer.append(line);\r\n                }\r\n\r\n                while ((line = input.readLine()) !== null) {\r\n                    stringBuffer.append(lineSeparator);\r\n                    stringBuffer.append(line);\r\n                }\r\n                //Make sure we return a JavaScript string and not a Java string.\r\n                content = String(stringBuffer.toString()); //String\r\n            } finally {\r\n                input.close();\r\n            }\r\n            callback(content);\r\n        };\r\n    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&\r\n            typeof Components !== 'undefined' && Components.classes &&\r\n            Components.interfaces)) {\r\n        //Avert your gaze!\r\n        Cc = Components.classes;\r\n        Ci = Components.interfaces;\r\n        Components.utils['import']('resource://gre/modules/FileUtils.jsm');\r\n        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);\r\n\r\n        text.get = function (url, callback) {\r\n            var inStream, convertStream, fileObj,\r\n                readData = {};\r\n\r\n            if (xpcIsWindows) {\r\n                url = url.replace(/\\//g, '\\\\');\r\n            }\r\n\r\n            fileObj = new FileUtils.File(url);\r\n\r\n            //XPCOM, you so crazy\r\n            try {\r\n                inStream = Cc['@mozilla.org/network/file-input-stream;1']\r\n                           .createInstance(Ci.nsIFileInputStream);\r\n                inStream.init(fileObj, 1, 0, false);\r\n\r\n                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']\r\n                                .createInstance(Ci.nsIConverterInputStream);\r\n                convertStream.init(inStream, \"utf-8\", inStream.available(),\r\n                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);\r\n\r\n                convertStream.readString(inStream.available(), readData);\r\n                convertStream.close();\r\n                inStream.close();\r\n                callback(readData.value);\r\n            } catch (e) {\r\n                throw new Error((fileObj && fileObj.path || '') + ': ' + e);\r\n            }\r\n        };\r\n    }\r\n    return text;\r\n});\r\n","// THIS FILE IS GENERATED - DO NOT EDIT!\r\n/*global module:false, define:false*/\r\n\r\n(function (define, undefined) {\r\ndefine(function () {\r\n    'use strict';\r\n\r\n    var impl = {};\r\n\r\n    impl.mobileDetectRules = {\r\n    \"phones\": {\r\n        \"iPhone\": \"\\\\biPhone\\\\b|\\\\biPod\\\\b\",\r\n        \"BlackBerry\": \"BlackBerry|\\\\bBB10\\\\b|rim[0-9]+\",\r\n        \"HTC\": \"HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\\\bEVO\\\\b|T-Mobile G1|Z520m\",\r\n        \"Nexus\": \"Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6\",\r\n        \"Dell\": \"Dell.*Streak|Dell.*Aero|Dell.*Venue|DELL.*Venue Pro|Dell Flash|Dell Smoke|Dell Mini 3iX|XCD28|XCD35|\\\\b001DL\\\\b|\\\\b101DL\\\\b|\\\\bGS01\\\\b\",\r\n        \"Motorola\": \"Motorola|DROIDX|DROID BIONIC|\\\\bDroid\\\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\\\bMoto E\\\\b\",\r\n        \"Samsung\": \"Samsung|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205|SM-G9350\",\r\n        \"LG\": \"\\\\bLG\\\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802|MS323)\",\r\n        \"Sony\": \"SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533\",\r\n        \"Asus\": \"Asus.*Galaxy|PadFone.*Mobile\",\r\n        \"Micromax\": \"Micromax.*\\\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\\\b\",\r\n        \"Palm\": \"PalmSource|Palm\",\r\n        \"Vertu\": \"Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature\",\r\n        \"Pantech\": \"PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790\",\r\n        \"Fly\": \"IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250\",\r\n        \"Wiko\": \"KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM\",\r\n        \"iMobile\": \"i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)\",\r\n        \"SimValley\": \"\\\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\\\b\",\r\n        \"Wolfgang\": \"AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q\",\r\n        \"Alcatel\": \"Alcatel\",\r\n        \"Nintendo\": \"Nintendo 3DS\",\r\n        \"Amoi\": \"Amoi\",\r\n        \"INQ\": \"INQ\",\r\n        \"GenericPhone\": \"Tapatalk|PDA;|SAGEM|\\\\bmmp\\\\b|pocket|\\\\bpsp\\\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\\\bwap\\\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser\"\r\n    },\r\n    \"tablets\": {\r\n        \"iPad\": \"iPad|iPad.*Mobile\",\r\n        \"NexusTablet\": \"Android.*Nexus[\\\\s]+(7|9|10)\",\r\n        \"SamsungTablet\": \"SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T815|SM-T360|SM-T533|SM-T113|SM-T335|SM-T715|SM-T560|SM-T670|SM-T677|SM-T377|SM-T567|SM-T357T|SM-T555|SM-T561\",\r\n        \"Kindle\": \"Kindle|Silk.*Accelerated|Android.*\\\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI)\\\\b\",\r\n        \"SurfaceTablet\": \"Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)\",\r\n        \"HPTablet\": \"HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10\",\r\n        \"AsusTablet\": \"^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\\\bK00F\\\\b|\\\\bK00C\\\\b|\\\\bK00E\\\\b|\\\\bK00L\\\\b|TX201LA|ME176C|ME102A|\\\\bM80TA\\\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K017 |ME572C|ME103K|ME170C|ME171C|\\\\bME70C\\\\b|ME581C|ME581CL|ME8510C|ME181C\",\r\n        \"BlackBerryTablet\": \"PlayBook|RIM Tablet\",\r\n        \"HTCtablet\": \"HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410\",\r\n        \"MotorolaTablet\": \"xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617\",\r\n        \"NookTablet\": \"Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2\",\r\n        \"AcerTablet\": \"Android.*; \\\\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\\\b|W3-810|\\\\bA3-A10\\\\b|\\\\bA3-A11\\\\b\",\r\n        \"ToshibaTablet\": \"Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO\",\r\n        \"LGTablet\": \"\\\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\\\b\",\r\n        \"FujitsuTablet\": \"Android.*\\\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\\\b\",\r\n        \"PrestigioTablet\": \"PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002\",\r\n        \"LenovoTablet\": \"Lenovo TAB|Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)\",\r\n        \"DellTablet\": \"Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7\",\r\n        \"YarvikTablet\": \"Android.*\\\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\\\b\",\r\n        \"MedionTablet\": \"Android.*\\\\bOYO\\\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB\",\r\n        \"ArnovaTablet\": \"AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2\",\r\n        \"IntensoTablet\": \"INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004\",\r\n        \"IRUTablet\": \"M702pro\",\r\n        \"MegafonTablet\": \"MegaFon V9|\\\\bZTE V9\\\\b|Android.*\\\\bMT7A\\\\b\",\r\n        \"EbodaTablet\": \"E-Boda (Supreme|Impresspeed|Izzycomm|Essential)\",\r\n        \"AllViewTablet\": \"Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)\",\r\n        \"ArchosTablet\": \"\\\\b(101G9|80G9|A101IT)\\\\b|Qilive 97R|Archos5|\\\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\\\b\",\r\n        \"AinolTablet\": \"NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark\",\r\n        \"SonyTablet\": \"Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP612|SOT31\",\r\n        \"PhilipsTablet\": \"\\\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\\\b\",\r\n        \"CubeTablet\": \"Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT\",\r\n        \"CobyTablet\": \"MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010\",\r\n        \"MIDTablet\": \"M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733|MID4X10\",\r\n        \"MSITablet\": \"MSI \\\\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\\\b\",\r\n        \"SMiTTablet\": \"Android.*(\\\\bMID\\\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)\",\r\n        \"RockChipTablet\": \"Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A\",\r\n        \"FlyTablet\": \"IQ310|Fly Vision\",\r\n        \"bqTablet\": \"Android.*(bq)?.*(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris E10)|Maxwell.*Lite|Maxwell.*Plus\",\r\n        \"HuaweiTablet\": \"MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim\",\r\n        \"NecTablet\": \"\\\\bN-06D|\\\\bN-08D\",\r\n        \"PantechTablet\": \"Pantech.*P4100\",\r\n        \"BronchoTablet\": \"Broncho.*(N701|N708|N802|a710)\",\r\n        \"VersusTablet\": \"TOUCHPAD.*[78910]|\\\\bTOUCHTAB\\\\b\",\r\n        \"ZyncTablet\": \"z1000|Z99 2G|z99|z930|z999|z990|z909|Z919|z900\",\r\n        \"PositivoTablet\": \"TB07STA|TB10STA|TB07FTA|TB10FTA\",\r\n        \"NabiTablet\": \"Android.*\\\\bNabi\",\r\n        \"KoboTablet\": \"Kobo Touch|\\\\bK080\\\\b|\\\\bVox\\\\b Build|\\\\bArc\\\\b Build\",\r\n        \"DanewTablet\": \"DSlide.*\\\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\\\b\",\r\n        \"TexetTablet\": \"NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE\",\r\n        \"PlaystationTablet\": \"Playstation.*(Portable|Vita)\",\r\n        \"TrekstorTablet\": \"ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab\",\r\n        \"PyleAudioTablet\": \"\\\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\\\b\",\r\n        \"AdvanTablet\": \"Android.* \\\\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\\\b \",\r\n        \"DanyTechTablet\": \"Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1\",\r\n        \"GalapadTablet\": \"Android.*\\\\bG1\\\\b\",\r\n        \"MicromaxTablet\": \"Funbook|Micromax.*\\\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\\\b\",\r\n        \"KarbonnTablet\": \"Android.*\\\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\\\b\",\r\n        \"AllFineTablet\": \"Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide\",\r\n        \"PROSCANTablet\": \"\\\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\\\b\",\r\n        \"YONESTablet\": \"BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026\",\r\n        \"ChangJiaTablet\": \"TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503\",\r\n        \"GUTablet\": \"TX-A1301|TX-M9002|Q702|kf026\",\r\n        \"PointOfViewTablet\": \"TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10\",\r\n        \"OvermaxTablet\": \"OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)\",\r\n        \"HCLTablet\": \"HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync\",\r\n        \"DPSTablet\": \"DPS Dream 9|DPS Dual 7\",\r\n        \"VistureTablet\": \"V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10\",\r\n        \"CrestaTablet\": \"CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989\",\r\n        \"MediatekTablet\": \"\\\\bMT8125|MT8389|MT8135|MT8377\\\\b\",\r\n        \"ConcordeTablet\": \"Concorde([ ]+)?Tab|ConCorde ReadMan\",\r\n        \"GoCleverTablet\": \"GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042\",\r\n        \"ModecomTablet\": \"FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003\",\r\n        \"VoninoTablet\": \"\\\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\\\bQ8\\\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\\\b\",\r\n        \"ECSTablet\": \"V07OT2|TM105A|S10OT1|TR10CS1\",\r\n        \"StorexTablet\": \"eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab\",\r\n        \"VodafoneTablet\": \"SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7\",\r\n        \"EssentielBTablet\": \"Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2\",\r\n        \"RossMoorTablet\": \"RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711\",\r\n        \"iMobileTablet\": \"i-mobile i-note\",\r\n        \"TolinoTablet\": \"tolino tab [0-9.]+|tolino shine\",\r\n        \"AudioSonicTablet\": \"\\\\bC-22Q|T7-QC|T-17B|T-17P\\\\b\",\r\n        \"AMPETablet\": \"Android.* A78 \",\r\n        \"SkkTablet\": \"Android.* (SKYPAD|PHOENIX|CYCLOPS)\",\r\n        \"TecnoTablet\": \"TECNO P9\",\r\n        \"JXDTablet\": \"Android.* \\\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\\\b\",\r\n        \"iJoyTablet\": \"Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)\",\r\n        \"FX2Tablet\": \"FX2 PAD7|FX2 PAD10\",\r\n        \"XoroTablet\": \"KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151\",\r\n        \"ViewsonicTablet\": \"ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a\",\r\n        \"OdysTablet\": \"LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\\\bXELIO\\\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10\",\r\n        \"CaptivaTablet\": \"CAPTIVA PAD\",\r\n        \"IconbitTablet\": \"NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S\",\r\n        \"TeclastTablet\": \"T98 4G|\\\\bP80\\\\b|\\\\bX90HD\\\\b|X98 Air|X98 Air 3G|\\\\bX89\\\\b|P80 3G|\\\\bX80h\\\\b|P98 Air|\\\\bX89HD\\\\b|P98 3G|\\\\bP90HD\\\\b|P89 3G|X98 3G|\\\\bP70h\\\\b|P79HD 3G|G18d 3G|\\\\bP79HD\\\\b|\\\\bP89s\\\\b|\\\\bA88\\\\b|\\\\bP10HD\\\\b|\\\\bP19HD\\\\b|G18 3G|\\\\bP78HD\\\\b|\\\\bA78\\\\b|\\\\bP75\\\\b|G17s 3G|G17h 3G|\\\\bP85t\\\\b|\\\\bP90\\\\b|\\\\bP11\\\\b|\\\\bP98t\\\\b|\\\\bP98HD\\\\b|\\\\bG18d\\\\b|\\\\bP85s\\\\b|\\\\bP11HD\\\\b|\\\\bP88s\\\\b|\\\\bA80HD\\\\b|\\\\bA80se\\\\b|\\\\bA10h\\\\b|\\\\bP89\\\\b|\\\\bP78s\\\\b|\\\\bG18\\\\b|\\\\bP85\\\\b|\\\\bA70h\\\\b|\\\\bA70\\\\b|\\\\bG17\\\\b|\\\\bP18\\\\b|\\\\bA80s\\\\b|\\\\bA11s\\\\b|\\\\bP88HD\\\\b|\\\\bA80h\\\\b|\\\\bP76s\\\\b|\\\\bP76h\\\\b|\\\\bP98\\\\b|\\\\bA10HD\\\\b|\\\\bP78\\\\b|\\\\bP88\\\\b|\\\\bA11\\\\b|\\\\bA10t\\\\b|\\\\bP76a\\\\b|\\\\bP76t\\\\b|\\\\bP76e\\\\b|\\\\bP85HD\\\\b|\\\\bP85a\\\\b|\\\\bP86\\\\b|\\\\bP75HD\\\\b|\\\\bP76v\\\\b|\\\\bA12\\\\b|\\\\bP75a\\\\b|\\\\bA15\\\\b|\\\\bP76Ti\\\\b|\\\\bP81HD\\\\b|\\\\bA10\\\\b|\\\\bT760VE\\\\b|\\\\bT720HD\\\\b|\\\\bP76\\\\b|\\\\bP73\\\\b|\\\\bP71\\\\b|\\\\bP72\\\\b|\\\\bT720SE\\\\b|\\\\bC520Ti\\\\b|\\\\bT760\\\\b|\\\\bT720VE\\\\b|T720-3GE|T720-WiFi\",\r\n        \"OndaTablet\": \"\\\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\\\b[\\\\s]+\",\r\n        \"JaytechTablet\": \"TPC-PA762\",\r\n        \"BlaupunktTablet\": \"Endeavour 800NG|Endeavour 1010\",\r\n        \"DigmaTablet\": \"\\\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\\\b\",\r\n        \"EvolioTablet\": \"ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\\\bEvotab\\\\b|\\\\bNeura\\\\b\",\r\n        \"LavaTablet\": \"QPAD E704|\\\\bIvoryS\\\\b|E-TAB IVORY|\\\\bE-TAB\\\\b\",\r\n        \"AocTablet\": \"MW0811|MW0812|MW0922|MTK8382\",\r\n        \"MpmanTablet\": \"MP11 OCTA|MP10 OCTA|MPQC1114|MPQC1004|MPQC994|MPQC974|MPQC973|MPQC804|MPQC784|MPQC780|\\\\bMPG7\\\\b|MPDCG75|MPDCG71|MPDC1006|MP101DC|MPDC9000|MPDC905|MPDC706HD|MPDC706|MPDC705|MPDC110|MPDC100|MPDC99|MPDC97|MPDC88|MPDC8|MPDC77|MP709|MID701|MID711|MID170|MPDC703|MPQC1010\",\r\n        \"CelkonTablet\": \"CT695|CT888|CT[\\\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\\\bCT-1\\\\b\",\r\n        \"WolderTablet\": \"miTab \\\\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\\\b\",\r\n        \"MiTablet\": \"\\\\bMI PAD\\\\b|\\\\bHM NOTE 1W\\\\b\",\r\n        \"NibiruTablet\": \"Nibiru M1|Nibiru Jupiter One\",\r\n        \"NexoTablet\": \"NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI\",\r\n        \"LeaderTablet\": \"TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100\",\r\n        \"UbislateTablet\": \"UbiSlate[\\\\s]?7C\",\r\n        \"PocketBookTablet\": \"Pocketbook\",\r\n        \"Hudl\": \"Hudl HT7S3|Hudl 2\",\r\n        \"TelstraTablet\": \"T-Hub2\",\r\n        \"GenericTablet\": \"Android.*\\\\b97D\\\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\\\bA7EB\\\\b|CatNova8|A1_07|CT704|CT1002|\\\\bM721\\\\b|rk30sdk|\\\\bEVOTAB\\\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\\\bM6pro\\\\b|CT1020W|arc 10HD|\\\\bJolla\\\\b|\\\\bTP750\\\\b\"\r\n    },\r\n    \"oss\": {\r\n        \"AndroidOS\": \"Android\",\r\n        \"BlackBerryOS\": \"blackberry|\\\\bBB10\\\\b|rim tablet os\",\r\n        \"PalmOS\": \"PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino\",\r\n        \"SymbianOS\": \"Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\\\bS60\\\\b\",\r\n        \"WindowsMobileOS\": \"Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Window Mobile|Windows Phone [0-9.]+|WCE;\",\r\n        \"WindowsPhoneOS\": \"Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;\",\r\n        \"iOS\": \"\\\\biPhone.*Mobile|\\\\biPod|\\\\biPad\",\r\n        \"MeeGoOS\": \"MeeGo\",\r\n        \"MaemoOS\": \"Maemo\",\r\n        \"JavaOS\": \"J2ME\\/|\\\\bMIDP\\\\b|\\\\bCLDC\\\\b\",\r\n        \"webOS\": \"webOS|hpwOS\",\r\n        \"badaOS\": \"\\\\bBada\\\\b\",\r\n        \"BREWOS\": \"BREW\"\r\n    },\r\n    \"uas\": {\r\n        \"Chrome\": \"\\\\bCrMo\\\\b|CriOS|Android.*Chrome\\/[.0-9]* (Mobile)?\",\r\n        \"Dolfin\": \"\\\\bDolfin\\\\b\",\r\n        \"Opera\": \"Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR\\/[0-9.]+|Coast\\/[0-9.]+\",\r\n        \"Skyfire\": \"Skyfire\",\r\n        \"IE\": \"IEMobile|MSIEMobile\",\r\n        \"Firefox\": \"fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile\",\r\n        \"Bolt\": \"bolt\",\r\n        \"TeaShark\": \"teashark\",\r\n        \"Blazer\": \"Blazer\",\r\n        \"Safari\": \"Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari\",\r\n        \"Tizen\": \"Tizen\",\r\n        \"UCBrowser\": \"UC.*Browser|UCWEB\",\r\n        \"baiduboxapp\": \"baiduboxapp\",\r\n        \"baidubrowser\": \"baidubrowser\",\r\n        \"DiigoBrowser\": \"DiigoBrowser\",\r\n        \"Puffin\": \"Puffin\",\r\n        \"Mercury\": \"\\\\bMercury\\\\b\",\r\n        \"ObigoBrowser\": \"Obigo\",\r\n        \"NetFront\": \"NF-Browser\",\r\n        \"GenericBrowser\": \"NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger\"\r\n    },\r\n    \"props\": {\r\n        \"Mobile\": \"Mobile\\/[VER]\",\r\n        \"Build\": \"Build\\/[VER]\",\r\n        \"Version\": \"Version\\/[VER]\",\r\n        \"VendorID\": \"VendorID\\/[VER]\",\r\n        \"iPad\": \"iPad.*CPU[a-z ]+[VER]\",\r\n        \"iPhone\": \"iPhone.*CPU[a-z ]+[VER]\",\r\n        \"iPod\": \"iPod.*CPU[a-z ]+[VER]\",\r\n        \"Kindle\": \"Kindle\\/[VER]\",\r\n        \"Chrome\": [\r\n            \"Chrome\\/[VER]\",\r\n            \"CriOS\\/[VER]\",\r\n            \"CrMo\\/[VER]\"\r\n        ],\r\n        \"Coast\": [\r\n            \"Coast\\/[VER]\"\r\n        ],\r\n        \"Dolfin\": \"Dolfin\\/[VER]\",\r\n        \"Firefox\": \"Firefox\\/[VER]\",\r\n        \"Fennec\": \"Fennec\\/[VER]\",\r\n        \"IE\": [\r\n            \"IEMobile\\/[VER];\",\r\n            \"IEMobile [VER]\",\r\n            \"MSIE [VER];\",\r\n            \"Trident\\/[0-9.]+;.*rv:[VER]\"\r\n        ],\r\n        \"NetFront\": \"NetFront\\/[VER]\",\r\n        \"NokiaBrowser\": \"NokiaBrowser\\/[VER]\",\r\n        \"Opera\": [\r\n            \" OPR\\/[VER]\",\r\n            \"Opera Mini\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"Opera Mini\": \"Opera Mini\\/[VER]\",\r\n        \"Opera Mobi\": \"Version\\/[VER]\",\r\n        \"UC Browser\": \"UC Browser[VER]\",\r\n        \"MQQBrowser\": \"MQQBrowser\\/[VER]\",\r\n        \"MicroMessenger\": \"MicroMessenger\\/[VER]\",\r\n        \"baiduboxapp\": \"baiduboxapp\\/[VER]\",\r\n        \"baidubrowser\": \"baidubrowser\\/[VER]\",\r\n        \"Iron\": \"Iron\\/[VER]\",\r\n        \"Safari\": [\r\n            \"Version\\/[VER]\",\r\n            \"Safari\\/[VER]\"\r\n        ],\r\n        \"Skyfire\": \"Skyfire\\/[VER]\",\r\n        \"Tizen\": \"Tizen\\/[VER]\",\r\n        \"Webkit\": \"webkit[ \\/][VER]\",\r\n        \"Gecko\": \"Gecko\\/[VER]\",\r\n        \"Trident\": \"Trident\\/[VER]\",\r\n        \"Presto\": \"Presto\\/[VER]\",\r\n        \"iOS\": \" \\\\bi?OS\\\\b [VER][ ;]{1}\",\r\n        \"Android\": \"Android [VER]\",\r\n        \"BlackBerry\": [\r\n            \"BlackBerry[\\\\w]+\\/[VER]\",\r\n            \"BlackBerry.*Version\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"BREW\": \"BREW [VER]\",\r\n        \"Java\": \"Java\\/[VER]\",\r\n        \"Windows Phone OS\": [\r\n            \"Windows Phone OS [VER]\",\r\n            \"Windows Phone [VER]\"\r\n        ],\r\n        \"Windows Phone\": \"Windows Phone [VER]\",\r\n        \"Windows CE\": \"Windows CE\\/[VER]\",\r\n        \"Windows NT\": \"Windows NT [VER]\",\r\n        \"Symbian\": [\r\n            \"SymbianOS\\/[VER]\",\r\n            \"Symbian\\/[VER]\"\r\n        ],\r\n        \"webOS\": [\r\n            \"webOS\\/[VER]\",\r\n            \"hpwOS\\/[VER];\"\r\n        ]\r\n    },\r\n    \"utils\": {\r\n        \"Bot\": \"Googlebot|facebookexternalhit|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom\",\r\n        \"MobileBot\": \"Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker\\/M1A1-R2D2\",\r\n        \"DesktopMode\": \"WPDesktop\",\r\n        \"TV\": \"SonyDTV|HbbTV\",\r\n        \"WebKit\": \"(webkit)[ \\/]([\\\\w.]+)\",\r\n        \"Console\": \"\\\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|PLAYSTATION|Xbox)\\\\b\",\r\n        \"Watch\": \"SM-V700\"\r\n    }\r\n};\r\n\r\n    // following patterns come from http://detectmobilebrowsers.com/\r\n    impl.detectMobileBrowsers = {\r\n        fullPattern: /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,\r\n        shortPattern: /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i,\r\n        tabletPattern: /android|ipad|playbook|silk/i\r\n    };\r\n\r\n    var hasOwnProp = Object.prototype.hasOwnProperty,\r\n        isArray;\r\n\r\n    impl.FALLBACK_PHONE = 'UnknownPhone';\r\n    impl.FALLBACK_TABLET = 'UnknownTablet';\r\n    impl.FALLBACK_MOBILE = 'UnknownMobile';\r\n\r\n    isArray = ('isArray' in Array) ?\r\n        Array.isArray : function (value) { return Object.prototype.toString.call(value) === '[object Array]'; };\r\n\r\n    function equalIC(a, b) {\r\n        return a != null && b != null && a.toLowerCase() === b.toLowerCase();\r\n    }\r\n\r\n    function containsIC(array, value) {\r\n        var valueLC, i, len = array.length;\r\n        if (!len || !value) {\r\n            return false;\r\n        }\r\n        valueLC = value.toLowerCase();\r\n        for (i = 0; i < len; ++i) {\r\n            if (valueLC === array[i].toLowerCase()) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function convertPropsToRegExp(object) {\r\n        for (var key in object) {\r\n            if (hasOwnProp.call(object, key)) {\r\n                object[key] = new RegExp(object[key], 'i');\r\n            }\r\n        }\r\n    }\r\n\r\n    (function init() {\r\n        var key, values, value, i, len, verPos, mobileDetectRules = impl.mobileDetectRules;\r\n        for (key in mobileDetectRules.props) {\r\n            if (hasOwnProp.call(mobileDetectRules.props, key)) {\r\n                values = mobileDetectRules.props[key];\r\n                if (!isArray(values)) {\r\n                    values = [values];\r\n                }\r\n                len = values.length;\r\n                for (i = 0; i < len; ++i) {\r\n                    value = values[i];\r\n                    verPos = value.indexOf('[VER]');\r\n                    if (verPos >= 0) {\r\n                        value = value.substring(0, verPos) + '([\\\\w._\\\\+]+)' + value.substring(verPos + 5);\r\n                    }\r\n                    values[i] = new RegExp(value, 'i');\r\n                }\r\n                mobileDetectRules.props[key] = values;\r\n            }\r\n        }\r\n        convertPropsToRegExp(mobileDetectRules.oss);\r\n        convertPropsToRegExp(mobileDetectRules.phones);\r\n        convertPropsToRegExp(mobileDetectRules.tablets);\r\n        convertPropsToRegExp(mobileDetectRules.uas);\r\n        convertPropsToRegExp(mobileDetectRules.utils);\r\n\r\n        // copy some patterns to oss0 which are tested first (see issue#15)\r\n        mobileDetectRules.oss0 = {\r\n            WindowsPhoneOS: mobileDetectRules.oss.WindowsPhoneOS,\r\n            WindowsMobileOS: mobileDetectRules.oss.WindowsMobileOS\r\n        };\r\n    }());\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and find the first matched key.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {String|null} the matched key if found, otherwise <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatch = function(rules, userAgent) {\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    return key;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and return an array of matched keys.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {Array} an array of matched keys, may be empty when there is no match, but not <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatches = function(rules, userAgent) {\r\n        var result = [];\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    result.push(key);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {String} version or <tt>null</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersionStr = function (propertyName, userAgent) {\r\n        var props = impl.mobileDetectRules.props, patterns, i, len, match;\r\n        if (hasOwnProp.call(props, propertyName)) {\r\n            patterns = props[propertyName];\r\n            len = patterns.length;\r\n            for (i = 0; i < len; ++i) {\r\n                match = patterns[i].exec(userAgent);\r\n                if (match !== null) {\r\n                    return match[1];\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {Number} version or <tt>NaN</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersion = function (propertyName, userAgent) {\r\n        var version = impl.getVersionStr(propertyName, userAgent);\r\n        return version ? impl.prepareVersionNo(version) : NaN;\r\n    };\r\n\r\n    /**\r\n     * Prepare the version number.\r\n     *\r\n     * @param {String} version\r\n     * @return {Number} the version number as a floating number\r\n     * @private\r\n     */\r\n    impl.prepareVersionNo = function (version) {\r\n        var numbers;\r\n\r\n        numbers = version.split(/[a-z._ \\/\\-]/i);\r\n        if (numbers.length === 1) {\r\n            version = numbers[0];\r\n        }\r\n        if (numbers.length > 1) {\r\n            version = numbers[0] + '.';\r\n            numbers.shift();\r\n            version += numbers.join('');\r\n        }\r\n        return Number(version);\r\n    };\r\n\r\n    impl.isMobileFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.fullPattern.test(userAgent) ||\r\n            impl.detectMobileBrowsers.shortPattern.test(userAgent.substr(0,4));\r\n    };\r\n\r\n    impl.isTabletFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.tabletPattern.test(userAgent);\r\n    };\r\n\r\n    impl.prepareDetectionCache = function (cache, userAgent, maxPhoneWidth) {\r\n        if (cache.mobile !== undefined) {\r\n            return;\r\n        }\r\n        var phone, tablet, phoneSized;\r\n\r\n        // first check for stronger tablet rules, then phone (see issue#5)\r\n        tablet = impl.findMatch(impl.mobileDetectRules.tablets, userAgent);\r\n        if (tablet) {\r\n            cache.mobile = cache.tablet = tablet;\r\n            cache.phone = null;\r\n            return; // unambiguously identified as tablet\r\n        }\r\n\r\n        phone = impl.findMatch(impl.mobileDetectRules.phones, userAgent);\r\n        if (phone) {\r\n            cache.mobile = cache.phone = phone;\r\n            cache.tablet = null;\r\n            return; // unambiguously identified as phone\r\n        }\r\n\r\n        // our rules haven't found a match -> try more general fallback rules\r\n        if (impl.isMobileFallback(userAgent)) {\r\n            phoneSized = MobileDetect.isPhoneSized(maxPhoneWidth);\r\n            if (phoneSized === undefined) {\r\n                cache.mobile = impl.FALLBACK_MOBILE;\r\n                cache.tablet = cache.phone = null;\r\n            } else if (phoneSized) {\r\n                cache.mobile = cache.phone = impl.FALLBACK_PHONE;\r\n                cache.tablet = null;\r\n            } else {\r\n                cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n                cache.phone = null;\r\n            }\r\n        } else if (impl.isTabletFallback(userAgent)) {\r\n            cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n            cache.phone = null;\r\n        } else {\r\n            // not mobile at all!\r\n            cache.mobile = cache.tablet = cache.phone = null;\r\n        }\r\n    };\r\n\r\n    // t is a reference to a MobileDetect instance\r\n    impl.mobileGrade = function (t) {\r\n        // impl note:\r\n        // To keep in sync w/ Mobile_Detect.php easily, the following code is tightly aligned to the PHP version.\r\n        // When changes are made in Mobile_Detect.php, copy this method and replace:\r\n        //     $this-> / t.\r\n        //     self::MOBILE_GRADE_(.) / '$1'\r\n        //     , self::VERSION_TYPE_FLOAT / (nothing)\r\n        //     isIOS() / os('iOS')\r\n        //     [reg] / (nothing)   <-- jsdelivr complaining about unescaped unicode character U+00AE\r\n        var $isMobile = t.mobile() !== null;\r\n\r\n        if (\r\n            // Apple iOS 3.2-5.1 - Tested on the original iPad (4.3 / 5.0), iPad 2 (4.3), iPad 3 (5.1), original iPhone (3.1), iPhone 3 (3.2), 3GS (4.3), 4 (4.3 / 5.0), and 4S (5.1)\r\n            t.os('iOS') && t.version('iPad')>=4.3 ||\r\n            t.os('iOS') && t.version('iPhone')>=3.1 ||\r\n            t.os('iOS') && t.version('iPod')>=3.1 ||\r\n\r\n            // Android 2.1-2.3 - Tested on the HTC Incredible (2.2), original Droid (2.2), HTC Aria (2.1), Google Nexus S (2.3). Functional on 1.5 & 1.6 but performance may be sluggish, tested on Google G1 (1.5)\r\n            // Android 3.1 (Honeycomb)  - Tested on the Samsung Galaxy Tab 10.1 and Motorola XOOM\r\n            // Android 4.0 (ICS)  - Tested on a Galaxy Nexus. Note: transition performance can be poor on upgraded devices\r\n            // Android 4.1 (Jelly Bean)  - Tested on a Galaxy Nexus and Galaxy 7\r\n            ( t.version('Android')>2.1 && t.is('Webkit') ) ||\r\n\r\n            // Windows Phone 7-7.5 - Tested on the HTC Surround (7.0) HTC Trophy (7.5), LG-E900 (7.5), Nokia Lumia 800\r\n            t.version('Windows Phone OS')>=7.0 ||\r\n\r\n            // Blackberry 7 - Tested on BlackBerry Torch 9810\r\n            // Blackberry 6.0 - Tested on the Torch 9800 and Style 9670\r\n            t.is('BlackBerry') && t.version('BlackBerry')>=6.0 ||\r\n            // Blackberry Playbook (1.0-2.0) - Tested on PlayBook\r\n            t.match('Playbook.*Tablet') ||\r\n\r\n            // Palm WebOS (1.4-2.0) - Tested on the Palm Pixi (1.4), Pre (1.4), Pre 2 (2.0)\r\n            ( t.version('webOS')>=1.4 && t.match('Palm|Pre|Pixi') ) ||\r\n            // Palm WebOS 3.0  - Tested on HP TouchPad\r\n            t.match('hp.*TouchPad') ||\r\n\r\n            // Firefox Mobile (12 Beta) - Tested on Android 2.3 device\r\n            ( t.is('Firefox') && t.version('Firefox')>=12 ) ||\r\n\r\n            // Chrome for Android - Tested on Android 4.0, 4.1 device\r\n            ( t.is('Chrome') && t.is('AndroidOS') && t.version('Android')>=4.0 ) ||\r\n\r\n            // Skyfire 4.1 - Tested on Android 2.3 device\r\n            ( t.is('Skyfire') && t.version('Skyfire')>=4.1 && t.is('AndroidOS') && t.version('Android')>=2.3 ) ||\r\n\r\n            // Opera Mobile 11.5-12: Tested on Android 2.3\r\n            ( t.is('Opera') && t.version('Opera Mobi')>11 && t.is('AndroidOS') ) ||\r\n\r\n            // Meego 1.2 - Tested on Nokia 950 and N9\r\n            t.is('MeeGoOS') ||\r\n\r\n            // Tizen (pre-release) - Tested on early hardware\r\n            t.is('Tizen') ||\r\n\r\n            // Samsung Bada 2.0 - Tested on a Samsung Wave 3, Dolphin browser\r\n            // @todo: more tests here!\r\n            t.is('Dolfin') && t.version('Bada')>=2.0 ||\r\n\r\n            // UC Browser - Tested on Android 2.3 device\r\n            ( (t.is('UC Browser') || t.is('Dolfin')) && t.version('Android')>=2.3 ) ||\r\n\r\n            // Kindle 3 and Fire  - Tested on the built-in WebKit browser for each\r\n            ( t.match('Kindle Fire') ||\r\n                t.is('Kindle') && t.version('Kindle')>=3.0 ) ||\r\n\r\n            // Nook Color 1.4.1 - Tested on original Nook Color, not Nook Tablet\r\n            t.is('AndroidOS') && t.is('NookTablet') ||\r\n\r\n            // Chrome Desktop 11-21 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Chrome')>=11 && !$isMobile ||\r\n\r\n            // Safari Desktop 4-5 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Safari')>=5.0 && !$isMobile ||\r\n\r\n            // Firefox Desktop 4-13 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Firefox')>=4.0 && !$isMobile ||\r\n\r\n            // Internet Explorer 7-9 - Tested on Windows XP, Vista and 7\r\n            t.version('MSIE')>=7.0 && !$isMobile ||\r\n\r\n            // Opera Desktop 10-12 - Tested on OS X 10.7 and Windows 7\r\n            // @reference: http://my.opera.com/community/openweb/idopera/\r\n            t.version('Opera')>=10 && !$isMobile\r\n\r\n            ){\r\n            return 'A';\r\n        }\r\n\r\n        if (\r\n            t.os('iOS') && t.version('iPad')<4.3 ||\r\n            t.os('iOS') && t.version('iPhone')<3.1 ||\r\n            t.os('iOS') && t.version('iPod')<3.1 ||\r\n\r\n            // Blackberry 5.0: Tested on the Storm 2 9550, Bold 9770\r\n            t.is('Blackberry') && t.version('BlackBerry')>=5 && t.version('BlackBerry')<6 ||\r\n\r\n            //Opera Mini (5.0-6.5) - Tested on iOS 3.2/4.3 and Android 2.3\r\n            ( t.version('Opera Mini')>=5.0 && t.version('Opera Mini')<=6.5 &&\r\n                (t.version('Android')>=2.3 || t.is('iOS')) ) ||\r\n\r\n            // Nokia Symbian^3 - Tested on Nokia N8 (Symbian^3), C7 (Symbian^3), also works on N97 (Symbian^1)\r\n            t.match('NokiaN8|NokiaC7|N97.*Series60|Symbian/3') ||\r\n\r\n            // @todo: report this (tested on Nokia N71)\r\n            t.version('Opera Mobi')>=11 && t.is('SymbianOS')\r\n            ){\r\n            return 'B';\r\n        }\r\n\r\n        if (\r\n        // Blackberry 4.x - Tested on the Curve 8330\r\n            t.version('BlackBerry')<5.0 ||\r\n            // Windows Mobile - Tested on the HTC Leo (WinMo 5.2)\r\n            t.match('MSIEMobile|Windows CE.*Mobile') || t.version('Windows Mobile')<=5.2\r\n\r\n            ){\r\n            return 'C';\r\n        }\r\n\r\n        //All older smartphone platforms and featurephones - Any device that doesn't support media queries\r\n        //will receive the basic, C grade experience.\r\n        return 'C';\r\n    };\r\n\r\n    impl.detectOS = function (ua) {\r\n        return impl.findMatch(impl.mobileDetectRules.oss0, ua) ||\r\n            impl.findMatch(impl.mobileDetectRules.oss, ua);\r\n    };\r\n\r\n    impl.getDeviceSmallerSide = function () {\r\n        return window.screen.width < window.screen.height ?\r\n            window.screen.width :\r\n            window.screen.height;\r\n    };\r\n\r\n    /**\r\n     * Constructor for MobileDetect object.\r\n     * <br>\r\n     * Such an object will keep a reference to the given user-agent string and cache most of the detect queries.<br>\r\n     * <div style=\"background-color: #d9edf7; border: 1px solid #bce8f1; color: #3a87ad; padding: 14px; border-radius: 2px; margin-top: 20px\">\r\n     *     <strong>Find information how to download and install:</strong>\r\n     *     <a href=\"https://github.com/hgoebl/mobile-detect.js/\">github.com/hgoebl/mobile-detect.js/</a>\r\n     * </div>\r\n     *\r\n     * @example <pre>\r\n     *     var md = new MobileDetect(window.navigator.userAgent);\r\n     *     if (md.mobile()) {\r\n     *         location.href = (md.mobileGrade() === 'A') ? '/mobile/' : '/lynx/';\r\n     *     }\r\n     * </pre>\r\n     *\r\n     * @param {string} userAgent typically taken from window.navigator.userAgent or http_header['User-Agent']\r\n     * @param {number} [maxPhoneWidth=600] <strong>only for browsers</strong> specify a value for the maximum\r\n     *        width of smallest device side (in logical \"CSS\" pixels) until a device detected as mobile will be handled\r\n     *        as phone.\r\n     *        This is only used in cases where the device cannot be classified as phone or tablet.<br>\r\n     *        See <a href=\"http://developer.android.com/guide/practices/screens_support.html\">Declaring Tablet Layouts\r\n     *        for Android</a>.<br>\r\n     *        If you provide a value < 0, then this \"fuzzy\" check is disabled.\r\n     * @constructor\r\n     * @global\r\n     */\r\n    function MobileDetect(userAgent, maxPhoneWidth) {\r\n        this.ua = userAgent || '';\r\n        this._cache = {};\r\n        //600dp is typical 7\" tablet minimum width\r\n        this.maxPhoneWidth = maxPhoneWidth || 600;\r\n    }\r\n\r\n    MobileDetect.prototype = {\r\n        constructor: MobileDetect,\r\n\r\n        /**\r\n         * Returns the detected phone or tablet type or <tt>null</tt> if it is not a mobile device.\r\n         * <br>\r\n         * For a list of possible return values see {@link MobileDetect#phone} and {@link MobileDetect#tablet}.<br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code>, <code>UnknownTablet</code> or\r\n         * <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>UnknownMobile</code> here.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key for the phone family or tablet family, e.g. \"Nexus\".\r\n         * @function MobileDetect#mobile\r\n         */\r\n        mobile: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.mobile;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected phone type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPhone, BlackBerry, HTC, Nexus, Dell, Motorola, Samsung, LG, Sony, Asus,\r\n         * Micromax, Palm, Vertu, Pantech, Fly, Wiko, iMobile, SimValley, Wolfgang,\r\n         * Alcatel, Nintendo, Amoi, INQ, GenericPhone</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the phone family or producer, e.g. \"iPhone\"\r\n         * @function MobileDetect#phone\r\n         */\r\n        phone: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.phone;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected tablet type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPad, NexusTablet, SamsungTablet, Kindle, SurfaceTablet, HPTablet, AsusTablet,\r\n         * BlackBerryTablet, HTCtablet, MotorolaTablet, NookTablet, AcerTablet,\r\n         * ToshibaTablet, LGTablet, FujitsuTablet, PrestigioTablet, LenovoTablet,\r\n         * DellTablet, YarvikTablet, MedionTablet, ArnovaTablet, IntensoTablet, IRUTablet,\r\n         * MegafonTablet, EbodaTablet, AllViewTablet, ArchosTablet, AinolTablet,\r\n         * SonyTablet, PhilipsTablet, CubeTablet, CobyTablet, MIDTablet, MSITablet,\r\n         * SMiTTablet, RockChipTablet, FlyTablet, bqTablet, HuaweiTablet, NecTablet,\r\n         * PantechTablet, BronchoTablet, VersusTablet, ZyncTablet, PositivoTablet,\r\n         * NabiTablet, KoboTablet, DanewTablet, TexetTablet, PlaystationTablet,\r\n         * TrekstorTablet, PyleAudioTablet, AdvanTablet, DanyTechTablet, GalapadTablet,\r\n         * MicromaxTablet, KarbonnTablet, AllFineTablet, PROSCANTablet, YONESTablet,\r\n         * ChangJiaTablet, GUTablet, PointOfViewTablet, OvermaxTablet, HCLTablet,\r\n         * DPSTablet, VistureTablet, CrestaTablet, MediatekTablet, ConcordeTablet,\r\n         * GoCleverTablet, ModecomTablet, VoninoTablet, ECSTablet, StorexTablet,\r\n         * VodafoneTablet, EssentielBTablet, RossMoorTablet, iMobileTablet, TolinoTablet,\r\n         * AudioSonicTablet, AMPETablet, SkkTablet, TecnoTablet, JXDTablet, iJoyTablet,\r\n         * FX2Tablet, XoroTablet, ViewsonicTablet, OdysTablet, CaptivaTablet,\r\n         * IconbitTablet, TeclastTablet, OndaTablet, JaytechTablet, BlaupunktTablet,\r\n         * DigmaTablet, EvolioTablet, LavaTablet, AocTablet, MpmanTablet, CelkonTablet,\r\n         * WolderTablet, MiTablet, NibiruTablet, NexoTablet, LeaderTablet, UbislateTablet,\r\n         * PocketBookTablet, Hudl, TelstraTablet, GenericTablet</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownTablet</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the tablet family or producer, e.g. \"SamsungTablet\"\r\n         * @function MobileDetect#tablet\r\n         */\r\n        tablet: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.tablet;\r\n        },\r\n\r\n        /**\r\n         * Returns the (first) detected user-agent string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned user-agent is one of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, IE, Firefox, Bolt, TeaShark, Blazer, Safari,\r\n         * Tizen, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Puffin, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {String} the key for the detected user-agent or <tt>null</tt>\r\n         * @function MobileDetect#userAgent\r\n         */\r\n        userAgent: function () {\r\n            if (this._cache.userAgent === undefined) {\r\n                this._cache.userAgent = impl.findMatch(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgent;\r\n        },\r\n\r\n        /**\r\n         * Returns all detected user-agent strings.\r\n         * <br>\r\n         * The array is empty or contains one or more of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, IE, Firefox, Bolt, TeaShark, Blazer, Safari,\r\n         * Tizen, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Puffin, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {Array} the array of detected user-agent keys or <tt>[]</tt>\r\n         * @function MobileDetect#userAgents\r\n         */\r\n        userAgents: function () {\r\n            if (this._cache.userAgents === undefined) {\r\n                this._cache.userAgents = impl.findMatches(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgents;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected operating system string or <tt>null</tt>.\r\n         * <br>\r\n         * The operating system is one of following keys:<br>\r\n         * <br><tt>AndroidOS, BlackBerryOS, PalmOS, SymbianOS, WindowsMobileOS, WindowsPhoneOS,\r\n         * iOS, MeeGoOS, MaemoOS, JavaOS, webOS, badaOS, BREWOS</tt><br>\r\n         *\r\n         * @returns {String} the key for the detected operating system.\r\n         * @function MobileDetect#os\r\n         */\r\n        os: function () {\r\n            if (this._cache.os === undefined) {\r\n                this._cache.os = impl.detectOS(this.ua);\r\n            }\r\n            return this._cache.os;\r\n        },\r\n\r\n        /**\r\n         * Get the version (as Number) of the given property in the User-Agent.\r\n         * <br>\r\n         * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, IE, NetFront, NokiaBrowser, Opera, Opera Mini, Opera\r\n         * Mobi, UC Browser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser, Iron,\r\n         * Safari, Skyfire, Tizen, Webkit, Gecko, Trident, Presto, iOS, Android,\r\n         * BlackBerry, BREW, Java, Windows Phone OS, Windows Phone, Windows CE, Windows\r\n         * NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {Number} the version as float or <tt>NaN</tt> if User-Agent doesn't contain this version.\r\n         *          Be careful when comparing this value with '==' operator!\r\n         * @function MobileDetect#version\r\n         */\r\n        version: function (key) {\r\n            return impl.getVersion(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Get the version (as String) of the given property in the User-Agent.\r\n         * <br>\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, IE, NetFront, NokiaBrowser, Opera, Opera Mini, Opera\r\n         * Mobi, UC Browser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser, Iron,\r\n         * Safari, Skyfire, Tizen, Webkit, Gecko, Trident, Presto, iOS, Android,\r\n         * BlackBerry, BREW, Java, Windows Phone OS, Windows Phone, Windows CE, Windows\r\n         * NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {String} the \"raw\" version as String or <tt>null</tt> if User-Agent doesn't contain this version.\r\n         *\r\n         * @function MobileDetect#versionStr\r\n         */\r\n        versionStr: function (key) {\r\n            return impl.getVersionStr(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Global test key against userAgent, os, phone, tablet and some other properties of userAgent string.\r\n         *\r\n         * @param {String} key the key (case-insensitive) of a userAgent, an operating system, phone or\r\n         *        tablet family.<br>\r\n         *        For a complete list of possible values, see {@link MobileDetect#userAgent},\r\n         *        {@link MobileDetect#os}, {@link MobileDetect#phone}, {@link MobileDetect#tablet}.<br>\r\n         *        Additionally you have following keys:<br>\r\n         * <br><tt>Bot, MobileBot, DesktopMode, TV, WebKit, Console, Watch</tt><br>\r\n         *\r\n         * @returns {boolean} <tt>true</tt> when the given key is one of the defined keys of userAgent, os, phone,\r\n         *                    tablet or one of the listed additional keys, otherwise <tt>false</tt>\r\n         * @function MobileDetect#is\r\n         */\r\n        is: function (key) {\r\n            return containsIC(this.userAgents(), key) ||\r\n                   equalIC(key, this.os()) ||\r\n                   equalIC(key, this.phone()) ||\r\n                   equalIC(key, this.tablet()) ||\r\n                   containsIC(impl.findMatches(impl.mobileDetectRules.utils, this.ua), key);\r\n        },\r\n\r\n        /**\r\n         * Do a quick test against navigator::userAgent.\r\n         *\r\n         * @param {String|RegExp} pattern the pattern, either as String or RegExp\r\n         *                        (a string will be converted to a case-insensitive RegExp).\r\n         * @returns {boolean} <tt>true</tt> when the pattern matches, otherwise <tt>false</tt>\r\n         * @function MobileDetect#match\r\n         */\r\n        match: function (pattern) {\r\n            if (!(pattern instanceof RegExp)) {\r\n                pattern = new RegExp(pattern, 'i');\r\n            }\r\n            return pattern.test(this.ua);\r\n        },\r\n\r\n        /**\r\n         * Checks whether the mobile device can be considered as phone regarding <code>screen.width</code>.\r\n         * <br>\r\n         * Obviously this method makes sense in browser environments only (not for Node.js)!\r\n         * @param {number} [maxPhoneWidth] the maximum logical pixels (aka. CSS-pixels) to be considered as phone.<br>\r\n         *        The argument is optional and if not present or falsy, the value of the constructor is taken.\r\n         * @returns {boolean|undefined} <code>undefined</code> if screen size wasn't detectable, else <code>true</code>\r\n         *          when screen.width is less or equal to maxPhoneWidth, otherwise <code>false</code>.<br>\r\n         *          Will always return <code>undefined</code> server-side.\r\n         */\r\n        isPhoneSized: function (maxPhoneWidth) {\r\n            return MobileDetect.isPhoneSized(maxPhoneWidth || this.maxPhoneWidth);\r\n        },\r\n\r\n        /**\r\n         * Returns the mobile grade ('A', 'B', 'C').\r\n         *\r\n         * @returns {String} one of the mobile grades ('A', 'B', 'C').\r\n         * @function MobileDetect#mobileGrade\r\n         */\r\n        mobileGrade: function () {\r\n            if (this._cache.grade === undefined) {\r\n                this._cache.grade = impl.mobileGrade(this);\r\n            }\r\n            return this._cache.grade;\r\n        }\r\n    };\r\n\r\n    // environment-dependent\r\n    if (typeof window !== 'undefined' && window.screen) {\r\n        MobileDetect.isPhoneSized = function (maxPhoneWidth) {\r\n            return maxPhoneWidth < 0 ? undefined : impl.getDeviceSmallerSide() <= maxPhoneWidth;\r\n        };\r\n    } else {\r\n        MobileDetect.isPhoneSized = function () {};\r\n    }\r\n\r\n    // should not be replaced by a completely new object - just overwrite existing methods\r\n    MobileDetect._impl = impl;\r\n\r\n    return MobileDetect;\r\n}); // end of call of define()\r\n})((function (undefined) {\r\n  return function (factory) { window.MobileDetect = factory(); };\r\n})());","(function(e){\"use strict\";var t=typeof window===\"undefined\"?null:window;if(typeof module!==\"undefined\"){module.exports=e(t)}else{t.DOMPurify=e(t)}})(function e(t){\"use strict\";var r=function(t){return e(t)};r.version=\"0.8.0\";r.removed=[];if(!t||!t.document||t.document.nodeType!==9){r.isSupported=false;return r}var n=t.document;var a=n;var i=t.DocumentFragment;var o=t.HTMLTemplateElement;var l=t.NodeFilter;var s=t.NamedNodeMap||t.MozNamedAttrMap;var f=t.Text;var c=t.Comment;var u=t.DOMParser;if(typeof o===\"function\"){var d=n.createElement(\"template\");if(d.content&&d.content.ownerDocument){n=d.content.ownerDocument}}var m=n.implementation;var p=n.createNodeIterator;var h=n.getElementsByTagName;var v=n.createDocumentFragment;var g=a.importNode;var y={};r.isSupported=typeof m.createHTMLDocument!==\"undefined\"&&n.documentMode!==9;var b=function(e,t){var r=t.length;while(r--){if(typeof t[r]===\"string\"){t[r]=t[r].toLowerCase()}e[t[r]]=true}return e};var T=function(e){var t={};var r;for(r in e){if(e.hasOwnProperty(r)){t[r]=e[r]}}return t};var x=null;var k=b({},[\"a\",\"abbr\",\"acronym\",\"address\",\"area\",\"article\",\"aside\",\"audio\",\"b\",\"bdi\",\"bdo\",\"big\",\"blink\",\"blockquote\",\"body\",\"br\",\"button\",\"canvas\",\"caption\",\"center\",\"cite\",\"code\",\"col\",\"colgroup\",\"content\",\"data\",\"datalist\",\"dd\",\"decorator\",\"del\",\"details\",\"dfn\",\"dir\",\"div\",\"dl\",\"dt\",\"element\",\"em\",\"fieldset\",\"figcaption\",\"figure\",\"font\",\"footer\",\"form\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"head\",\"header\",\"hgroup\",\"hr\",\"html\",\"i\",\"img\",\"input\",\"ins\",\"kbd\",\"label\",\"legend\",\"li\",\"main\",\"map\",\"mark\",\"marquee\",\"menu\",\"menuitem\",\"meter\",\"nav\",\"nobr\",\"ol\",\"optgroup\",\"option\",\"output\",\"p\",\"pre\",\"progress\",\"q\",\"rp\",\"rt\",\"ruby\",\"s\",\"samp\",\"section\",\"select\",\"shadow\",\"small\",\"source\",\"spacer\",\"span\",\"strike\",\"strong\",\"style\",\"sub\",\"summary\",\"sup\",\"table\",\"tbody\",\"td\",\"template\",\"textarea\",\"tfoot\",\"th\",\"thead\",\"time\",\"tr\",\"track\",\"tt\",\"u\",\"ul\",\"var\",\"video\",\"wbr\",\"svg\",\"altglyph\",\"altglyphdef\",\"altglyphitem\",\"animatecolor\",\"animatemotion\",\"animatetransform\",\"circle\",\"clippath\",\"defs\",\"desc\",\"ellipse\",\"filter\",\"font\",\"g\",\"glyph\",\"glyphref\",\"hkern\",\"image\",\"line\",\"lineargradient\",\"marker\",\"mask\",\"metadata\",\"mpath\",\"path\",\"pattern\",\"polygon\",\"polyline\",\"radialgradient\",\"rect\",\"stop\",\"switch\",\"symbol\",\"text\",\"textpath\",\"title\",\"tref\",\"tspan\",\"view\",\"vkern\",\"feBlend\",\"feColorMatrix\",\"feComponentTransfer\",\"feComposite\",\"feConvolveMatrix\",\"feDiffuseLighting\",\"feDisplacementMap\",\"feFlood\",\"feFuncA\",\"feFuncB\",\"feFuncG\",\"feFuncR\",\"feGaussianBlur\",\"feMerge\",\"feMergeNode\",\"feMorphology\",\"feOffset\",\"feSpecularLighting\",\"feTile\",\"feTurbulence\",\"math\",\"menclose\",\"merror\",\"mfenced\",\"mfrac\",\"mglyph\",\"mi\",\"mlabeledtr\",\"mmuliscripts\",\"mn\",\"mo\",\"mover\",\"mpadded\",\"mphantom\",\"mroot\",\"mrow\",\"ms\",\"mpspace\",\"msqrt\",\"mystyle\",\"msub\",\"msup\",\"msubsup\",\"mtable\",\"mtd\",\"mtext\",\"mtr\",\"munder\",\"munderover\",\"#text\"]);var A=null;var w=b({},[\"accept\",\"action\",\"align\",\"alt\",\"autocomplete\",\"background\",\"bgcolor\",\"border\",\"cellpadding\",\"cellspacing\",\"checked\",\"cite\",\"class\",\"clear\",\"color\",\"cols\",\"colspan\",\"coords\",\"datetime\",\"default\",\"dir\",\"disabled\",\"download\",\"enctype\",\"face\",\"for\",\"headers\",\"height\",\"hidden\",\"high\",\"href\",\"hreflang\",\"id\",\"ismap\",\"label\",\"lang\",\"list\",\"loop\",\"low\",\"max\",\"maxlength\",\"media\",\"method\",\"min\",\"multiple\",\"name\",\"noshade\",\"novalidate\",\"nowrap\",\"open\",\"optimum\",\"pattern\",\"placeholder\",\"poster\",\"preload\",\"pubdate\",\"radiogroup\",\"readonly\",\"rel\",\"required\",\"rev\",\"reversed\",\"rows\",\"rowspan\",\"spellcheck\",\"scope\",\"selected\",\"shape\",\"size\",\"span\",\"srclang\",\"start\",\"src\",\"step\",\"style\",\"summary\",\"tabindex\",\"title\",\"type\",\"usemap\",\"valign\",\"value\",\"width\",\"xmlns\",\"accent-height\",\"accumulate\",\"additivive\",\"alignment-baseline\",\"ascent\",\"attributename\",\"attributetype\",\"azimuth\",\"basefrequency\",\"baseline-shift\",\"begin\",\"bias\",\"by\",\"clip\",\"clip-path\",\"clip-rule\",\"color\",\"color-interpolation\",\"color-interpolation-filters\",\"color-profile\",\"color-rendering\",\"cx\",\"cy\",\"d\",\"dx\",\"dy\",\"diffuseconstant\",\"direction\",\"display\",\"divisor\",\"dur\",\"edgemode\",\"elevation\",\"end\",\"fill\",\"fill-opacity\",\"fill-rule\",\"filter\",\"flood-color\",\"flood-opacity\",\"font-family\",\"font-size\",\"font-size-adjust\",\"font-stretch\",\"font-style\",\"font-variant\",\"font-weight\",\"fx\",\"fy\",\"g1\",\"g2\",\"glyph-name\",\"glyphref\",\"gradientunits\",\"gradienttransform\",\"image-rendering\",\"in\",\"in2\",\"k\",\"k1\",\"k2\",\"k3\",\"k4\",\"kerning\",\"keypoints\",\"keysplines\",\"keytimes\",\"lengthadjust\",\"letter-spacing\",\"kernelmatrix\",\"kernelunitlength\",\"lighting-color\",\"local\",\"marker-end\",\"marker-mid\",\"marker-start\",\"markerheight\",\"markerunits\",\"markerwidth\",\"maskcontentunits\",\"maskunits\",\"max\",\"mask\",\"mode\",\"min\",\"numoctaves\",\"offset\",\"operator\",\"opacity\",\"order\",\"orient\",\"orientation\",\"origin\",\"overflow\",\"paint-order\",\"path\",\"pathlength\",\"patterncontentunits\",\"patterntransform\",\"patternunits\",\"points\",\"preservealpha\",\"r\",\"rx\",\"ry\",\"radius\",\"refx\",\"refy\",\"repeatcount\",\"repeatdur\",\"restart\",\"result\",\"rotate\",\"scale\",\"seed\",\"shape-rendering\",\"specularconstant\",\"specularexponent\",\"spreadmethod\",\"stddeviation\",\"stitchtiles\",\"stop-color\",\"stop-opacity\",\"stroke-dasharray\",\"stroke-dashoffset\",\"stroke-linecap\",\"stroke-linejoin\",\"stroke-miterlimit\",\"stroke-opacity\",\"stroke\",\"stroke-width\",\"surfacescale\",\"targetx\",\"targety\",\"transform\",\"text-anchor\",\"text-decoration\",\"text-rendering\",\"textlength\",\"u1\",\"u2\",\"unicode\",\"values\",\"viewbox\",\"visibility\",\"vert-adv-y\",\"vert-origin-x\",\"vert-origin-y\",\"word-spacing\",\"wrap\",\"writing-mode\",\"xchannelselector\",\"ychannelselector\",\"x\",\"x1\",\"x2\",\"y\",\"y1\",\"y2\",\"z\",\"zoomandpan\",\"accent\",\"accentunder\",\"bevelled\",\"close\",\"columnsalign\",\"columnlines\",\"columnspan\",\"denomalign\",\"depth\",\"display\",\"displaystyle\",\"fence\",\"frame\",\"largeop\",\"length\",\"linethickness\",\"lspace\",\"lquote\",\"mathbackground\",\"mathcolor\",\"mathsize\",\"mathvariant\",\"maxsize\",\"minsize\",\"movablelimits\",\"notation\",\"numalign\",\"open\",\"rowalign\",\"rowlines\",\"rowspacing\",\"rowspan\",\"rspace\",\"rquote\",\"scriptlevel\",\"scriptminsize\",\"scriptsizemultiplier\",\"selection\",\"separator\",\"separators\",\"stretchy\",\"subscriptshift\",\"supscriptshift\",\"symmetric\",\"voffset\",\"xlink:href\",\"xml:id\",\"xlink:title\",\"xml:space\",\"xmlns:xlink\"]);var E=null;var S=null;var M=true;var O=false;var L=false;var N=false;var D=/\\{\\{[\\s\\S]*|[\\s\\S]*\\}\\}/gm;var _=/<%[\\s\\S]*|[\\s\\S]*%>/gm;var C=false;var z=false;var R=false;var F=false;var H=true;var B=true;var W=b({},[\"audio\",\"head\",\"math\",\"script\",\"style\",\"svg\",\"video\"]);var j=b({},[\"audio\",\"video\",\"img\",\"source\"]);var G=b({},[\"alt\",\"class\",\"for\",\"id\",\"label\",\"name\",\"pattern\",\"placeholder\",\"summary\",\"title\",\"value\",\"style\",\"xmlns\"]);var I=null;var q=n.createElement(\"form\");var P=function(e){if(typeof e!==\"object\"){e={}}x=\"ALLOWED_TAGS\"in e?b({},e.ALLOWED_TAGS):k;A=\"ALLOWED_ATTR\"in e?b({},e.ALLOWED_ATTR):w;E=\"FORBID_TAGS\"in e?b({},e.FORBID_TAGS):{};S=\"FORBID_ATTR\"in e?b({},e.FORBID_ATTR):{};M=e.ALLOW_DATA_ATTR!==false;O=e.ALLOW_UNKNOWN_PROTOCOLS||false;L=e.SAFE_FOR_JQUERY||false;N=e.SAFE_FOR_TEMPLATES||false;C=e.WHOLE_DOCUMENT||false;z=e.RETURN_DOM||false;R=e.RETURN_DOM_FRAGMENT||false;F=e.RETURN_DOM_IMPORT||false;H=e.SANITIZE_DOM!==false;B=e.KEEP_CONTENT!==false;if(N){M=false}if(R){z=true}if(e.ADD_TAGS){if(x===k){x=T(x)}b(x,e.ADD_TAGS)}if(e.ADD_ATTR){if(A===w){A=T(A)}b(A,e.ADD_ATTR)}if(B){x[\"#text\"]=true}if(Object&&\"freeze\"in Object){Object.freeze(e)}I=e};var U=function(e){r.removed.push({element:e});try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=\"\"}};var V=function(e,t){r.removed.push({attribute:t.getAttributeNode(e),from:t});t.removeAttribute(e)};var K=function(e){var t,r;try{t=(new u).parseFromString(e,\"text/html\")}catch(n){}if(!t||!t.documentElement){t=m.createHTMLDocument(\"\");r=t.body;r.parentNode.removeChild(r.parentNode.firstElementChild);r.outerHTML=e}if(typeof t.getElementsByTagName===\"function\"){return t.getElementsByTagName(C?\"html\":\"body\")[0]}return h.call(t,C?\"html\":\"body\")[0]};var J=function(e){return p.call(e.ownerDocument||e,e,l.SHOW_ELEMENT|l.SHOW_COMMENT|l.SHOW_TEXT,function(){return l.FILTER_ACCEPT},false)};var Q=function(e){if(e instanceof f||e instanceof c){return false}if(typeof e.nodeName!==\"string\"||typeof e.textContent!==\"string\"||typeof e.removeChild!==\"function\"||!(e.attributes instanceof s)||typeof e.removeAttribute!==\"function\"||typeof e.setAttribute!==\"function\"){return true}return false};var X=function(e){var t,r;ne(\"beforeSanitizeElements\",e,null);if(Q(e)){U(e);return true}t=e.nodeName.toLowerCase();ne(\"uponSanitizeElement\",e,{tagName:t});if(!x[t]||E[t]){if(B&&!W[t]&&typeof e.insertAdjacentHTML===\"function\"){try{e.insertAdjacentHTML(\"AfterEnd\",e.innerHTML)}catch(n){}}U(e);return true}if(L&&!e.firstElementChild&&(!e.content||!e.content.firstElementChild)){e.innerHTML=e.textContent.replace(/</g,\"&lt;\")}if(N&&e.nodeType===3){r=e.textContent;r=r.replace(D,\" \");r=r.replace(_,\" \");e.textContent=r}ne(\"afterSanitizeElements\",e,null);return false};var Y=/^data-[\\-\\w.\\u00B7-\\uFFFF]/;var Z=/^(?:(?:(?:f|ht)tps?|mailto|tel):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i;var $=/^(?:\\w+script|data):/i;var ee=/[\\x00-\\x20\\xA0\\u1680\\u180E\\u2000-\\u2029\\u205f\\u3000]/g;var te=function(e){var r,a,i,o,l,s,f,c;ne(\"beforeSanitizeAttributes\",e,null);s=e.attributes;if(!s){return}f={attrName:\"\",attrValue:\"\",keepAttr:true};c=s.length;while(c--){r=s[c];a=r.name;i=r.value;o=a.toLowerCase();f.attrName=o;f.attrValue=i;f.keepAttr=true;ne(\"uponSanitizeAttribute\",e,f);i=f.attrValue;if(o===\"name\"&&e.nodeName===\"IMG\"&&s.id){l=s.id;s=Array.prototype.slice.apply(s);V(\"id\",e);V(a,e);if(s.indexOf(l)>c){e.setAttribute(\"id\",l.value)}}else{if(a===\"id\"){e.setAttribute(a,\"\")}V(a,e)}if(!f.keepAttr){continue}if(H&&(o===\"id\"||o===\"name\")&&(i in t||i in n||i in q)){continue}if(N){i=i.replace(D,\" \");i=i.replace(_,\" \")}if(A[o]&&!S[o]&&(G[o]||Z.test(i.replace(ee,\"\"))||o===\"src\"&&i.indexOf(\"data:\")===0&&j[e.nodeName.toLowerCase()])||M&&Y.test(o)||O&&!$.test(i.replace(ee,\"\"))){try{e.setAttribute(a,i)}catch(u){}}}ne(\"afterSanitizeAttributes\",e,null)};var re=function(e){var t;var r=J(e);ne(\"beforeSanitizeShadowDOM\",e,null);while(t=r.nextNode()){ne(\"uponSanitizeShadowNode\",t,null);if(X(t)){continue}if(t.content instanceof i){re(t.content)}te(t)}ne(\"afterSanitizeShadowDOM\",e,null)};var ne=function(e,t,n){if(!y[e]){return}y[e].forEach(function(e){e.call(r,t,n,I)})};r.sanitize=function(e,n){var o,l,s,f,c;if(!e){e=\"\"}if(typeof e!==\"string\"){if(typeof e.toString!==\"function\"){throw new TypeError(\"toString is not a function\")}else{e=e.toString()}}if(!r.isSupported){if(typeof t.toStaticHTML===\"object\"||typeof t.toStaticHTML===\"function\"){return t.toStaticHTML(e)}return e}P(n);r.removed=[];if(!z&&!C&&e.indexOf(\"<\")===-1){return e}o=K(e);if(!o){return z?null:\"\"}f=J(o);while(l=f.nextNode()){if(l.nodeType===3&&l===s){continue}if(X(l)){continue}if(l.content instanceof i){re(l.content)}te(l);s=l}if(z){if(R){c=v.call(o.ownerDocument);while(o.firstChild){c.appendChild(o.firstChild)}}else{c=o}if(F){c=g.call(a,c,true)}return c}return C?o.outerHTML:o.innerHTML};r.addHook=function(e,t){if(typeof t!==\"function\"){return}y[e]=y[e]||[];y[e].push(t)};r.removeHook=function(e){if(y[e]){y[e].pop()}};r.removeHooks=function(e){if(y[e]){y[e]=[]}};r.removeAllHooks=function(){y=[]};return r});","if (!String.prototype.endsWith) {\r\n  String.prototype.endsWith = function(searchString, position) {\r\n      var subjectString = this.toString();\r\n      if (typeof position !== 'number' || !isFinite(position) || Math.floor(position) !== position || position > subjectString.length) {\r\n        position = subjectString.length;\r\n      }\r\n      position -= searchString.length;\r\n      var lastIndex = subjectString.indexOf(searchString, position);\r\n      return lastIndex !== -1 && lastIndex === position;\r\n  };\r\n}\r\n\r\n// Define outerHtml method for jQuery since we need to give openlayers plain html\r\n// http://stackoverflow.com/questions/2419749/get-selected-elements-outer-html\r\n// Elements outerHtml property only works on IE and chrome\r\njQuery.fn.outerHTML = function (arg) {\r\n    var ret;\r\n\r\n    // If no items in the collection, return\r\n    if (!this.length) {\r\n        return typeof arg === 'undefined' ? this : null;\r\n    }\r\n    // Getter overload (no argument passed)\r\n    if (!arg) {\r\n        return this[0].outerHTML || (ret = this.wrap('<div>').parent().html(), this.unwrap(), ret);\r\n    }\r\n    // Setter overload\r\n    jQuery.each(this, function (i, el) {\r\n        var fnRet,\r\n            pass = el,\r\n            inOrOut = el.outerHTML ? 'outerHTML' : 'innerHTML';\r\n\r\n        if (!el.outerHTML) {\r\n            el = jQuery(el).wrap('<div>').parent()[0];\r\n        }\r\n\r\n        if (jQuery.isFunction(arg)) {\r\n            if ((fnRet = arg.call(pass, i, el[inOrOut])) !== false) {\r\n                el[inOrOut] = fnRet;\r\n            }\r\n        } else {\r\n            el[inOrOut] = arg;\r\n        }\r\n\r\n        if (!el.outerHTML) {\r\n            jQuery(el).children().unwrap();\r\n        }\r\n    });\r\n\r\n    return this;\r\n};\r\n/*\r\n// Polymer statsgrid needs this for IE, but there are more problems with it so we don't need to add it yet\r\n// new Event(); polyfill for IE\r\n(function () {\r\n  // https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent\r\n  try {\r\n    new Event();\r\n  } catch(err) {\r\n    function CustomEvent ( event, params ) {\r\n      params = params || { bubbles: false, cancelable: false, detail: undefined };\r\n      var evt = document.createEvent( 'CustomEvent' );\r\n      evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\r\n      return evt;\r\n     }\r\n\r\n    CustomEvent.prototype = window.Event.prototype;\r\n\r\n    window.CustomEvent = CustomEvent;\r\n  }\r\n})();\r\n*/","/**\r\n * @class Oskari\r\n *\r\n * A set of methods to support loosely coupled classes and instances for the mapframework\r\n */\r\nOskari = (function () {\r\n    var isDebug = false;\r\n    var _markers = [];\r\n\r\n    return {\r\n        VERSION : \"1.41.0\",\r\n\r\n        /**\r\n         * @public @method Oskari.setDebugMode\r\n         * @param {boolean} d Debug mode on/off\r\n         */\r\n        setDebugMode: function (d) {\r\n            isDebug = !!d;\r\n        },\r\n        isDebug : function() {\r\n            return isDebug;\r\n        },\r\n        /**\r\n         * @public @static @method Oskari.setMarkers\r\n         * @param {Array} markers markers\r\n         */\r\n        setMarkers: function(markers) {\r\n            _markers = markers || [];\r\n        },\r\n        /**\r\n         * @public @static @method Oskari.getMarkers\r\n         * @return {Array} markers markers\r\n         */\r\n        getMarkers: function() {\r\n            return _markers;\r\n        },\r\n\r\n        /**\r\n         * @public @static @method Oskari.getDefaultMarker\r\n         * @return {Object} default marker\r\n         */\r\n        getDefaultMarker: function(){\r\n            return (_markers.length>=3) ? _markers[2] : _markers[0];\r\n        }\r\n    };\r\n}());","/**\r\n * Adds a sequence counter to Oskari\r\n * Oskari.seq.nextVal(<type>)\r\n * @param  {String} type optional type\r\n * @return {Integer} next available sequence number for the type\r\n */\r\n(function(o) {\r\n    var serials = {};\r\n    var count = 0;\r\n    o.seq = {\r\n    \tnextVal: function (type) {\r\n\t    \tif(!type) {\r\n\t    \t\treturn count++;\r\n\t    \t}\r\n\t        if (!serials[type]) {\r\n\t            serials[type] = 1;\r\n\t        } else {\r\n\t            serials[type] += 1;\r\n\t        }\r\n\t        return serials[type];\r\n\t    }\r\n    };\r\n}(Oskari));","/**\r\n * Provides logger functionality for Oskari\r\n * var log = Oskari.log('MyLog');\r\n * log.enableDebug(true);\r\n * log.debug('my debug message');\r\n * log.warn('my warn message');\r\n * log.error('my error message');\r\n */\r\n(function() {\r\n\r\n    var hasConsole = window.console;\r\n    // Set to true to enable timestamps in log messages\r\n    var inclTimestamp = false;\r\n\t/** Utility methods for logger */\r\n    var _logMsg = function (args) {\r\n    \tvar level = args.shift();\r\n        if (!hasConsole || \r\n        \t!window.console[level] || \r\n        \t!window.console[level].apply) {\r\n            // maybe gather messages and provide a custom debug console?\r\n            return;\r\n        }\r\n        window.console[level].apply(window.console, args);\r\n    };\r\n\r\n    var _unshift = function(addToFirst, list) {\r\n  \t\tvar args = Array.prototype.slice.call(list);\r\n  \t\targs.unshift(addToFirst);\r\n    \treturn args;\r\n    }\r\n    var ts = function() {\r\n    \tif(!inclTimestamp) {\r\n    \t\treturn '';\r\n    \t}\r\n    \tvar date = new Date();\r\n    \treturn date.toLocaleTimeString() + '.' + date.getUTCMilliseconds() + ' ';\r\n    }\r\n    var _doLogging = function(logName, logLevel, logMessages, includeCaller, callee) {\r\n    \tvar header = ts() + logName + ':';\r\n    \t// prefix messages with logName\r\n        var newArgs = _unshift(header, logMessages);\r\n    \t// prefix logName + messages with logLevel\r\n        newArgs = _unshift(logLevel, newArgs);\r\n        // attach caller info if available and requested\r\n        if(includeCaller && callee && callee.caller) {\r\n            newArgs.push(callee.caller);\r\n        }\r\n        // write to log\r\n        _logMsg(newArgs, callee);\r\n    }\r\n\t/**\r\n\t * Logger definition\r\n\t * @param {String} name logger name\r\n\t */\r\n    var Logger = function(name, enableDebug, inclCaller) {\r\n        this.name = name || \"Logger\";\r\n        this.isDebug = !!enableDebug;\r\n        this.includeCaller = !!inclCaller;\r\n    };\r\n\r\n    Logger.prototype.setInclCaller = function(bln) {\r\n        this.includeCaller = !!bln;\r\n    }\r\n\r\n    Logger.prototype.enableDebug = function(bln) {\r\n        this.isDebug = !!bln;\r\n    }\r\n\r\n    Logger.prototype.debug = function() {\r\n        if(!this.isDebug) {\r\n            return;\r\n        }\r\n        _doLogging(this.name, 'debug', arguments, this.includeCaller, arguments.callee);\r\n    };\r\n\r\n    Logger.prototype.info =  function() {\r\n        _doLogging(this.name, 'log', arguments, this.includeCaller, arguments.callee);\r\n    };\r\n\r\n    Logger.prototype.warn =  function() {\r\n        _doLogging(this.name, 'warn', arguments, this.includeCaller, arguments.callee);\r\n    };\r\n\r\n    Logger.prototype.error =  function() {\r\n        _doLogging(this.name, 'error', arguments, this.includeCaller, arguments.callee);\r\n    };\r\n\r\n    // keep track of existing loggers\r\n\tvar loggers = {};\r\n\r\n\tOskari.log = function(logName) {\r\n\t\tlogName = logName || \"Oskari\";\r\n\t\tif(loggers[logName]) {\r\n\t\t\treturn loggers[logName];\r\n\t\t}\r\n\t\tvar log = new Logger(logName);\r\n\t\tloggers[logName] = log;\r\n\t    return log;\r\n\t};\r\n\r\n}());\r\n","(function(o) {\r\n    // default impl for validator and defaultValue generator\r\n    var noop = function() { return true; };\r\n\r\n    var setterGetter = function setterGetterFn(collection, key, value, defaultValue, validator) {\r\n        if (!collection) {\r\n            return;\r\n        }\r\n\r\n        // setter\r\n        if (key && value) {\r\n            var currentValue = collection[key];\r\n\r\n            // validate if validator is provided, pass is value and previous value\r\n            if (!validator(value, currentValue)) {\r\n                return false;\r\n            }\r\n\r\n            collection[key] = value;\r\n            return true;\r\n        }\r\n\r\n        // getters\r\n        if (!key) {\r\n            // get registered keys\r\n            var result = [];\r\n            for (var prop in collection) {\r\n                result.push(prop);\r\n            };\r\n            return result;\r\n        } else {\r\n            if(!collection[key]) {\r\n                collection[key] = defaultValue(key);\r\n            }\r\n            // return values registered for name\r\n            return collection[key];\r\n        }\r\n    };\r\n    /*\r\n    Returns an object with given methodName (defaults to 'data' if missing -> uses options as first param)\r\n    options is an (optional) object with keys:\r\n    - defaultValue : function that returns value to use if key doesn't have a value, it will receive the key as parameter\r\n    - validator : function that will receive the value to be inserted and the current value as params\r\n\r\n    Returns an object with functions:\r\n    - reset(key) : removes value from the key or resets the whole storage if omitted\r\n    - data(key, value) :\r\n        - the actual method name can be overridden with constructor arg (defaults to data)\r\n    */\r\n    var Storage = function(methodName, options) {\r\n        // normalize params\r\n        if (typeof methodName !== 'string') {\r\n            options = methodName;\r\n            methodName = null;\r\n        }\r\n\r\n        methodName = methodName || 'data';\r\n        if (typeof options !== 'object') {\r\n            options = {};\r\n        }\r\n\r\n        var _collection = {};\r\n        var _me = {\r\n            reset: function(key) {\r\n                if (!key) {\r\n                    // do we need to loop and delete here to save memory?\r\n                    _collection = {};\r\n                } else {\r\n                    delete _collection[key];\r\n                }\r\n            }\r\n        };\r\n        // Initialize default value function to no-op if not a function\r\n        var defaultValue = options.defaultValue;\r\n        if (typeof defaultValue !== 'function') {\r\n            defaultValue = noop;\r\n        }\r\n        var validator = options.validator;\r\n        if (typeof validator !== 'function') {\r\n            validator = noop;\r\n        }\r\n\r\n        _me[methodName] = function(key, value) {\r\n            return setterGetter(_collection, key, value, defaultValue, validator);\r\n        };\r\n\r\n        return _me;\r\n    };\r\n\r\n    o.createStore = function(methodName, options) {\r\n        return new Storage(methodName, options);\r\n    };\r\n}(Oskari));","/**\r\n * Creates on, off, trigger functions for Oskari\r\n */\r\n(function(o) {\r\n    if (!o) {\r\n        // can't add eventbus if no Oskari ref\r\n        return;\r\n    }\r\n    if (o.on) {\r\n        // already created on, don't run again\r\n        return;\r\n    }\r\n    var log = Oskari.log('Events');\r\n\r\n    var EventBus = function() {\r\n\r\n        var store = o.createStore('subscribers', {\r\n            defaultValue: function() {\r\n                // return an array as default for any key\r\n                return [];\r\n            }\r\n        });\r\n\r\n        return {\r\n            'on': function(event, handlerFn) {\r\n                // only allow functions to be stored as handlers\r\n                if (typeof handlerFn !== 'function') {\r\n                    return false;\r\n                }\r\n\r\n                var list = store.subscribers(event);\r\n\r\n                list.push(handlerFn);\r\n                log.debug('Subscriber added for ' + event);\r\n                return store.subscribers(event, list);\r\n            },\r\n\r\n            'off': function(event, handlerFn) {\r\n                var currentSubs = store.subscribers(event);\r\n\r\n                // remove if handlerFn found in currentSubs\r\n                var success = false;\r\n                for (var n = 0; n < currentSubs.length; n++) {\r\n                    if (currentSubs[n] === handlerFn) {\r\n                        currentSubs.splice(n, 1);\r\n                        success = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                log.debug('Subscriber removed for ' + event);\r\n                return success;\r\n            },\r\n\r\n            'trigger': function(event, data) {\r\n                var currentSubs = store.subscribers(event);\r\n                var count = 0;\r\n                currentSubs.forEach(function(sub) {\r\n                    try {\r\n                        sub(data, event);\r\n                        count++;\r\n                    } catch (e) {\r\n                        log.warn('Error notifying about ' + event, e);\r\n                    }\r\n                });\r\n\r\n                log.debug('Triggered ' + event + ' - subscribers: ' + count);\r\n                return count;\r\n            }\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Creates an event bus and attaches to target if parameter is given\r\n     * @param  {Object} target optional target to attach observable functions\r\n     * @return {Object} object with on, off and trigger functions\r\n     */\r\n    o.makeObservable = function(target) {\r\n        var bus = new EventBus();\r\n        if (!target) {\r\n            return bus;\r\n        }\r\n        target.on = bus.on;\r\n        target.off = bus.off;\r\n        target.trigger = bus.trigger;\r\n        return target;\r\n    };\r\n\r\n    // create eventbus for Oskari core\r\n    o.makeObservable(o);\r\n\r\n}(Oskari));","\r\n/*\r\n* @class Oskari.util\r\n* Util class instance for static methods what may be used to for checks values.\r\n* For example check at value is number or how many decimals this value have.\r\n*\r\n*/\r\nOskari.util = (function () {\r\n    var log = Oskari.log('Oskari.util');\r\n    var util = {};\r\n\r\n    /**\r\n    * Checks at if value has leading zeros.\r\n    * @private @method isLeadingZero\r\n    *\r\n    * @param {Object} value checked value\r\n    */\r\n    function isLeadingZero(value){\r\n        if(typeof value === 'string' && value.length>0 && value[0] === '0') {\r\n            if(util.isDecimal(value) && value.length>1 && value[1] === '.') {\r\n                return false;\r\n            } else {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n    * Checks at if value is number.\r\n    * @static @method Oskari.util.isNumber\r\n    *\r\n    * @param {Object} value checked value\r\n    * @param {Boolean} keepLeadingZero, need keep leading zero\r\n    */\r\n    util.isNumber = function(value, keepLeadingZero) {\r\n        if(value === null) {\r\n            return false;\r\n        }\r\n        var reg = new RegExp('^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$'),\r\n            isNumber = true,\r\n            i;\r\n\r\n        if(typeof value === 'object') {\r\n            for(i=0; i<value.length; i++) {\r\n                if(keepLeadingZero && keepLeadingZero === true && isLeadingZero(value[i] + '')) {\r\n                   isNumber = false;\r\n                   break;\r\n                }\r\n                if(reg.test(value[i]) === false) {\r\n                    isNumber = false;\r\n                    break;\r\n                }\r\n            }\r\n        } else {\r\n            if(keepLeadingZero && keepLeadingZero === true && isLeadingZero(value + '')) {\r\n                isNumber = false;\r\n            } else {\r\n                isNumber = reg.test(value);\r\n            }\r\n        }\r\n        return isNumber;\r\n    };\r\n\r\n    /**\r\n    * Checks at if value is decimal.\r\n    * @static @method Oskari.util.isDecimal\r\n    *\r\n    * @param {Object} value checked value\r\n    */\r\n    util.isDecimal = function(value){\r\n        var isDecimal = true,\r\n            i,\r\n            s,\r\n            val;\r\n\r\n        if(!value || value === null || value === '') {\r\n            return false;\r\n        }\r\n\r\n        if(typeof value === 'object') {\r\n             for(i=0; i<value.length; i++) {\r\n                val = String(value[i]);\r\n                s = val.split('.');\r\n                if(s.length === 2 && !isLeadingZero(val) && !isNaN(s[0]) && !isNaN(s[1])){\r\n                    isDecimal = true;\r\n                } else {\r\n                    isDecimal = false;\r\n                }\r\n                if(isDecimal === false) {\r\n                    break;\r\n                }\r\n             }\r\n        } else {\r\n            val = value+'';\r\n            s = val.split('.');\r\n\r\n            if(s.length === 2 && !isNaN(s[0]) && !isNaN(s[1]) &&\r\n                ((isLeadingZero(s[0]) && s[0].length==1) || !isLeadingZero(s[0]))\r\n                ){\r\n                isDecimal = true;\r\n            } else {\r\n                isDecimal = false;\r\n            }\r\n        }\r\n        return isDecimal;\r\n    };\r\n\r\n    /**\r\n    * Calculates the amount of decimals in value or maximum number of decimals in numbers of an array.\r\n    * @static @method Oskari.util.decimals\r\n    *\r\n    * @param {Object} value checked value\r\n    */\r\n    util.decimals = function(value){\r\n        var val,\r\n            maxDecimals = 0;\r\n\r\n        if(!value || value === null || value === '' || (isNaN(value) && typeof value !== 'object')) {\r\n            return null;\r\n        }\r\n        if(typeof value === 'object') {\r\n            for(i=0; i<value.length; i++) {\r\n                val = value[i] + '';\r\n                val = val.split('.');\r\n                if(val.length===2 && maxDecimals<val[1].length) {\r\n                    maxDecimals = val[1].length;\r\n                }\r\n            }\r\n            return maxDecimals;\r\n        } else {\r\n            val = value + '';\r\n            val = val.split('.');\r\n            return val.length === 2 ? val[1].length : 0;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Converts hexadecimal color values to decimal values (255,255,255)\r\n     * Green: hexToRgb(\"#0033ff\").g\r\n     * http://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\r\n     *\r\n     * @method hex\r\n     * hexadecimal color value e.g. '#00ff99'\r\n     */\r\n    util.hexToRgb = function(hex) {\r\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n        var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        hex = hex.replace(shorthandRegex, function (m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n\r\n        var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        return result ? {\r\n            r: parseInt(result[1], 16),\r\n            g: parseInt(result[2], 16),\r\n            b: parseInt(result[3], 16)\r\n        } : null;\r\n    };\r\n\r\n    /**\r\n     * Convert rgb values to hexadecimal color values\r\n     *\r\n     * @method rgbToHex\r\n     * @param {String} rgb decimal color values e.g. 'rgb(255,0,0)'\r\n     */\r\n    util.rgbToHex = function (rgb) {\r\n        if (rgb.charAt(0) === '#') {\r\n            return rgb.substring(1);\r\n        }\r\n        var parts = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/),\r\n            j;\r\n\r\n        delete(parts[0]);\r\n        for (j = 1; j <= 3; j += 1) {\r\n            parts[j] = parseInt(parts[j], 10).toString(16);\r\n            if (parts[j].length === 1) {\r\n                parts[j] = '0' + parts[j];\r\n            }\r\n        }\r\n        return parts.join('');\r\n    };\r\n\r\n   /**\r\n    * Check, if nested key exists\r\n    * @method keyExists\r\n    * @params {Object}  object to check { \"test\" : { \"this\" : true }}\r\n    * @params String object path \"test.this\"\r\n    * @public\r\n    *\r\n    * @returns {Boolean}: true if nested key exists\r\n    */\r\n    util.keyExists = function(obj, keypath) {\r\n        var tmpObj = obj,\r\n            cnt = 0,\r\n            splits = keypath.split('.');\r\n\r\n        for (var i=0; tmpObj && i < splits.length; i++) {\r\n            if (splits[i] in tmpObj) {\r\n                tmpObj = tmpObj[splits[i]];\r\n                cnt++;\r\n            }\r\n        }\r\n        return cnt === splits.length;\r\n    };\r\n\r\n    /**\r\n     * Natural array sort\r\n     * @method  naturalSort\r\n     * @param  {String|Integer|Double} valueA     sorted value a\r\n     * @param  {String|Integer|Double} valueB     soted value b\r\n     * @param  {Boolean} descending is descending\r\n     * @return {Integer}            sort number\r\n     */\r\n    util.naturalSort = function(valueA, valueB, descending) {\r\n        var re = /(^([+\\-]?(?:\\d*)(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)?$|^0x[\\da-fA-F]+$|\\d+)/g,\r\n            sre = /^\\s+|\\s+$/g,   // trim pre-post whitespace\r\n            snre = /\\s+/g,        // normalize all whitespace to single ' ' character\r\n            dre = /(^([\\w ]+,?[\\w ]+)?[\\w ]+,?[\\w ]+\\d+:\\d+(:\\d+)?[\\w ]?|^\\d{1,4}[\\/\\-]\\d{1,4}[\\/\\-]\\d{1,4}|^\\w+, \\w+ \\d+, \\d{4})/,\r\n            hre = /^0x[0-9a-f]+$/i,\r\n            ore = /^0/,\r\n            i = function(s) {\r\n                return ('' + s).toLowerCase().replace(sre, '');\r\n            },\r\n            // convert all to strings strip whitespace\r\n            x = i(valueA) || '',\r\n            y = i(valueB) || '',\r\n            // chunk/tokenize\r\n            xN = x.replace(re, '\\0$1\\0').replace(/\\0$/,'').replace(/^\\0/,'').split('\\0'),\r\n            yN = y.replace(re, '\\0$1\\0').replace(/\\0$/,'').replace(/^\\0/,'').split('\\0'),\r\n            // numeric, hex or date detection\r\n            xD = parseInt(x.match(hre), 16) || (xN.length !== 1 && Date.parse(x)),\r\n            yD = parseInt(y.match(hre), 16) || xD && y.match(dre) && Date.parse(y) || null,\r\n            normChunk = function(s, l) {\r\n                // normalize spaces; find floats not starting with '0', string or 0 if not defined (Clint Priest)\r\n                return (!s.match(ore) || l == 1) && parseFloat(s) || s.replace(snre, ' ').replace(sre, '') || 0;\r\n            },\r\n            sortFunc = function(oFxNcL, oFyNcL){\r\n                // handle numeric vs string comparison - number < string - (Kyle Adams)\r\n                if (isNaN(oFxNcL) !== isNaN(oFyNcL)) {\r\n                    retValue = (isNaN(oFxNcL)) ? 1 : -1;\r\n                    return true;\r\n                }\r\n                // rely on string comparison if different types - i.e. '02' < 2 != '02' < '2'\r\n                else if (typeof oFxNcL !== typeof oFyNcL) {\r\n                    oFxNcL += '';\r\n                    oFyNcL += '';\r\n                }\r\n\r\n                if (oFxNcL < oFyNcL) {\r\n                    retValue = -1;\r\n                    return true;\r\n                }\r\n                if (oFxNcL > oFyNcL) {\r\n                    retValue = 1;\r\n                    return true;\r\n                }\r\n            },\r\n            oFxNcL, oFyNcL,\r\n            retValue = 0,\r\n            sortCompleted = false;\r\n\r\n        // first try and sort Hex codes or Dates\r\n        if (yD) {\r\n            if ( xD < yD ) {\r\n                retValue = -1;\r\n                sortCompleted = true;\r\n            }\r\n            else if ( xD > yD ) {\r\n                retValue = 1;\r\n                sortCompleted = true;\r\n            }\r\n        }\r\n\r\n        if(!sortCompleted) {\r\n            // natural sorting through split numeric strings and default strings\r\n            for(var cLoc=0, xNl = xN.length, yNl = yN.length, numS=Math.max(xNl, yNl); cLoc < numS; cLoc++) {\r\n                oFxNcL = normChunk(xN[cLoc] || '', xNl);\r\n                oFyNcL = normChunk(yN[cLoc] || '', yNl);\r\n\r\n                sortCompleted = sortFunc(oFxNcL, oFyNcL);\r\n\r\n                if(sortCompleted) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (descending) {\r\n            retValue =  -1 * retValue;\r\n        }\r\n        return retValue;\r\n    };\r\n\r\n    util.getColorBrightness = function(color){\r\n        var r,g,b,brightness;\r\n\r\n        if (color.match(/^rgb/)) {\r\n          color = color.match(/rgba?\\(([^)]+)\\)/)[1];\r\n          color = color.split(/ *, */).map(Number);\r\n          r = color[0];\r\n          g = color[1];\r\n          b = color[2];\r\n        } else if ('#' == color[0] && 7 == color.length) {\r\n          r = parseInt(color.slice(1, 3), 16);\r\n          g = parseInt(color.slice(3, 5), 16);\r\n          b = parseInt(color.slice(5, 7), 16);\r\n        } else if ('#' == color[0] && 4 == color.length) {\r\n          r = parseInt(color[1] + color[1], 16);\r\n          g = parseInt(color[2] + color[2], 16);\r\n          b = parseInt(color[3] + color[3], 16);\r\n        }\r\n\r\n        brightness = (r * 299 + g * 587 + b * 114) / 1000;\r\n\r\n        if (brightness < 125) {\r\n          return 'dark';\r\n        } else {\r\n          return 'light';\r\n        }\r\n    };\r\n    util.isDarkColor = function(color){\r\n        return this.getColorBrightness(color) === 'dark';\r\n    };\r\n    util.isLightColor = function(color){\r\n        return this.getColorBrightness(color) === 'light';\r\n    };\r\n\r\n    util.isMobile = function() {\r\n        var md = new MobileDetect(window.navigator.userAgent);\r\n        var mobileDefs = {\r\n            width: 500,\r\n            height: 400\r\n        };\r\n        var size = {\r\n            height: jQuery(window).height(),\r\n            width: jQuery(window).width()\r\n        };\r\n\r\n        var isSizeMobile = false;\r\n        if(size.width <= mobileDefs.width || size.height <= mobileDefs.height) {\r\n            isSizeMobile = true;\r\n        }\r\n\r\n        var isMobile = (md.mobile() !== null) ? true : isSizeMobile;\r\n\r\n        return isMobile;\r\n    };\r\n    /**\r\n     *\r\n     * Sanitizes input and returns a string containing the sanitized content that can be injected to document and shown to user.\r\n     * @param {String} content content to sanitize\r\n     * @return String\r\n     */\r\n    util.sanitize = function(content) {\r\n        return DOMPurify.sanitize(content, {SAFE_FOR_JQUERY: true, ADD_ATTR: ['target']});\r\n    };\r\n\r\n    var validCoordinates = function(point) {\r\n        if(!point && typeof point !== 'object' && isNaN(point.length) && point.length !== 2)  {\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n    };\r\n\r\n    var coordChars = {\r\n        CHAR_DEG: \"\\u00B0\",\r\n        CHAR_MIN: \"\\u0027\",\r\n        CHAR_SEC: \"\\u0022\",\r\n        CHAR_SEP: \"\\u0020\"\r\n    };\r\n\r\n    var coordinateDMSDecode = function(value) {\r\n        if(typeof value === 'number') {\r\n            value = '' + value;\r\n        }\r\n        value = value.replace(Oskari.getDecimalSeparator(), '.');\r\n        // also convert comma to dot\r\n        value = value.replace(',', '.');\r\n\r\n        var patterns = {\r\n            'DDMMSS.s':     '(-?\\\\d+)[' + coordChars.CHAR_DEG + 'd]\\\\s*' +          // DD\r\n                            '(\\\\d+)' + coordChars.CHAR_MIN + '\\\\s*' +               // MM\r\n                            '(\\\\d+(?:\\\\.\\\\d+)?)' + coordChars.CHAR_SEC,             // SS.s\r\n            'DDMM.mmm 1':   '(-?\\\\d+)[' + coordChars.CHAR_DEG + 'd]\\\\s*' +          // DD\r\n                            '(\\\\d+(?:\\\\.\\\\d+)?)[' + coordChars.CHAR_MIN + ']\\\\s*',  // MM.mmm\r\n            'DDMM.mmm 2':   '(-?\\\\d+)[' + coordChars.CHAR_DEG + 'd]\\\\s*' +          // DD\r\n                            '(\\\\d+(?:\\\\.\\\\d+)?)\\\\s*',                               // MM.mmm\r\n            'DD.ddddd':     '(\\\\d+(?:\\\\.\\\\d+)?)[' + coordChars.CHAR_DEG + 'd]\\\\s*' // DD.ddd\r\n        };\r\n\r\n        for(var key in patterns) {\r\n            if(patterns.hasOwnProperty(key) && value.match(new RegExp(patterns[key]))) {\r\n                log.debug('Coordinate match to pattern ' + key);\r\n                return value.match(new RegExp(patterns[key]));\r\n            }\r\n        }\r\n\r\n        log.debug('Coordinate not match to any patterns');\r\n        return null;\r\n    };\r\n\r\n    util.coordinateMetricToDegrees = function(point, decimals){\r\n        var roundToDecimals = decimals || 0;\r\n        if(roundToDecimals>20) {\r\n            roundToDecimals = 20;\r\n        }\r\n        if(validCoordinates(point))  {\r\n            // first coordinate\r\n            var dms1 = NaN;\r\n            if(!coordinateDMSDecode(point[0])) {\r\n                var p1 = parseFloat(point[0]);\r\n                var d1 = p1|0;\r\n                var m1 = ((p1 - d1) * 60)|0;\r\n                var s1 = (p1 - d1 - m1/60) * 3600;\r\n                s1 = parseFloat(s1).toFixed(roundToDecimals);\r\n                s1 = '' + s1;\r\n                s1 = s1.replace('.', Oskari.getDecimalSeparator());\r\n                dms1 = d1 + coordChars.CHAR_DEG + coordChars.CHAR_SEP + m1 + coordChars.CHAR_MIN + coordChars.CHAR_SEP + s1 + coordChars.CHAR_SEC;\r\n            } else {\r\n                dms1 = point[0];\r\n            }\r\n\r\n            // second coordinate\r\n            var dms2 = NaN;\r\n            if(!coordinateDMSDecode(point[1])) {\r\n                var p2 = parseFloat(point[1]);\r\n                var d2 = p2|0;\r\n                var m2 = ((p2 - d2) * 60)|0;\r\n                var s2 = (p2 - d2 - m2/60) * 3600;\r\n                s2 = parseFloat(s2).toFixed(roundToDecimals);\r\n                s2 = '' + s2;\r\n                s2 = s2.replace('.', Oskari.getDecimalSeparator());\r\n                dms2 = d2 + coordChars.CHAR_DEG + coordChars.CHAR_SEP + m2 + coordChars.CHAR_MIN + coordChars.CHAR_SEP + s2 + coordChars.CHAR_SEC;\r\n            } else {\r\n                dms2 = point[1];\r\n            }\r\n\r\n            return [dms1, dms2];\r\n        } else {\r\n            return [NaN, NaN];\r\n        }\r\n    };\r\n\r\n    util.coordinateDegreesToMetric = function(point, decimals){\r\n        var roundToDecimals = decimals || 0;\r\n        if(roundToDecimals>20) {\r\n            roundToDecimals = 20;\r\n        }\r\n        if(validCoordinates(point))  {\r\n            // first coordinate\r\n            var dd1 = NaN;\r\n            var matches1 = coordinateDMSDecode(point[0]);\r\n\r\n            if (matches1) {\r\n                var d1 = parseFloat(matches1[1]);\r\n                var m1 = parseFloat(matches1[2]);\r\n                var s1 = parseFloat(matches1[3]);\r\n\r\n                if (!(isNaN(d1) || isNaN(m1) || isNaN(s1))) {\r\n                    dd1 = parseFloat(d1 + (m1 / 60.0) + (s1 / 3600)).toFixed(roundToDecimals);\r\n                } else if (!(isNaN(d1) || isNaN(m1))) {\r\n                    dd1 = parseFloat(d1 + (m1 / 60.0)).toFixed(roundToDecimals);\r\n                } else if (!(isNaN(d1))) {\r\n                    dd1 = parseFloat(d1).toFixed(roundToDecimals);\r\n                }\r\n            }\r\n\r\n            // second coordinate\r\n            var dd2 = NaN;\r\n            var matches2 = coordinateDMSDecode(point[1]);\r\n\r\n            if (matches2) {\r\n                var d2 = parseFloat(matches2[1]);\r\n                var m2 = parseFloat(matches2[2]);\r\n                var s2 = parseFloat(matches2[3]);\r\n\r\n                if (!(isNaN(d2) || isNaN(m2) || isNaN(s2))) {\r\n                    dd2 = parseFloat(d2 + (m2 / 60.0) + (s2 / 3600)).toFixed(roundToDecimals);\r\n                } else if (!(isNaN(d2) || isNaN(m2))) {\r\n                    dd2 = parseFloat(d2 + (m2 / 60.0)).toFixed(roundToDecimals);\r\n                } else if (!(isNaN(d2))) {\r\n                    dd2 = parseFloat(d2).toFixed(roundToDecimals);\r\n                }\r\n            }\r\n\r\n            return [dd1,dd2];\r\n        } else {\r\n            return [NaN, NaN];\r\n        }\r\n    };\r\n\r\n    util.coordinateIsDegrees = function(point){\r\n        var matches1 = coordinateDMSDecode(point[0]);\r\n        var matches2 = coordinateDMSDecode(point[1]);\r\n        return (matches1 && matches2);\r\n    };\r\n\r\n    /**\r\n     * @method getRequestParam\r\n     * Returns a request parameter from query string\r\n     * http://javablog.info/2008/04/17/url-request-parameters-using-javascript/\r\n     * @param {String} name - parameter name\r\n     * @param {String} defaultValue - default value if param is not set\r\n     * @return {String} value for the parameter or null if not found\r\n     */\r\n    util.getRequestParam = function (name, defaultValue) {\r\n      var query = location.search.substr(1);\r\n      var result = {};\r\n      query.split(\"&\").forEach(function(part) {\r\n        var item = part.split(\"=\");\r\n        result[item[0]] = decodeURIComponent(item[1]);\r\n      });\r\n      return result[name] || defaultValue;\r\n    };\r\n    /**\r\n     * Returns true if first param is a number with value between start-stop parameters\r\n     * @param  {Number}  num   [description]\r\n     * @param  {Number}  start [description]\r\n     * @param  {Number}  stop  [description]\r\n     * @return {Boolean}       [description]\r\n     */\r\n    util.isNumberBetween = function(num, start, stop) {\r\n        if(typeof num !== 'number') {\r\n            return false;\r\n        }\r\n        return num >= start && num <= stop;\r\n    };\r\n\r\n    /**\r\n     * Moves item in array using from and to parameters as indexes.\r\n     * Returns boolean indicating if something was changed.\r\n     * @param  {Object[]} array array to re-order\r\n     * @param  {Number}   from  index for item to move\r\n     * @param  {Number}   to    index to move the item to\r\n     * @return {Boolean}  true if order was changed\r\n     */\r\n    util.arrayMove = function(array, from, to) {\r\n        // normalize\r\n        if(!array || !array.length || !array.splice) {\r\n            return false;\r\n        }\r\n        if(!util.isNumberBetween(from, 0, array.length -1)) {\r\n            from = array.length - 1;\r\n        }\r\n        if(!util.isNumberBetween(to, 0, array.length -1)) {\r\n            to = array.length - 1;\r\n        }\r\n        if(from === to) {\r\n            return false;\r\n        }\r\n        // From http://jsperf.com/arraymove-many-sizes\r\n        if (Math.abs(from - to) > 60) {\r\n            array.splice(to, 0, array.splice(from, 1)[0]);\r\n        } else {\r\n            // works better when we are not moving things very far\r\n            var target = array[from];\r\n            var inc = (to - from) / Math.abs(to - from);\r\n            var current = from;\r\n            for (; current != to; current += inc) {\r\n                array[current] = array[current + inc];\r\n            }\r\n            array[to] = target;\r\n        }\r\n        return true;\r\n    };\r\n\r\n\r\n    return util;\r\n}());\r\n","/**\r\n * Adds internalization support for Oskari\r\n */\r\n(function(O) {\r\n\tvar oskariLang = 'en';\r\n\tvar localizations = {};\r\n\tvar supportedLocales = null;\r\n\r\n    // ------------------------------------------------\r\n    // Locales/lang\r\n    // ------------------------------------------------\r\n    /**\r\n     * @public @method setSupportedLocales\r\n     *\r\n     * @param {string[]} locales Locales array\r\n     *\r\n     */\r\n    O.setSupportedLocales = function (locales) {\r\n        if (!locales) {\r\n            return;\r\n        }\r\n        if (!Array.isArray(locales)) {\r\n            throw new TypeError(\r\n                'setSupportedLocales(): locales is not an array'\r\n            );\r\n        }\r\n        supportedLocales = locales;\r\n    };\r\n    /**\r\n     * @public @method getSupportedLocales\r\n     *\r\n     *\r\n     * @return {string[]} Supported locales\r\n     */\r\n    O.getSupportedLocales = function () {\r\n        return supportedLocales || [];\r\n    };\r\n    /**\r\n     * @public @method setLang\r\n     *\r\n     * @param {string} lang Language\r\n     *\r\n     */\r\n    O.setLang = function (lang) {\r\n        if (!lang) {\r\n            return;\r\n        }\r\n        oskariLang = lang;\r\n    };\r\n\r\n    /**\r\n     * @public @method getLang\r\n     *\r\n     *\r\n     * @return {string} Language\r\n     */\r\n    O.getLang = function () {\r\n        return oskariLang || 'en';\r\n    };\r\n\r\n    /**\r\n     * @public @method getSupportedLanguages\r\n     *\r\n     *\r\n     * @return {string[]} Supported languages\r\n     */\r\n    O.getSupportedLanguages = function () {\r\n        var langs = [],\r\n            supported = O.getSupportedLocales(),\r\n            locale,\r\n            i;\r\n\r\n        for (i = 0; i < supported.length; i += 1) {\r\n            locale = supported[i];\r\n            // FIXME what do if indexOf === -1?\r\n            langs.push(locale.substring(0, locale.indexOf('_')));\r\n        }\r\n        return langs;\r\n    };\r\n\r\n    /**\r\n     * @public @method getDefaultLanguage\r\n     *\r\n     *\r\n     * @return {string} Default language\r\n     */\r\n    O.getDefaultLanguage = function () {\r\n        var supported = O.getSupportedLocales();\r\n\r\n        if(supported.length === 0) {\r\n            return this.getLang();\r\n        }\r\n        var locale = supported[0];\r\n\r\n        if (locale.indexOf('_') !== -1) {\r\n            return locale.substring(0, locale.indexOf('_'));\r\n        }\r\n        return this.getLang();\r\n    };\r\n\r\n\r\n    // ------------------------------------------------\r\n    // Locale strings\r\n    // ------------------------------------------------\r\n\r\n    /**\r\n     * @public @method setLocalization\r\n     *\r\n     * @param {string}  lang  Language\r\n     * @param {string}  key   Key\r\n     * @param {string=} value Value\r\n     *\r\n     */\r\n    var setLocalization = function (lang, key, value) {\r\n        if (lang === null || lang === undefined) {\r\n            throw new TypeError(\r\n                'setLocalization(): Missing lang'\r\n            );\r\n        }\r\n        if (key === null || key === undefined) {\r\n            throw new TypeError(\r\n                'setLocalization(): Missing key'\r\n            );\r\n        }\r\n        if (!localizations[lang]) {\r\n            localizations[lang] = {};\r\n        }\r\n        localizations[lang][key] = value;\r\n    };\r\n    /**\r\n     * @public @method getLocalization\r\n     *\r\n     * @param  {string} key Key\r\n     * @param  {string} lang Lang\r\n     * @param  {boolean} fallbackToDefault whether to fall back to Oskari Default language in case localization is not found for given lang\r\n     * @return {string}     Localized value for key\r\n     */\r\n\tO.getLocalization = function (key, lang, fallbackToDefault) {\r\n        var l = lang || oskariLang;\r\n        if (key === null || key === undefined) {\r\n            throw new TypeError(\r\n                'getLocalization(): Missing key'\r\n            );\r\n        }\r\n        if (!localizations) {\r\n            return null;\r\n        }\r\n        if(localizations[l] && localizations[l][key]) {\r\n            return localizations[l][key];\r\n        } else {\r\n            var defaultLang = O.getDefaultLanguage();\r\n            if (fallbackToDefault && localizations[defaultLang] && localizations[defaultLang][key]) {\r\n                return localizations[defaultLang][key];\r\n            } else {\r\n                return null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @public @static @method Oskari.registerLocalization\r\n     *\r\n     * @param {Object|Object[]} props Properties\r\n     * @param {Boolean} override override languages\r\n     *\r\n     */\r\n    O.registerLocalization = function (props, override) {\r\n        var p,\r\n            pp,\r\n            loc;\r\n\r\n        if (props === null || props === undefined) {\r\n            throw new TypeError('registerLocalization(): Missing props');\r\n        }\r\n\r\n        if (props.length) {\r\n            for (p = 0; p < props.length; p += 1) {\r\n                pp = props[p];\r\n\r\n                if(override && override === true){\r\n                    if(pp.key && pp.lang){\r\n                        loc = O.getLocalization(pp.key, pp.lang);\r\n                    }\r\n\r\n                    if(loc && loc !== null){\r\n                        pp.value = jQuery.extend(true, {}, loc, pp.value);\r\n                    }\r\n\r\n                } else {\r\n                    if(pp.key && pp.lang){\r\n                        loc = O.getLocalization(pp.key, pp.lang);\r\n                    }\r\n\r\n                    if(loc && loc !== null){\r\n                        pp.value = jQuery.extend(true, {}, pp.value, loc);\r\n                    }\r\n                }\r\n\r\n                setLocalization(pp.lang, pp.key, pp.value);\r\n            }\r\n\r\n        } else {\r\n            if(override && override === true){\r\n                if(props.key && props.lang){\r\n                    loc = O.getLocalization(props.key, props.lang);\r\n                }\r\n\r\n                if(loc && loc !== null){\r\n                    props.value = jQuery.extend(true, {}, loc, props.value);\r\n                }\r\n\r\n            } else {\r\n                if(props.key && props.lang){\r\n                    loc = O.getLocalization(props.key, props.lang);\r\n                }\r\n\r\n                if(loc && loc !== null){\r\n                    props.value = jQuery.extend(true, {}, props.value, loc);\r\n                }\r\n            }\r\n            setLocalization(props.lang,props.key,props.value);\r\n\r\n        }\r\n    };\r\n\r\n    // ------------------------------------------------\r\n    // Decimal separators\r\n    // ------------------------------------------------\r\n    var decimalSeparator;\r\n\r\n    /**\r\n     * @public @method setDecimalSeparator\r\n     *\r\n     * @param {String} separator to use. Defaults to ','\r\n     *\r\n     */\r\n    O.setDecimalSeparator = function (separator) {\r\n        if(!separator) {\r\n            return;\r\n        }\r\n        decimalSeparator = separator;\r\n    };\r\n    /**\r\n     * @public @method getDecimalSeparator\r\n     *\r\n     * @return {string} Decimal separator\r\n     */\r\n    O.getDecimalSeparator =  function () {\r\n        return decimalSeparator || ',';\r\n    };\r\n\r\n    /**\r\n     * Returns a string from localized content.\r\n     */\r\n     O.getLocalized = function (locale, lang) {\r\n        if (typeof locale !== 'object') {\r\n            return locale;\r\n        }\r\n        if (!lang) {\r\n            lang = Oskari.getLang();\r\n        }\r\n        var value = locale[lang];\r\n        if(!value) {\r\n            value = locale[Oskari.getDefaultLanguage()];\r\n        }\r\n        if(!value) {\r\n            for(var key in locale) {\r\n                if(locale[key]) {\r\n                    // any locale will do at this point\r\n                    return locale[key];\r\n                }\r\n            }\r\n\r\n        }\r\n        return value;\r\n    };\r\n}(Oskari));\r\n","/**\r\n * Creates on, off, trigger functions for Oskari\r\n */\r\n(function(o) {\r\n    if (!o) {\r\n        // can't add eventbus if no Oskari ref\r\n        return;\r\n    }\r\n    if (o.requestBuilder) {\r\n        // already created on, don't run again\r\n        return;\r\n    }\r\n    var log = Oskari.log('Messages');\r\n    var clazzes = {};\r\n\r\n    function getClazzByNameAndType(name, type) {\r\n        var typeNames = clazzes[type];\r\n        if(!typeNames) {\r\n            clazzes[type] = {};\r\n            typeNames = clazzes[type];\r\n        }\r\n        if(typeNames[name]) {\r\n            return typeNames[name];\r\n        }\r\n        log.debug('Updating metadata for ' + type);\r\n        var allKnownClassesOfType = Oskari.clazz.protocol(type);\r\n        for (var clazzName in allKnownClassesOfType) {\r\n            if (!allKnownClassesOfType.hasOwnProperty(clazzName)) {\r\n                continue;\r\n            }\r\n            var clazzDefinition = allKnownClassesOfType[clazzName];\r\n            var requestName = clazzDefinition._class.prototype.getName();\r\n            typeNames[requestName] = clazzName;\r\n        }\r\n        log.debug('Finished updating metadata for ' + type);\r\n        return typeNames[name];\r\n    }\r\n\r\n    o.requestBuilder = function(name) {\r\n        var qname = getClazzByNameAndType(name, 'Oskari.mapframework.request.Request');\r\n        if (!qname) {\r\n            log.warn('No builder found for', name);\r\n            return undefined;\r\n        }\r\n\r\n        if(!o.getSandbox().hasHandler(name)) {\r\n            log.warn('Request ' + name + ' defined, but handler not registered. Perhaps timing issue?');\r\n            return undefined;\r\n        }\r\n        return Oskari.clazz.builder(qname);\r\n    };\r\n\r\n    o.eventBuilder = function(name) {\r\n        var qname = getClazzByNameAndType(name, 'Oskari.mapframework.event.Event');\r\n        if (!qname) {\r\n            log.warn('No builder found for', name);\r\n            return undefined;\r\n        }\r\n        return Oskari.clazz.builder(qname);\r\n    };\r\n\r\n}(Oskari));","\r\n(function(o){\r\n    /**\r\n     * Registers O2ClassSystem as global so Oskari can build on it\r\n     */\r\n    var O2ClassSystem = function () {\r\n        this.packages = {};\r\n        this.protocols = {};\r\n        this.inheritance = {};\r\n        this.aspects = {};\r\n        this.classcache = {};\r\n        this.globals = {};\r\n    };\r\n\r\n    O2ClassSystem.prototype = {\r\n\r\n        /**\r\n         * @public @method purge\r\n         */\r\n        purge: function () {\r\n            // TODO implement & document?\r\n            return undefined;\r\n        },\r\n\r\n        /**\r\n         * @public @method protocol\r\n         *\r\n         * @param  {string} protocolName Protocol name\r\n         *\r\n         * @return {Object}              Protocol\r\n         */\r\n        protocol: function (protocolName) {\r\n            if (protocolName === null || protocolName === undefined) {\r\n                throw new TypeError('protocol(): Missing protocolName');\r\n            }\r\n            return this.protocols[protocolName];\r\n        },\r\n\r\n        /**\r\n         * @private @method _getPackageDefinition\r\n         *\r\n         * @param  {string} packageName Package name\r\n         *\r\n         * @return {Object}             Package definition\r\n         */\r\n        _getPackageDefinition: function (packageName) {\r\n            var packageDefinition = this.packages[packageName];\r\n\r\n            if (!packageDefinition) {\r\n                packageDefinition = {};\r\n                this.packages[packageName] = packageDefinition;\r\n            }\r\n            return packageDefinition;\r\n        },\r\n\r\n        /**\r\n         * @private @method _getClassQName\r\n         *\r\n         * @param  {string} className Class name\r\n         *\r\n         * @return {Object}           ClassQName\r\n         */\r\n        _getClassQName: function (className) {\r\n            var parts = className.split('.');\r\n\r\n            return {\r\n                basePkg: parts[0],\r\n                pkg: parts[1],\r\n                sp: parts.slice(2).join('.')\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @private @method _getClassInfo\r\n         *\r\n         * @param  {string} className Class name\r\n         *\r\n         * @return {Object}           ClassInfo\r\n         */\r\n        _getClassInfo: function (className) {\r\n            var classInfo = this.classcache[className],\r\n                classQName = this._getClassQName(className),\r\n                packageDefinition;\r\n\r\n            if (!classInfo) {\r\n                packageDefinition = this._getPackageDefinition(classQName.pkg);\r\n                classInfo = packageDefinition[classQName.sp];\r\n                this.classcache[className] = classInfo;\r\n            }\r\n            return classInfo;\r\n        },\r\n\r\n        /**\r\n         * @private @method _cloneProperties\r\n         *\r\n         * @param {Object}          from\r\n         * @param {Object|Object[]} to\r\n         *\r\n         */\r\n        _cloneProperties: function (from, to) {\r\n            var i,\r\n                propertyName,\r\n                propertyValue,\r\n                toArray = Array.isArray(to) ? to : [to];\r\n\r\n            for (propertyName in from) {\r\n                if (from.hasOwnProperty(propertyName)) {\r\n                    propertyValue = from[propertyName];\r\n                    for (i = toArray.length - 1; i >= 0; i -= 1) {\r\n                        toArray[i][propertyName] = propertyValue;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @private @method _createEmptyClassDefinition\r\n         *\r\n         *\r\n         * @return {function()} Empty function with an empty prototype\r\n         */\r\n        _createEmptyClassDefinition: function () {\r\n            var ret = function () {\r\n                return undefined;\r\n            };\r\n            ret.prototype = {};\r\n            return ret;\r\n        },\r\n\r\n        /**\r\n         * @public @method getMetadata\r\n         * Returns metadata for the class\r\n         *\r\n         * @param  {string} className Class name\r\n         *\r\n         * @return {Object}           Class metadata\r\n         */\r\n        getMetadata: function (className) {\r\n            var classInfo;\r\n            if (className === null || className === undefined) {\r\n                throw new TypeError('metadata(): Missing className');\r\n            }\r\n            classInfo = this._getClassInfo(className);\r\n            if (!classInfo) {\r\n                throw 'Class ' + className + ' does not exist';\r\n            }\r\n            return classInfo._metadata;\r\n        },\r\n\r\n        /**\r\n         * @private @method _updateMetadata\r\n         * Updates and binds class metadata\r\n         *\r\n         * @param {string} basePkg   Base package\r\n         * @param {string} pkg       Package\r\n         * @param {string} sp\r\n         * @param {Object} classInfo ClassInfo\r\n         * @param {Object} classMeta Class metadata\r\n         *\r\n         */\r\n        _updateMetadata: function (basePkg, pkg, sp, classInfo, classMeta) {\r\n            var protocols,\r\n                p,\r\n                pt,\r\n                className;\r\n\r\n            if (!classInfo._metadata) {\r\n                classInfo._metadata = {};\r\n            }\r\n            classInfo._metadata.meta = classMeta;\r\n            className = [basePkg, pkg, sp].join('.');\r\n            protocols = classMeta.protocol;\r\n            if (protocols) {\r\n                for (p = 0; p < protocols.length; p += 1) {\r\n                    pt = protocols[p];\r\n                    if (!this.protocols[pt]) {\r\n                        this.protocols[pt] = {};\r\n                    }\r\n                    this.protocols[pt][className] = classInfo;\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @private @method _super\r\n         *\r\n         * @param  {string} supCat\r\n         * @param  {string} supMet\r\n         *\r\n         * @return\r\n         */\r\n        _super: function (supCat, supMet) {\r\n            var me = this;\r\n\r\n            return function () {\r\n                return me._._superCategory[supCat][supMet].apply(me, arguments);\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @public @method define Creates a class definition.\r\n         *\r\n         * @param  {string}   className        Class name\r\n         * @param  {function} classConstructor Class constructor function\r\n         * @param  {Object}   prototype        A property object containing\r\n         *                                     methods and definitions for the\r\n         *                                     class prototype\r\n         * @param  {Object}   metadata         Optional metadata for the class\r\n         *\r\n         * @return {Object}                    ClassInfo\r\n         */\r\n        define: function (className, classConstructor, prototype, metadata) {\r\n            var classDefinition,\r\n                classQName,\r\n                composition,\r\n                packageDefinition,\r\n                classInfo,\r\n                e,\r\n                extnds,\r\n                superClass;\r\n\r\n            if (className === null || className === undefined) {\r\n                throw new TypeError('define(): Missing className');\r\n            }\r\n\r\n            if (typeof classConstructor !== 'function') {\r\n                throw new TypeError(\r\n                    'define(): classConstructor is not a function'\r\n                );\r\n            }\r\n\r\n            // Prototype is undefined for Oskari._.1\r\n            if (prototype && typeof prototype !== 'object') {\r\n                throw new TypeError('define(): Prototype is not an object');\r\n            }\r\n\r\n            classQName = this._getClassQName(className);\r\n            packageDefinition = this._getPackageDefinition(classQName.pkg);\r\n            classInfo = packageDefinition[classQName.sp];\r\n\r\n            if (!classInfo) {\r\n                classDefinition = this._createEmptyClassDefinition();\r\n                composition = {\r\n                    className: className,\r\n                    superClass: null,\r\n                    subClass: null\r\n                };\r\n\r\n                classInfo = {\r\n                    _class: classDefinition,\r\n                    _constructor: classConstructor,\r\n                    _category: {},\r\n                    _composition: composition\r\n                };\r\n                classDefinition.prototype._ = classInfo;\r\n                classDefinition.prototype._super = this._super;\r\n                this.inheritance[className] = composition;\r\n                packageDefinition[classQName.sp] = classInfo;\r\n            }\r\n            // update constrcutor\r\n            if (classConstructor) {\r\n                classInfo._constructor = classConstructor;\r\n            }\r\n            // update prototype\r\n            if (prototype) {\r\n                this._cloneProperties(prototype, classInfo._class.prototype);\r\n                classInfo._category[className] = prototype;\r\n            }\r\n            // update metadata\r\n            if (metadata) {\r\n                extnds = metadata.extend;\r\n                for (e = 0; extnds && e < extnds.length; e += 1) {\r\n                    superClass = this.lookup(extnds[e]);\r\n                    if (!superClass._composition.subClass) {\r\n                        superClass._composition.subClass = {};\r\n                    }\r\n                    superClass._composition.subClass[className] = classInfo;\r\n                    classInfo._composition.superClass = superClass;\r\n                }\r\n                this._updateMetadata(\r\n                    classQName.basePkg,\r\n                    classQName.pkg,\r\n                    classQName.sp,\r\n                    classInfo,\r\n                    metadata\r\n                );\r\n            }\r\n            this._pullDown(classInfo);\r\n            this._pushDown(classInfo);\r\n            return classInfo;\r\n        },\r\n\r\n        /**\r\n         * @public @method category\r\n         * Adds some logical group of methods to class prototype\r\n         * Oskari.clazz.category(\r\n         * 'Oskari.mapframework.request.common.' +\r\n         * 'ActivateOpenlayersMapControlRequest',\r\n         * 'map-layer-funcs',{ \"xxx\": function () {} }\r\n         * );\r\n         *\r\n         * @param  {string} className    Class name\r\n         * @param  {string} categoryName Category name\r\n         * @param  {Object} prototype    Prototype\r\n         *\r\n         * @return {Object}              ClassInfo\r\n         */\r\n        category: function (className, categoryName, prototype) {\r\n            var classDefinition,\r\n                classInfo,\r\n                classQName,\r\n                composition,\r\n                packageDefinition,\r\n                prot;\r\n\r\n            if (className === null || className === undefined) {\r\n                throw new TypeError('category(): Missing className');\r\n            }\r\n\r\n            classQName = this._getClassQName(className);\r\n            packageDefinition = this._getPackageDefinition(classQName.pkg);\r\n            classInfo = packageDefinition[classQName.sp];\r\n\r\n            if (!classInfo) {\r\n                classDefinition = this._createEmptyClassDefinition();\r\n                composition = {\r\n                    className: className,\r\n                    superClass: null,\r\n                    subClass: null\r\n                };\r\n                // TODO why do we set categoryName as constructor?\r\n                classInfo = {\r\n                    _class: classDefinition,\r\n                    _constructor: categoryName,\r\n                    _category: {},\r\n                    _composition: composition\r\n                };\r\n                classDefinition.prototype._ = classInfo;\r\n                classDefinition.prototype._super = this._super;\r\n                this.inheritance[className] = composition;\r\n                packageDefinition[classQName.sp] = classInfo;\r\n            }\r\n            prot = classInfo._class.prototype;\r\n            this._cloneProperties(prototype, prot);\r\n            if (prototype) {\r\n                classInfo._category[categoryName] = prototype;\r\n            }\r\n            this._pullDown(classInfo);\r\n            this._pushDown(classInfo);\r\n            return classInfo;\r\n        },\r\n\r\n        /**\r\n         * @public @method lookup\r\n         *\r\n         * @param  {string} className   Class name\r\n         * @param           constructor Constructor\r\n         *\r\n         * @return {Object}             ClassInfo\r\n         */\r\n        lookup: function (className, constructor) {\r\n            var classDefinition,\r\n                classQName,\r\n                composition,\r\n                packageDefinition,\r\n                classInfo;\r\n\r\n            if (className === null || className === undefined) {\r\n                throw new TypeError('lookup(): Missing className');\r\n            }\r\n            // TODO constructor seems to be undefined all the time?\r\n\r\n            classQName = this._getClassQName(className);\r\n            packageDefinition = this._getPackageDefinition(classQName.pkg);\r\n            classInfo = packageDefinition[classQName.sp];\r\n\r\n            if (!classInfo) {\r\n                classDefinition = this._createEmptyClassDefinition();\r\n                composition = {\r\n                    className: className,\r\n                    superClass: null,\r\n                    subClass: null\r\n                };\r\n                classInfo = {\r\n                    _class: classDefinition,\r\n                    _constructor: constructor,\r\n                    _category: {},\r\n                    _composition: composition\r\n                };\r\n                this.inheritance[className] = composition;\r\n                packageDefinition[classQName.sp] = classInfo;\r\n            }\r\n            return classInfo;\r\n        },\r\n\r\n        /**\r\n         * @public @method extend\r\n         *\r\n         * @param  {string} subClassName   SubClass name\r\n         * @param  {string} superClassName SuperClass name\r\n         *\r\n         * @return {Object}                SubClass\r\n         */\r\n        extend: function (subClassName, superClassName) {\r\n            var superClass,\r\n                subClass;\r\n\r\n            if (subClassName === null || subClassName === undefined) {\r\n                throw new TypeError('extend(): Missing subClassName');\r\n            }\r\n\r\n            if (superClassName === null || superClassName === undefined) {\r\n                throw new TypeError('extend(): Missing superClassName');\r\n            }\r\n\r\n            superClass = this.lookup(superClassName);\r\n            subClass = this.lookup(subClassName);\r\n\r\n            if (!superClass._composition.subClass) {\r\n                superClass._composition.subClass = {};\r\n            }\r\n            superClass._composition.subClass[subClassName] = subClass;\r\n            subClass._composition.superClass = superClass;\r\n            this._pullDown(subClass);\r\n            return subClass;\r\n        },\r\n\r\n        /**\r\n         * @private @method _pushDown\r\n         * Force each derived class to pullDown.\r\n         * Some overhead here if complex hierarchies are implemented.\r\n         *\r\n         * @param  {Object} classInfo ClassInfo\r\n         *\r\n         * @return {Object}           ClassInfo\r\n         */\r\n        _pushDown: function (classInfo) {\r\n            var subName,\r\n                pdefsub;\r\n\r\n            if (classInfo === null || classInfo === undefined) {\r\n                throw new TypeError('_pushDown(): Missing classInfo');\r\n            }\r\n\r\n            /* !self */\r\n            if (!classInfo._composition.subClass) {\r\n                return;\r\n            }\r\n            for (subName in classInfo._composition.subClass) {\r\n                if (classInfo._composition.subClass.hasOwnProperty(subName)) {\r\n                    pdefsub = classInfo._composition.subClass[subName];\r\n                    this._pullDown(pdefsub);\r\n                    this._pushDown(pdefsub);\r\n                }\r\n            }\r\n            return classInfo;\r\n        },\r\n\r\n        /**\r\n         * @private @method _pullDown\r\n         * EACH class is responsible for it's entire hierarchy\r\n         * no intermediate results are being consolidated\r\n         *\r\n         * @param  {Object} classInfo ClassInfo\r\n         *\r\n         * @return {Object}           ClassInfo\r\n         */\r\n        _pullDown: function (classInfo) {\r\n            var i,\r\n                category,\r\n                clazz,\r\n                classHierarchy,\r\n                className,\r\n                classConstructor,\r\n                classMethods,\r\n                classPrototype,\r\n                prototype,\r\n                superClassInfo;\r\n\r\n            if (classInfo === null || classInfo === undefined) {\r\n                throw new TypeError('_pullDown(): Missing classInfo');\r\n            }\r\n\r\n            if (!classInfo._composition.superClass) {\r\n                // Class doesn't extend\r\n                return;\r\n            }\r\n            // Class hierarchy from bottom (i.e. given class) up\r\n            classHierarchy = [];\r\n            classHierarchy.push(classInfo);\r\n            superClassInfo = classInfo;\r\n            while (true) {\r\n                superClassInfo = superClassInfo._composition.superClass;\r\n                if (!superClassInfo) {\r\n                    break;\r\n                }\r\n                classHierarchy.push(superClassInfo);\r\n            }\r\n\r\n            classInfo._constructors = [];\r\n            classInfo._superCategory = {};\r\n            classPrototype = classInfo._class.prototype;\r\n            // Traverse class hierarchy from topmost super to given class,\r\n            // add found methods to class info\r\n            for (i = classHierarchy.length - 1; i >= 0; i -= 1) {\r\n                clazz = classHierarchy[i];\r\n                className = clazz._composition.className;\r\n                classConstructor = clazz._constructor;\r\n                classInfo._constructors.push(classConstructor);\r\n                classMethods = {};\r\n                // TODO explain categories?\r\n                for (category in clazz._category) {\r\n                    if (clazz._category.hasOwnProperty(category)) {\r\n                        prototype = clazz._category[category];\r\n                        this._cloneProperties(\r\n                            prototype,\r\n                            [classPrototype, classMethods]\r\n                        );\r\n                    }\r\n                }\r\n                classInfo._superCategory[className] = classMethods;\r\n            }\r\n            return classInfo;\r\n        },\r\n\r\n        /**\r\n         * @private @method _slicer\r\n         */\r\n        _slicer: Array.prototype.slice,\r\n\r\n        /**\r\n         * @public @method create\r\n         * Creates a class instance\r\n         *\r\n         * @param  {string} className Class name\r\n         *\r\n         * @return {Object}           Class instance\r\n         */\r\n        create: function (className) {\r\n            var classInfo,\r\n                classInstance,\r\n                constructors,\r\n                i,\r\n                instanceArguments;\r\n\r\n            if (className === null || className === undefined) {\r\n                throw new TypeError('create(): Missing className');\r\n            }\r\n\r\n            instanceArguments = this._slicer.apply(arguments, [1]);\r\n            classInfo = this._getClassInfo(className);\r\n            if (!classInfo) {\r\n                // If this error is thrown,\r\n                // the class definition is missing.\r\n                // Ensure the file has been loaded before use\r\n                throw 'Class \"' + className + '\" does not exist';\r\n            }\r\n            classInstance = new classInfo._class();\r\n            constructors = classInfo._constructors;\r\n\r\n            if (constructors) {\r\n                // Class is extended, call super constructors first?\r\n                for (i = 0; i < constructors.length; i += 1) {\r\n                    // If an error occurs below, the constructor is missing.\r\n                    // Ensure the file has been loaded before use.\r\n                    // Note! check extends classes as well, those might also be\r\n                    // missing.\r\n                    if (constructors[i] === null || constructors[i] === undefined) {\r\n                        throw new Error('Class ' + className + ' is missing super constructor ' + (i + 1) + '/' + constructors.length);\r\n                    }\r\n                    var returned = constructors[i].apply(classInstance, instanceArguments);\r\n                    if(returned) {\r\n                        classInstance = returned;\r\n                    }\r\n                }\r\n            } else {\r\n                var returned = classInfo._constructor.apply(classInstance, instanceArguments);\r\n                if(returned) {\r\n                    classInstance = returned;\r\n                }\r\n            }\r\n            return classInstance;\r\n        },\r\n\r\n        /**\r\n         * @public @method createWithClassInfo\r\n         *\r\n         * @param  {Object} classInfo         ClassInfo\r\n         * @param  {[]}     instanceArguments Instance arguments\r\n         *\r\n         * @return {Object}                   Class instance\r\n         */\r\n        createWithClassInfo: function (classInfo, instanceArguments) {\r\n            var classInstance,\r\n                constructors,\r\n                i;\r\n\r\n            if (classInfo === null || classInfo === undefined) {\r\n                throw new TypeError('createWithClassInfo(): Missing classInfo');\r\n            }\r\n            // TODO check instanceArguments?\r\n            classInstance = new classInfo._class();\r\n            constructors = classInfo._constructors;\r\n            if (constructors) {\r\n                for (i = 0; i < constructors.length; i += 1) {\r\n                    if (constructors[i] === null ||\r\n                            constructors[i] === undefined) {\r\n                        throw new Error(\r\n                            'createWithClassInfo(): Undefined constructor in ' +\r\n                                'class \"' + classInfo._composition.className +\r\n                                '\"'\r\n                        );\r\n                    }\r\n                    constructors[i].apply(classInstance, instanceArguments);\r\n                }\r\n            } else {\r\n                classInfo._constructor.apply(classInstance, instanceArguments);\r\n            }\r\n            return classInstance;\r\n        },\r\n\r\n        /**\r\n         * @public @method builder\r\n         * Implements Oskari frameworks support for cached class instance\r\n         * builders.\r\n         *\r\n         * @param  {string}   className Class name\r\n         *\r\n         * @return {function}           Class builder\r\n         */\r\n        builder: function (className) {\r\n            var classInfo;\r\n\r\n            if (className === null || className === undefined) {\r\n                throw new TypeError('builder(): Missing className');\r\n            }\r\n\r\n            classInfo = this._getClassInfo(className);\r\n            if (!classInfo) {\r\n                throw 'Class \"' + className + '\" does not exist';\r\n            }\r\n            return this.getBuilderFromClassInfo(classInfo);\r\n        },\r\n\r\n        /**\r\n         * @public @method getBuilderFromClassInfo\r\n         * Implements Oskari frameworks support for cached class instance\r\n         * builders.\r\n         *\r\n         * @param  {Object}   classInfo ClassInfo\r\n         *\r\n         * @return {function}           Class builder\r\n         */\r\n        getBuilderFromClassInfo: function (classInfo) {\r\n            if (classInfo === null || classInfo === undefined) {\r\n                throw new TypeError(\r\n                    'getBuilderFromClassInfo(): Missing classInfo'\r\n                );\r\n            }\r\n\r\n            if (classInfo._builder) {\r\n                return classInfo._builder;\r\n            }\r\n            classInfo._builder = function () {\r\n                var classInstance = new classInfo._class(),\r\n                    constructors = classInfo._constructors,\r\n                    i,\r\n                    instanceArguments = arguments;\r\n\r\n                if (constructors) {\r\n                    for (i = 0; i < constructors.length; i += 1) {\r\n                        constructors[i].apply(classInstance, instanceArguments);\r\n                    }\r\n                } else {\r\n                    classInfo._constructor.apply(\r\n                        classInstance,\r\n                        instanceArguments\r\n                    );\r\n                }\r\n                return classInstance;\r\n            };\r\n            return classInfo._builder;\r\n        },\r\n\r\n        /**\r\n         * @private @method _global\r\n         *\r\n         * @param {string} key   Key\r\n         * @param          value Value\r\n         *\r\n         * @return\r\n         */\r\n        _global: function (key, value) {\r\n            if (key === undefined) {\r\n                return this.globals;\r\n            }\r\n            if (value !== undefined) {\r\n                this.globals[key] = value;\r\n            }\r\n            return this.globals[key];\r\n        }\r\n    };\r\n    o.clazz = new O2ClassSystem();\r\n}(Oskari));","\r\n(function(o){\r\n    if(!o || !o.clazz) {\r\n        // can't add loader if no Oskari ref\r\n        return;\r\n    }\r\n    var log = Oskari.log('Oskari.bundle_manager');\r\n    /**\r\n     * singleton instance of the class system\r\n     */\r\n    var class_singleton = o.clazz;\r\n    var cs = class_singleton;\r\n\r\n    /* legacy Bundle_manager */\r\n\r\n    /**\r\n     * @singleton @class Oskari.Bundle_manager\r\n     */\r\n    var Bundle_manager = function () {\r\n    \tthis.clazz = o.clazz;\r\n        var me = this;\r\n        me.serial = 0;\r\n        me.bundleDefinitions = {};\r\n        me.sources = {};\r\n        me.bundleInstances = {};\r\n        me.bundles = {};\r\n\r\n        /*\r\n         * CACHE for lookups state management\r\n         */\r\n        me.bundleDefinitionStates = {};\r\n\r\n        me.bundleSourceStates = {};\r\n\r\n        /* CACHE for statuses */\r\n        me.bundleStates = {};\r\n\r\n        me.loaderStateListeners = [];\r\n    };\r\n\r\n    Bundle_manager.prototype = {\r\n\r\n        /**\r\n         * @private @method _getSerial\r\n         *\r\n         *\r\n         * @return {number}\r\n         */\r\n        _getSerial: function () {\r\n            this.serial += 1;\r\n            return this.serial;\r\n        },\r\n\r\n        /**\r\n         * @private @method _purge\r\n         */\r\n        _purge: function () {\r\n            var p,\r\n                me = this;\r\n\r\n            for (p in me.sources) {\r\n                if (me.sources.hasOwnProperty(p)) {\r\n                    delete me.sources[p];\r\n                }\r\n            }\r\n            for (p in me.bundleDefinitionStates) {\r\n                if (me.bundleDefinitionStates.hasOwnProperty(p)) {\r\n                    delete me.bundleDefinitionStates[p].loader;\r\n                }\r\n            }\r\n            for (p in me.bundleSourceStates) {\r\n                if (me.bundleSourceStates.hasOwnProperty(p)) {\r\n                    delete me.bundleSourceStates[p].loader;\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @private @method _install\r\n         * installs bundle\r\n         * DOES not INSTANTIATE only register bundleDefinition as function\r\n         * declares any additional sources required\r\n         *\r\n         * @param {string}   biid             Bundle implementation id\r\n         * @param {function} bundleDefinition Bundle registration function\r\n         * @param {Object}   srcFiles         Source files\r\n         * @param {Object}   bundleMetadata   Bundle metadata\r\n         *\r\n         */\r\n        _install: function (biid, bundleDefinition, srcFiles, bundleMetadata) {\r\n            var me = this,\r\n                defState = me.bundleDefinitionStates[biid];\r\n\r\n            if (defState) {\r\n                defState.state = 1;\r\n                log.debug('SETTING STATE FOR BUNDLEDEF ' + biid +\r\n                    ' existing state to ' + defState.state);\r\n            } else {\r\n                defState = {\r\n                    state: 1\r\n                };\r\n\r\n                me.bundleDefinitionStates[biid] = defState;\r\n                log.debug('SETTING STATE FOR BUNDLEDEF ' + biid +\r\n                    ' NEW state to ' + defState.state);\r\n            }\r\n            defState.metadata = bundleMetadata;\r\n\r\n            me.bundleDefinitions[biid] = bundleDefinition;\r\n            me.sources[biid] = srcFiles;\r\n            //postChange(null, null, 'bundle_definition_loaded');\r\n        },\r\n\r\n        /**\r\n         * @public @method installBundleClass\r\n         * Installs a bundle defined as Oskari native Class.\r\n         *\r\n         * @param {string} biid      Bundle implementation ID\r\n         * @param {string} className Class name\r\n         *\r\n         */\r\n        installBundleClass: function (biid, className) {\r\n            var clazz = Oskari.clazz.create(className);\r\n            if(clazz) {\r\n                // Oskari.bundle is the new registry for requirejs loader\r\n                Oskari.bundle(biid, {\r\n                    clazz : clazz,\r\n                    metadata : cs.getMetadata(className).meta\r\n                });\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @public @method installBundleClassInfo\r\n         * Installs a bundle defined as Oskari native Class\r\n         *\r\n         * @param {string} biid      Bundle implementation ID\r\n         * @param {Object} classInfo ClassInfo\r\n         *\r\n         */\r\n        installBundleClassInfo: function (biid, classInfo) {\r\n            var bundleDefinition = cs.getBuilderFromClassInfo(classInfo),\r\n                bundleMetadata = classInfo._metadata,\r\n                sourceFiles = {};\r\n\r\n            if (biid === null || biid === undefined) {\r\n                throw new TypeError('installBundleClassInfo(): Missing biid');\r\n            }\r\n\r\n            if (classInfo === null || classInfo === undefined) {\r\n                throw new TypeError(\r\n                    'installBundleClassInfo(): Missing classInfo'\r\n                );\r\n            }\r\n\r\n            this._install(\r\n                biid,\r\n                bundleDefinition,\r\n                sourceFiles,\r\n                bundleMetadata\r\n            );\r\n        },\r\n\r\n        /**\r\n         * @public @method createBundle\r\n         * Creates a Bundle (NOTE NOT an instance of bundle)\r\n         * implid, bundleid most likely same value\r\n         *\r\n         * @param  {string} biid Bundle implementation ID\r\n         * @param  {string} bid  Bundle ID\r\n         *\r\n         * @return {Object}      Bundle\r\n         */\r\n        createBundle: function (biid, bid) {\r\n            var bundle,\r\n                bundleDefinition,\r\n                me = this,\r\n                bundleDefinitionState;\r\n\r\n            if (biid === null || biid === undefined) {\r\n                throw new TypeError('createBundle(): Missing biid');\r\n            }\r\n\r\n            if (bid === null || bid === undefined) {\r\n                throw new TypeError('createBundle(): Missing bid');\r\n            }\r\n\r\n            bundleDefinitionState =\r\n                me.bundleDefinitionStates[biid];\r\n\r\n            if (!bundleDefinitionState) {\r\n                throw new Error(\r\n                    'createBundle(): Couldn\\'t find a definition for' +\r\n                        ' bundle ' + biid + '/' + bid +\r\n                        ', check spelling and that the bundle has been' +\r\n                        ' installed.'\r\n                );\r\n            }\r\n            bundleDefinition = this.bundleDefinitions[biid];\r\n            // FIXME no alerts please. Throw something or log something.\r\n            if (!bundleDefinition) {\r\n                alert('this.bundleDefinitions[' + biid + '] is null!');\r\n                return;\r\n            }\r\n            bundle = bundleDefinition(bundleDefinitionState);\r\n            this.bundles[bid] = bundle;\r\n            this.bundleStates[bid] = {\r\n                state: true,\r\n                bundlImpl: biid\r\n            };\r\n            //postChange(bundle, null, 'bundle_created');\r\n            return bundle;\r\n        },\r\n\r\n        /**\r\n         * @public @method createInstance\r\n         * Creates a bundle instance for previously installed and created bundle\r\n         *\r\n         * @param  {string} bid Bundle ID\r\n         *\r\n         * @return {Object}     Bundle instance\r\n         */\r\n        createInstance: function (bid) {\r\n            // creates a bundle_instance\r\n            // any configuration and setup IS BUNDLE / BUNDLE INSTANCE specific\r\n            // create / config / start / process / stop / destroy ...\r\n            var me = this,\r\n                bundle,\r\n                bundleInstance,\r\n                bundleInstanceId;\r\n\r\n            if (bid === null || bid === undefined) {\r\n                throw new TypeError('createInstance(): Missing bid');\r\n            }\r\n\r\n            if (!me.bundleStates[bid] ||\r\n                    !me.bundleStates[bid].state) {\r\n                throw new Error(\r\n                    'createInstance(): Couldn\\'t find a definition for' +\r\n                        ' bundle ' + bid + ', check spelling' +\r\n                        ' and that the bundle has been installed.'\r\n                );\r\n            }\r\n\r\n            bundle = this.bundles[bid];\r\n            if (bundle === null || bundle === undefined) {\r\n                // TODO find out how this could happen, offer a solution\r\n                throw new Error(\r\n                    'createInstance(): Couldn\\'t find bundle with id' + bid\r\n                );\r\n            }\r\n\r\n            bundleInstance = bundle.create();\r\n            if (bundleInstance === null || bundleInstance === undefined) {\r\n                throw new Error(\r\n                    'createInstance(): Couldn\\'t create bundle ' + bid +\r\n                        ' instance. Make sure your bundle\\'s create function' +\r\n                        ' returns the instance.'\r\n                );\r\n            }\r\n            bundleInstanceId = me._getSerial().toString();\r\n\r\n            this.bundleInstances[bundleInstanceId] = bundleInstance;\r\n\r\n            //postChange(bundle, bundleInstance, 'instance_created');\r\n            return bundleInstance;\r\n        },\r\n\r\n        /**\r\n         * @private @method _destroyInstance\r\n         * Destroys and unregisters bundle instance\r\n         *\r\n         * @param {string} biid Bundle instance ID\r\n         *\r\n         * @return\r\n         */\r\n        _destroyInstance: function (biid) {\r\n            var bundleInstance;\r\n\r\n            if (biid === null || biid === undefined) {\r\n                throw new TypeError('_destroyInstance(): Missing biid');\r\n            }\r\n\r\n            bundleInstance = this.bundleInstances[biid];\r\n            this.bundleInstances[biid] = null;\r\n            bundleInstance = null;\r\n\r\n            return bundleInstance;\r\n        }\r\n    };\r\n\r\n    o.bundle_manager = new Bundle_manager();\r\n}(Oskari));","/**\r\n * @class Oskari.mapframework.domain.User\r\n *\r\n * Contains information about a logged in user.\r\n * If #isLoggedIn returns true, other methods should return info about user.\r\n * Otherwise the user isn't logged in and no data is available.\r\n */\r\nOskari.clazz.define('Oskari.mapframework.domain.User',\r\n\r\n    /**\r\n     * @method create called automatically on construction\r\n     * @static\r\n     *\r\n     * Initial data on construction with\r\n     * Oskari.clazz.create('Oskari.mapframework.domain.User', (here))\r\n     *\r\n     * @param {Object} userData\r\n     *            json data about the user. If undefined -> user not logged in.\r\n     *            Should have atleast name and uuid for a logged in user.\r\n     */\r\n\r\n    function (userData) {\r\n        this._loggedIn = false;\r\n        this._roles = [];\r\n        if (userData) {\r\n            this._firstName = userData.firstName;\r\n            this._lastName = userData.lastName;\r\n            this._nickName = userData.nickName;\r\n            // TODO: remove loginName as it's misleading and use email instead\r\n            this._email = userData.email || userData.loginName;\r\n            this._uuid = userData.userUUID;\r\n            this._roles = userData.roles || [];\r\n            if (userData.userUUID) {\r\n                this._loggedIn = true;\r\n            }\r\n            this._apiKey = userData.apikey;\r\n        }\r\n    }, {\r\n        /**\r\n         * @method getName\r\n         * Full name for the user\r\n         *\r\n         * @return {String}\r\n         *            name\r\n         */\r\n        getName: function () {\r\n            return this._firstName + \" \" + this._lastName;\r\n        },\r\n        /**\r\n         * @method getFirstName\r\n         * First name for the user\r\n         *\r\n         * @return {String}\r\n         *            first name\r\n         */\r\n        getFirstName: function () {\r\n            return this._firstName;\r\n        },\r\n        /**\r\n         * @method getLastName\r\n         * Last name for the user\r\n         *\r\n         * @return {String}\r\n         *            last name\r\n         */\r\n        getLastName: function () {\r\n            return this._lastName;\r\n        },\r\n        /**\r\n         * @method getNickName\r\n         * Nickname for the user\r\n         *\r\n         * @return {String}\r\n         *            nickname\r\n         */\r\n        getNickName: function () {\r\n            return this._nickName;\r\n        },\r\n        /**\r\n         * @deprecated Use getEmail() instead!\r\n         * @method getLoginName\r\n         * Loginname for the user\r\n         *\r\n         * @return {String}\r\n         *            loginName\r\n         */\r\n        getLoginName: function () {\r\n            return this.getEmail();\r\n        },\r\n        /**\r\n         * @method getLoginName\r\n         * Loginname for the user\r\n         *\r\n         * @return {String}\r\n         *            loginName\r\n         */\r\n        getEmail: function () {\r\n            return this._email;\r\n        },\r\n        /**\r\n         * @method getUuid\r\n         * Uuid for the user\r\n         *\r\n         * @return {String}\r\n         *            uuid\r\n         */\r\n        getUuid: function () {\r\n            return this._uuid;\r\n        },\r\n        /**\r\n         * @method getAPIkey\r\n         * API-key for the user\r\n         *\r\n         * @return {String}\r\n         */\r\n        getAPIkey: function () {\r\n            return this._apiKey;\r\n        },\r\n        /**\r\n         * @method isLoggedIn\r\n         * Returns true if user is logged in\r\n         *\r\n         * @return {Boolean}\r\n         */\r\n        isLoggedIn: function () {\r\n            return this._loggedIn;\r\n        },\r\n        /**\r\n         * @method getRoles\r\n         * Roles for the user\r\n         *\r\n         * @return {Object}\r\n         *            roles\r\n         */\r\n        getRoles: function () {\r\n            return this._roles;\r\n        },\r\n\r\n        /**\r\n         * Returns true if user has any role matching any id provided as param\r\n         * @method hasRole\r\n         *\r\n         * @param {Number|Number[]} id or list of ids for roles\r\n         * @return {Boolean} true if any id match roles that user has\r\n         */\r\n        hasRole: function (idList) {\r\n            if(typeof idList === 'number') {\r\n                idList = [idList];\r\n            }\r\n            if(!idList || typeof idList.forEach !== 'function') {\r\n                return false;\r\n            }\r\n            var found = false;\r\n            var userRoles = this.getRoles();\r\n            userRoles.forEach(function(role) {\r\n                if(idList.indexOf(role.id) !== -1) {\r\n                    found = true;\r\n                }\r\n            });\r\n            return found;\r\n        }\r\n    });","\r\n(function(o){\r\n    if(!o) {\r\n        // can't add functions if no Oskari ref\r\n        return;\r\n    }\r\n    var defaultName = 'sandbox';\r\n    var getName = function(name) {\r\n        return name || defaultName;\r\n    }\r\n\r\n    var sandboxStore = o.createStore({\r\n        defaultValue : function(sandboxName) {\r\n            // Notice that these are not part of the core.\r\n            var sb = o.clazz.create('Oskari.Sandbox', getName(sandboxName));\r\n            return sb;\r\n        }\r\n    });\r\n\r\n    /**\r\n     * @public @static @method Oskari.getSandbox\r\n     *\r\n     * @param  {string=} sandboxName Sandbox name\r\n     *\r\n     * @return {Object}              Sandbox\r\n     */\r\n     o.getSandbox = function (name) {\r\n        return sandboxStore.data(getName(name));\r\n    };\r\n}(Oskari));","/**\r\n * @class Oskari.Sandbox\r\n *\r\n * Sandbox is the component providing bundles ways to get information about the status of the system\r\n * and communicate to other bundles using requests and events. Sandbox is created at the same time as\r\n * Oskari.mapframework.core.Core. Module init/start/stop methods get reference to sandbox through\r\n * the Oskari Module protocol.\r\n */\r\n(function(Oskari) {\r\n    var user;\r\n    var ajaxUrl;\r\n    var log;\r\n    var services = {};\r\n    var requestHandlers = {};\r\n    var isDebugMode = false;\r\n\r\n\r\n    Oskari.clazz.define('Oskari.Sandbox',\r\n\r\n        /**\r\n         * @method create called automatically on construction\r\n         * @static\r\n         *\r\n         * @param {String} name optional name for non-default sandbox.\r\n         */\r\n        function (name) {\r\n            var postFix = '' ;\r\n            if(name !== 'sandbox') {\r\n                postFix = '.' + name;\r\n            }\r\n            log = Oskari.log('Sandbox' + postFix);\r\n\r\n            var me = this;\r\n\r\n            this._map = Oskari.clazz.create('Oskari.mapframework.domain.Map', this);\r\n            // assumes map is present\r\n            this.handleMapLinkParams();\r\n\r\n            /*\r\n             * All registered listeners in map key: event name value:\r\n             * array of modules who are interested in this type of event\r\n             */\r\n            me._listeners = [];\r\n\r\n            /* array of all registered modules */\r\n            me._modules = [];\r\n            me._modulesByName = {};\r\n            me._statefuls = {};\r\n\r\n            me.requestEventLog = [];\r\n            me.requestEventStack = [];\r\n\r\n            // TODO: move to some conf?\r\n            /* as of 2012-09-24 debug by default false */\r\n            me.maxGatheredRequestsAndEvents = 4096;\r\n            me.requestAndEventGather = [];\r\n            me._eventLoopGuard = 0;\r\n        }, {\r\n            getLog : function() {\r\n                return log;\r\n            },\r\n            /**\r\n             * Returns true if anything is registered as a handler for the request.\r\n             * @param  {String}  requestName request to check\r\n             * @return {Boolean}             true if request is being handled.\r\n             */\r\n            hasHandler : function(requestName) {\r\n                return !!requestHandlers[requestName];\r\n            },\r\n            /**\r\n             * Get value if no parameter is given, set value with parameter\r\n             * @param  {Boolean} setDebug optional parameter to set the debug mode\r\n             * @return {Boolean}          true if debug is enabled\r\n             */\r\n            debug: function (setDebug) {\r\n                if(typeof setDebug === 'undefined') {\r\n                    // getter\r\n                    return isDebugMode;\r\n                }\r\n                isDebugMode = !!setDebug;\r\n                log.enableDebug(isDebugMode);\r\n                return isDebugMode;\r\n            },\r\n\r\n            /**\r\n             * @method setUser\r\n             *\r\n             * Creates Oskari.mapframework.domain.User from the given data as current\r\n             * user\r\n             * @param {Object} userData\r\n             *     JSON presentation of user\r\n             */\r\n            setUser: function (userData) {\r\n                user = Oskari.clazz.create('Oskari.mapframework.domain.User', userData);\r\n            },\r\n\r\n            /**\r\n             * @method getUser\r\n             * Returns current user. See #setUser\r\n             *\r\n             * @return {Oskari.mapframework.domain.User} user\r\n             */\r\n            getUser: function () {\r\n                if (!user) {\r\n                    // init user\r\n                    this.setUser();\r\n                }\r\n                return user;\r\n            },\r\n\r\n            /**\r\n             * @method setAjaxUrl\r\n             * Sets a global Url that is used to communicate with the server\r\n             * @param {String} pUrl\r\n             */\r\n            setAjaxUrl: function (pUrl) {\r\n                ajaxUrl = pUrl;\r\n            },\r\n\r\n            /**\r\n             * @method getAjaxUrl\r\n             * Returns global ajax url for the application. See #setAjaxUrl\r\n             * @param {String} route optional route that's used as action_route parameter\r\n             * @return {String}\r\n             */\r\n            getAjaxUrl: function (route) {\r\n                if(route) {\r\n                    return ajaxUrl + 'action_route=' + route;\r\n                }\r\n                return ajaxUrl;\r\n            },\r\n\r\n            /**\r\n             * @method registerService\r\n             * Registers given service to Oskari system\r\n             *\r\n             * @param {Oskari.mapframework.service.Service}\r\n             *            service service to register\r\n             */\r\n            registerService: function (service) {\r\n                services[service.getQName()] = service;\r\n            },\r\n\r\n            /**\r\n             * Method for asking a registered service\r\n             *\r\n             * @param {String}\r\n             *            serviceQName that identifies the service in the core\r\n             * @return {Oskari.mapframework.service.Service}\r\n             */\r\n            getService: function (type) {\r\n                return services[type];\r\n            },\r\n\r\n            /**\r\n             * @method registerAsStateful\r\n             * Registers given bundle instance to sandbox as stateful\r\n             *\r\n             * @param {String}\r\n             *            pBundleId bundle instance id to which the state will be mapped\r\n             * to\r\n             * @param {Oskari.bundle.BundleInstance}\r\n             *            pInstance reference to actual bundle instance\r\n             */\r\n            registerAsStateful: function (pBundleId, pInstance) {\r\n                this._statefuls[pBundleId] = pInstance;\r\n            },\r\n\r\n            /**\r\n             * @method unregisterStateful\r\n             * Unregisters given bundle instance from stateful bundles in sandbox\r\n             *\r\n             * @param {String}\r\n             *            pBundleId bundle instance id which to unregister\r\n             */\r\n            unregisterStateful: function (pBundleId) {\r\n                this._statefuls[pBundleId] = null;\r\n                delete this._statefuls[pBundleId];\r\n            },\r\n\r\n            /**\r\n             * @method getStatefulComponents\r\n             * Returns an object that has references to stateful components (see\r\n             * #registerAsStateful).\r\n             * The objects propertynames match the instance id and property value is\r\n             * reference to the stateful component.\r\n             * @return {Object}\r\n             */\r\n            getStatefulComponents: function () {\r\n                return this._statefuls;\r\n            },\r\n\r\n            /**\r\n             * @method register\r\n             * Registers given module to sandbox and calls the modules init() method\r\n             *\r\n             * @param {Oskari.mapframework.module.Module}\r\n             *            module\r\n             */\r\n            register: function (module) {\r\n                this._modules.push(module);\r\n                this._modulesByName[module.getName()] = module;\r\n                return module.init(this);\r\n            },\r\n\r\n            /**\r\n             * @method unregister\r\n             * Unregisters given module from sandbox\r\n             *\r\n             * @param {Oskari.mapframework.module.Module}\r\n             *            module\r\n             */\r\n            unregister: function (module) {\r\n                var me = this,\r\n                    remainingModules = [],\r\n                    m;\r\n                for (m = 0; m < me._modules.length; m += 1) {\r\n                    if (module === me._modules[m]) {\r\n                        continue;\r\n                    }\r\n                    remainingModules.push(me._modules[m]);\r\n                }\r\n                me._modules = remainingModules;\r\n                me._modulesByName[module.getName()] = undefined;\r\n                delete me._modulesByName[module.getName()];\r\n            },\r\n\r\n            /**\r\n             * @method registerForEventByName\r\n             * Registers given module to listen to given event\r\n             *\r\n             * @param {Oskari.mapframework.module.Module} module\r\n             * @param {String} eventName\r\n             */\r\n            registerForEventByName: function (module, eventName) {\r\n                log.debug('#*#*#* Sandbox is registering module \\'' + module.getName() + '\\' to event \\'' + eventName + '\\'');\r\n                var oldListeners = this._listeners[eventName];\r\n                if (oldListeners === null || oldListeners === undefined) {\r\n                    oldListeners = [];\r\n                    this._listeners[eventName] = oldListeners;\r\n                }\r\n\r\n                oldListeners.push(module);\r\n                log.debug('There are currently ' + oldListeners.length + ' listeners for event \\'' + eventName + '\\'');\r\n            },\r\n\r\n            /**\r\n             * @method unregisterFromEventByName\r\n             * Unregisters given module from listening to given event\r\n             *\r\n             * @param {Oskari.mapframework.module.Module} module\r\n             * @param {String} eventName\r\n             */\r\n            unregisterFromEventByName: function (module, eventName) {\r\n                log.debug('Sandbox is unregistering module \\'' + module.getName() + '\\' from event \\'' + eventName + '\\'');\r\n                var oldListeners = this._listeners[eventName],\r\n                    deleteIndex = -1,\r\n                    d;\r\n                if (oldListeners === null || oldListeners === undefined) {\r\n                    // no listeners\r\n                    log.debug('Module does not listen to that event, skipping.');\r\n                    return;\r\n                }\r\n\r\n                for (d = 0; d < oldListeners.length; d += 1) {\r\n                    if (oldListeners[d] === module) {\r\n                        deleteIndex = d;\r\n                        break;\r\n                    }\r\n                }\r\n                if (deleteIndex > -1) {\r\n                    oldListeners.splice(deleteIndex, 1);\r\n                    log.debug('Module unregistered successfully from event');\r\n                } else {\r\n                    log.debug('Module does not listen to that event, skipping.');\r\n                }\r\n            },\r\n\r\n            /**\r\n             * @method request\r\n             * Registered modules can request work to be done using this method\r\n             *\r\n             * @param {Oskari.mapframework.module.Module/String} creator\r\n             *            that created request. This can be either actual\r\n             *            module or the name of the module. Both are\r\n             *            accepted.\r\n             * @param {Oskari.mapframework.request.Request} request\r\n             *            request to be performed\r\n             */\r\n            request: function (creator, request) {\r\n                var creatorName = null,\r\n                    creatorComponent,\r\n                    rv = null;\r\n\r\n                if (creator === null || creator === undefined) {\r\n                    throw new TypeError('sandbox.request(): missing creator.');\r\n                }\r\n\r\n                if (creator.getName !== null && creator.getName !== undefined) {\r\n                    creatorName = creator.getName();\r\n                } else {\r\n                    creatorName = creator;\r\n                }\r\n                creatorComponent = this.findRegisteredModuleInstance(creatorName);\r\n\r\n                if (creatorComponent === null || creatorComponent === undefined) {\r\n                    throw 'Attempt to create request with unknown component \\'' + creator + '\\' as creator';\r\n                }\r\n                request._creator = creatorName;\r\n\r\n                if (this.debug()) {\r\n                    this._pushRequestAndEventGather(creatorName + '->Sandbox: ', request.getName());\r\n                }\r\n\r\n                this._debugPushRequest(creatorName, request);\r\n                rv = this.processRequest(request);\r\n                this._debugPopRequest();\r\n\r\n                return rv;\r\n            },\r\n            /**\r\n             * @method processRequest\r\n             * Forwards requests to corresponding request handlers.\r\n             * If request doesn't have handler, prints warning to console.\r\n             * @param {Oskari.mapframework.request.Request} request to forward\r\n             * @return {Boolean} Returns true, if request was handled, false otherwise\r\n             */\r\n            processRequest: function (request) {\r\n                var requestName = request.getName();\r\n\r\n                var handlerClsInstance = this.requestHandler(requestName);\r\n                if (!handlerClsInstance || typeof handlerClsInstance.handleRequest !== 'function') {\r\n                    log.warn('No handler for request', requestName);\r\n                    return;\r\n                }\r\n                handlerClsInstance.handleRequest.apply(handlerClsInstance, [undefined, request]);\r\n            },\r\n\r\n            /**\r\n             * @method requestByName\r\n             * Registered modules can request work to be done using this method.\r\n             *\r\n             * This is a utility to work with request names instead of constructing\r\n             * request objects\r\n             *\r\n             * @param {Oskari.mapframework.module.Module/String} creator\r\n             *            that created request. This can be either actual\r\n             *            module or the name of the module. Both are\r\n             *            accepted.\r\n             * @param {String} requestName (this is NOT the request class name)\r\n             * @param {Array} requestArgs (optional)\r\n             * @return {Boolean} Returns true, if request was handled, false otherwise\r\n             */\r\n            requestByName: function (creator, requestName, requestArgs) {\r\n                log.debug(\r\n                    '#!#!#! --------------> requestByName ' + requestName\r\n                );\r\n                var requestBuilder = Oskari.requestBuilder(requestName),\r\n                    request = requestBuilder.apply(this, requestArgs || []);\r\n                return this.request(creator, request);\r\n            },\r\n\r\n            /**\r\n             * @property postMasterComponent\r\n             * @static\r\n             * Used as request/event sender if creator cannot be determined\r\n             */\r\n            postMasterComponent: 'postmaster',\r\n\r\n            /**\r\n             * @method postRequestByName\r\n             *\r\n             * This posts a request for processing. As the method doesn't require\r\n             * a registered bundle to be the sender of the request\r\n             * #postMasterComponent property will be used as creator\r\n             *\r\n             * NOTE! This is asynchronous - by design.\r\n             *\r\n             * This attempts to loose some stack frames as well as provide\r\n             * some yield time for the browser.\r\n             *\r\n             * @param {String} requestName (this is NOT the request class name)\r\n             * @param {Array} requestArgs (optional)\r\n             */\r\n            postRequestByName: function (requestName, requestArgs) {\r\n                var me = this,\r\n                    requestBuilder = Oskari.requestBuilder(requestName);\r\n                if (!requestBuilder || !this.hasHandler(requestName)) {\r\n                    log.warn('Trying to post request', requestName, 'that is undefined or missing a handler. Skipping!');\r\n                    return;\r\n                }\r\n                window.setTimeout(function () {\r\n                    var request = requestBuilder.apply(me, requestArgs || []),\r\n                        creatorComponent = me.postMasterComponent,\r\n                        rv = null;\r\n\r\n                    request._creator = creatorComponent;\r\n\r\n                    if (me.debug()) {\r\n                        me._pushRequestAndEventGather(\r\n                            creatorComponent + '->Sandbox: ',\r\n                            request.getName()\r\n                        );\r\n                    }\r\n\r\n                    if (me.debug()) {\r\n                        me._debugPushRequest(creatorComponent, request);\r\n                    }\r\n\r\n                    rv = me.processRequest(request);\r\n\r\n                    if (me.debug()) {\r\n                        me._debugPopRequest();\r\n                    }\r\n\r\n                }, 0);\r\n\r\n            },\r\n\r\n            /**\r\n             * @method _findModulesInterestedIn\r\n             * Internal method for finding modules that are interested\r\n             * in given event\r\n             * @private\r\n             * @param {Oskari.mapframework.event.Event} event\r\n             * @return {Oskari.mapframework.module.Module[]} modules listening to the event\r\n             */\r\n            _findModulesInterestedIn: function (event) {\r\n                var eventName = event.getName(),\r\n                    currentListeners = this._listeners[eventName];\r\n                if (!currentListeners) {\r\n                    return [];\r\n                }\r\n                return currentListeners;\r\n            },\r\n\r\n            /**\r\n             * @method notifyAll\r\n             * Finds out registered modules that are interested in given event and\r\n             * notifies them\r\n             *\r\n             * @param {Oskari.mapframework.event.Event} event - event to send\r\n             * @param {Boolean} retainEvent true to not send event but only print debug which modules are listening, usually left undefined (optional)\r\n             */\r\n            notifyAll: function (event, retainEvent) {\r\n                var eventName;\r\n                if (!retainEvent) {\r\n                    eventName = event.getName();\r\n                    log.debug(\r\n                        'Sandbox received notifyall for event \\'' + eventName + '\\''\r\n                    );\r\n                }\r\n\r\n                var modules = this._findModulesInterestedIn(event),\r\n                    i,\r\n                    module;\r\n                if (!retainEvent) {\r\n                    log.debug(\r\n                        'Found ' + modules.length + ' interested modules'\r\n                    );\r\n                }\r\n                for (i = 0; i < modules.length; i += 1) {\r\n                    module = modules[i];\r\n                    if (!retainEvent) {\r\n                        log.debug(\r\n                            'Notifying module \\'' + module.getName() + '\\'.'\r\n                        );\r\n\r\n                        if (this.debug()) {\r\n                            this._pushRequestAndEventGather(\r\n                                'Sandbox->' + module.getName() + ':', eventName\r\n                            );\r\n                        }\r\n                    }\r\n\r\n                    this._debugPushEvent(\r\n                        event._creator || 'NA',\r\n                        module,\r\n                        event\r\n                    );\r\n                    module.onEvent(event);\r\n                    this._debugPopEvent();\r\n                }\r\n\r\n                // finally clean event memory\r\n                if (!retainEvent) {\r\n                    // FIXME only properties should be deleted\r\n                    delete event;\r\n                }\r\n            },\r\n\r\n            /**\r\n             * @method findRegisteredModuleInstance\r\n             * Returns module with given name if it is registered to sandbox\r\n             *\r\n             * @param {String} name for the module\r\n             * @return {Oskari.mapframework.module.Module} registered module or null if not found, map of modules if name is not given\r\n             */\r\n            findRegisteredModuleInstance: function (name) {\r\n                if(!name) {\r\n                    return this._modulesByName;\r\n                }\r\n                return this._modulesByName[name];\r\n            },\r\n\r\n            /**\r\n             * @method getBrowserWindowSize\r\n             * Returns an object with properties width and height as the window size in pixels\r\n             * @return {Object} object with properties width and height as the window size in pixels\r\n             */\r\n            getBrowserWindowSize: function () {\r\n                var width = jQuery(window).width(),\r\n                    size = {};\r\n                size.height = jQuery(window).height();\r\n                size.width = width;\r\n\r\n                log.debug(\r\n                    'Got browser window size is: width: ' + size.width +\r\n                    ' px, height:' + size.height + ' px.'\r\n                );\r\n\r\n                return size;\r\n            },\r\n\r\n            /**\r\n             * @method requestHandler\r\n             * Registers a request handler for requests with the given name and handler or returns the handler for\r\n             * request if handler is undefined.\r\n             *\r\n             * NOTE: only one request handler can be registered/request\r\n             * @param {String} requestName - name of the request\r\n             * @param {Oskari.mapframework.core.RequestHandler} handlerClsInstance request handler\r\n             */\r\n            requestHandler : function(requestName, handler) {\r\n                if(typeof handler === 'undefined') {\r\n                    // getter\r\n                    return requestHandlers[requestName];\r\n                }\r\n                if(requestHandlers[requestName] && handler !== null) {\r\n                    log.warn('Overwriting request handler!!');\r\n                }\r\n                // setter, removal with handler value <null>\r\n                requestHandlers[requestName] = handler;\r\n            },\r\n            /**\r\n             * @method _debugPushRequest\r\n             * @private\r\n             * Adds request to list so we can show a debugging diagram with\r\n             * popUpSeqDiagram() method\r\n             *\r\n             * @param {String} creator name for the component sending the request\r\n             * @param {Oskari.mapframework.request.Request} req - request that was sent\r\n             */\r\n            _debugPushRequest: function (creator, req) {\r\n                if (!this.debug()) {\r\n                    return;\r\n                }\r\n                var reqLog = {\r\n                    from: creator,\r\n                    reqName: req.getName()\r\n                };\r\n                this.requestEventStack.push(reqLog);\r\n                this.requestEventLog.push(reqLog);\r\n                if (this.requestEventLog.length > 64) {\r\n                    this.requestEventLog.shift();\r\n                }\r\n            },\r\n            /**\r\n             * @method _debugPopRequest\r\n             * @private\r\n             * Pops the request from the debugging stack\r\n             */\r\n            _debugPopRequest: function () {\r\n                if (!this.debug()) {\r\n                    return;\r\n                }\r\n                this.requestEventStack.pop();\r\n            },\r\n\r\n            /**\r\n             * @method _debugPushEvent\r\n             * @private\r\n             * Adds event to list so we can show a debugging diagram with\r\n             * popUpSeqDiagram() method\r\n             *\r\n             * @param {String} creator - name for the component sending the event\r\n             * @param {Oskari.mapframework.module.Module} target - module that is receiving the event\r\n             * @param {Oskari.mapframework.event.Event} evt - event that was sent\r\n             */\r\n            _debugPushEvent: function (creator, target, evt) {\r\n                if (!this.debug()) {\r\n                    return;\r\n                }\r\n                this._eventLoopGuard += 1;\r\n\r\n                if (this._eventLoopGuard > 64) {\r\n                    throw 'Events Looped?';\r\n                }\r\n\r\n                var evtLog = {\r\n                    from: creator,\r\n                    to: target.getName(),\r\n                    evtName: evt.getName()\r\n                };\r\n                this.requestEventStack.push(evtLog);\r\n                this.requestEventLog.push(evtLog);\r\n                if (this.requestEventLog.length > 64) {\r\n                    this.requestEventLog.shift();\r\n                }\r\n            },\r\n\r\n            /**\r\n             * @method _debugPopRequest\r\n             * @private\r\n             * Pops the event from the debugging stack\r\n             */\r\n            _debugPopEvent: function () {\r\n                if (!this.debug()) {\r\n                    return;\r\n                }\r\n                this._eventLoopGuard -= 1;\r\n                this.requestEventStack.pop();\r\n            },\r\n\r\n            /**\r\n             * @method _pushRequestAndEventGather\r\n             * @private\r\n             * Adds request/event to list so we can show a debugging diagram with\r\n             * popUpSeqDiagram() method\r\n             *\r\n             * @param {String} name for the component sending the request\r\n             * @param {Oskari.mapframework.request.Request/Oskari.mapframework.event.Event} req - request that was sent\r\n             */\r\n            _pushRequestAndEventGather: function (name, request) {\r\n                var module = {};\r\n                module.name = name;\r\n                module.request = request;\r\n                this.requestAndEventGather.push(module);\r\n                if (this.requestAndEventGather.length > this.maxGatheredRequestsAndEvents) {\r\n                    this.requestAndEventGather.shift();\r\n                }\r\n            },\r\n            /**\r\n             * @method popUpSeqDiagram\r\n             * Opens a new window containing a sequence diagram of requests and events that has been sent\r\n             * for debugging purposes. Uses request/event creator to be set so to get usable diagram, requests\r\n             * should be sent from registered modules (instead of postRequestByName()).\r\n             *\r\n             * Use #enableDebug() to enable data gathering.\r\n             *\r\n             * Uses www.websequencediagrams.com to create the diagram.\r\n             */\r\n            popUpSeqDiagram: function () {\r\n                var seq_html =\r\n                        '<html>' +\r\n                        '  <head></head>' +\r\n                        '  <body>' +\r\n                        '    <div class=\"wsd\" wsd_style=\"modern-blue\">' +\r\n                        '      <pre>',\r\n                    seq_commands = '',\r\n                    openedWindow,\r\n                    x;\r\n\r\n                for (x in this.requestAndEventGather) {\r\n                    if (this.requestAndEventGather.hasOwnProperty(x)) {\r\n                        seq_commands += this.requestAndEventGather[x].name + this.requestAndEventGather[x].request + '\\n';\r\n                    }\r\n                }\r\n                if (seq_commands !== '') {\r\n                    seq_html +=\r\n                        seq_commands +\r\n                        '</pre>\\n' +\r\n                        '    </div>' +\r\n                        '    <script type=\"text/javascript\">' +\r\n                        // Web Sequenced Diagrams service.js\r\n                        ' /* This part of code getted in here: http://www.websequencediagrams.com/service.js */ '+\r\n                        '(function()'+\r\n                        '{'+\r\n                            '// The script location'+\r\n                            'var ScriptSrc = (function() {'+\r\n                                'var src;'+\r\n                                'var i;'+\r\n                                'var scripts = document.getElementsByTagName(\"script\"),'+\r\n                                    'script = scripts[scripts.length - 1];'+\r\n                                'if (script.getAttribute.length !== undefined) {'+\r\n                                    'src = script.src;'+\r\n                                '} else {'+\r\n                                    'src = script.getAttribute(\"src\", -1);'+\r\n                                '}'+\r\n                                'return src;'+\r\n                            '}());'+\r\n                            'function GetScriptHostname()'+\r\n                            '{'+\r\n                                '// Returns script protocol, hostname and port.'+\r\n                                'var regex = /(https?:\\/\\/[^\\/]+)/;'+\r\n                                'var m = regex.exec(ScriptSrc);'+\r\n                                'if ( m && m.length > 1 ) {'+\r\n                                    'return m[1];'+\r\n                                '} else {'+\r\n                                    'return \"error\";'+\r\n                                '}'+\r\n                            '}'+\r\n                            'function BitWriter()'+\r\n                            '{'+\r\n                                '// encodes as URL-BASE64'+\r\n                                'this.str = \"\";'+\r\n                                'this.partial = 0;'+\r\n                                'this.partialSize = 0;'+\r\n                                'this.table = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\";'+\r\n                                'this.addBits = function( bits, size )'+\r\n                                '{'+\r\n                                    'this.partial = (this.partial << size) | bits;'+\r\n                                    'this.partialSize += size;'+\r\n                                    'while ( this.partialSize >= 6 ) {'+\r\n                                        'this.str += this.table.charAt((this.partial >>'+\r\n                                                                       '(this.partialSize - 6)) & 0x3f);'+\r\n                                        'this.partialSize -= 6;'+\r\n                                    '}'+\r\n                                '};'+\r\n                                'this.finish = function() {'+\r\n                                    'if ( this.partialSize ) {'+\r\n                                        'this.str += this.table.charAt('+\r\n                                            '( this.partial << ( 6 - this.partialSize ) ) & 0x3f );'+\r\n                                        'this.partialSize = 0;'+\r\n                                        'this.partial = 0;'+\r\n                                    '}'+\r\n                                '};'+\r\n                            '}'+\r\n                            'function encodeBase64(str)'+\r\n                            '{'+\r\n                                'var writer = new BitWriter();'+\r\n                                'for (var n = 0; n < str.length; n++) {'+\r\n                                    'writer.addBits( str.charCodeAt( n ), 8 );'+\r\n                                '}'+\r\n                                'writer.finish();'+\r\n                                'return writer.str;'+\r\n                            '}'+\r\n                            'function encodeUtf8(string) {'+\r\n                                '// fronm http://www.webtoolkit.info/'+\r\n                                'string = string.replace(/\\r\\n/g,\"\\n\");'+\r\n                                'var utftext = \"\";'+\r\n                                'for (var n = 0; n < string.length; n++) {'+\r\n                                    'var c = string.charCodeAt(n);'+\r\n                                    'if (c < 128) {'+\r\n                                        'utftext += String.fromCharCode(c);'+\r\n                                    '}'+\r\n                                    'else if((c > 127) && (c < 2048)) {'+\r\n                                        'utftext += String.fromCharCode((c >> 6) | 192);'+\r\n                                        'utftext += String.fromCharCode((c & 63) | 128);'+\r\n                                    '}'+\r\n                                    'else {'+\r\n                                        'utftext += String.fromCharCode((c >> 12) | 224);'+\r\n                                        'utftext += String.fromCharCode(((c >> 6) & 63) | 128);'+\r\n                                        'utftext += String.fromCharCode((c & 63) | 128);'+\r\n                                    '}'+\r\n                                '}'+\r\n                                'return utftext;'+\r\n                            '}'+\r\n                            'function encodeNumber(num)'+\r\n                            '{'+\r\n                                '// encodes a number in only as many bytes as required, 7 bits at a time.'+\r\n                                '// bit 8 is used to indicate whether another byte follows.'+\r\n                                'if ( num >= 0x3FFF ) {'+\r\n                                    'return String.fromCharCode( 0x80 | ( (num >> 14) & 0x7f ) ) +'+\r\n                                           'String.fromCharCode( 0x80 | ( (num >>  7) & 0x7f ) ) +'+\r\n                                           'String.fromCharCode( num & 0x7f );'+\r\n                                '} else if ( num >= 0x7F ) {'+\r\n                                    'return String.fromCharCode( 0x80 | ( (num >>  7) & 0x7f ) ) +'+\r\n                                           'String.fromCharCode( num & 0x7f );'+\r\n                                '} else {'+\r\n                                    'return String.fromCharCode( num );'+\r\n                                '}'+\r\n                            '}'+\r\n                            'function encodeLz77( input )'+\r\n                            '{'+\r\n                                'var MinStringLength = 4;'+\r\n                                'var output = \"\";'+\r\n                                'var pos = 0;'+\r\n                                'var hash = {};'+\r\n                                '// set last pos to just after the last chunk.'+\r\n                                'var lastPos = input.length - MinStringLength;'+\r\n                                'for ( var i = MinStringLength; i < input.length; i++ ) {'+\r\n                                    'var subs = input.substr(i-MinStringLength, MinStringLength);'+\r\n                                    'if ( hash[subs] === undefined ) {'+\r\n                                        'hash[subs] = [];'+\r\n                                    '}'+\r\n                                    'hash[subs].push( i-MinStringLength );'+\r\n                                    '//document.write(\"subs[\" + subs + \"]=\" + (pos - MinStringLength) + \"<br>\");'+\r\n                                '}'+\r\n                                '// loop until pos reaches the last chunk.'+\r\n                                'while (pos < lastPos) {'+\r\n                                    '// search start is the current position minus the window size, capped'+\r\n                                    '// at the beginning of the string.'+\r\n                                    'var matchLength = MinStringLength;'+\r\n                                    'var foundMatch = false;'+\r\n                                    'var bestMatch = {distance: 0, length: 0};'+\r\n                                    'var prefix = input.substr(pos, MinStringLength);'+\r\n                                    'var matches = hash[prefix];'+\r\n                                    '// loop until the end of the matched region reaches the current'+\r\n                                    '// position.'+\r\n                                    '//while ((searchStart + matchLength) < pos) {'+\r\n                                    'if ( matches !== undefined ) {'+\r\n                                        'for ( var i = 0; i < matches.length; i++ ) {'+\r\n                                            'var searchStart = matches[i];'+\r\n                                            'if ( searchStart + matchLength >= pos ) {'+\r\n                                                'break;'+\r\n                                            '}'+\r\n                                            'while( searchStart + matchLength < pos ) {'+\r\n                                                '// check if string matches.'+\r\n                                                'var isValidMatch = ('+\r\n                                                        '(input.substr(searchStart, matchLength) == input.substr(pos, matchLength))'+\r\n                                                        ');'+\r\n                                                'if (isValidMatch) {'+\r\n                                                    '// we found at least one match. try for a larger one.'+\r\n                                                    'var realMatchLength = matchLength;'+\r\n                                                    'matchLength++;'+\r\n                                                    'if (foundMatch && (realMatchLength > bestMatch.length)) {'+\r\n                                                        'bestMatch.distance = pos - searchStart - realMatchLength;'+\r\n                                                        'bestMatch.length = realMatchLength;'+\r\n                                                    '}'+\r\n                                                    'foundMatch = true;'+\r\n                                                '} else {'+\r\n                                                    'break;'+\r\n                                                '}'+\r\n                                            '}'+\r\n                                        '}'+\r\n                                    '}'+\r\n                                    'if (bestMatch.length) {'+\r\n                                        'output += String.fromCharCode( 0 ) +'+\r\n                                            'encodeNumber(bestMatch.distance) +'+\r\n                                            'encodeNumber(bestMatch.length);'+\r\n                                        'pos += bestMatch.length;'+\r\n                                    '} else {'+\r\n                                        'if (input.charCodeAt(pos) !== 0) {'+\r\n                                            'output += input.charAt(pos);'+\r\n                                        '} else {'+\r\n                                            'output += String.fromCharCode( 0 ) +'+\r\n                                                'String.fromCharCode( 0 );'+\r\n                                        '}'+\r\n                                        'pos++;'+\r\n                                    '}'+\r\n                                '}'+\r\n                                'return output + input.slice(pos).replace(/\\0/g, \"\\0\\0\");'+\r\n                            '}'+\r\n                            'function getText( node )'+\r\n                            '{'+\r\n                                'var text = \"\";'+\r\n                                'for( var i = 0; i < node.childNodes.length; i++ ) {'+\r\n                                    'var child = node.childNodes[i];'+\r\n                                    'if ( child.nodeType == 3 ) {'+\r\n                                        'text += child.data;'+\r\n                                    '} else {'+\r\n                                        'text += getText( child );'+\r\n                                    '}'+\r\n                                '}'+\r\n                                'return text;'+\r\n                            '}'+\r\n                            'function process(divs) {'+\r\n                                'var hostname = GetScriptHostname();'+\r\n                                'for ( var i = 0; i < divs.length; i++ ) {'+\r\n                                    'if ( divs[i].className == \"wsd\" && !divs[i].wsd_processed ) {'+\r\n                                        'divs[i].wsd_processed = true;'+\r\n                                        'var style = \"\";'+\r\n                                        'if ( divs[i].attributes[\"wsd_style\"] ) {'+\r\n                                            'style = \"&s=\" + divs[i].attributes[\"wsd_style\"].value;'+\r\n                                        '}'+\r\n                                        'var text = encodeBase64( encodeLz77( encodeUtf8( getText( divs[i] ) ) ) );'+\r\n                                        'var str = hostname + \"/cgi-bin/cdraw?\" +'+\r\n                                            '\"lz=\" + text + style;'+\r\n                                        'if ( true || str.length < 2048 ) {'+\r\n                                            'for( var j = divs[i].childNodes.length-1; j >= 0; j-- ) {'+\r\n                                                'divs[i].removeChild( divs[i].childNodes[j] );'+\r\n                                            '}'+\r\n                                            'var img = document.createElement(\"img\");'+\r\n                                            'img.setAttribute(\"src\", str);'+\r\n                                            'divs[i].appendChild( img );'+\r\n                                        '} else {'+\r\n                                            'divs[i].insertBefore( document.createTextNode(\"Diagram too large for web service.\"), divs[i].firstChild );'+\r\n                                        '}'+\r\n                                    '}'+\r\n                                '}'+\r\n                            '}'+\r\n                            'process( document.getElementsByTagName(\"div\") );'+\r\n                            'process( document.getElementsByTagName(\"span\") );'+\r\n                        '})();'+\r\n                        '    </script>' +\r\n                        '  </body>' +\r\n                        '</html>';\r\n                    openedWindow = window.open();\r\n                    openedWindow.document.write(seq_html);\r\n                    this.requestAndEventGather = [];\r\n                } else {\r\n                    alert('No requests in queue');\r\n                }\r\n            },\r\n            /**\r\n             * @method getLocalizedProperty\r\n             * @param property Property\r\n             * @param lang Optional language\r\n             */\r\n            getLocalizedProperty: function (property, lang) {\r\n                var ret,\r\n                    supportedLocales,\r\n                    i,\r\n                    language = lang || Oskari.getLang();\r\n                if (property === null || property === undefined) {\r\n                    return null;\r\n                }\r\n                if (typeof property === 'object') {\r\n                    // property value is an object, so it's prolly localized\r\n                    ret = property[language];\r\n                    if (ret === null) {\r\n                        supportedLocales = Oskari.getSupportedLocales();\r\n                        for (i = 0; i < supportedLocales.length; i += 1) {\r\n                            ret = property[supportedLocales[i]];\r\n                            if (ret) {\r\n                                // We found the property in _some_ language...\r\n                                break;\r\n                            }\r\n                        }\r\n                        // TODO (needs supportedLocales)\r\n                        // try default lang\r\n                        // try any lang?\r\n                    }\r\n                    return ret;\r\n                }\r\n                // property is not localized\r\n                return property;\r\n            },\r\n            /**\r\n             * Fills in missing details for base url. Uses\r\n             * window.location.protocol/host/port/path if needed.\r\n             * @method createURL\r\n             * @param  {String} baseUrl URL fragment or whole URL\r\n             * @param  {Boolean} prepQueryString if true, makes sure the url ends with ? or & character\r\n             * @return {String} Usable URL or null if couldn't create it.\r\n             */\r\n            createURL : function(baseUrl, prepQueryString) {\r\n                if(!baseUrl) {\r\n                    return null;\r\n                }\r\n                var url = this.__constructUrl(baseUrl);\r\n                if(!!prepQueryString) {\r\n                    url = this.__prepareQueryString(url);\r\n                }\r\n                return url;\r\n            },\r\n            /**\r\n             * Fills in missing details for base url. Uses window.location.protocol/host/port/path if needed.\r\n             * @method __constructUrl\r\n             * @private\r\n             * @param  {String} baseUrl baseUrl URL fragment or whole URL\r\n             * @return {String} Usable URL\r\n             */\r\n            __constructUrl : function(baseUrl) {\r\n                // whole url, use as is\r\n                if(baseUrl.indexOf('://') !== -1) {\r\n                    return baseUrl;\r\n                }\r\n                // starts with // -> fill in protocol\r\n                if(baseUrl.indexOf('//') === 0) {\r\n                    return window.location.protocol + baseUrl;\r\n                }\r\n                var serverUrl = window.location.protocol + '//'\r\n                         + window.location.host;\r\n                // starts with / -> fill in protocol + host including port\r\n                if(baseUrl.indexOf('/') === 0) {\r\n                    return serverUrl + baseUrl;\r\n                }\r\n                return serverUrl + window.location.pathname + '/' + baseUrl;\r\n            },\r\n            /**\r\n             * Ensures that the given parameter has ? character and appends & to the end if\r\n             * url-parameter doesn't end to '?' or '&' characters\r\n             * @method __prepareQueryString\r\n             * @private\r\n             * @param  {String} url\r\n             * @return {String} modified url that ends with ? or &\r\n             */\r\n            __prepareQueryString : function(url) {\r\n                if(!url) {\r\n                    return null;\r\n                }\r\n                if(url.indexOf('?') === -1) {\r\n                    url = url + '?';\r\n                }\r\n                var lastChar = url.charAt(url.length-1);\r\n                if(lastChar !== '&' && lastChar !== '?') {\r\n                    url = url + '&';\r\n                }\r\n                return url;\r\n            }\r\n        }\r\n    );\r\n}(Oskari));","/**\r\n * @class Oskari.Sandbox.stateMethods\r\n *\r\n * This category class adds state methods to Oskari sandbox as they were in\r\n * the class itself.\r\n */\r\nOskari.clazz.category('Oskari.Sandbox', 'state-methods', {\r\n    /**\r\n     * @method registerAsStateful\r\n     * Registers given bundle instance to sandbox as stateful\r\n     *\r\n     * @param {String}\r\n     *            pBundleId bundle instance id to which the state will be mapped\r\n     * to\r\n     * @param {Oskari.bundle.BundleInstance}\r\n     *            pInstance reference to actual bundle instance\r\n     */\r\n    registerAsStateful: function (pBundleId, pInstance) {\r\n        this._statefuls[pBundleId] = pInstance;\r\n    },\r\n\r\n    /**\r\n     * @method unregisterStateful\r\n     * Unregisters given bundle instance from stateful bundles in sandbox\r\n     *\r\n     * @param {String}\r\n     *            pBundleId bundle instance id which to unregister\r\n     */\r\n    unregisterStateful: function (pBundleId) {\r\n        this._statefuls[pBundleId] = null;\r\n        delete this._statefuls[pBundleId];\r\n    },\r\n\r\n    /**\r\n     * @method getStatefulComponents\r\n     * Returns an object that has references to stateful components (see\r\n     * #registerAsStateful).\r\n     * The objects propertynames match the instance id and property value is\r\n     * reference to the stateful component.\r\n     * @return {Object}\r\n     */\r\n    getStatefulComponents: function () {\r\n        return this._statefuls;\r\n    },\r\n\r\n    /**\r\n     * @method getCurrentState\r\n     * @return {Object} JSON object presenting the state of the application at\r\n     * the moment.\r\n     */\r\n    getCurrentState: function () {\r\n        var state = {},\r\n            components = this.getStatefulComponents(),\r\n            bundleid;\r\n        for (bundleid in components) {\r\n            if (!components.hasOwnProperty(bundleid)) {\r\n                continue;\r\n            }\r\n            if (components[bundleid].getState) {\r\n                state[bundleid] = {\r\n                    // wrap with additional state property so we can use the same json as in startup configuration\r\n                    'state': components[bundleid].getState()\r\n                };\r\n            } else {\r\n                Oskari.log('Sandbox').warn('Stateful component ' + bundleid + ' doesnt have getState()');\r\n            }\r\n        }\r\n        return state;\r\n    },\r\n    /**\r\n     * @method resetState\r\n     * Resets the application state to the initial state provided by GetAppSetup action route.\r\n     */\r\n    resetState: function () {\r\n         // conf got loaded when application started\r\n        this.useState(Oskari.app.getConfiguration());\r\n    },\r\n\r\n    /**\r\n     * Sets application state for stateful bundles. \r\n     * InitialConf is a configuration object similar to GetAppSetup.configuration with bundleid as keys and a state object under the bundleid key.\r\n     * @param  {Object} initialConf state configuration object including data for all bundles\r\n     */\r\n    useState: function (initialConf) {\r\n        var newStateConfig = jQuery.extend(true, {}, initialConf),\r\n            components = this.getStatefulComponents(),\r\n            bundleState,\r\n            bundle,\r\n            bundleid;\r\n        // loop trough all the stateful bundles.\r\n        for (bundleid in components) {\r\n            if (!components.hasOwnProperty(bundleid)) {\r\n                continue;\r\n            }\r\n            bundle = components[bundleid];\r\n            // Double check that the bundle really is stateful\r\n            if (!bundle.setState) {\r\n                continue;\r\n            }\r\n            // newStateConfig has all the states from GetAppSetup.\r\n            if(newStateConfig[bundleid]) {\r\n                bundleState = newStateConfig[bundleid].state;\r\n            }\r\n            else {\r\n                bundleState = {};\r\n            }\r\n            // reset to the default state\r\n            bundle.setState(bundleState);\r\n        }\r\n    },\r\n    setSessionExpiring: function (minutes, callback) {\r\n        if(typeof minutes !== 'number' || typeof callback !== 'function') {\r\n            return;\r\n        }\r\n        var milliSeconds = 60 * 1000 * minutes;\r\n        setTimeout(function () {\r\n            callback();\r\n        }, milliSeconds);\r\n    },\r\n    extendSession: function (errorCallback) {\r\n        var url = this.getAjaxUrl() + 'action_route=GetCurrentUser',\r\n            currentUuid = this.getUser().getUuid(),\r\n            successCallback = function (res, textStatus, jqXHR) {\r\n                var resUuid = jqXHR.getResponseHeader('currentUserUid');\r\n                if (resUuid !== currentUuid) {\r\n                    // the uuid in response was not what we expected\r\n                    errorCallback();\r\n                }\r\n            };\r\n\r\n        this.ajax(url, successCallback, errorCallback);\r\n    }\r\n});","/**\r\n * @class Oskari.Sandbox.mapLayerMethods\r\n *\r\n * This category class adds map layers related methods to Oskari sandbox as they\r\n * were in the class itself.\r\n */\r\nOskari.clazz.category('Oskari.Sandbox', 'map-layer-methods', {\r\n\r\n    /**\r\n     * @method findMapLayerFromAllAvailable\r\n     * Finds map layer from all available. Uses Oskari.mapframework.service.MapLayerService.\r\n     *\r\n     * @param {String} id of the layer to get. If id is null, name is used to search the layer.\r\n     * @param {String} name of the layer to get. Only used if id = null.\r\n     * @return {Oskari.mapframework.domain.WmsLayer/Oskari.mapframework.domain.WfsLayer/Oskari.mapframework.domain.VectorLayer/Object}\r\n     *  layer domain object if found matching id or null if not found\r\n     */\r\n    findMapLayerFromAllAvailable: function (id, name) {\r\n        return this.getService('Oskari.mapframework.service.MapLayerService').findMapLayer(id);\r\n    },\r\n\r\n    /**\r\n     * @method findAllSelectedMapLayers\r\n     * Returns all currently selected map layers\r\n     * @return {Oskari.mapframework.domain.WmsLayer[]/Oskari.mapframework.domain.WfsLayer[]/Oskari.mapframework.domain.VectorLayer[]/Mixed}\r\n     */\r\n    findAllSelectedMapLayers: function () {\r\n        var layersList = this.getMap().getLayers();\r\n        // copy the array so changing it wont change the core data\r\n        return layersList.slice(0);\r\n    },\r\n    /**\r\n     * @method findAllHighlightedLayers\r\n     * Returns all currently highlighted map layers\r\n     * @return {Oskari.mapframework.domain.WmsLayer[]/Oskari.mapframework.domain.WfsLayer[]/Oskari.mapframework.domain.VectorLayer[]/Mixed}\r\n     */\r\n    findAllHighlightedLayers: function () {\r\n        var layersList = this.getMap().getActivatedLayers();\r\n        return layersList.slice(0);;\r\n    },\r\n\r\n    /**\r\n     * @method findMapLayerFromSelectedMapLayers\r\n     * Returns the layer domain object matching the id if it is added to map\r\n     *\r\n     * @param {String} id of the layer to get\r\n     * @return {Oskari.mapframework.domain.WmsLayer/Oskari.mapframework.domain.WfsLayer/Oskari.mapframework.domain.VectorLayer/Object}\r\n     *  layer domain object if found matching id or null if not found\r\n     */\r\n    findMapLayerFromSelectedMapLayers: function (layerId) {\r\n        return this.getMap().getSelectedLayer(layerId);\r\n    },\r\n\r\n    /**\r\n     * @method isLayerAlreadySelected\r\n     * Checks if the layer matching the id is added to map\r\n     *\r\n     * @param {String} id of the layer to check\r\n     * @return {Boolean} true if the layer is added to map\r\n     */\r\n    isLayerAlreadySelected: function (id) {\r\n        return this.getMap().isLayerSelected(id);\r\n    },\r\n\r\n\r\n    /**\r\n     * @method isMapLayerHighLighted\r\n     * Checks if the layer matching the id is highlighted on the map\r\n     *\r\n     * @param {String} id of the layer to check\r\n     * @return {Boolean} true if the layer is highlighted\r\n     */\r\n    isMapLayerHighLighted: function (id) {\r\n        return this.getMap().isLayerActivated(id);\r\n    },\r\n\r\n    /**\r\n     * @method allowMultipleHighlightLayers\r\n     * Allow multiple layers to be highlighted at once\r\n     *\r\n     * @param {Boolean} allow - true to allow, false to restrict to one highlight at a time\r\n     */\r\n    allowMultipleHighlightLayers: function (allow) {\r\n        this.getMap().allowMultipleActivatedLayers(allow);\r\n    },\r\n\r\n    /**\r\n     * Calls the core to remove the map layer.\r\n     *\r\n     * @method removeMapLayer\r\n     * @param  {String/Number} layerId\r\n     * @return {undefined}\r\n     */\r\n    removeMapLayer: function(layerId) {\r\n        this.getMap().removeLayer(layerId);\r\n    }\r\n});","/**\r\n * @class Oskari.Sandbox.mapMethods\r\n *\r\n * This category class adds map related methods to Oskari sandbox as they were in\r\n * the class itself.\r\n */\r\nOskari.clazz.category('Oskari.Sandbox', 'map-methods', {\r\n\r\n    /**\r\n     * @method getMap\r\n     * Returns map domain object\r\n     *\r\n     * @return {Oskari.mapframework.domain.Map}\r\n     */\r\n    getMap: function () {\r\n        return this._map;\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @method syncMapState\r\n     * Convenience method to send out a map move request with the values on\r\n     * {Oskari.mapframework.domain.Map} domain object (see #getMap()).\r\n     *\r\n     * @param {Boolean} blnInitialMove (optional)\r\n     *          If true, will clear the map history after moving. Defaults to false.\r\n     * @param {Oskari.mapframework.ui.module.common.MapModule} mapModule\r\n     * (optional)\r\n     *          Refreshes the map state so that the added layers are shown correctly\r\n     */\r\n    syncMapState: function (blnInitialMove, mapModule) {\r\n        var mapDomain = this.getMap(),\r\n            zoom = mapDomain.getZoom(),\r\n            maxZoom = 13;\r\n\r\n        if(mapModule) {\r\n            maxZoom = mapModule.getMaxZoomLevel();\r\n        }\r\n\r\n        if (blnInitialMove === true && zoom == maxZoom) {\r\n            // workaround, openlayers needs to be nudged a bit to actually draw\r\n            // the map images if we enter at max zoomlevel\r\n            // so if zoom == max zoom level -> send a dummy request to get openlayers working\r\n            // correctly\r\n            // TODO: find out why OL needs this\r\n            this.postRequestByName('MapMoveRequest', [mapDomain.getX(), mapDomain.getY(), 0]);\r\n        }\r\n        this.postRequestByName('MapMoveRequest', [mapDomain.getX(), mapDomain.getY(), zoom]);\r\n    },\r\n\r\n    /**\r\n     * @method generateMapLinkParameters\r\n     * Generates query string for an URL that has the maps state with coordinates, zoom and selected map layers\r\n     *\r\n     * Options syntax/supported fields:  {\r\n     *     marker : <boolean, default false>,\r\n     *     forceCache : <boolean, default true>,\r\n     *     noSavedState : <boolean, default true>\r\n     * }\r\n     *\r\n     * @param {Object} options - overrides default parameter values (optional)\r\n     * @return {String}\r\n     */\r\n    generateMapLinkParameters: function (options) {\r\n        // get stateful component parameters\r\n        // Note! These parameters must be passed to the server in index.js to be used\r\n        var components = this.getStatefulComponents(),\r\n            iterator = null,\r\n            component = null,\r\n            optionsLinkParameterArray = [],\r\n            componentLinkParameterArray = [];\r\n        for (iterator in components) {\r\n            if (components.hasOwnProperty(iterator)) {\r\n                component = components[iterator];\r\n\r\n                // Make sure the function exists and is a function\r\n                if (component.getStateParameters && typeof component.getStateParameters === \"function\") {\r\n                    var params = component.getStateParameters();\r\n                    if(params) {\r\n                        componentLinkParameterArray.push(params);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // use given options or empty object to have the strings only once\r\n        options = options || {\r\n            \"showMarker\": false,\r\n            \"forceCache\": false,\r\n            \"noSavedState\": false\r\n        };\r\n\r\n        for (iterator in options) {\r\n            if (options.hasOwnProperty(iterator)) {\r\n                optionsLinkParameterArray.push(iterator + '=' + (options[iterator] !== false));\r\n            }\r\n        }\r\n\r\n        // Use array join to make sure the values are always separated with '&', but not the first or last\r\n        return componentLinkParameterArray.concat(optionsLinkParameterArray).join('&') || null;\r\n    }\r\n});\r\n","/**\r\n * @class Oskari.Sandbox.abstractionMethods\r\n *\r\n * This category class adds abstraction methods to Oskari sandbox as they were in\r\n * the class itself.\r\n */\r\nOskari.clazz.category('Oskari.Sandbox', 'abstraction-methods', {\r\n    /**\r\n     * @method domSelector\r\n     * Abstraction method for DOM selector f.ex. jQuery\r\n     * @param {Object} argument for the concrete domSelector f. ex. jQuery\r\n     * @return {Object} concrete domSelector return value\r\n     */\r\n    domSelector: function (arg) {\r\n        return jQuery(arg);\r\n    },\r\n    /**\r\n     * @method ajax\r\n     *\r\n     * Abstraction method for ajax calls f.ex. jQuery.ajax\r\n     * Makes an ajax request to url with given callbacks.\r\n     * Detects available framework and uses it to make the call.\r\n     * TODO: complete and data params not implemented\r\n     * @deprecated implementation will propably change\r\n     *\r\n     * @param {String} url\r\n     *      URL to call\r\n     * @param {Function} success\r\n     *      callback for succesful action\r\n     * @param {Function} failure\r\n     *      callback for failed action\r\n     * @param {Object} data (optional)\r\n     *      data to post\r\n     * @param {Function} complete - NOTE! NOT IMPLEMENTED YET\r\n     *      callback on action completed (optional)\r\n     */\r\n    ajax: function (url, success, failure, data, complete) {\r\n        var userIsLoggedIn = this.getUser().isLoggedIn();\r\n        // default to jQuery\r\n        if (jQuery && jQuery.ajax) {\r\n            var failureWrapper = function (jqXHR, textStatus, err) {\r\n                if (jqXHR.status === 403 && userIsLoggedIn) {\r\n                    // user was logged in but still unauthorized ->\r\n                    // session might have been expired.\r\n                    // FIXME: use more sophisticated, localized message instead.\r\n                    alert('Session expired. Please log in again.');\r\n                } else {\r\n                    failure(jqXHR, textStatus, err);\r\n                }\r\n            };\r\n            // if data != null -> type = POST\r\n            var type = \"GET\";\r\n            if (data) {\r\n                type = \"POST\";\r\n            }\r\n\r\n            jQuery.ajax({\r\n                type: type,\r\n                url: url,\r\n                beforeSend: function (x) {\r\n                    if (x && x.overrideMimeType) {\r\n                        x.overrideMimeType(\"application/j-son;charset=UTF-8\");\r\n                    }\r\n                },\r\n                data: data,\r\n                success: success,\r\n                error: failureWrapper\r\n            });\r\n\r\n        } else {\r\n            // TODO: fallback to Openlayers?\r\n            failure();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @method getDefer\r\n     * Abstraction method for getting a defer object from Q\r\n     * or undefined Q is not available.\r\n     * @return {Object} Q defer or undefined if Q is not available\r\n     */\r\n    getDefer: function () {\r\n        var ret;\r\n        // Use Q if available\r\n        if (window.Q && window.Q.defer) {\r\n            ret = window.Q.defer();\r\n        } else {\r\n            ret = undefined;\r\n        }\r\n        return ret;\r\n    }\r\n});","/**\r\n * Bundle register.\r\n * Usage:\r\n *\r\n *     // get\r\n *     var bundledetails = Oskari.bundle('mybundle');\r\n *     // set\r\n *     Oskari.bundle('mybundle', bundledetails);\r\n *\r\n * Details contain an object with:\r\n *    {\r\n *        clazz : instance of class defined in packages/.../bundle.js,\r\n *        metadata : metadata for above bundle.js including scripts to load for the bundle\r\n *    }\r\n *\r\n */\r\n(function(o){\r\n    if(!o) {\r\n        // can't add bundle if no Oskari ref\r\n        return;\r\n    }\r\n    var _bundleRegistry = {};\r\n    // Add the bundle method to Oskari\r\n    o.bundle = function(bundleId, value) {\r\n        if(value) {\r\n            _bundleRegistry[bundleId] = value;\r\n        }\r\n        return _bundleRegistry[bundleId];\r\n    };\r\n}(Oskari));\r\n/**\r\n * File loader/startupsequence processor for Oskari.\r\n * Usage:\r\n *\r\n *     var startupSequence = [...bundles to load/start... ];\r\n *     var config = { ... bundle configs ... };\r\n *     var loader = Oskari.loader(startupSequence, config);\r\n *     loader.log.enableDebug(true); // to get additional logging\r\n *     loader.processSequence(function() {\r\n *         // application started\r\n *     });\r\n *\r\n * Also provides file linking like:\r\n *\r\n *     Oskari.loader.linkFile('/my.css');\r\n *     Oskari.loader.linkFile('/my.html', 'import', 'text/html');\r\n */\r\n(function(o){\r\n    if(!o) {\r\n        // can't add loader if no Oskari ref\r\n        return;\r\n    }\r\n    if(o.loader) {\r\n        // loader already present, but we might want another?\r\n    }\r\n    var log = Oskari.log('Loader');\r\n    var linkFile = function(href, rel, type) {\r\n        var importParentElement = document.head || document.body;\r\n        var linkElement = document.createElement('link');\r\n        linkElement.rel = rel || 'stylesheet';\r\n        linkElement.type = type || 'text/css';\r\n        linkElement.href = href;\r\n        importParentElement.appendChild(linkElement);\r\n    };\r\n\r\n\r\n    // http://stackoverflow.com/questions/14780350/convert-relative-path-to-absolute-using-javascript\r\n    var absolute = function(base, relative) {\r\n        var stack = base.split(\"/\"),\r\n            parts = relative.split(\"/\");\r\n        stack.pop(); // remove current file name (or empty string)\r\n                     // (omit if \"base\" is the current folder without trailing slash)\r\n        for (var i=0; i<parts.length; i++) {\r\n            if (parts[i] == \".\")\r\n                continue;\r\n            if (parts[i] == \"..\")\r\n                stack.pop();\r\n            else\r\n                stack.push(parts[i]);\r\n        }\r\n        return stack.join(\"/\");\r\n    };\r\n\r\n    var getPath = function(base, src) {\r\n        // handle case where src start with /\r\n        var path = src;\r\n        // handle relative ../../ case with src\r\n        if (src.indexOf('/') !== 0) {\r\n            path = absolute(base, src);\r\n        }\r\n        return path.split('//').join('/');\r\n\r\n    };\r\n    /**\r\n     * Loader\r\n     * @param  {Object[]} startupSequence sequence of bundles to load/start\r\n     * @param  {Object}   config          configuration for bundles\r\n     */\r\n    var loader = function(startupSequence, config) {\r\n        var sequence = [];\r\n        if(startupSequence && typeof startupSequence.slice === 'function') {\r\n            sequence = startupSequence.slice(0);\r\n        }\r\n        else {\r\n            log.warn('No startupsequence given to loader or sequence is not an array');\r\n        }\r\n        var appConfig = config || {};\r\n\r\n        var globalExpose = {};\r\n        // Listen to started bundles\r\n        var result = {\r\n            bundles : [],\r\n            errors : []\r\n        };\r\n        o.on('bundle.start', function(details) {\r\n            result.bundles.push(details.id);\r\n        });\r\n        o.on('bundle.err', function(details) {\r\n            result.errors.push(details);\r\n        });\r\n\r\n        return {\r\n            /**\r\n             * {\r\n                    \"bundleinstancename\": \"openlayers-default-theme\",\r\n                    \"bundlename\": \"openlayers-default-theme\",\r\n                    \"metadata\": {\r\n                        \"Import-Bundle\": {\r\n                            \"openlayers-default-theme\": {\r\n                                \"bundlePath\": \"../../../packages/openlayers/bundle/\"\r\n                            },\r\n                            \"openlayers-full-map\": {\r\n                                \"bundlePath\": \"../../../packages/openlayers/bundle/\"\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n             * @param  {Object} sequence see above\r\n             */\r\n            processSequence : function(done) {\r\n                var me = this;\r\n                if(sequence.length === 0) {\r\n                    // everything has been loaded\r\n                    if(typeof done === 'function') {\r\n                        done(result);\r\n                    }\r\n                    o.trigger('app.start', result);\r\n                    return;\r\n                }\r\n                var seqToLoad = sequence.shift();\r\n                if(typeof seqToLoad !== 'object') {\r\n                    // log warning: block not object\r\n                    log.warn('StartupSequence item is a ' + typeof seqToLoad + ' instead of object. Skipping');\r\n                    // iterate to next\r\n                    this.processSequence(done);\r\n                    return;\r\n                }\r\n                if(typeof seqToLoad.metadata !== 'object' ||\r\n                    typeof seqToLoad.metadata['Import-Bundle']  !== 'object') {\r\n                    // log warning: \"Nothing to load\"\r\n                    log.warn('StartupSequence item doesn\\'t contain the structure item.metadata[\"Import-Bundle\"]. Skipping ', seqToLoad);\r\n                    // iterate to next\r\n                    this.processSequence(done);\r\n                    return;\r\n                }\r\n\r\n                var bundleToStart = seqToLoad.bundlename;\r\n                if(!bundleToStart) {\r\n                    log.warn('StartupSequence item doesn\\'t contain bundlename. Skipping ', seqToLoad);\r\n                    // iterate to next\r\n                    this.processSequence(done);\r\n                    return;\r\n                }\r\n                // if bundleinstancename is missing, use bundlename for config key.\r\n                var configId = seqToLoad.bundleinstancename || bundleToStart;\r\n                var config = appConfig[configId] || {};\r\n                var bundlesToBeLoaded = seqToLoad.metadata['Import-Bundle'];\r\n                var paths = [];\r\n                var bundles = [];\r\n                for(var id in bundlesToBeLoaded) {\r\n                    var value = bundlesToBeLoaded[id];\r\n                    if(typeof value !== 'object' ||\r\n                        typeof value.bundlePath !== 'string') {\r\n                        // log warning: bundlePath not defined\r\n                        log.warn('StartupSequence import doesn\\'t contain bundlePath. Skipping! Item is ' + bundleToStart + ' import is ' + id);\r\n                        continue;\r\n                    }\r\n                    var basepath = value.bundlePath + '/' + id;\r\n                    var path = basepath + '/bundle.js';\r\n                    paths.push(path.split('//').join('/'));\r\n                    bundles.push({\r\n                        id : id,\r\n                        path : basepath\r\n                    });\r\n                }\r\n                if(Oskari.bundle(bundleToStart)) {\r\n                    log.debug('Bundle preloaded ' + bundleToStart);\r\n                    me.startBundle(bundleToStart, config, configId);\r\n                    this.processSequence(done);\r\n                    return;\r\n                }\r\n                // load all bundlePaths mentioned in sequence-block\r\n                require(paths, function() {\r\n                    // if loaded undefined - find from Oskari.instalBundle register with id\r\n                    for(var i = 0; i < arguments.length; ++i) {\r\n                        if(typeof arguments[i] !== 'undefined') {\r\n                            // this would be a bundle.js with amd support\r\n                            log.warn('Support for AMD-bundles is not yet implemented', arguments[i]);\r\n                        }\r\n                    }\r\n                    log.debug('Loaded bundles', bundles);\r\n                    // the loaded files have resulted in calls to\r\n                    // Oskari.bundle_manager.installBundleClass(id, \"Oskari.mapframework.domain.Bundle\");\r\n                    // loop all bundles and require sources from installs\r\n                    me.processBundleJS(bundles, function() {\r\n                        me.startBundle(bundleToStart, config, configId);\r\n                        me.processSequence(done);\r\n                    });\r\n                }, function (err) {\r\n                    log.error('Error loading bundles for ' +  bundleToStart, err);\r\n                    me.processSequence(done);\r\n                });\r\n            },\r\n            startBundle : function(bundleId, config, instanceId) {\r\n                var bundle = Oskari.bundle(bundleId);\r\n                if(!bundle) {\r\n                    throw new Error('Bundle not loaded ' + bundleId);\r\n                }\r\n                var instance = bundle.clazz.create();\r\n                if(!instance) {\r\n                    throw new Error('Couldn\\'t create an instance of bundle ' + bundleId);\r\n                }\r\n                instance.mediator = {\r\n                    bundleId : bundleId,\r\n                    instanceId : instanceId\r\n                }\r\n                // quick'n'dirty property injection\r\n                for(var key in config) {\r\n                    instance[key] = config[key];\r\n                }\r\n                log.debug('Starting bundle ' + bundleId);\r\n                try {\r\n                    instance.start();\r\n                    Oskari.trigger('bundle.start', { id : bundleId });\r\n                } catch(err) {\r\n                    Oskari.trigger('bundle.err', { id : bundleId, error : err });\r\n                    log.error('Couldn\\'t start bundle with id ' + bundleId + '. Error was: ',err);\r\n                    throw err;\r\n                }\r\n            },\r\n            processBundleJS : function(bundles, callback) {\r\n                var me = this;\r\n                var loading = [];\r\n                var done = function(id) {\r\n                    // remove id from loading array\r\n                    var index = loading.indexOf(id);\r\n                    loading.splice(index, 1);\r\n                    // once loading is empty - call callback\r\n                    if(loading.length === 0) {\r\n                        callback();\r\n                    }\r\n\r\n                };\r\n                bundles.forEach(function(item) {\r\n                    var bundle = Oskari.bundle(item.id);\r\n                    if(!bundle.clazz || !bundle.metadata || !bundle.metadata.source) {\r\n                        return;\r\n                    }\r\n                    loading.push(item.id);\r\n                    me.handleBundleLoad(item.path, bundle.metadata.source, function() {\r\n                        done(item.id);\r\n                    });\r\n                });\r\n            },\r\n            handleBundleLoad : function(basePath, src, callback) {\r\n                var files = [];\r\n\r\n                // src.locales\r\n                if(src.locales) {\r\n                    src.locales.forEach(function(file) {\r\n                        if(file.lang && file.lang !== Oskari.getLang()) {\r\n                            // dont load locale files that have declared language \r\n                            // and are not the language Oskari is started with.\r\n                            return;\r\n                        }\r\n                        if(file.src.endsWith('.js')) {\r\n                            var path = getPath(basePath, file.src);\r\n                            files.push(path);\r\n                            if(file.expose) {\r\n                                globalExpose[path] = file.expose;\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                // src.resources\r\n                if(src.resources) {\r\n                    src.resources.forEach(function(file) {\r\n                        if(file.src.endsWith('.js')) {\r\n                            files.push(getPath(basePath, file.src));\r\n                        }\r\n                    });\r\n                }\r\n                // src.scripts\r\n                if(src.scripts) {\r\n                    src.scripts.forEach(function(file) {\r\n                        var path = getPath(basePath, file.src);\r\n\r\n                        if(file.src.endsWith('.js')) {\r\n                            files.push(path);\r\n                            if(file.expose) {\r\n                                globalExpose[path] = file.expose;\r\n                            }\r\n                        }\r\n                        else if (file.src.endsWith('.css')) {\r\n                            linkFile(path);\r\n                        }\r\n                    });\r\n                }\r\n\r\n                // src.links\r\n                if(src.links) {\r\n                    src.links.forEach(function(file) {\r\n                        if(file.rel.toLowerCase() === 'import') {\r\n                            linkFile(getPath(basePath, file.href), file.rel, 'text/html');\r\n                        }\r\n                    });\r\n                }\r\n                require(files, function() {\r\n                    for(var i = 0; i < arguments.length; ++i) {\r\n                        if(typeof arguments[i] !== 'undefined') {\r\n                            // this would be a linked file.js with amd support\r\n                            var key = globalExpose[files[i]];\r\n                            if(key) {\r\n                                window[key] = arguments[i];\r\n                            } else {\r\n                                log.warn('Support for AMD-files is not yet implemented. Bundles need to have an \"expose\" statement in bundle.js to register libs as globals.', files[i]);\r\n                            }\r\n                        }\r\n                    }\r\n                    callback();\r\n                }, function (err) {\r\n                    log.error('Error loading files', files, err);\r\n                    callback();\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    // setup additional members\r\n    loader.log = log;\r\n    // accessible without calling loader() with loader.linkFile()\r\n    loader.linkFile = linkFile;\r\n    // attach to Oskari\r\n    o.loader = loader;\r\n}(Oskari));","// So IE won't use a cached xhr result -> adds a _=timestamp param for each request...\r\njQuery.ajaxSetup({ cache: false });\r\n\r\n(function(o){\r\n    if(!o) {\r\n        // can't add loader if no Oskari ref\r\n        return;\r\n    }\r\n    /* legacy Bundle_facade */\r\n    /**\r\n     * @class Oskari.Bundle_facade\r\n     * Highlevel interface to bundle management Work in progress\r\n     *\r\n     * @param {} bundleManager\r\n     *\r\n     */\r\n    var Bundle_facade = function () {\r\n        /**\r\n         * @property appSetup\r\n         * application startup sequence\r\n         */\r\n        this.appSetup = null;\r\n\r\n        /**\r\n         * @property appConfig\r\n         * application configuration (state) for instances\r\n         * this is injected to instances before 'start' is called\r\n         *\r\n         */\r\n        this.appConfig = {};\r\n    };\r\n\r\n    /**\r\n     * FACADE will have only a couple of methods which trigger alotta operations\r\n     */\r\n    Bundle_facade.prototype = {\r\n        /**\r\n         * @public @method getBundleInstanceConfigurationByName\r\n         * Returns configuration for instance by bundleinstancename\r\n         *\r\n         * @param  {string} biid Bundle instance ID\r\n         *\r\n         * @return {Object}      Bundle instance configuration\r\n         */\r\n        getBundleInstanceConfigurationByName: function (biid) {\r\n            return this.appConfig[biid];\r\n        },\r\n\r\n        /**\r\n         * @public @method playBundle\r\n         * Plays a bundle player JSON object by instantiating any required\r\n         * bundle instances.\r\n         *\r\n         * @param {Object}           recData  Bundle player JSON\r\n         * @param {function(Object)} callback Callback function\r\n         *\r\n         */\r\n        playBundle: function (recData, config, callback) {\r\n            if(typeof recData !== 'object') {\r\n                throw new Error('Bundle def is not an object');\r\n            }\r\n            if(typeof config === 'function') {\r\n                callback = config;\r\n                config = undefined;\r\n            }\r\n\r\n            if(config) {\r\n                // wrap to acceptable format\r\n                var configName = recData.bundleinstancename || recData.bundlename;\r\n                var tmp = {};\r\n                tmp[configName] = config;\r\n                config = tmp;\r\n            }\r\n            else {\r\n                config = this.appConfig;\r\n            }\r\n            var loader = Oskari.loader([recData], config);\r\n            loader.processSequence(callback);\r\n        },\r\n        /**\r\n         * Convenience function to load appsetup from url with given params and startup the Oskari app.\r\n         * @param  {String}   url       Url to load the appsetup json from\r\n         * @param  {Object}   params    Optional parameters to pass for the request\r\n         * @param  {Function} errorCB   Optional callback for handling error\r\n         * @param  {Function} successCB Optional callback that is called when the application has started\r\n         * @param  {Function} modifyCB  Optional callback that is called appsetup is loaded, but before it's used by Oskari\r\n         */\r\n        loadAppSetup : function(url, params, errorCB, successCB, modifyCB) {\r\n            var me = this;\r\n            jQuery.ajax({\r\n                type : 'GET',\r\n                dataType : 'json',\r\n                data : params || {},\r\n                url: url,\r\n                success : function(setup) {\r\n                    if(typeof modifyCB ==='function') {\r\n                        modifyCB(setup);\r\n                    }\r\n                    me.setApplicationSetup(setup);\r\n                    me.startApplication(successCB);\r\n                },\r\n                error : function(jqXHR) {\r\n                    if(typeof errorCB === 'function') {\r\n                        errorCB(jqXHR);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        /**\r\n         * @public @method setApplicationSetup\r\n         * Each bundledef is of kind playable by method playBundle. callback:\r\n         * property may be set to receive some feedback - as well as\r\n         * registerLoaderStateListener\r\n         *\r\n         * @param {Object} setup JSON application setup {\r\n         * startupSequence: [ <bundledef1>, <bundledef2>, <bundledef3>, ] }\r\n         *\r\n         */\r\n        setApplicationSetup: function (setup) {\r\n            this.appSetup = setup;\r\n            if(setup.configuration) {\r\n                this.setConfiguration(setup.configuration);\r\n            }\r\n            setup.env = setup.env || {};\r\n            if(typeof Oskari.setLang === 'function') {\r\n                Oskari.setLang(setup.env.lang || window.language);\r\n            }\r\n            if(typeof Oskari.setSupportedLocales === 'function') {\r\n                Oskari.setSupportedLocales(setup.env.locales);\r\n            }\r\n            if(typeof Oskari.setDecimalSeparator === 'function') {\r\n                Oskari.setDecimalSeparator(setup.env.decimalSeparator);\r\n            }\r\n\r\n            if(typeof Oskari.setMarkers === 'function') {\r\n                Oskari.setMarkers(setup.env.svgMarkers || []);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @public @method getApplicationSetup\r\n         * @return {Object} Application setup\r\n         */\r\n        getApplicationSetup: function () {\r\n            return this.appSetup;\r\n        },\r\n\r\n        /**\r\n         * @public @method setConfiguration\r\n         * @param {Object} config Config\r\n         */\r\n        setConfiguration: function (config) {\r\n            this.appConfig = config;\r\n        },\r\n\r\n        /**\r\n         * @public @method getConfiguration\r\n         * @return {Object}\r\n         */\r\n        getConfiguration: function () {\r\n            return this.appConfig;\r\n        },\r\n\r\n        startApplication: function (callback) {\r\n            var loader = Oskari.loader(this.appSetup.startupSequence, this.appConfig);\r\n            loader.processSequence(callback);\r\n        },\r\n\r\n        /**\r\n         * @method stopApplication\r\n         * Might stop app if/when all stops implemented\r\n         */\r\n        stopApplication: function () {\r\n            throw new Error('Not supported');\r\n        }\r\n    };\r\n    o.app = new Bundle_facade();\r\n}(Oskari));","\r\n(function(o){\r\n\tvar cs = o.clazz;\r\n\r\n    /* @class Oskari.ModuleSpec\r\n     * Helper class instance of which is returned from oskari 2.0 api\r\n     * Returned class instance may be used to chain class definition calls.\r\n     *\r\n     * @param {Object} classInfo ClassInfo\r\n     * @param {string} className Class name\r\n     *\r\n     */\r\n    cs.define('Oskari.ModuleSpec', function (classInfo, className) {\r\n        this.cs = cs;\r\n        this.classInfo = classInfo;\r\n        this.className = className;\r\n\r\n    }, {\r\n\r\n        /**\r\n         * @private @method _slicer\r\n         */\r\n        _slicer: Array.prototype.slice,\r\n\r\n        /**\r\n         * @method category\r\n         * Adds a set of methods to class\r\n         *\r\n         * @param  {Object}            prototype    Prototype\r\n         * @param  {string}            categoryName Category name\r\n         *\r\n         * @return {Oskari.ModuleSpec}              this\r\n         */\r\n        category: function (prototype, categoryName) {\r\n            var classInfo = cs.category(\r\n                this.className,\r\n                categoryName ||\r\n                    (['__', o.seq.nextVal('Category')].join('_')),\r\n                prototype\r\n            );\r\n            this.classInfo = classInfo;\r\n            return this;\r\n        },\r\n\r\n        /**\r\n         * @method methods\r\n         * Adds a set of methods to class - alias to category\r\n         *\r\n         * @param  {}                  prototype    Prototype\r\n         * @param  {string}            categoryName Category name\r\n         *\r\n         * @return {Oskari.ModuleSpec}              this\r\n         */\r\n        methods: function (prototype, categoryName) {\r\n            var classInfo = cs.category(\r\n                this.className,\r\n                categoryName ||\r\n                    (['__', o.seq.nextVal('Category')].join('_')),\r\n                prototype\r\n            );\r\n            this.classInfo = classInfo;\r\n            return this;\r\n        },\r\n\r\n        /**\r\n         * @method extend\r\n         * Adds inheritance from a base class.\r\n         * Base class can be declared later but must be defined before\r\n         * instantiation.\r\n         *\r\n         * @param  {Object|Object[]}   clazz Class or an array of classes\r\n         *\r\n         * @return {Oskari.ModuleSpec}       this\r\n         */\r\n        extend: function (clazz) {\r\n            var classInfo;\r\n\r\n            if (clazz === null || clazz === undefined) {\r\n                throw new TypeError('extend(): Missing clazz');\r\n            }\r\n\r\n            classInfo = cs.extend(\r\n                this.className,\r\n                clazz.length ? clazz : [clazz]\r\n            );\r\n            this.classInfo = classInfo;\r\n            return this;\r\n        },\r\n\r\n        /**\r\n         * @method create\r\n         * Creates an instance of this clazz\r\n         *\r\n         *\r\n         * @return {Object} Class instance\r\n         */\r\n        create: function () {\r\n            return cs.createWithClassInfo(this.classInfo, arguments);\r\n        },\r\n\r\n        /**\r\n         * @method nam\r\n         * Returns the class name\r\n         *\r\n         *\r\n         * @return {string} Class name\r\n         */\r\n        name: function () {\r\n            return this.className;\r\n        },\r\n\r\n        /**\r\n         * @method metadata\r\n         * Returns class metadata\r\n         *\r\n         *\r\n         * @return {Object} Class metadata\r\n         */\r\n        metadata: function () {\r\n            return cs.getMetadata(this.className);\r\n        },\r\n\r\n        /**\r\n         * @method events\r\n         * Adds a set of event handlers to class\r\n         *\r\n         * @param  {Object}            events Eventhandlers map\r\n         *\r\n         * @return {Oskari.ModuleSpec}        this\r\n         */\r\n        events: function (events) {\r\n            var orgmodspec = this;\r\n            orgmodspec.category({\r\n                eventHandlers: events,\r\n                onEvent: function (event) {\r\n                    var handler = this.eventHandlers[event.getName()];\r\n                    if (!handler) {\r\n                        return;\r\n                    }\r\n\r\n                    return handler.apply(this, [event]);\r\n                }\r\n            }, '___events');\r\n            return orgmodspec;\r\n        },\r\n\r\n        /**\r\n         * @method requests\r\n         *\r\n         * @param  {Object}            requests Requesthandlers map\r\n         *\r\n         * @return {Oskari.ModuleSpec}          this\r\n         */\r\n        requests: function (requests) {\r\n            var orgmodspec = this;\r\n            orgmodspec.category({\r\n                requestHandlers: requests,\r\n                onRequest: function (request) {\r\n                    var handler = this.requestHandlers[request.getName()];\r\n                    return handler ? handler.apply(this, [request]) : undefined;\r\n                }\r\n            }, '___requests');\r\n            return orgmodspec;\r\n        },\r\n\r\n        /**\r\n         * @method builder\r\n         *\r\n         *\r\n         * @return {function}\r\n         */\r\n        builder: function () {\r\n            return cs.getBuilderFromClassInfo(this.classInfo);\r\n        }\r\n    });\r\n}(Oskari));","(function(o){\r\n    if(!o) {\r\n        // can't add functions if no Oskari ref\r\n        return;\r\n    }\r\n\r\n    var _baseClassFor = {\r\n        extension: 'Oskari.userinterface.extension.EnhancedExtension',\r\n        bundle: 'Oskari.mapframework.bundle.extension.ExtensionBundle',\r\n        tile: 'Oskari.userinterface.extension.EnhancedTile',\r\n        flyout: 'Oskari.userinterface.extension.EnhancedFlyout',\r\n        view: 'Oskari.userinterface.extension.EnhancedView'\r\n    };\r\n    var bundleInstances = {};\r\n    /**\r\n     * @public @method cls\r\n     * Entry point to new class API.\r\n     * @see Oskari.ModuleSpec above.\r\n     *\r\n     * @param  {string}   className   Class name\r\n     * @param  {function} constructor Constructor\r\n     * @param  {Object}   proto       Prototype\r\n     * @param  {Object}   metas       Metadata\r\n     *\r\n     * @return {Object}               Class instance\r\n     */\r\n    o.cls = function (className, constructor, proto, metas) {\r\n        var classInfo;\r\n\r\n        if (!className) {\r\n            className = [\r\n                'Oskari',\r\n                '_',\r\n                o.seq.nextVal('Class')\r\n            ].join('.');\r\n        } else {\r\n            classInfo = o.clazz.lookup(className);\r\n        }\r\n\r\n        if (!(classInfo && classInfo._constructor && !constructor)) {\r\n            classInfo = o.clazz.define(\r\n                className,\r\n                constructor || function () {},\r\n                proto,\r\n                metas || {}\r\n            );\r\n        }\r\n\r\n        return o.clazz.create('Oskari.ModuleSpec', classInfo, className);\r\n    };\r\n\r\n    /**\r\n     * @public @method loc\r\n     * Oskari1Builder helper to register localisation\r\n     */\r\n    o.loc = function () {\r\n        return o.registerLocalization.apply(o, arguments);\r\n    };\r\n\r\n    /**\r\n     * @public @static @method Oskari.eventCls\r\n     * O2 api for event class\r\n     *\r\n     * @param  {string}   eventName   Event name\r\n     * @param  {function} constructor Constructor\r\n     * @param  {Object}   proto       Prototype\r\n     *\r\n     * @return\r\n     */\r\n    o.eventCls = function (eventName, constructor, proto) {\r\n        var className,\r\n            rv;\r\n\r\n        if (eventName === null || eventName === undefined) {\r\n            throw new TypeError('eventCls(): Missing eventName');\r\n        }\r\n\r\n        className = 'Oskari.event.registry.' + eventName;\r\n        rv = o.cls(\r\n            className,\r\n            constructor,\r\n            proto,\r\n            {protocol: ['Oskari.mapframework.event.Event']}\r\n        );\r\n\r\n        rv.category({\r\n            getName: function () {\r\n                return eventName;\r\n            }\r\n        }, '___event');\r\n\r\n        rv.eventName = eventName;\r\n\r\n        return rv;\r\n    };\r\n\r\n    /**\r\n     * @public @static @method Oskari.requestCls\r\n     * O2 api for request class\r\n     *\r\n     * @param  {string}   className   Class name\r\n     * @param  {function} constructor Constructor\r\n     * @param  {Object}   proto       Prototype\r\n     *\r\n     * @return {Object}\r\n     */\r\n    o.requestCls = function (requestName, constructor, proto) {\r\n        var className,\r\n            rv;\r\n\r\n        if (requestName === null || requestName === undefined) {\r\n            throw new TypeError('requestCls(): Missing requestName');\r\n        }\r\n\r\n        className = 'Oskari.request.registry.' + requestName;\r\n        rv = o.cls(\r\n            className,\r\n            constructor,\r\n            proto,\r\n            {protocol: ['Oskari.mapframework.request.Request']}\r\n        );\r\n\r\n        rv.category({\r\n            getName: function () {\r\n                return requestName;\r\n            }\r\n        }, '___request');\r\n\r\n        rv.requestName = requestName;\r\n\r\n        return rv;\r\n    };\r\n\r\n\r\n    /**\r\n     * @public @static @method Oskari.extensionCls O2 api for extension classes\r\n     *\r\n     * @param  {string} className Class name\r\n     *\r\n     * @return\r\n     */\r\n    o.extensionCls = function (className) {\r\n        if (className === null || className === undefined) {\r\n            throw new TypeError('extensionCls(): Missing className');\r\n        }\r\n\r\n        return o.cls(className).extend(\r\n            _baseClassFor.extension\r\n        );\r\n    };\r\n\r\n    /**\r\n     * @public @static @method Oskari.bundleCls O2 api for bundle classes\r\n     *\r\n     * @param  {string} bundleId  Bundle ID\r\n     * @param  {string} className Class name\r\n     *\r\n     * @return {Object}           Bundle instance\r\n     */\r\n    o.bundleCls = function (bundleId, className) {\r\n        var rv;\r\n\r\n        if (className === null || className === undefined) {\r\n            throw new TypeError('bundleCls(): Missing className');\r\n        }\r\n\r\n        if (!bundleId) {\r\n            bundleId = (['__', o.seq.nextVal('Bundle')].join('_'));\r\n        }\r\n\r\n        rv = o.cls(className, function () {}, {\r\n            update: function () {}\r\n        }, {\r\n            protocol: ['Oskari.bundle.Bundle', _baseClassFor.bundle],\r\n            manifest: {\r\n                'Bundle-Identifier': bundleId\r\n            }\r\n        });\r\n        bm.installBundleClassInfo(bundleId, rv.classInfo);\r\n\r\n        rv.___bundleIdentifier = bundleId;\r\n\r\n        rv.loc = function (properties) {\r\n            properties.key = this.___bundleIdentifier;\r\n            o.registerLocalization(properties);\r\n            return rv;\r\n        };\r\n\r\n        // FIXME instanceId isn't used for anything?\r\n        rv.start = function (instanceId) {\r\n            var bid = this.___bundleIdentifier,\r\n                bundle,\r\n                bundleInstance,\r\n                configProps,\r\n                ip;\r\n\r\n            if (!o.app.bundles[bid]) {\r\n                bundle = bm.createBundle(bid, bid);\r\n                o.bundle(bid, bundle);\r\n            }\r\n\r\n            bundleInstance = bm.createInstance(bid);\r\n            bundleInstances[bid] = bundleInstance;\r\n\r\n            configProps = o.app.getBundleInstanceConfigurationByName(bid);\r\n            if (configProps) {\r\n                for (ip in configProps) {\r\n                    if (configProps.hasOwnProperty(ip)) {\r\n                        bundleInstance[ip] = configProps[ip];\r\n                    }\r\n                }\r\n            }\r\n            bundleInstance.start();\r\n            return bundleInstance;\r\n        };\r\n        rv.stop = function () {\r\n            var bundleInstance = bundleInstances[this.___bundleIdentifier];\r\n\r\n            return bundleInstance.stop();\r\n        };\r\n        return rv;\r\n    };\r\n\r\n    /**\r\n     * @static @method Oskari.flyoutCls\r\n     *\r\n     * @param  {string} className Class name\r\n     *\r\n     * @return\r\n     */\r\n    o.flyoutCls = function (className) {\r\n        if (className === null || className === undefined) {\r\n            throw new TypeError('flyoutCls(): Missing className');\r\n        }\r\n\r\n        return o.cls(className).extend(\r\n            _baseClassFor.flyout\r\n        );\r\n    };\r\n\r\n    /**\r\n     * @static @method Oskari.tileCls\r\n     *\r\n     * @param  {string} className Class name\r\n     *\r\n     * @return\r\n     */\r\n    o.tileCls = function (className) {\r\n        if (className === null || className === undefined) {\r\n            throw new TypeError('tileCls(): Missing className');\r\n        }\r\n\r\n        return o.cls(className).extend(_baseClassFor.tile);\r\n    };\r\n\r\n    /**\r\n     * @static @method Oskari.viewCls\r\n     *\r\n     * @param  {string} className Class name\r\n     *\r\n     * @return\r\n     */\r\n    o.viewCls = function (className) {\r\n        if (className === null || className === undefined) {\r\n            throw new TypeError('viewCls(): Missing className');\r\n        }\r\n\r\n        return o.cls(className).extend(_baseClassFor.view);\r\n    };\r\n}(Oskari));","(function(o){\r\n\tvar log = Oskari.log('Oskari.deprecated');\r\n\r\n\t// Warn 2 times before falling silent\r\n\tvar warnMessagesSent = {};\r\n\tvar warn = function(name) {\r\n\t\tif(!warnMessagesSent[name]) {\r\n\t\t\twarnMessagesSent[name] = 0;\r\n\t\t}\r\n\t\twarnMessagesSent[name]++;\r\n\t\tif(warnMessagesSent[name] < 3) {\r\n\t\t\tlog.warn('Oskari.' + name + '() will be removed in future release. Remove calls to it.')\r\n\t\t}\r\n\t};\r\n\r\n\tvar mode = 'default';\r\n    var domMgr;\r\n    var dollarStore = o.createStore();\r\n    var _ctrlKeyDown = false;\r\n\tvar funcs = {\r\n\r\n\t    /**\r\n\t     * @public @static @method Oskari.setLoaderMode\r\n\t     * @param {string} m Loader mode\r\n\t     */\r\n\t    setLoaderMode :  function (m) {\r\n\t    \tmode = m;\r\n\t    },\r\n\r\n\t    /**\r\n\t     * @public @method Oskari.getLoaderMode\r\n\t     * @return {string} Loader mode\r\n\t     */\r\n\t    getLoaderMode : function () {\r\n\t        return mode;\r\n\t    },\r\n\r\n\t    /**\r\n\t     * @public @method Oskari.setPreloaded\r\n\t     * @deprecated No longer has any effect. Remove calls to it. Will be removed in 1.38 or later.\r\n\t     */\r\n\t    setPreloaded : function () {},\r\n\r\n\t    purge : function () {},\r\n\r\n\t    getDomManager : function () {\r\n\t        return domMgr;\r\n\t    },\r\n\t    setDomManager :  function (dm) {\r\n\t\t\tdomMgr = dm;\r\n\t    },\r\n\r\n\t    /**\r\n\t     * @public @method Oskari.$\r\n\t     * @return {}\r\n\t     */\r\n\t    $ : function (name, value) {\r\n\t        return dollarStore.data(name, value);\r\n\t    },\r\n\t    setSandbox : function (name, sandbox) {},\r\n\r\n        /**\r\n         * @method handleCtrlKeyDownRequest\r\n         * Sets flag to show that CTRL key is pressed down\r\n         * @private\r\n         */\r\n        ctrlKeyDown: function (isDown) {\r\n        \tif(typeof isDown === 'undefined') {\r\n        \t\t// getter\r\n        \t\treturn _ctrlKeyDown;\r\n        \t}\r\n        \t// setter\r\n            _ctrlKeyDown = !!isDown;\r\n        }\r\n\t};\r\n\tvar attachWarning = function(name) {\r\n\t\treturn function() {\r\n\t\t\twarn(name);\r\n\t\t\treturn funcs[name].apply(o, arguments);\r\n\t\t};\r\n\t}\r\n\t// attach to Oskari with a warning message wrapping\r\n\tfor(var key in funcs) {\r\n\t\to[key] = attachWarning(key);\r\n\t}\r\n}(Oskari));","/**\r\n * ***********************************************************************************************\r\n * Deprecated sandbox functions\r\n * ***********************************************************************************************\r\n */\r\n(function(o) {\r\n\tvar log = o.log('Sandbox.deprecated');\r\n\r\n    var extraInfo = {\r\n    \taddRequestHandler : \"Use Sandbox.requestHandler(requestName, handlerInstance) instead.\",\r\n    \tremoveRequestHandler : \"Use Sandbox.requestHandler(requestName, null) instead.\",\r\n    \tisCtrlKeyDown : \"It works on Openlayers 2 only.\",\r\n\t\tgetEventBuilder : \"Use Oskari.eventBuilder() instead.\",\r\n\t\tgetRequestBuilder : \"Use Oskari.requestBuilder() instead.\",\r\n\t\tprintDebug : \"Use Oskari.log() instead.\",\r\n\t\tprintWarn : \"Use Oskari.log() instead.\",\r\n\t\tprintError : \"Use Oskari.log() instead.\"\r\n    };\r\n    // Warn 2 times before falling silent\r\n    var warnMessagesSent = {};\r\n    var warn = function(name) {\r\n        if(!warnMessagesSent[name]) {\r\n            warnMessagesSent[name] = 0;\r\n        }\r\n        warnMessagesSent[name]++;\r\n        if(warnMessagesSent[name] < 3) {\r\n\t\t\tlog.warn('Sandbox.' + name + '() will be removed in future release.', extraInfo[name] || 'Remove calls to it.');\r\n        }\r\n    };\r\n    Oskari.clazz.category('Oskari.Sandbox', 'deprecated-sb-methods', {\r\n        /**\r\n         * Moved from core, to be removed\r\n         */\r\n        handleMapLinkParams: function() {\r\n        \twarn('handleMapLinkParams');\r\n            log.debug('Checking if map is started with link...');\r\n            var coord = o.util.getRequestParam('coord', null);\r\n            var zoomLevel = o.util.getRequestParam('zoomLevel', null);\r\n\r\n            if (coord === null || zoomLevel === null) {\r\n                // not a link\r\n                return;\r\n            }\r\n\r\n            var splittedCoord;\r\n\r\n            // Coordinates can be separated either with new \"_\" or old \"%20\"\r\n            if (coord.indexOf('_') >= 0) {\r\n                splittedCoord = coord.split('_');\r\n            } else if (coord.indexOf('%20') >= 0) {\r\n                splittedCoord = coord.split('%20');\r\n            } else {\r\n                // coordinate format not recognized\r\n            \treturn;\r\n            }\r\n\r\n            var longitude = splittedCoord[0],\r\n                latitude = splittedCoord[1];\r\n            if (longitude === null || latitude === null) {\r\n                log.debug('Could not parse link location. Skipping.');\r\n                return;\r\n            }\r\n            log.debug('This is startup by link, moving map...');\r\n            this.getMap().moveTo(longitude, latitude, zoomLevel);\r\n        },\r\n        /**\r\n         * @method addRequestHandler\r\n         * Registers a request handler for requests with the given name\r\n         * NOTE: only one request handler can be registered/request\r\n         * @param {String} requestName - name of the request\r\n         * @param {Oskari.mapframework.core.RequestHandler} handlerInstance request handler\r\n         */\r\n        addRequestHandler: function (requestName, handlerInstance) {\r\n        \twarn('addRequestHandler');\r\n            this.requestHandler(requestName, handlerInstance);\r\n        },\r\n\r\n        /**\r\n         * @method removeRequestHandler\r\n         * Unregisters a request handler for requests with the given name\r\n         * NOTE: only one request handler can be registered/request\r\n         * @param {String} requestName - name of the request\r\n         * @param {Oskari.mapframework.core.RequestHandler} handlerClsInstance request handler\r\n         */\r\n        removeRequestHandler: function (requestName, handlerInstance) {\r\n        \twarn('removeRequestHandler');\r\n            this.requestHandler(requestName, null);\r\n        },\r\n\r\n        isCtrlKeyDown : function() {\r\n        \twarn('isCtrlKeyDown');\r\n            return Oskari.ctrlKeyDown();\r\n        },\r\n        /**\r\n         * @method getRequestBuilder\r\n         *\r\n         * Access to request builder that creates requests by name\r\n         * rather than by class name\r\n         * @param {String} name request name that we are creating\r\n         * @return {Function} builder function for given request\r\n         */\r\n        getRequestBuilder: function (name) {\r\n        \twarn('getRequestBuilder');\r\n            return Oskari.requestBuilder(name);\r\n        },\r\n\r\n        /**\r\n         * @method getEventBuilder\r\n         *\r\n         * Access to event builder that creates events by name\r\n         *\r\n         * @param {String} name request name that we are creating\r\n         * @return {Function} builder function for given event\r\n         */\r\n        getEventBuilder: function (name) {\r\n        \twarn('getEventBuilder');\r\n            return Oskari.eventBuilder(name);\r\n        },\r\n        /**\r\n         * @method printDebug\r\n         * Utility method for printing debug messages to browser console\r\n         */\r\n        printDebug: function () {\r\n        \twarn('printDebug');\r\n            log.debug.apply(log, arguments);\r\n        },\r\n        /**\r\n         * @method printWarn\r\n         * Utility method for printing warn messages to browser console\r\n         */\r\n        printWarn: function () {\r\n        \twarn('printWarn');\r\n            log.warn.apply(log, arguments);\r\n        },\r\n        /**\r\n         * @method printError\r\n         * Utility method for printing error messages to browser console\r\n         */\r\n        printError: function () {\r\n        \twarn('printError');\r\n            log.error.apply(log, arguments);\r\n        }\r\n    });\r\n\r\n}(Oskari));"]}