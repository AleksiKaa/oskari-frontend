/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 12:23:19 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.wmts.mapmodule.plugin.WmtsLayerPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._supportedFormats={};this._wmtsLayerClazz=Oskari.clazz.create("Oskari.openlayers.Patch.layer.WMTS")},{__name:"WmtsLayerPlugin",getName:function(){return this.pluginName},getMap:function(){return this._map},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("WmtsLayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("WmtsLayer",null)},init:function(a){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterMapLayerAddEvent:function(a){this.afterMapLayerAddEvent(a)},AfterMapLayerRemoveEvent:function(a){this.afterMapLayerRemoveEvent(a)},AfterChangeMapLayerOpacityEvent:function(a){this.afterChangeMapLayerOpacityEvent(a)},AfterChangeMapLayerStyleEvent:function(a){this.afterChangeMapLayerStyleEvent(a)}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},preselectLayers:function(e){var b=this._sandbox;for(var d=0;d<e.length;d++){var c=e[d];var a=c.getId();if(!c.isLayerOfType("WMTS")){continue}b.printDebug("preselecting "+a);this.addMapLayerToMap(c,true,c.isBaseLayer())}},afterMapLayerAddEvent:function(a){this.addMapLayerToMap(a.getMapLayer(),a.getKeepLayersOrder(),a.isBasemap())},addMapLayerToMap:function(i,h,d){if(!i.isLayerOfType("WMTS")){return}var m=this;var b=m.getMap();var e=i.getWmtsMatrixSet().matrixIds;var c=i.getWmtsLayerDef();var j=null;if(i.isBaseLayer()){j="basemap_"+i.getId()}else{j="layer_"+i.getId()}var n=this._sandbox;var o=i.getWmtsUrls()[0];var a=i.getWmtsMatrixSet();var k={visibility:true,transparent:true,format:"image/png",url:o,layer:i.getWmtsName(),style:i.getCurrentStyle().getName(),matrixIds:a.matrixIds,matrixSet:a.identifier,isBaseLayer:i.isBaseLayer(),buffer:0,minScale:i.getMinScale(),maxScale:i.getMaxScale()};n.printDebug("[WmtsLayerPlugin] creating WMTS Layer "+a.identifier+" / "+k.id+"/"+k.layer+"/"+k.url);var g=OpenLayers.Util.applyDefaults(k,{url:o,name:j,style:i.getCurrentStyle().getName(),matrixIds:a.matrixIds,layerDef:c});var l=this._wmtsLayerClazz.getPatch();var f=new l(g);f.opacity=i.getOpacity()/100;n.printDebug("[WmtsLayerPlugin] created WMTS layer "+f);b.addLayers([f])},afterMapLayerRemoveEvent:function(b){var a=b.getMapLayer();this.removeMapLayerFromMap(a)},removeMapLayerFromMap:function(d){if(!d.isLayerOfType("WMTS")){return}if(d.isBaseLayer()){var b="";if(d.getSubLayers().length>0){for(var c=0;c<d.getSubLayers().length;c++){var a=this._map.getLayersByName("basemap_"+d.getSubLayers()[c].getId());a[0].destroy()}}else{var a=this._map.getLayersByName("layer_"+d.getId());a[0].destroy()}}else{var a=this._map.getLayersByName("layer_"+d.getId());a[0].destroy()}},getOLMapLayers:function(c){if(!c.isLayerOfType("WMTS")){return null}if(c.isBaseLayer()){var a="";if(c.getSubLayers().length>0){for(var b=0;b<c.getSubLayers().length;b++){return this._map.getLayersByName("basemap_"+c.getSubLayers()[b].getId())}}else{return this._map.getLayersByName("layer_"+c.getId())}}else{return this._map.getLayersByName("layer_"+c.getId())}return null},afterChangeMapLayerOpacityEvent:function(c){var b=c.getMapLayer();if(!b.isLayerOfType("WMTS")){return}if(b.isBaseLayer()){if(b.getSubLayers().length>0){for(var d=0;d<b.getSubLayers().length;d++){var a=this._map.getLayersByName("basemap_"+b.getSubLayers()[d].getId());a[0].setOpacity(b.getOpacity()/100)}}else{var a=this._map.getLayersByName("layer_"+b.getId());if(a[0]!=null){a[0].setOpacity(b.getOpacity()/100)}}}else{this._sandbox.printDebug("Setting Layer Opacity for "+b.getId()+" to "+b.getOpacity());var a=this._map.getLayersByName("layer_"+b.getId());
if(a[0]!=null){a[0].setOpacity(b.getOpacity()/100)}}},afterChangeMapLayerStyleEvent:function(c){var b=c.getMapLayer();if(!b.isLayerOfType("WMTS")){return}if(!b.isBaseLayer()){var a=this._map.getLayersByName("layer_"+b.getId());if(a!=null){a[0].mergeNewParams({styles:b.getCurrentStyle().getName()})}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.wmts.domain.WmtsLayer",function(){this._id=null;this._name=null;this._WmtsLayerName=null;this._WmtsMatrixSet=null;this._inspireName=null;this._organizationName=null;this._dataUrl=null;this._type=null;this._opacity=null;this._featureInfoEnabled=null;this._subLayers=[];this._styles=[];this._description=null;this._WmtsUrls=[];this._dataUrl=null;this._legendImage=null;this._maxScale=null;this._minScale=null;this._queryable=null;this._currentStyle=null;this._visible=null;this._queryFormat=null;this._orderNumber=null;this._permissions={};this._geometry=[];this._geometryWKT=null},{setGeometryWKT:function(a){this._geometryWKT=a},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(a){this._geometry=a},getGeometry:function(){return this._geometry},addPermission:function(b,a){this._permissions[b]=a},removePermission:function(a){this._permissions[a]=null},getPermission:function(a){return this._permissions[a]},setId:function(a){this._id=a},getId:function(){return this._id},setQueryFormat:function(a){this._queryFormat=a},getQueryFormat:function(){return this._queryFormat},setName:function(a){this._name=a},getName:function(){return this._name},setWmtsName:function(a){this._WmtsName=a},getWmtsName:function(){return this._WmtsName},setWmtsMatrixSet:function(a){this._WmtsMatrixSet=a},getWmtsMatrixSet:function(){return this._WmtsMatrixSet},setWmtsLayerDef:function(a){this._WmtsLayerDef=a},getWmtsLayerDef:function(){return this._WmtsLayerDef},setType:function(a){this._type=a},getType:function(){return this._type},setOpacity:function(a){this._opacity=a},getOpacity:function(){return this._opacity},setDataUrl:function(a){this._dataUrl=a},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(a){this._organizationName=a},getOrganizationName:function(){return this._organizationName},setInspireName:function(a){this._inspireName=a},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(a){this._featureInfoEnabled=a},isFeatureInfoEnabled:function(){if(this._featureInfoEnabled===true){return true}return false},setDescription:function(a){this._description=a},getDescription:function(){return this._description},addWmtsUrl:function(a){this._WmtsUrls.push(a)},getWmtsUrls:function(){return this._WmtsUrls},addStyle:function(a){this._styles.push(a)},getStyles:function(){return this._styles},addSubLayer:function(a){this._subLayers.push(a)},getSubLayers:function(){return this._subLayers},setLegendImage:function(a){this._legendImage=a},getLegendImage:function(){return this._legendImage},setMaxScale:function(a){this._maxScale=a},getMaxScale:function(){return this._maxScale},setMinScale:function(a){this._minScale=a},getMinScale:function(){return this._minScale},setQueryable:function(a){this._queryable=a},getQueryable:function(){return this._queryable},setAsGroupLayer:function(){this._type="GROUP_LAYER"},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setOrderNumber:function(a){this._orderNumber=a},getOrderNumber:function(){return this._orderNumber},isBaseLayer:function(){if(this._type=="BASE_LAYER"){return true}else{return false}},selectStyle:function(b){var c=null;if(this._styles.length>0){if(b!==""){for(var a=0;a<this._styles.length;a++){c=this._styles[a];if(c.getName()==b){this._currentStyle=c;return}}}else{if(this._styles.length>1){this._currentStyle=this._styles[0]}else{c=Oskari.clazz.create("Oskari.mapframework.domain.Style");c.setName("");c.setTitle("");c.setLegend("");this._currentStyle=c}return}}else{c=Oskari.clazz.create("Oskari.mapframework.domain.Style");c.setName("");c.setTitle("");c.setLegend("");
this._currentStyle=c;return}c=Oskari.clazz.create("Oskari.mapframework.domain.Style");c.setName("");c.setTitle("");c.setLegend("");this._currentStyle=c},getCurrentStyle:function(){return this._currentStyle},isVisible:function(){return this._visible},setVisible:function(a){this._visible=a},isInScale:function(c){var b=this.isBaseLayer();if(!c){var a=Oskari.$().sandbox;c=a.getMap().getScale()}if(!this.isBaseLayer()){if(c>this.getMaxScale()&&c<this.getMinScale()){b=true}}return b},isLayerOfType:function(a){return a=="WMTS"||a=="wmtslayer"},isGroupLayer:function(){if(this._type=="GROUP_LAYER"){return true}else{return false}}});Oskari.clazz.define("Oskari.mapframework.wmts.service.WMTSLayerService",function(a){this.mapLayerService=a;this.capabilities={};this.capabilitiesClazz=Oskari.clazz.create("Oskari.openlayers.Patch.WMTSCapabilities_v1_0_0")},{setCapabilities:function(a,b){this.capabilities[a]=b},getCapabilities:function(a){return this.capabilities[a]},readWMTSCapabilites:function(a,e,d){var b=this;var c=this.capabilitiesClazz.getPatch();var f=new c();OpenLayers.Request.GET({url:e,params:{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"},success:function(h){var i=h.responseXML;if(!i||!i.documentElement){i=h.responseText}var g=f.read(i);b.setCapabilities(a,g);b.parseCapabilitiesToLayers(a,g,d)},failure:function(){alert("Trouble getting capabilities doc");OpenLayers.Console.error.apply(OpenLayers.Console,arguments)}})},parseCapabilitiesToLayers:function(b,a,d){var t=this;var e=this.mapLayerService;var r=null;if(a.operationsMetadata.GetTile.dcp.http.getArray){r=a.operationsMetadata.GetTile.dcp.http.getArray}else{r=a.operationsMetadata.GetTile.dcp.http.get}var u=a.contents.layers;var q=a.contents;var d=q.tileMatrixSets[d];for(var k=0;k<u.length;k++){var c=u[k];var g=c.identifier;var s=c.identifier;var l={name:g,minScale:10000000,maxScale:1,opacity:100,wmtsName:g,descriptionLink:"",orgName:"WMTS",type:"wmtslayer",legendImage:"",formats:{value:"text/html"},isQueryable:true,minScale:4*4*4*4*40000,style:"",dataUrl:"",name:g,opacity:100,inspire:"WMTS",maxScale:1};var v=Oskari.clazz.create("Oskari.mapframework.wmts.domain.WmtsLayer");v.setAsNormalLayer();v.setId(g);v.setName(l.name);v.setWmtsName(l.wmtsName);v.setOpacity(l.opacity);v.setMaxScale(l.maxScale);v.setMinScale(l.minScale);v.setDescription(l.info);v.setDataUrl(l.dataUrl);v.setOrganizationName(l.orgName);v.setInspireName(l.inspire);v.setWmtsMatrixSet(d);v.setWmtsLayerDef(c);v.addWmtsUrl(r);var h=Oskari.clazz.builder("Oskari.mapframework.domain.Style");var j;for(var m=0,f=c.styles.length;m<f;++m){j=c.styles[m];var o=h();o.setName(j.identifier);o.setTitle(j.identifier);v.addStyle(o);if(j.isDefault){v.selectStyle(j.identifier);break}}e.addLayer(v,false)}}});Oskari.clazz.define("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder",function(){},{parseLayerData:function(d,e,g){d.setWmtsName(e.wmsName);if(e.wmsUrl){var j=e.wmsUrl.split(",");for(var c=0;c<j.length;c++){d.addWmtsUrl(j[c])}}var f=Oskari.clazz.builder("Oskari.mapframework.domain.Style");var b;for(var c=0,h=e.styles.length;c<h;++c){b=e.styles[c];var a=f();a.setName(b.identifier);a.setTitle(b.identifier);d.addStyle(a);if(b.isDefault){d.selectStyle(b.identifier);break}}d.setFeatureInfoEnabled(true);if(e.tileMatrixSetData){d.setWmtsMatrixSet(e.tileMatrixSetData);d.setWmtsLayerDef(e.tileLayerData)}}});Oskari.clazz.define("Oskari.openlayers.Patch.WMTSCapabilities_v1_0_0",function(){},{getPatch:function(){if(this.patch){return this.patch}return this.buildPatch()},buildPatch:function(){this.patch=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b;var a=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(a,this.yx)},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])
}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);a.version=this.version;return a},props:{wmts:{TileMatrixLimits:{MinTileRow:["minTileRow",parseInt],MaxTileRow:["maxTileRow",parseInt],MinTileCol:["minTileCol",parseInt],MaxTileCol:["maxTileCol",parseInt],TileMatrix:["tileMatrix",null]}}},readers:{wmts:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={};b.contents.layers=[];b.contents.tileMatrixSets={};this.readChildNodes(a,b.contents)},Layer:function(b,c){var a={styles:[],formats:[],tileMatrixSetLinks:[],tileMatrixSetLinksMap:{}};a.layers=[];this.readChildNodes(b,a);c.layers.push(a)},Style:function(b,c){var a={};a.isDefault=(b.getAttribute("isDefault")==="true");this.readChildNodes(b,a);c.styles.push(a)},Format:function(a,b){b.formats.push(this.getChildValue(a))},TileMatrixSetLink:function(b,c){var a={};this.readChildNodes(b,a);c.tileMatrixSetLinks.push(a);c.tileMatrixSetLinksMap[a.tileMatrixSet]=a},TileMatrixSet:function(b,c){if(c.layers){var a={matrixIds:[]};this.readChildNodes(b,a);c.tileMatrixSets[a.identifier]=a}else{c.tileMatrixSet=this.getChildValue(b)}},TileMatrix:function(b,c){var a={supportedCRS:c.supportedCRS};this.readChildNodes(b,a);c.matrixIds.push(a)},ScaleDenominator:function(a,b){b.scaleDenominator=parseFloat(this.getChildValue(a))},TopLeftCorner:function(d,f){var c=this.getChildValue(d);var e=c.split(" ");var a;if(f.supportedCRS){var b=f.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");a=!!this.yx[b]}if(a){f.topLeftCorner=new OpenLayers.LonLat(e[1],e[0])}else{f.topLeftCorner=new OpenLayers.LonLat(e[0],e[1])}},TileWidth:function(a,b){b.tileWidth=parseInt(this.getChildValue(a))},TileHeight:function(a,b){b.tileHeight=parseInt(this.getChildValue(a))},MatrixWidth:function(a,b){b.matrixWidth=parseInt(this.getChildValue(a))},MatrixHeight:function(a,b){b.matrixHeight=parseInt(this.getChildValue(a))},ResourceURL:function(a,b){b.resourceUrl=b.resourceUrl||{};b.resourceUrl[a.getAttribute("resourceType")]={format:a.getAttribute("format"),template:a.getAttribute("template")}},WSDL:function(a,b){b.wsdl={};b.wsdl.href=a.getAttribute("xlink:href")},ServiceMetadataURL:function(a,b){b.serviceMetadataUrl={};b.serviceMetadataUrl.href=a.getAttribute("xlink:href")},TileMatrixSetLimits:function(d,e){var b={tileMatrixLimits:[]};e.tileMatrixSetLimits=b;this.readChildNodes(d,b);var c={};for(var f=0;f<b.tileMatrixLimits.length;f++){var a=b.tileMatrixLimits[f];c[a.tileMatrix]=a}e.tileMatrixSetLimitsMap=c},TileMatrixLimits:function(f,h){var b=this.getElementsByTagNameNS(f,this.namespaces.wmts,"*");var j=this.props.wmts.TileMatrixLimits;var c={};for(var d=0;d<b.length;d++){var g=b[d];var e=this.getChildValue(g);var k=g.localName||g.nodeName.split(":").pop();var a=j[k][0];var i=j[k][1];c[a]=i?i(e):e}h.tileMatrixLimits.push(c)}},ows:OpenLayers.Util.applyDefaults({HTTP:function(b,a){a.http={};this.readChildNodes(b,a.http)},Get:function(c,b){var a=this.getAttributeNS(c,this.namespaces.xlink,"href");if(!b.get){b.get=a}if(!b.getArray){b.getArray=[]}b.getArray.push(a)}},OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows)},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});return this.patch}},{protocol:["Oskari.openlayers.Patch"]});Oskari.clazz.define("Oskari.openlayers.Patch.layer.WMTS",function(){},{getPatch:function(){if(this.patch){return this.patch}return this.buildPatch()},buildPatch:function(){this.patch=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,layerDef:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(c){var f={url:true,layer:true,style:true,matrixSet:true};for(var g in f){if(!(g in c)){throw new Error("Missing property '"+g+"' in layer configuration.")}}c.params=OpenLayers.Util.upperCaseObject(c.params);
var b=[c.name,c.url,c.params,c];OpenLayers.Layer.Grid.prototype.initialize.apply(this,b);if(!this.formatSuffix){this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()}if(this.matrixIds){var a=this.matrixIds.length;if(a&&typeof this.matrixIds[0]==="string"){var e=this.matrixIds;this.matrixIds=new Array(a);for(var d=0;d<a;++d){this.matrixIds[d]={identifier:e[d]}}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.updateMatrixProperties()},updateMatrixProperties:function(){this.matrix=this.getMatrix();if(this.matrix){if(this.matrix.topLeftCorner){this.tileOrigin=this.matrix.topLeftCorner}if(this.matrix.tileWidth&&this.matrix.tileHeight){this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)}if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)}if(!this.tileFullExtent){this.tileFullExtent=this.maxExtent}}},moveTo:function(b,a,c){if(a||!this.matrix){this.updateMatrixProperties()}return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMTS(this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getMatrix:function(){var b;if(!this.matrixIds||this.matrixIds.length===0){b={identifier:this.map.getZoom()+this.zoomOffset}}else{if("scaleDenominator" in this.matrixIds[0]){var a=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.map.getResolution()/0.00028;var e=Number.POSITIVE_INFINITY;var f;for(var c=0,d=this.matrixIds.length;c<d;++c){f=Math.abs(1-(this.matrixIds[c].scaleDenominator/a));if(f<e){e=f;b=this.matrixIds[c]}}}else{b=this.matrixIds[this.map.getZoom()+this.zoomOffset]}}return b},getTileInfo:function(f){var b=this.map.getResolution();var d=(f.lon-this.tileOrigin.lon)/(b*this.tileSize.w);var c=(this.tileOrigin.lat-f.lat)/(b*this.tileSize.h);var a=Math.floor(d);var e=Math.floor(c);return{col:a,row:e,i:Math.floor((d-a)*this.tileSize.w),j:Math.floor((c-e)*this.tileSize.h)}},getURL:function(a){a=this.adjustBounds(a);var c="";if(!(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(a))){return c}var b=a.getCenterLonLat();var d=this.getTileInfo(b);var j=this.matrix.identifier;if(this.layerDef&&this.layerDef.tileMatrixSetLinksMap){var k=this.layerDef.tileMatrixSetLinksMap[this.matrixSet];var h=k?k.tileMatrixSetLimitsMap[this.matrix.identifier]:null;var l=h?(d.row>=h.minTileRow&&d.row<=h.maxTileRow):false;var e=h?(d.col>=h.minTileCol&&d.col<=h.maxTileCol):false;if(!(l&&e)){return OpenLayers.Util.getImagesLocation()+"blank.gif"}}if(this.requestEncoding.toUpperCase()==="REST"){var m=this.version+"/"+this.layer+"/"+this.style+"/";if(this.dimensions){for(var g=0;g<this.dimensions.length;g++){if(this.params[this.dimensions[g]]){m=m+this.params[this.dimensions[g]]+"/"}}}m=m+this.matrixSet+"/"+this.matrix.identifier+"/"+d.row+"/"+d.col+"."+this.formatSuffix;if(OpenLayers.Util.isArray(this.url)){c=this.selectUrl(m,this.url)}else{c=this.url}if(!c.match(/\/$/)){c=c+"/"}c=c+m}else{if(this.requestEncoding.toUpperCase()==="KVP"){var f={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:d.row,TILECOL:d.col,FORMAT:this.format};c=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[f])}}return c},mergeNewParams:function(a){if(this.requestEncoding.toUpperCase()==="KVP"){return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)])}},CLASS_NAME:"OpenLayers.Layer.WMTS"});return this.patch}},{protocol:["Oskari.openlayers.Patch"]});Oskari.clazz.define("Oskari.mapframework.bundle.MapWmtsBundleInstance",function(a){this.name="MapWmts";this.mediator=null;this.sandbox=null;this.service=null;this.ui=null},{start:function(){if(this.mediator.getState()=="started"){return}var c=Oskari.$("sandbox");this.sandbox=c;var b=c.getService("Oskari.mapframework.service.MapLayerService");b.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var d=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");
b.registerLayerModelBuilder("wmtslayer",d);var a=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",b);this.service=a;this.mediator.setState("started");return this},update:function(d,a,c,e){d.alert("RECEIVED update notification @BUNDLE_INSTANCE: "+e)},stop:function(){this.mediator.setState("stopped");return this},getName:function(){return this.__name},__name:"Oskari.mapframework.bundle.MapWmtsBundleInstance"},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.Extension"]});