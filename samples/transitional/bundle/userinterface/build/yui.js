/* This is a packed Oskari bundle (bundle script version Thu Dec 08 2011 10:08:11 GMT+0200 (Suomen normaaliaika)) */ 
Oskari.clazz.define("Oskari.mapframework.ui.manager.transitional.MapFullUiManager",function(a){this._sandbox;this._conf=a;this._mapModuleDom;this._searchModuleExt;this._mapPositionModuleDom;this._overlayPopupModuleExt;this._mapControlsDom;this._uimodules=[];this._uimodulesByName={}},{createModulesAndUi:function(g){g.printDebug("[MapFullUiManager] Creating UI for Map full...");this._sandbox=g;var e=this._conf;var h=e.mapConfigurations.index_map;var f=e.mapConfigurations.zoom_bar;var b=e.mapConfigurations.scala_bar;var c=e.mapConfigurations.pan;var a=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",h,f,b,c);this._mapModuleDom=g.register(a);g.printDebug("[MapFullUiManager] creating default ui modules...");var d=e.mapConfigurations.map_function;if(d){var a=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapControlsModule");this._mapControlsDom=g.register(a)}else{this._mapControlsDom=""}var i=e.mapConfigurations.footer;if(i){var a=Oskari.clazz.create("Oskari.mapframework.ui.module.mapfull.MapPositionModule");this._mapPositionModuleDom=g.register(a)}else{this._mapPositionModuleDom=null}var a=Oskari.clazz.create("Oskari.mapframework.ui.module.common.OverlayPopupModule");this._overlayPopupModuleExt=g.register(a);this.setupExtensionModules(g);g.printDebug("[MapFullUiManager] All modules created, next build up EXTJs frame...");this.createUi(g);g.printDebug("[MapFullUiManager] Map full UI construction completed.")},setupExtensionModules:function(a){a.printDebug("[MapFullUiManager] setupExtensionModules...");for(var c=0;c<this._uimodules.length;c++){var b=this._uimodules[c];a.printDebug("[MapFullUiManager] Registering "+b.identifier);b.component=a.register(b.module)}},addExtensionModule:function(b,a,d){var c={module:b,identifier:a,region:d,component:null};this._uimodules.push(c);this._uimodulesByName[a]=c;return c},getExtensionModule:function(a){return this._uimodulesByName[a].module},getExtensionModuleDefinition:function(a){return this._uimodulesByName[a]},getExtensionModuleComponentsByRegion:function(d){var a=this._sandbox;var b=[];var f="";for(p in d){f+=p+"="+d[p]+" "}a.printDebug("[MapFullUiManager] getExtensionModulesByRegion called with "+f);for(var e=0;e<this._uimodules.length;e++){var c=this._uimodules[e];if(d[c.region]){b.push(c.component);a.printDebug("[MapFullUiManager] - module "+c.identifier+" matched")}}return b},getExtensionModuleDefinitionsByRegion:function(c){var a=[];for(var d=0;d<this._uimodules.length;d++){var b=this._uimodules[d];if(c[b.region]){a.push(b)}}return a},createMapPanel:function(){var a=Ext.create("Ext.Panel",{region:"center",layout:"fit",items:[]});return a},createMapContainer:function(a){var b=Ext.createWidget("nlsfimappanel",{olmap:a,layout:"absolute",flex:1});return b},createUi:function(d){var g=Oskari.$().startup.mapConfigurations;var k=300;var m=this.getExtensionModuleComponentsByRegion({S:true});var h=Ext.create("Ext.Panel",{region:"south",split:true,layout:"fit",region:"south",collapsed:true,collapsible:true,animCollapse:false,titleCollapse:false,collapseMode:"mini",id:"main-app-bottom",height:k,boxMinHeight:k,width:g.width,animCollapse:false,titleCollapse:false,frame:true,header:false,items:m});var e=this.getExtensionModuleComponentsByRegion({E:true});var b=Ext.create("Ext.Panel",{id:"main-right-panel",region:"east",collapsible:true,collapseMode:"mini",split:true,layout:"accordion",layoutConfig:{titleCollapse:false,animate:true,activeOnTop:true},width:220,items:e,collapsed:e.length==0});var j=this.getExtensionModuleComponentsByRegion({NW:true});var a=[];if(j.length>0){a.push(Ext.create("Ext.Panel",{anchor:"100%, 50%",id:"left_upper",border:false,frame:false,layout:"fit",items:j}))}var v=this.getExtensionModuleComponentsByRegion({W:true});for(var r=0;r<v.length;r++){a.push(v[r])}var t=Ext.create("Ext.Panel",{region:"west",split:true,layout:"anchor",items:a,id:"main-left-panel",collapseMode:"mini",collapsed:a.length==0,border:false,frame:false,width:220,region:"west",collapsible:true,split:true,animCollapse:false,titleCollapse:false,autoHeight:false,boxMaxWidth:600,boxMinWidth:220,hidden:!g.plane_list,title:d.getText("leftpanel_maplevels_title")});
var c=null;if(this._mapModuleDom){c=this.createMapPanel();var q=this.createMapContainer(this._mapModuleDom);c.add(q);if(this._mapControlsDom){q.add(this._mapControlsDom)}}if(!c){c=Ext.create("Ext.Panel",{html:"<b>No items</b>",layout:"fit"})}var o=Ext.create("Ext.Panel",{region:"center",split:true,items:c,id:"main-center",border:false,region:"center",layout:"fit",frame:false,header:false,collapsible:false,animCollapse:false,titleCollapse:false});var l=[];if(t){l.push(t)}l.push(o);if(b){l.push(b)}var i=[];if(this._mapPositionModuleDom){i.push(this._mapPositionModuleDom)}var s=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom",items:i});var f=Ext.create("Ext.Panel",{id:"main-app-panel",layout:"border",region:"center",items:l,bbar:s});var u=Ext.create("Ext.Panel",{layout:"border",id:"main-app",renderTo:"map-full",width:g.width,height:g.height+k,split:true,items:[f,h]});this._facade=Oskari.clazz.create("Oskari.mapframework.ui.manager.transitional.Facade",d,this,{W:t,E:b,S:h,Center:o,Viewport:u,ViewportCenter:f,StatusRegion:s});Oskari.$("UI.facade",this._facade);this._uiReady=true},getBundleMenu:function(){return[{text:"Load Bundle: Bundle Manager",handler:function(){var a=Oskari.bundle_facade;a.require({"Import-Bundle":{bundlemanager:{bundlePath:"../example-bundles/bundle/"}}},function(b){Oskari.bundle_facade.requireBundle("bundlemanager","BundleManager",function(){var c=b.createInstance("BundleManager");c.start()})})}}]}});Oskari.clazz.define("Oskari.mapframework.ui.manager.transitional.Facade",function(a,b,c){this.sandbox=a;this.manager=b;this.parts=c;this.additionalComponents={}},{registerPart:function(a,b){this.parts[a]=b},getSandbox:function(){return this.sandbox},getManager:function(){return this.manager},getParts:function(){return this.parts},appendExtensionModule:function(e,l,a,i,g,k,j){var d=this.sandbox.getLanguage();var c=this.manager.addExtensionModule(e,l,g,k,j);c.bundleInstance=i;if(c.module){if(c.component){c.initialisedComponent=this.getSandbox().register(c.module)}else{c.component=this.getSandbox().register(c.module)}}if(c.component){var n=null;var h=true;if(typeof g=="string"){n=g}var o=this.parts[n];var b=null;if(k&&k[d]){b=k[d].title}var f={title:b,layout:"fit",items:[c.component]};var m=o.add(f);c.host=o;c.cmp=m;c.component=null}for(p in a){this.sandbox.registerForEventByName(e,p)}return c},removeExtensionModule:function(b,a,e,d,c){for(p in e){this.sandbox.unregisterFromEventByName(b,p)}this.sandbox.unregister(b)},collapseDirections:{N:Ext.Component.DIRECTION_TOP,E:Ext.Component.DIRECTION_RIGHT,S:Ext.Component.DIRECTION_BOTTOM,W:Ext.Component.DIRECTION_LEFT},collapsePart:function(a){this.parts.Drawer[a].collapse(this.collapseDirections[a],false)},expandPart:function(a){this.parts.Drawer[a].expand(false)},addUIComponent:function(b,a,d){this.parts[d].add(a);var c={ident:b,region:d,comp:a};this.additionalComponents[b]=c},removeUIComponent:function(a){var b=this.additionalComponents[identtifier];this.parts[b.region].remove(b.comp)}},{protocol:["Oskari.mapframework.ui.manager.Facade"]});