/* This is a packed Oskari bundle (bundle script version Thu Feb 23 2012 11:08:28 GMT+0200 (Suomen normaaliaika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.WebFormBundleInstance",function(){this.map=null;this.mapster=null;this.ui=null;this.sandbox=null},{getUserInterface:function(){return this.ui},start:function(){var a=null;if(document.location.search.length>1){a=Ext.urlDecode(document.location.search.substring(1))}else{a={}}var d=Oskari.clazz.create("Oskari.mapframework.webform.Sample");var c=Oskari.clazz.create("Oskari.mapframework.wmts.NlsFiLayerConfig",{default_wms_url:"http://wms.a.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?,http://wms.b.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?,http://wms.c.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?,http://wms.d.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?"});var b=c.create();d.setMapConfiguration(b);Oskari.$("pageArgs",a);Oskari.$("startup",c.getMapConfiguration());Oskari.$("Ext",Ext);d.startFramework();this.app=d},getApp:function(){return this.app},update:function(){},stop:function(){alert("Stopped!")}},{protocol:["Oskari.bundle.BundleInstance"]});Oskari.clazz.define("Oskari.mapframework.webform.Sample",function(){this._core=null;this.mapConfiguration=null;this.ui=null},{setMapConfiguration:function(a){this.mapConfiguration=a},getMapConfiguration:function(){return this.mapConfiguration},getWmtsService:function(){return this.wmtsService},startFramework:function(){var c=this.getMapConfiguration();var b=Oskari.clazz.create("Oskari.mapframework.core.Core");this._core=b;var a=b.getSandbox();this.handlers={addExternalMapLayer:Oskari.clazz.create("Oskari.mapframework.bundle.AddExternalMapLayerHandler",a),removeExternalMapLayer:Oskari.clazz.create("Oskari.mapframework.bundle.RemoveExternalMapLayerHandler",a)};a.addRequestHandler("AddExternalMapLayerRequest",this.handlers.addExternalMapLayer);a.addRequestHandler("RemoveExternalMapLayerRequest",this.handlers.removeExternalMapLayer);var d=this.createServices(c);var f=this.createEnhancements(c);var e=this.createUserInterface(c);this.ui=e;this.createDefaultExtensionModules(c,e);this.createExtensionBundles(c,e);this.createCoreQuirks(c,b);b.init(e,d,f,c.layers,c.userInterfaceLanguage,c.mapPublisherWizardUrl)},getSandbox:function(){return this._core.getSandbox()},getUserInterface:function(){return this.ui},createCoreQuirks:function(b,a){if(b.disableDevelopmentMode=="true"){var c=Oskari.clazz.create("Oskari.mapframework.enhancement.common.DisableDevelopmentModeEnhancement",true);c.enhance(a)}},createServices:function(b){var c=[];c.push(Oskari.clazz.create("Oskari.mapframework.service.SearchService",b.globalMapAjaxUrl,b.globalPortletNameSpace));var a=Oskari.clazz.create("Oskari.mapframework.service.MapLayerService",null,this._core.getSandbox());c.push(a);a.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var d=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");a.registerLayerModelBuilder("wmtslayer",d);var e=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",a);this.wmtsService=e;c.push(Oskari.clazz.create("Oskari.mapframework.service.GetFeatureInfoService",b.globalMapAjaxUrl));c.push(Oskari.clazz.create("Oskari.mapframework.service.LanguageService",b.userInterfaceLanguage));c.push(Oskari.clazz.create("Oskari.mapframework.service.UsageSnifferService",2,"/log/"));return c},createEnhancements:function(a){var d=[];var c=false;var b=(a.netServiceCenterAvailable==true);d.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithConfigurationsEnhancement",a.preSelectedLayers,a.mapConfigurations));d.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement"));return d},createUserInterface:function(a){return Oskari.clazz.create("Oskari.mapframework.oskari.ui.WebFormUiManager",a,this)},createDefaultExtensionModules:function(d,f){var b=Oskari.clazz.create("Oskari.mapframework.ui.module.layerselector.AllLayersModule");f.addExtensionModule(b,"allLayersModule","NW");var g=Oskari.clazz.create("Oskari.mapframework.ui.module.layerselector.SelectedLayersModule");f.addExtensionModule(g,"selectedLayersModule","W");var c=Oskari.clazz.create("Oskari.mapframework.ui.module.searchservice.SearchModule");
f.addExtensionModule(c,"searchModule","E");var e=Oskari.clazz.create("Oskari.mapframework.ui.module.searchservice.MetadataModule");f.addExtensionModule(e,"metadataModule","E");if(d.bundles){for(bundleIndex in d.bundles){var a=d.bundles[bundleIndex];f.addExtensionModule(Oskari.clazz.create(a.type,a.config),a.ident,a.location)}}return f},createExtensionBundles:function(a,b){}});Oskari.clazz.define("Oskari.mapframework.oskari.ui.WebFormFacade",function(a,b,c){this.sandbox=a;this.manager=b;this.parts=c;this.additionalComponents=[]},{registerPart:function(a,b){this.parts[a]=b},getSandbox:function(){return this.sandbox},getManager:function(){return this.manager},getParts:function(){return this.parts},showUIComponent:function(b,a,e){var c=this.findUIComponentIndex(b);if(c!=-1){var d=this.additionalComponents[c];this.expandPart(d.region);if("S"===d.region){this.parts[d.region].setActiveTab(d.comp)}else{if(d.comp.expand){d.comp.expand(false)}}}},removeUIComponent:function(a){var b=this.findUIComponentIndex(a);if(b!=-1){var c=this.additionalComponents[b];this.parts[c.region].remove(c.comp);this.additionalComponents.splice(b,1)}},findUIComponentIndex:function(a){var c=-1;for(var b=0;b<this.additionalComponents.length;++b){var d=this.additionalComponents[b];if(d.ident==a){return b}}return -1},addUIComponent:function(b,a,d){this.parts[d].add(a);var c={ident:b,region:d,comp:a};this.additionalComponents[b]=c},appendExtensionModule:function(e,l,a,i,g,k,j){var d=this.sandbox.getLanguage();var c=this.manager.addExtensionModule(e,l,g,k,j);c.bundleInstance=i;if(c.module){if(c.component){c.initialisedComponent=this.getSandbox().register(c.module)}else{c.component=this.getSandbox().register(c.module)}}if(c.component){var n=null;var h=true;if(typeof g=="string"){n=g}var o=this.parts[n];var b=null;if(k&&k[d]){b=k[d].title}var f={title:b,layout:"fit",items:[c.component]};var m=o.add(f);c.host=o;c.cmp=m;c.component=null}for(p in a){this.sandbox.registerForEventByName(e,p)}return c},removeExtensionModule:function(b,a,e,d,c){for(p in e){this.sandbox.unregisterFromEventByName(b,p)}this.sandbox.unregister(b)},collapseDirections:{N:Ext.Component.DIRECTION_TOP,E:Ext.Component.DIRECTION_RIGHT,S:Ext.Component.DIRECTION_BOTTOM,W:Ext.Component.DIRECTION_LEFT},collapsePart:function(a){if(this.parts.Drawer[a]){this.parts.Drawer[a].collapse(this.collapseDirections[a],false)}else{this.parts[a].collapse(true)}},expandPart:function(a){if(this.parts.Drawer[a]){this.parts.Drawer[a].expand(false)}else{this.parts[a].expand(true)}}},{protocol:["Oskari.mapframework.ui.manager.Facade"]});Oskari.clazz.define("Oskari.mapframework.oskari.ui.WebFormUiManager",function(a,b){this._app=b;this._sandbox;this._conf=a;this._mapModuleDom;this._mapPositionModuleDom;this._overlayPopupModuleExt;this._mapControlsDom;this._uimodules=[];this._uimodulesByName={}},{createModulesAndUi:function(l){l.printDebug("[MapFullUiManager] Creating UI for Map full...");this._sandbox=l;var j=this;l.register(j);for(p in j.eventHandlers){console.log("WEBFORM REGISTER TO ",p);l.registerForEventByName(j,p)}var h=this._conf;var m=h.mapConfigurations.index_map;var k=h.mapConfigurations.zoom_bar;var b=h.mapConfigurations.scala_bar;var c=h.mapConfigurations.pan;var a=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",m,k,b,c);this._mapModuleDom=l.register(a);var d=[];d.push("Oskari.mapframework.mapmodule.LayersPlugin");d.push("Oskari.mapframework.mapmodule.WmsLayerPlugin");d.push("Oskari.mapframework.mapmodule.MarkersPlugin");d.push("Oskari.mapframework.mapmodule.VectorLayerPlugin");d.push("Oskari.mapframework.mapmodule.TilesGridPlugin");d.push("Oskari.mapframework.mapmodule.ControlsPlugin");d.push("Oskari.mapframework.mapmodule.WfsLayerPlugin");d.push("Oskari.mapframework.mapmodule.GetInfoPlugin");for(var f=0;f<d.length;f++){var g=Oskari.clazz.create(d[f]);a.registerPlugin(g)}l.printDebug("[MapFullUiManager] creating default ui modules...");var e=false;if(e){var a=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapControlsModule");this._mapControlsDom=l.register(a)}else{this._mapControlsDom=""
}var n=false;if(n){var a=Oskari.clazz.create("Oskari.mapframework.ui.module.mapfull.MapPositionModule");this._mapPositionModuleDom=l.register(a)}else{this._mapPositionModuleDom=null}this.setupExtensionModules(l);l.printDebug("[MapFullUiManager] All modules created, next build up EXTJs frame...");this.createUi(l);l.printDebug("[MapFullUiManager] Map full UI construction completed.")},setupExtensionModules:function(a){a.printDebug("[MapFullUiManager] setupExtensionModules...");for(var c=0;c<this._uimodules.length;c++){var b=this._uimodules[c];a.printDebug("[MapFullUiManager] Registering "+b.identifier);b.component=a.register(b.module)}},addExtensionModule:function(b,a,d){var c={module:b,identifier:a,region:d,component:null};this._uimodules.push(c);this._uimodulesByName[a]=c;return c},getExtensionModule:function(a){return this._uimodulesByName[a].module},getExtensionModuleDefinition:function(a){return this._uimodulesByName[a]},getExtensionModuleComponentsByRegion:function(d){var a=this._sandbox;var b=[];var f="";for(p in d){f+=p+"="+d[p]+" "}a.printDebug("[MapFullUiManager] getExtensionModulesByRegion called with "+f);for(var e=0;e<this._uimodules.length;e++){var c=this._uimodules[e];if(d[c.region]){b.push(c.component);a.printDebug("[MapFullUiManager] - module "+c.identifier+" matched")}}return b},getExtensionModuleDefinitionsByRegion:function(c){var a=[];for(var d=0;d<this._uimodules.length;d++){var b=this._uimodules[d];if(c[b.region]){a.push(b)}}return a},defaults:{minScale:40000,maxScale:1},adaptWebForm:function(){var j=this._sandbox;var c=Ext;var e=this;var b=Oskari.clazz.create("Oskari.poc.sade3.SadeApp",{});this._app.webFormApp=b;b.setSandbox(j);var a=Oskari.clazz.create("Oskari.poc.sade3.Mediator");b.setMediator(a);var d=Oskari.clazz.create("Oskari.poc.sade3.SadeWorker",{urls:{KTJkiiWFS:"../../../wfs-dispatch/ktjkii-wfs/wfs",RakennustiedotWFS:"../../../wfs-dispatch/rahu/wfs",NimistoWFS:"../../../wfs-dispatch/nimisto/wfs",MaastoWFS:"../../../wfs-dispatch/maasto/wfs"}});var g=this;var f=Oskari.clazz.create("Oskari.poc.sade3.LayerManager",j,d.workerLayers,this.defaults,true,g.getName());this.layerManager=f;b.setLayerManager(f);f.createLayer("sade",true,null);d.mapplet.setLayerManager(f);d.mapplet.mapProj=new OpenLayers.Projection("EPSG:3067");d.setupWorkers();b.setWorker(d);var h=Oskari.clazz.create("Oskari.poc.sade3.SadeUI");this._app.webFormUI=h;h.setMapAdapter(f);h.setApp(b);h.getFormView().createFields(h);h.getFormView().grids.RakennuksenOminaisuustiedot=h.getFormView().createGrid(h);var i=Oskari.clazz.create("Oskari.poc.sade3.Adapter",b,h);b.setAdapter(i);return h},start:function(){},stop:function(){},init:function(){},eventHandlers:{"MyPlaces.MyPlaceSelectedEvent":function(b){console.log("HACK","update OpenLayers SIZE");var a=this._sandbox.findRegisteredModuleInstance("MainMapModule");a._map.updateSize();this._app.webFormApp.getLayerManager().dimMapLayer()},AfterMapMoveEvent:function(c){var b=this;var a=this.sandbox;var f=c.getScale();if(!(f<this.defaults.minScale&&f>this.defaults.maxScale)){return}var g=c.getCenterY();var d=c.getCenterX()},FeaturesGetInfoEvent:function(a){var c=Ext;var b=a.getLon();var h=a.getLat();var e=a.getMapLayer();var i=this._app.webFormApp.getLayerManager().sandbox;if(e.getId()!=this._app.webFormApp.getLayerManager().layers.sade.layerId){return}var f=this;var g=this._app.webFormUI;g.reset();this._app.webFormApp.getWorker().reset();var d=new OpenLayers.LonLat(b,h);this._app.webFormApp.getWorker().searchAnyByLonLat(d)},AfterAddExternalMapLayerEvent:function(b){var a=b.getLayer();console.log("AfterAddExternalMapLayerEvent",b,a,this._app.webFormApp);this._app.webFormApp.getLayerManager().registerLayerImpl(a)},AfterRemoveExternalMapLayerEvent:function(a){}},onEvent:function(a){console.log("EVENT",a);return this.eventHandlers[a.getName()].apply(this,[a])},getName:function(){return"WebForm"},createWebFormContainer:function(i,b,j,n){var e=Ext.createWidget("nlsfimappanel",{olmap:b,x:0,y:0,width:612,height:550,layout:"absolute",bodyBorder:false,bodyCls:"mapster",bodyStyle:{border:"1pt dashed #c0c0c0"}});
if(j){e.add(j)}var n=Ext.create("Ext.tab.Panel",{width:612,height:364,x:63,y:280});i.Drawer["S"]=n;i.S=n;var f=this.adaptWebForm();function k(){console.log("SCROLLERCOASTER")}var l={x:216,y:152,width:460,height:62,layout:"absolute",items:[{x:2,y:0,xtype:"checkbox",name:"ytt",inputValue:false,id:"checkbox1"},{x:2,y:16,xtype:"checkbox",name:"vjl",inputValue:false,id:"checkbox2"},{x:2,y:48,xtype:"checkbox",name:"muu",inputValue:false,id:"checkbox3"},{x:180,y:0,xtype:"checkbox",name:"ktm",inputValue:false,id:"checkbox4"},{x:180,y:16,xtype:"checkbox",name:"vtv",inputValue:false,id:"checkbox5"},{x:362,y:0,xtype:"checkbox",name:"hlk",inputValue:false,id:"checkbox6"}],baseCls:"transparent",bodyStyle:{border:"1pt dashed #c0c0c0"}};var m={bodyStyle:{border:"1pt dashed #c0c0c0"},y:320,x:224,width:400,height:24,layout:"hbox",items:[f.getFormView().fields.tf_CU_identifier,{xtype:"button",text:"Hae",handler:function(){f.getApp().getWorker().searchAnyByCUQualifiedIdentifier(f.getFormView().fields.tf_CU_identifier.getValue(),{zoomToExtent:true})}},{xtype:"button",text:"Osoita kartalta",handler:function(){console.log("HACK","update OpenLayers SIZE");var o=f.getApp().getLayerManager().sandbox.findRegisteredModuleInstance("MainMapModule");o._map.updateSize();f.getApp().getLayerManager().highlightMapLayer()}}]};var h={title:"Sivu 1",layout:"absolute",width:700,height:991,bodyCls:"page-a",autoScroll:false,style:{overflow:"auto"},items:[{x:63,y:416,width:612,height:550,items:[e]},m,l,{xtype:"checkbox",x:63,y:977,text:"(EUPL) 2012 oskari.org"}]};var g={title:"Sivu 2",width:700,height:991,bodyCls:"page-b",layout:"absolute",items:[n],autoScroll:false,style:{overflow:"auto"}};var d={title:"Sivu 3",width:700,height:991,bodyCls:"page-c",autoScroll:false,style:{overflow:"auto"}};var c={title:"Sivu 4",width:700,height:991,bodyCls:"page-d",autoScroll:true,layout:"absolute",style:{overflow:"auto"},items:[{x:63,y:190,width:612,height:754,items:[f.getFormView().grids.RakennuksenOminaisuustiedot]}]};var a=Ext.create("Ext.tab.Panel",{autoScroll:true,items:[h,g,d,c]});return a},createStatusBar:function(a,d){var c=[];c.push("-");var b=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom",items:c});return b},createEastPanel:function(a){var c=this.getExtensionModuleComponentsByRegion({E:true});var b=Ext.create("Ext.Panel",{id:"main-right-panel",region:"east",collapsible:true,collapseMode:"mini",split:true,layout:"accordion",layoutConfig:{titleCollapse:false,animate:true,activeOnTop:true},width:220,items:c,collapsed:c.length==0});return b},createSouthPanel:function(a,e){var b=200;var d=this.getExtensionModuleComponentsByRegion({S:true});var c=Ext.create("Ext.tab.Panel",{layout:"fit",height:312,width:480,frame:true,header:false,items:d});return c},createFlyouts:function(a,f,e){var d=this;var b='<em id="{id}-btnWrap" class="toolsbar"><button class="toolsbar" id="{id}-btnEl" type="{type}" hidefocus="true"<tpl if="tabIndex"> tabIndex="{tabIndex}"</tpl> role="button" autocomplete="off"><span id="{id}-btnInnerEl" class="{baseCls}-inner" style="{innerSpanStyle}">{text}</span><span id="{id}-btnIconEl" class="{baseCls}-icon {iconCls}">&#160;</span></button></em>';f.push({xtype:"button",width:40,flex:0,baseCls:"toolsbar",iconCls:"toolsbarIcon",renderTpl:b,tooltip:"close_menu",handler:function(){e.lastOpener=null;e.toolsMenu.hide()}});var g='<em id="{id}-btnWrap" class="bndlsbar-btn"><button class="bndlsbar-btn  {iconCls}" id="{id}-btnEl" type="{type}" hidefocus="true"<tpl if="tabIndex"> tabIndex="{tabIndex}"</tpl> role="button" autocomplete="off"><span id="{id}-btnInnerEl" class="{baseCls}-inner" style="{innerSpanStyle}">{text}</span><span id="{id}-btnIconEl" class="{baseCls}-icon">&#160;</span></button></em>';var c=Ext.create("Ext.panel.Panel",{xtype:"panel",width:120,baseCls:"bndlsbar",layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",height:96,baseCls:"bndlsplaceholder"},{xtype:"button",text:"Karttatasot",height:96,baseCls:"bndlsbar",iconCls:"bndls-layerselector",renderTpl:g,tooltip:"show_layerselector",handler:function(){if(e.lastOpener==0){e.toolsMenu.hide();e.lastOpener=null
}else{e.toolsMenu.show();e.toolsMenuRight.getLayout().setActiveItem(0);e.lastOpener=0}}},{xtype:"button",text:"Valitut karttatasot",height:96,baseCls:"bndlsbar",iconCls:"bndls-layerselection",renderTpl:g,tooltip:"show_layerselection",handler:function(){if(e.lastOpener==1){e.toolsMenu.hide();e.lastOpener=null}else{e.toolsMenu.show();e.toolsMenuRight.getLayout().setActiveItem(1);e.lastOpener=1}}}]});e.bundleButtonsTpl=g;e.bundleButtons=c;f.push(c);return f},createToolsMenu:function(b,e){var d='<em id="{id}-btnWrap" class="menubutton"><button class="menubutton" id="{id}-btnEl" type="{type}" hidefocus="true"<tpl if="tabIndex"> tabIndex="{tabIndex}"</tpl> role="button" autocomplete="off"><span id="{id}-btnInnerEl" class="{baseCls}-inner" style="{innerSpanStyle}">{text}</span><span id="{id}-btnIconEl" class="{baseCls}-icon {iconCls}">&#160;</span></button></em>';var f={toolsMenuRight:null,toolsMenu:null,toolsMenuShown:false};var c=Ext.create("Ext.panel.Panel",{layout:{type:"card"},itemCls:"toolsmenuitem",activeItem:2,flex:1,height:412,items:e,bodyFrame:false,bodyCls:"toolsmenu_right"});f.toolsMenuRight=c;var a=Ext.create("Ext.panel.Panel",{layout:{type:"hbox",align:"top"},hideMode:"offsets",floating:true,shadow:"sides",frame:false,autoShow:false,preventHeader:true,width:768,height:480,x:40+120,y:96,closable:false,resizable:true,resizeHandles:"se",bodyBorder:false,border:0,items:[c],bodyCls:"toolsmenu"});f.toolsMenu=a;return f},createUi:function(m){var h=Oskari.$().startup.mapConfigurations;var q=300;var k=this.getExtensionModuleComponentsByRegion({NW:true});var c=[];if(k.length>0){c.push(Ext.create("Ext.Panel",{anchor:"100%, 50%",id:"left_upper",border:false,frame:false,layout:"fit",items:k}))}var j=this.getExtensionModuleComponentsByRegion({W:true});for(var d=0;d<j.length;d++){c.push(j[d])}var g=null;if(this._mapModuleDom){g=Ext.create("Ext.Panel",{region:"center",layout:"fit",bodyBorder:false,items:[]})}var l=[];var b=this.createToolsMenu(m,c);this.createFlyouts(m,l,b);l.push(g);var r=this.createEastPanel(m);l.push({layout:"fit",xtype:"panel",width:312,items:[r]});var o=this.createStatusBar(m,h);var i=Ext.create("Ext.Panel",{layout:{type:"hbox",align:"stretch"},id:"main-app",bodyCls:"main-app",bodyBorder:false,items:l,bbar:o});var a=Ext.create("Ext.container.Viewport",{layout:"fit",items:[i]});var f={Drawer:{},E:r,Viewport:i,ToolsMenu:b.toolsMenu,StatusRegion:o,BundleButtons:b.bundleButtons,BundleButtonsTpl:b.bundleButtonsTpl};var e=this.createWebFormContainer(f,this._mapModuleDom,this._mapControlsDom);g.add(e);this._facade=Oskari.clazz.create("Oskari.mapframework.oskari.ui.WebFormFacade",m,this,f);Oskari.$("UI.facade",this._facade);this._uiReady=true},getFacade:function(){return this._facade}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.bundle.extension.Extension","Oskari.mapframework.bundle.extension.EventListener"]});