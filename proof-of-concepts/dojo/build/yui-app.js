/* This is a packed Oskari app (bundle script version Thu May 31 2012 12:02:04 GMT+0300 (Suomen kesäaika)) */ 
/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 12:02:04 GMT+0300 (Suomen kesäaika)) */ 
Oskari.clazz.define("Oskari.tools.Yui",function(){this.bundle_manager=Oskari.bundle_manager;this.excludeTags={mapframework:true},this.langs={fi:true,sv:true,en:true},this.flushPackFiles()},{flushPackFiles:function(){this.packedFiles=[];this.packedLocales={};for(l in this.langs){this.packedLocales[l]=[]}},setExcludeTags:function(a){this.excludeTags=a},getBundleTags:function(a){return this.bundle_manager.stateForBundleDefinitions[a].metadata.manifest["Bundle-Tag"]||{}},shallExclude:function(a){var b=this;var c=b.excludeTags;for(p in a){if(c[p]){return true}}return false},defaultCompressorJar:'"../tools/bundle/yui/yuicompressor-2.4.6.jar"',yui_command_line:function(j,k,g){var i=this;var c=i.bundle_manager.sources[j];var m="";m+="md build\n";var f="bundle.js";m+="java -jar "+k+" --charset UTF-8 --line-break 4096 --type js "+f+" > build/bundle-yui.js\n";m+="echo /* This is a packed Oskari bundle (bundle script version "+(new Date())+") */ > build/yui.js\n";m+="echo /* This is a unpacked Oskari bundle (bundle script version "+(new Date())+") */ > build/yui-pack.js\n";for(var d=0;d<c.scripts.length;d++){var b=c.scripts[d];var a=new String(b.src);var e="text/javascript"==b.type?"js":"css";if("css"==e){continue}while(a.indexOf("/")!=-1){a=a.replace("/","\\")}m+='type "'+a+'" >> build/yui-pack.js\n'}m+="java -jar "+k+" --charset UTF-8 --line-break 4096 --type js build/yui-pack.js >> build/yui.js\n";this.packedFiles.push(g+"/build/yui.js");for(l in this.langs){if(!this.langs[l]){continue}m+="echo /* This is a unpacked Oskari bundle (bundle script version "+(new Date())+") */ > build/yui-pack-locale-"+l+".js\n"}if(c.locales){for(var d=0;d<c.locales.length;d++){var b=c.locales[d];var h=b.lang;var a=new String(b.src);var e="text/javascript"==b.type?"js":"css";if("css"==e){continue}while(a.indexOf("/")!=-1){a=a.replace("/","\\")}m+='type "'+a+'" >> build/yui-pack-locale-'+h+".js\n"}}for(l in this.langs){if(!this.langs[l]){continue}m+="java -jar "+k+" --charset UTF-8 --line-break 4096 --type js build/yui-pack-locale-"+l+".js >> build/yui-locale-"+l+".js\n";this.packedLocales[l].push(g+"/build/yui-locale-"+l+".js")}return m},yui_command_lines:function(a){var d=this;var c={};for(bndlName in d.bundle_manager.sources){var f=d.getBundleTags(bndlName);if(d.shallExclude(f)){continue}var b=Oskari.bundle_manager.stateForBundleDefinitions[bndlName].bundlePath;var e="";e+='pushd "'+b+'"\n';e+=d.yui_command_line(bndlName,a,b);e+="popd\n";c[bndlName]=e}return c},yui_command_line_for_app:function(h){var g=this;g.flushPackFiles();var f="SET CURRENT=%CD%\n";var d="SET YUICOMPRESSOR=%CURRENT%/"+this.defaultCompressorJar+"\n";var e=g.yui_command_lines(h);var c="";for(p in e){c+=e[p]}var i="";i+="md build\n";i+="echo /* This is a packed Oskari app (bundle script version "+(new Date())+") */ > build/yui-app.js\n";for(var b=0;b<this.packedFiles.length;b++){var a=this.packedFiles[b];while(a.indexOf("/")!=-1){a=a.replace("/","\\")}i+='type "'+a+'" >> build/yui-app.js\n'}for(l in this.langs){i+="echo /* This is a packed Oskari locale for app (bundle script version "+(new Date())+") */ > build/yui-app-locale-"+l+".js\n";for(var b=0;b<this.packedLocales[l].length;b++){var a=this.packedLocales[l][b];while(a.indexOf("/")!=-1){a=a.replace("/","\\")}i+='type "'+a+'" >> build/yui-app-locale-'+l+".js\n"}}return f+d+c+i},showYuiBuildCmd:function(){var a=this.yui_command_line_for_app("%YUICOMPRESSOR%");var b=window.open();b.document.write('<body ><pre style="font: 9pt Verdana;">'+a+"</body></pre>")}});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 12:02:04 GMT+0300 (Suomen kesäaika)) */ 
Oskari.clazz.define("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance",function(){this.sandbox=null;this.requestHandlers={};this.extensions=[];this.extensionsByName={};this.templates={}},{getSandbox:function(){return this.sandbox},start:function(){this.createTileTemplate();this.createFlyoutTemplate();var a=Oskari.$("sandbox");this.sandbox=a;this.requestHandlers.add=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",this);this.requestHandlers.remove=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",this);this.requestHandlers.update=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",this);a.addRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add);a.addRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove);a.addRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update)},update:function(){},stop:function(){sandbox.removeRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update);sandbox.removeRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove);sandbox.removeRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add)},createTileTemplate:function(){this.templates["Oskari.userinterface.Tile"]=$('<div style="display:none;" class="oskari-tile"><div class="oskari-tile-title"></div><div class="oskari-tile-status"></div><div class="oskari-tile-close"></div></div>')},createFlyoutTemplate:function(){var a=$('<div class="oskari-flyout attached"><div class="oskari-flyouttoolbar"><div class="oskari-flyout-title"><p></p></div><div class="oskari-flyouttool-attach"></div><div class="oskari-flyouttool-detach"></div><div class="oskari-flyouttool-minimize"></div><div class="oskari-flyouttool-restore"></div><div class="oskari-flyouttool-close"></div></div><div class="oskari-flyoutcontentcontainer"><div class="oskari-flyoutcontent"></div></div></div>');a.css("left","-3195px");a.css("top","-3100px");this.templates["Oskari.userinterface.Flyout"]=a},addExtension:function(m){m.startExtension();var d=m.getPlugins();var h=null;var k=this.extensions;var e=this.extensionsByName;var n={state:"close",extension:m,draggable:null,draggableHandle:null};var i=k.length;var a=m.getName();var g=d["Oskari.userinterface.Flyout"];var l=null;if(g!=null){l=this.createFlyout(m,g,i,n);n.draggableHandle=l.children(".oskari-flyouttoolbar").children(".oskari-flyout-title").get()[0];var f=l.children(".oskari-flyoutcontentcontainer");var c=f.children(".oskari-flyoutcontent");g.setEl(c.get());$(document.body).append(l);g.startPlugin()}var b=d["Oskari.userinterface.Tile"];var j=null;if(b!=null){j=this.createTile(m,b,i,n);b.startPlugin();j.fadeIn(200)}if(j!=null){$("#menubar").append(j)}n.plugins={"Oskari.userinterface.Tile":{plugin:b,el:j},"Oskari.userinterface.Flyout":{plugin:g,el:l}};k.push(n);e[a]=n;return n},createTile:function(h,c,d,j){var f=this;var a=$("#menubar");var e=this.templates["Oskari.userinterface.Tile"].clone(true,true);var g=e.children(".oskari-tile-title");g.append(c.getTitle());var b=e.children(".oskari-tile-status");var i=e.children(".oskari-tile-close");g.click(function(){c.setState();console.log("TOGGLE -----------------------------------------------------------------------------");f.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"toggle"])});i.click(function(){f.getSandbox().postRequestByName("userinterface.RemoveExtensionRequest",[h])});c.setEl(e.get());return e},createFlyout:function(h,f,e,a){var d=this;var b=this.templates["Oskari.userinterface.Flyout"].clone(true,true);var g=b.children(".oskari-flyouttoolbar");var c={attach:g.children(".oskari-flyouttool-attach"),detach:g.children(".oskari-flyouttool-detach"),minimize:g.children(".oskari-flyouttool-minimize"),restore:g.children(".oskari-flyouttool-restore"),close:g.children(".oskari-flyouttool-close")};c.detach.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"detach"])
});c.attach.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"attach"])});c.minimize.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"minimize"])});c.restore.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"restore"])});c.close.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"close"])});return b},removeExtension:function(q){var l=this;var m=l.extensions;var g=this.extensionsByName;var r=g[q.getName()];var f=r.state;var i=r.plugins["Oskari.userinterface.Flyout"];var h=i.plugin;var o=i.el;var d=r.plugins["Oskari.userinterface.Tile"];var c=d.plugin;var k=d.el;var b=this.flyoutOps;var p=b.close;p.apply(this,[o,h,r]);k.remove();o.remove();console.log("NYI","This really does NOT close - just hiding for now");g[q.getName()]=null;var a=[];for(var e=0,j=m.length;e<j;e++){if(m[e]===r){continue}a.push(m[e])}l.extensions=a;q.stopExtension()},updateExtension:function(i,d){var v=this;var u=v.extensions;var a=this.extensionsByName;var k=a[i.getName()];var g=k.state;var e=d.getState();console.log("UPDATE",i,d,u,a);var j=k.plugins["Oskari.userinterface.Flyout"];var p=j.plugin;var t=j.el;var b=this.flyoutOps;var f=b.close;if(e=="toggle"){if(g=="close"){e="attach"}else{if(g=="attach"){e="close"}else{if(g=="detach"){e="close"}else{if(g=="minimize"){e="detach"}}}}}if(e=="attach"){for(var m=0,r=u.length;m<r;m++){var o=u[m];if(o===k){continue}if(o.state!="attach"){continue}var c="close";console.log("CLOSING",o.extension.getName(),o);var q=o.plugins["Oskari.userinterface.Flyout"];var s=q.plugin;var l=q.el;s.setState(c);o.state=c;f.apply(this,[l,s,o]);v.updateFlyoutState(c,l,s,o)}}p.setState(e);k.state=e;var h=b[e];h.apply(this,[t,p,k]);v.updateFlyoutState(e,t,p,k)},updateFlyoutState:function(d,b,c,a){console.log("updateFlyoutState",d,b,c,a)},flyoutOps:{detach:function(b,c,a){var d=this;b.animate({left:"224px"},200,"cubicIn");b.removeClass("oskari-attached");b.addClass("oskari-detached");b.removeClass("oskari-closed");var e=a.draggableHandle;a.draggable=new Draggable(b.get()[0],{handle:e,scroll:false,onStop:function(f,g){d.updateFlyoutState("dragStop",b,c,a)}})},attach:function(b,c,a){b.css("left","195px");b.css("top","100px");b.addClass("oskari-attached");b.removeClass("oskari-detached");b.removeClass("oskari-closed");if(a.draggable){a.draggable.destroy();a.draggable=null}},minimize:function(a){a.css("left","224px");a.css("top","100px");a.addClass("oskari-minimized");a.removeClass("oskari-closed");a.removeClass("oskari-detached")},restore:function(a){a.removeClass("oskari-minimized");a.removeClass("oskari-closed");a.css("top","100px");a.css("left","224px");a.addClass("oskari-detached")},close:function(a){a.removeClass("oskari-attached");a.removeClass("oskari-detached");a.addClass("oskari-closed")}}},{protocol:["Oskari.bundle.BundleInstance"]});Oskari.clazz.define("Oskari.userinterface.request.AddExtensionRequest",function(a){this._extension=a},{__name:"userinterface.AddExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",function(a){this.ui=a},{handleRequest:function(a,b){var c=b.getExtension();this.ui.addExtension(c)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.request.RemoveExtensionRequest",function(a){this._extension=a},{__name:"userinterface.RemoveExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",function(a){this.ui=a},{handleRequest:function(a,b){var c=b.getExtension();this.ui.removeExtension(c)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.request.UpdateExtensionRequest",function(b,a){this._extension=b;
this._state=a},{__name:"userinterface.UpdateExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension},getState:function(){return this._state}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",function(a){this.ui=a},{handleRequest:function(a,b){var c=b.getExtension();this.ui.updateExtension(c,b)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 12:02:04 GMT+0300 (Suomen kesäaika)) */ 
Oskari.clazz.define("Oskari.poc.oskari.bundle.MapPublisherBundleInstance",function(){this.map=null;this.core=null;this.sandbox=null;this.mapmodule=null;this.started=false;this.plugins={}},{__name:"Oskari.poc.oskari.bundle.MapPublisherBundleInstance",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},start:function(){if(this.started){return}this.started=true;var a=Oskari.$("sandbox");this.sandbox=a;a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}var b=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,b)},init:function(){return null},update:function(){},afterChangeMapLayerOpacityEvent:function(a){},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{},stop:function(){var a=this.sandbox;for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);a.request(this,b);this.sandbox.unregister(this);this.started=false},setSandbox:function(a){this.sandbox=null},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.poc.oskari.mappublisher.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.poc.oskari.mappublisher.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getTitle:function(){return"Layer Selection"},getDescription:function(){return"Sample"},getPlugins:function(){return this.plugins}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.poc.oskari.mappublisher.Flyout",function(a){this.instance=a;this.container=null;this.template=null;this.state=null;this.mapmodule=null;this.map=null},{getName:function(){return"Oskari.poc.oskari.mappublisher.Flyout"},setEl:function(c,b,a){this.container=$(c)},startPlugin:function(){var d=this;this.template=$('<div style="border:2pt dashed grey; margin:0; padding:0; height:400px;width:540px;" class="mappublisher"><div style="position:relative;border:2pt solid black;left: 10px; top:10px; height:95%;width:95%;" class="map"></div></div>');var b=d.instance.getSandbox();this.createMapModule();var a=this.mapmodule;var e=this.map;var c=b.getMap();e.setCenter(new OpenLayers.LonLat(c.getX(),c.getY()),c.getZoom(),false);this.refresh();a.start(b);a.updateCurrentState()},stopPlugin:function(){var c=this;var a=this.mapmodule;var b=c.instance.getSandbox();a.stop(b);b.unregister(c.mapmodule);this.container.empty()},getTitle:function(){return"Valitut karttatasot"},getDescription:function(){},getOptions:function(){},setState:function(a){this.state=a;console.log("Flyout.setState",this,a)},refresh:function(){var b=this.container;var a=this.template;var e=a.clone();e.appendTo(b);var c=e.children(".map");var d=this.map;d.render(c[0]);RightJS.$(e[0]).makeResizable()},createMapModule:function(){var h=this;var k=h.instance.getSandbox();var l=false;var j=false;var c=false;var d=true;var b=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","MapPubslizer",l,j,c,d);b.setStealth(true);this.mapmodule=b;var a=k.register(b);var e=[];e.push("Oskari.mapframework.bundle.mapmodule.plugin.LayersPlugin");e.push("Oskari.mapframework.mapmodule.WmsLayerPlugin");e.push("Oskari.mapframework.mapmodule.ControlsPlugin");for(var f=0;f<e.length;f++){var g=Oskari.clazz.create(e[f]);b.registerPlugin(g)}a.addControl(new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:true}}));this.map=a}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.poc.oskari.mappublisher.Tile",function(a){this.instance=a;this.container=null;this.template=null},{getName:function(){return"Oskari.poc.oskari.mappublisher.Tile"},setEl:function(c,b,a){this.container=$(c)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return"Julkaise kartta"},getDescription:function(){},getOptions:function(){},setState:function(a){console.log("Tile.setState",this,a)
},refresh:function(){var d=this;var a=d.instance;var c=this.container;var b=this.template}},{protocol:["Oskari.userinterface.Tile"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 12:02:04 GMT+0300 (Suomen kesäaika)) */ 
Oskari.clazz.define("Oskari.poc.dojo.bundle.FeatureInfoBundleInstance",function(){this.map=null;this.core=null;this.sandbox=null;this.mapmodule=null;this.started=false;this.template=null;this.plugins={};this.dojo=null},{__name:"DojoFeatureInfo",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},start:function(){var c=this;if(c.started){return}c.started=true;var a=Oskari.$("sandbox");c.sandbox=a;a.register(c);for(p in c.eventHandlers){a.registerForEventByName(c,p)}var b=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,b);c.mediator.bundle.require(function(d){c.dojo=d;c.plugins["Oskari.userinterface.Flyout"].setDojo(c.dojo);c.plugins["Oskari.userinterface.Tile"].setDojo(c.dojo);c.refresh()})},init:function(){return null},update:function(){},afterChangeMapLayerOpacityEvent:function(a){},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{AfterMapLayerAddEvent:function(a){this.plugins["Oskari.userinterface.Flyout"].handleMapLayerAdded(a);this.plugins["Oskari.userinterface.Tile"].handleMapLayerAdded(a)},AfterMapLayerRemoveEvent:function(a){this.plugins["Oskari.userinterface.Flyout"].handleMapLayerRemoved(a);this.plugins["Oskari.userinterface.Tile"].handleMapLayerRemoved(a)},AfterMapMoveEvent:function(a){},AfterChangeMapLayerOpacityEvent:function(a){if(this.sandbox.getObjectCreator(a)!=this.getName()){this.afterChangeMapLayerOpacityEvent(a)}}},stop:function(){var a=this.sandbox();for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);a.request(this,b);this.sandbox.unregister(this);this.started=false},setSandbox:function(a){this.sandbox=null},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.poc.dojo.featureinfo.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.poc.dojo.featureinfo.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getTitle:function(){return"Layer Selection"},getDescription:function(){return"Sample"},getPlugins:function(){return this.plugins},refresh:function(){var a=this;if(!a.dojo){return}this.plugins["Oskari.userinterface.Flyout"].refresh();this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.poc.dojo.featureinfo.Flyout",function(a){this.instance=a;this.container=null;this.template=null;this.state=null;this.dojo=null},{setDojo:function(a){this.dojo=a},getName:function(){return"Oskari.poc.dojo.featureinfo.Flyout"},setEl:function(c,b,a){this.container=c[0]},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return"Valitut karttatasot"},getDescription:function(){},getOptions:function(){},setState:function(a){this.state=a;console.log("Flyout.setState",this,a)},handleMapLayerAdded:function(a){},handleMapLayerRemoved:function(a){},refresh:function(){var e=this;var f=e.dojo["dojo/query"];var d=e.dojo.dojo;var b=e.dojo["dojo/dom-construct"];var g=e.dojo["dojo/dom"];var e=this;var c=d.query(this.container);console.log("DOJO",c);var a=e.instance.getSandbox();b.empty(c);var h=b.create("div",{className:"grid",id:"grid-module",style:{width:"400px",height:"300px",background:"white"}},this.container);e.createGrid(h,"dojo/io/script",e.dojo["dojox/grid/DataGrid"],e.dojo["dojo/store/Memory"],e.dojo["dojo/data/ObjectStore"],e.dojo["dojo/_base/xhr"])},createGrid:function(g,d,h,e,c,i){var f=new e({data:[{id:"sami1",name:"tieto1"},{id:"sami2",name:"tieto2"}]});var b=new c({objectStore:f});var a=new h({store:b,style:{width:"100%",height:"200px"},structure:[{name:"ID",field:"id",width:"50%"},{name:"Nimi",field:"name",width:"50%"}]},g);a.startup()}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.poc.dojo.featureinfo.Tile",function(a){this.instance=a;this.container=null;this.template=null;this.dojo=null
},{setDojo:function(a){this.dojo=a},getName:function(){return"Oskari.poc.dojo.featureinfo.Tile"},setEl:function(c,b,a){this.container=$(c)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return"Kohdetiedot"},getDescription:function(){},getOptions:function(){},setState:function(a){console.log("Tile.setState",this,a)},handleMapLayerAdded:function(a){},handleMapLayerRemoved:function(a){},refresh:function(){var f=this;var a=f.instance;var e=this.container;var d=this.template;var c=a.getSandbox();var g=c.findAllSelectedMapLayers();var b=e.children(".oskari-tile-status")}},{protocol:["Oskari.userinterface.Tile"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 12:02:04 GMT+0300 (Suomen kesäaika)) */ 
Oskari.clazz.define("Oskari.poc.dojo.bundle.LayerSelectionBundleInstance",function(){this.map=null;this.core=null;this.sandbox=null;this.mapmodule=null;this.started=false;this.template=null;this.plugins={};this.dojo=null},{__name:"DojoLayerSelection",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},start:function(){var c=this;if(c.started){return}c.started=true;var a=Oskari.$("sandbox");c.sandbox=a;a.register(c);for(p in c.eventHandlers){a.registerForEventByName(c,p)}var b=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,b);c.mediator.bundle.require(function(d){c.dojo=d;c.refresh()})},init:function(){return null},update:function(){},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{AfterMapLayerAddEvent:function(a){this.refresh()},AfterMapLayerRemoveEvent:function(a){this.refresh()},AfterMapMoveEvent:function(a){},AfterChangeMapLayerOpacityEvent:function(a){if(this.sandbox.getObjectCreator(a)!=this.getName()){this.plugins["Oskari.userinterface.Flyout"].updateLayer(a.getMapLayer())}}},stop:function(){var a=this.sandbox();for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);a.request(this,b);this.sandbox.unregister(this);this.started=false},setSandbox:function(a){this.sandbox=null},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.poc.dojo.layerselection.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.poc.dojo.layerselection.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getTitle:function(){return"Layer Selection"},getDescription:function(){return"Sample"},getPlugins:function(){return this.plugins},refresh:function(){var a=this;if(!a.dojo){return}this.plugins["Oskari.userinterface.Flyout"].setDojo(a.dojo);this.plugins["Oskari.userinterface.Flyout"].refresh();this.plugins["Oskari.userinterface.Tile"].setDojo(a.dojo);this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.poc.dojo.layerselection.Flyout",function(a){this.instance=a;this.container=null;this.template=null;this.state=null;this.dojo=null;this.layercontrols={}},{setDojo:function(a){this.dojo=a;var b=this.dojo.dojo;b.extend(this.dojo["dojo/dnd/Source"],{copyState:function(c,d){return false}})},getName:function(){return"Oskari.poc.dojo.layerselection.Flyout"},setEl:function(c,b,a){this.container=c[0]},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return"Valitut karttatasot"},getDescription:function(){},getOptions:function(){},setState:function(a){this.state=a;console.log("Flyout.setState",this,a)},updateLayer:function(b){var d=this.layercontrols[b.getId()];if(!d){return}var c=d.slider;var a=b.getOpacity();c.set("value",a)},refresh:function(){var i=this;var d=i.dojo.dojo;var e=i.dojo["dojo/dom-construct"];var i=this;var j=i.instance.getSandbox();e.empty(this.container);var k=e.create("div",{className:"selectedLayerList"},this.container);i.layercontrols={};var b=new i.dojo["dojo/dnd/Source"](k,{accept:["selectedLayer"],singular:true});var f=j.findAllSelectedMapLayers();var a=[];for(var c=f.length-1;c>=0;--c){var g=f[c];var h=this.createLayerContainer(g);a.push(h)}b.insertNodes(false,a);d.connect(b,"onDndDrop",function(m,l,o,n){i._layerOrderChanged(m,l,o,n)})},_layerOrderChanged:function(a,d,b,k){var h=d[0].id;var c=k.getAllNodes();var m=-1;for(var f=0,g=c.length;f<g;++f){if(c[f].id==h){m=f;break}}if(m>-1){m=(c.length-1)-m;var j=h.substring("selected_".length);var l=this.instance.getSandbox();var e=l.getRequestBuilder("RearrangeSelectedMapLayerRequest")(j,m);l.request(this.instance.getName(),e)}},getLayerContainer:function(a){var b=this;var c=b.dojo["dojo/dom"];return c.byId("selected_"+a)},createLayerContainer:function(h){var l=this;var n=l.instance.getSandbox();
var a=n.getRequestBuilder("ChangeMapLayerOpacityRequest");var k=l.dojo["dojo/query"];var c=l.dojo.dojo;var d=l.dojo["dojo/dom-construct"];var f=l.dojo["dojo/dom"];var e=h.getId();var m=h.getOpacity();var j=d.create("div",{className:"selectedLayer",id:"selected_"+e,style:{border:"solid; 2px"}});var g=d.create("p",{innerHTML:h.getName()},j);var i=d.create("div",{className:"slider",style:{}},j);var b=new l.dojo["dijit/form/HorizontalSlider"]({minimum:0,maximum:100,pageIncrement:20,value:m,intermediateChanges:true,style:"width: 200px;",layer:h,moduleName:l.instance.getName()},i);l.layercontrols[e]={slider:b};c.connect(b,"onChange",function(r){var q=this.moduleName;var o=this.layer.getId();n.request(q,a(o,r))});b.startup();return j}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.poc.dojo.layerselection.Tile",function(a){this.instance=a;this.container=null;this.template=null;this.dojo=null},{setDojo:function(a){this.dojo=a},getName:function(){return"Oskari.poc.dojo.layerselection.Tile"},setEl:function(c,b,a){this.container=$(c)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return"Valitut tasot DOJO"},getDescription:function(){},getOptions:function(){},setState:function(a){console.log("Tile.setState",this,a)},refresh:function(){var f=this;var a=f.instance;var e=this.container;var d=this.template;var c=a.getSandbox();var g=c.findAllSelectedMapLayers();var b=e.children(".oskari-tile-status");b.empty();b.append("("+g.length+")")}},{protocol:["Oskari.userinterface.Tile"]});