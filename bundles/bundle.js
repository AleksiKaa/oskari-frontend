var requirejs,require,define;!function(ga){function ka(e,t,n,i){return i||""}function K(e){return"[object Function]"===Q.call(e)}function L(e){return"[object Array]"===Q.call(e)}function y(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function X(e,t){if(e){var n;for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));--n);}}function x(e,t){return la.call(e,t)}function e(e,t){return x(e,t)&&e[t]}function D(e,t){for(var n in e)if(x(e,n)&&t(e[n],n))break}function Y(e,t,n,i){return t&&D(t,function(t,r){!n&&x(e,r)||(!i||"object"!=typeof t||!t||L(t)||K(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),Y(e[r],t,n,i)))}),e}function z(e,t){return function(){return t.apply(e,arguments)}}function ha(e){throw e}function ia(e){if(!e)return e;var t=ga;return y(e.split("."),function(e){t=t[e]}),t}function F(e,t,n,i){return t=Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e),t.requireType=e,t.requireModules=i,n&&(t.originalError=n),t}function ma(t){function n(t,n,i){var r,o,s,a,u,l,c,d;n=n&&n.split("/");var f=T.map,p=f&&f["*"];if(t){for(t=t.split("/"),o=t.length-1,T.nodeIdCompat&&U.test(t[o])&&(t[o]=t[o].replace(U,"")),"."===t[0].charAt(0)&&n&&(o=n.slice(0,n.length-1),t=o.concat(t)),o=t,s=0;s<o.length;s++)a=o[s],"."===a?(o.splice(s,1),--s):".."===a&&0!==s&&(1!==s||".."!==o[2])&&".."!==o[s-1]&&s>0&&(o.splice(s-1,2),s-=2);t=t.join("/")}if(i&&f&&(n||p)){o=t.split("/"),s=o.length;e:for(;s>0;--s){if(u=o.slice(0,s).join("/"),n)for(a=n.length;a>0;--a)if((i=e(f,n.slice(0,a).join("/")))&&(i=e(i,u))){r=i,l=s;break e}!c&&p&&e(p,u)&&(c=e(p,u),d=s)}!r&&c&&(r=c,l=d),r&&(o.splice(0,l,r),t=o.join("/"))}return(r=e(T.pkgs,t))?r:t}function i(e){E&&y(document.getElementsByTagName("script"),function(t){return t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===_.contextName?(t.parentNode.removeChild(t),!0):void 0})}function r(t){var n=e(T.paths,t);return n&&L(n)&&1<n.length?(n.shift(),_.require.undef(t),_.makeRequire(null,{skipMap:!0})([t]),!0):void 0}function o(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function s(t,i,r,s){var a,u,l=null,c=i?i.name:null,d=t,f=!0,p="";return t||(f=!1,t="_@r"+(P+=1)),t=o(t),l=t[0],t=t[1],l&&(l=n(l,c,s),u=e(B,l)),t&&(l?p=u&&u.normalize?u.normalize(t,function(e){return n(e,c,s)}):-1===t.indexOf("!")?n(t,c,s):t:(p=n(t,c,s),t=o(p),l=t[0],p=t[1],r=!0,a=_.nameToUrl(p))),r=!l||u||r?"":"_unnormalized"+(R+=1),{prefix:l,name:p,parentMap:i,unnormalized:!!r,url:a,originalName:d,isDefine:f,id:(l?l+"!"+p:p)+r}}function a(t){var n=t.id,i=e(M,n);return i||(i=M[n]=new _.Module(t)),i}function u(t,n,i){var r=t.id,o=e(M,r);!x(B,r)||o&&!o.defineEmitComplete?(o=a(t),o.error&&"error"===n?i(o.error):o.on(n,i)):"defined"===n&&i(B[r])}function l(t,n){var i=t.requireModules,r=!1;n?n(t):(y(i,function(n){(n=e(M,n))&&(n.error=t,n.events.error&&(r=!0,n.emit("error",t)))}),r||g.onError(t))}function c(){V.length&&(y(V,function(e){var t=e[0];"string"==typeof t&&(_.defQueueMap[t]=!0),O.push(e)}),V=[])}function d(e){delete M[e],delete I[e]}function f(t,n,i){var r=t.map.id;t.error?t.emit("error",t.error):(n[r]=!0,y(t.depMaps,function(r,o){var s=r.id,a=e(M,s);!a||t.depMatched[o]||i[s]||(e(n,s)?(t.defineDep(o,B[s]),t.check()):f(a,n,i))}),i[r]=!0)}function p(){var e,t,n=(e=1e3*T.waitSeconds)&&_.startTime+e<(new Date).getTime(),o=[],s=[],a=!1,u=!0;if(!b){if(b=!0,D(I,function(e){var l=e.map,c=l.id;if(e.enabled&&(l.isDefine||s.push(e),!e.error))if(!e.inited&&n)r(c)?a=t=!0:(o.push(c),i(c));else if(!e.inited&&e.fetched&&l.isDefine&&(a=!0,!l.prefix))return u=!1}),n&&o.length)return e=F("timeout","Load timeout for modules: "+o,null,o),e.contextName=_.contextName,l(e);u&&y(s,function(e){f(e,{},{})}),n&&!t||!a||!E&&!ja||k||(k=setTimeout(function(){k=0,p()},50)),b=!1}}function h(e){x(B,e[0])||a(s(e[0],null,!0)).init(e[1],e[2])}function m(e){e=e.currentTarget||e.srcElement;var t=_.onScriptLoad;return e.detachEvent&&!ca?e.detachEvent("onreadystatechange",t):e.removeEventListener("load",t,!1),t=_.onScriptError,e.detachEvent&&!ca||e.removeEventListener("error",t,!1),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function v(){var e;for(c();O.length;){if(e=O.shift(),null===e[0])return l(F("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));h(e)}_.defQueueMap={}}var b,w,_,C,k,T={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},M={},I={},q={},O=[],B={},j={},A={},P=1,R=1;return C={require:function(e){return e.require?e.require:e.require=_.makeRequire(e.map)},exports:function(e){return e.usingExports=!0,e.map.isDefine?e.exports?B[e.map.id]=e.exports:e.exports=B[e.map.id]={}:void 0},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){return e(T.config,t.map.id)||{}},exports:t.exports||(t.exports={})}}},w=function(t){this.events=e(q,t.id)||{},this.map=t,this.shim=e(T.shim,t.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},w.prototype={init:function(e,t,n,i){i=i||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=z(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,--this.depCount,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,_.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();_.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],z(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;j[e]||(j[e]=!0,_.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id;t=this.depExports;var i=this.exports,r=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,1>this.depCount&&!this.defined){if(K(r)){if(this.events.error&&this.map.isDefine||g.onError!==ha)try{i=_.execCb(n,r,t,i)}catch(o){e=o}else i=_.execCb(n,r,t,i);if(this.map.isDefine&&void 0===i&&((t=this.module)?i=t.exports:this.usingExports&&(i=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",l(this.error=e)}else i=r;if(this.exports=i,this.map.isDefine&&!this.ignore&&(B[n]=i,g.onResourceLoad)){var s=[];y(this.depMaps,function(e){s.push(e.normalizedMap||e)}),g.onResourceLoad(_,this.map,s)}d(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else x(_.defQueueMap,n)||this.fetch()}},callPlugin:function(){var t=this.map,i=t.id,r=s(t.prefix);this.depMaps.push(r),u(r,"defined",z(this,function(r){var o,c,f=e(A,this.map.id),p=this.map.name,h=this.map.parentMap?this.map.parentMap.name:null,m=_.makeRequire(t.parentMap,{enableBuildCallback:!0});this.map.unnormalized?(r.normalize&&(p=r.normalize(p,function(e){return n(e,h,!0)})||""),c=s(t.prefix+"!"+p,this.map.parentMap),u(c,"defined",z(this,function(e){this.map.normalizedMap=c,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),(r=e(M,c.id))&&(this.depMaps.push(c),this.events.error&&r.on("error",z(this,function(e){this.emit("error",e)})),r.enable())):f?(this.map.url=_.nameToUrl(f),this.load()):(o=z(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),o.error=z(this,function(e){this.inited=!0,this.error=e,e.requireModules=[i],D(M,function(e){0===e.map.id.indexOf(i+"_unnormalized")&&d(e.map.id)}),l(e)}),o.fromText=z(this,function(e,n){var r=t.name,u=s(r),c=S;n&&(e=n),c&&(S=!1),a(u),x(T.config,i)&&(T.config[r]=T.config[i]);try{g.exec(e)}catch(d){return l(F("fromtexteval","fromText eval for "+i+" failed: "+d,d,[i]))}c&&(S=!0),this.depMaps.push(u),_.completeLoad(r),m([r],o)}),r.load(t.name,m,o,T))})),_.enable(r,this),this.pluginMaps[r.id]=r},enable:function(){I[this.map.id]=this,this.enabling=this.enabled=!0,y(this.depMaps,z(this,function(t,n){var i,r;if("string"==typeof t){if(t=s(t,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[n]=t,i=e(C,t.id))return void(this.depExports[n]=i(this));this.depCount+=1,u(t,"defined",z(this,function(e){this.undefed||(this.defineDep(n,e),this.check())})),this.errback?u(t,"error",z(this,this.errback)):this.events.error&&u(t,"error",z(this,function(e){this.emit("error",e)}))}i=t.id,r=M[i],x(C,i)||!r||r.enabled||_.enable(t,this)})),D(this.pluginMaps,z(this,function(t){var n=e(M,t.id);n&&!n.enabled&&_.enable(t,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){y(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},_={config:T,contextName:t,registry:M,defined:B,urlFetched:j,defQueue:O,defQueueMap:{},Module:w,makeModuleMap:s,nextTick:g.nextTick,onError:l,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,n){return(-1===n.indexOf("?")?"?":"&")+t}}var n=T.shim,i={paths:!0,bundles:!0,config:!0,map:!0};D(e,function(e,t){i[t]?(T[t]||(T[t]={}),Y(T[t],e,!0,!0)):T[t]=e}),e.bundles&&D(e.bundles,function(e,t){y(e,function(e){e!==t&&(A[e]=t)})}),e.shim&&(D(e.shim,function(e,t){L(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=_.makeShimExports(e)),n[t]=e}),T.shim=n),e.packages&&y(e.packages,function(e){var t;e="string"==typeof e?{name:e}:e,t=e.name,e.location&&(T.paths[t]=e.location),T.pkgs[t]=e.name+"/"+(e.main||"main").replace(na,"").replace(U,"")}),D(M,function(e,t){e.inited||e.map.unnormalized||(e.map=s(t,null,!0))}),(e.deps||e.callback)&&_.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(ga,arguments)),t||e.exports&&ia(e.exports)}},makeRequire:function(r,o){function u(e,n,i){var c,d;return o.enableBuildCallback&&n&&K(n)&&(n.__requireJsBuild=!0),"string"==typeof e?K(n)?l(F("requireargs","Invalid require call"),i):r&&x(C,e)?C[e](M[r.id]):g.get?g.get(_,e,r,u):(c=s(e,r,!1,!0),c=c.id,x(B,c)?B[c]:l(F("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+t+(r?"":". Use require([])")))):(v(),_.nextTick(function(){v(),d=a(s(null,r)),d.skipMap=o.skipMap,d.init(e,n,i,{enabled:!0}),p()}),u)}return o=o||{},Y(u,{isBrowser:E,toUrl:function(e){var t,i=e.lastIndexOf("."),o=e.split("/")[0];return-1!==i&&("."!==o&&".."!==o||i>1)&&(t=e.substring(i,e.length),e=e.substring(0,i)),_.nameToUrl(n(e,r&&r.id,!0),t,!0)},defined:function(e){return x(B,s(e,r,!1,!0).id)},specified:function(e){return e=s(e,r,!1,!0).id,x(B,e)||x(M,e)}}),r||(u.undef=function(t){c();var n=s(t,r,!0),o=e(M,t);o.undefed=!0,i(t),delete B[t],delete j[n.url],delete q[t],X(O,function(e,n){e[0]===t&&O.splice(n,1)}),delete _.defQueueMap[t],o&&(o.events.defined&&(q[t]=o.events),d(t))}),u},enable:function(t){e(M,t.id)&&a(t).enable()},completeLoad:function(t){var n,i,o=e(T.shim,t)||{},s=o.exports;for(c();O.length;){if(i=O.shift(),null===i[0]){if(i[0]=t,n)break;n=!0}else i[0]===t&&(n=!0);h(i)}if(_.defQueueMap={},i=e(M,t),!n&&!x(B,t)&&i&&!i.inited){if(!(!T.enforceDefine||s&&ia(s)))return r(t)?void 0:l(F("nodefine","No define call for "+t,null,[t]));h([t,o.deps||[],o.exportsFn])}p()},nameToUrl:function(t,n,i){var r,o,s,a;if((r=e(T.pkgs,t))&&(t=r),r=e(A,t))return _.nameToUrl(r,n,i);if(g.jsExtRegExp.test(t))r=t+(n||"");else{for(r=T.paths,o=t.split("/"),s=o.length;s>0;--s)if(a=o.slice(0,s).join("/"),a=e(r,a)){L(a)&&(a=a[0]),o.splice(0,s,a);break}r=o.join("/"),r+=n||(/^data\:|^blob\:|\?/.test(r)||i?"":".js"),r=("/"===r.charAt(0)||r.match(/^[\w\+\.\-]+:/)?"":T.baseUrl)+r}return T.urlArgs&&!/^blob\:/.test(r)?r+T.urlArgs(t,r):r},load:function(e,t){g.load(_,e,t)},execCb:function(e,t,n,i){return t.apply(i,n)},onScriptLoad:function(e){("load"===e.type||oa.test((e.currentTarget||e.srcElement).readyState))&&(N=null,e=m(e),_.completeLoad(e.id))},onScriptError:function(e){var t=m(e);if(!r(t.id)){var n=[];return D(M,function(e,i){0!==i.indexOf("_@r")&&y(e.depMaps,function(e){return e.id===t.id?(n.push(i),!0):void 0})}),l(F("scripterror",'Script error for "'+t.id+(n.length?'", needed by: '+n.join(", "):'"'),e,[t.id]))}}},_.require=_.makeRequire(),_}function pa(){return N&&"interactive"===N.readyState?N:(X(document.getElementsByTagName("script"),function(e){return"interactive"===e.readyState?N=e:void 0}),N)}var g,B,C,H,O,I,N,P,u,T,qa=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,ra=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,U=/\.js$/,na=/^\.\//;B=Object.prototype;var Q=B.toString,la=B.hasOwnProperty,E=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),ja=!E&&"undefined"!=typeof importScripts,oa=E&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,ca="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),J={},w={},V=[],S=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(K(requirejs))return;w=requirejs,requirejs=void 0}"undefined"==typeof require||K(require)||(w=require,require=void 0),g=requirejs=function(t,n,i,r){var o,s="_";return L(t)||"string"==typeof t||(o=t,L(n)?(t=n,n=i,i=r):t=[]),o&&o.context&&(s=o.context),(r=e(J,s))||(r=J[s]=g.s.newContext(s)),o&&r.configure(o),r.require(t,n,i)},g.config=function(e){return g(e)},g.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=g),g.version="2.2.0",g.jsExtRegExp=/^\/|:|\?|\.js$/,g.isBrowser=E,B=g.s={contexts:J,newContext:ma},g({}),y(["toUrl","undef","defined","specified"],function(e){g[e]=function(){var t=J._;return t.require[e].apply(t,arguments)}}),E&&(C=B.head=document.getElementsByTagName("head")[0],H=document.getElementsByTagName("base")[0])&&(C=B.head=H.parentNode),g.onError=ha,g.createNode=function(e,t,n){return t=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),t.type=e.scriptType||"text/javascript",t.charset="utf-8",t.async=!0,t},g.load=function(e,t,n){var i,r=e&&e.config||{};if(E)return i=g.createNode(r,t,n),i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),!i.attachEvent||i.attachEvent.toString&&0>i.attachEvent.toString().indexOf("[native code")||ca?(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)):(S=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)),i.src=n,r.onNodeCreated&&r.onNodeCreated(i,r,t,n),P=i,H?C.insertBefore(i,H):C.appendChild(i),P=null,i;if(ja)try{setTimeout(function(){},0),importScripts(n),e.completeLoad(t)}catch(o){e.onError(F("importscripts","importScripts failed for "+t+" at "+n,o,[t]))}},E&&!w.skipDataMain&&X(document.getElementsByTagName("script"),function(e){return C||(C=e.parentNode),(O=e.getAttribute("data-main"))?(u=O,w.baseUrl||-1!==u.indexOf("!")||(I=u.split("/"),u=I.pop(),T=I.length?I.join("/")+"/":"./",w.baseUrl=T),u=u.replace(U,""),g.jsExtRegExp.test(u)&&(u=O),w.deps=w.deps?w.deps.concat(u):[u],!0):void 0}),define=function(e,t,n){var i,r;"string"!=typeof e&&(n=t,t=e,e=null),L(t)||(n=t,t=null),!t&&K(n)&&(t=[],n.length&&(n.toString().replace(qa,ka).replace(ra,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),S&&(i=P||pa())&&(e||(e=i.getAttribute("data-requiremodule")),r=J[i.getAttribute("data-requirecontext")]),r?(r.defQueue.push([e,t,n]),r.defQueueMap[e]=!0):V.push([e,t,n])},define.amd={jQuery:!0},g.exec=function(b){return eval(b)},g(w)}}(this),define("text",["module"],function(e){"use strict";var t,n,i,r,o,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,c=l&&location.protocol&&location.protocol.replace(/\:/,""),d=l&&location.hostname,f=l&&(location.port||void 0),p={},h=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:h.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(i){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,i,r=!1,o=e.lastIndexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!s||o>1)?(t=e.substring(0,o),n=e.substring(o+1)):t=e,i=n||t,o=i.indexOf("!"),-1!==o&&(r="strip"===i.substring(o+1),i=i.substring(0,o),n?n=i:t=i),{moduleName:t,ext:n,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,r){var o,s,a,u=t.xdRegExp.exec(e);return u?(o=u[2],s=u[3],s=s.split(":"),a=s[1],s=s[0],!(o&&o!==n||s&&s.toLowerCase()!==i.toLowerCase()||(a||s)&&a!==r)):!0},finishLoad:function(e,n,i,r){i=n?t.strip(i):i,h.isBuild&&(p[e]=i),r(i)},load:function(e,n,i,r){if(r&&r.isBuild&&!r.inlineText)return void i();h.isBuild=r&&r.isBuild;var o=t.parseName(e),s=o.moduleName+(o.ext?"."+o.ext:""),a=n.toUrl(s),u=h.useXhr||t.useXhr;return 0===a.indexOf("empty:")?void i():void(!l||u(a,c,d,f)?t.get(a,function(n){t.finishLoad(e,o.strip,n,i)},function(e){i.error&&i.error(e)}):n([s],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,i)}))},write:function(e,n,i,r){if(p.hasOwnProperty(n)){var o=t.jsEscape(p[n]);i.asModule(e+"!"+n,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,n,i,r,o){var s=t.parseName(n),a=s.ext?"."+s.ext:"",u=s.moduleName+a,l=i.toUrl(s.moduleName+a)+".js";t.load(u,i,function(n){var i=function(e){return r(l,e)};i.asModule=function(e,t){return r.asModule(e,l,t)},t.write(e,u,i,o)},o)}},"node"===h.env||!h.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var r=n.readFileSync(e,"utf8");"\ufeff"===r[0]&&(r=r.substring(1)),t(r)}catch(o){i&&i(o)}}):"xhr"===h.env||!h.env&&t.createXhr()?t.get=function(e,n,i,r){var o,s=t.createXhr();if(s.open("GET",e,!0),r)for(o in r)r.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),r[o]);h.onXhr&&h.onXhr(s,e),s.onreadystatechange=function(t){var r,o;4===s.readyState&&(r=s.status||0,r>399&&600>r?(o=new Error(e+" HTTP status: "+r),o.xhr=s,i&&i(o)):n(s.responseText),h.onXhrComplete&&h.onXhrComplete(s,e))},s.send(null)}:"rhino"===h.env||!h.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,r="utf-8",o=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),r)),u="";try{for(n=new java.lang.StringBuffer,i=a.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=a.readLine());)n.append(s),n.append(i);u=String(n.toString())}finally{a.close()}t(u)}:("xpconnect"===h.env||!h.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,r=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,s,a,u={};o&&(e=e.replace(/\//g,"\\")),a=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),n.init(a,1,0,!1),s=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),s.init(n,"utf-8",n.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),u),s.close(),n.close(),t(u.value)}catch(l){throw new Error((a&&a.path||"")+": "+l)}}),t}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>n.length)&&(t=n.length),t-=e.length;var i=n.indexOf(e,t);return-1!==i&&i===t}),jQuery.fn.outerHTML=function(e){var t;return this.length?e?(jQuery.each(this,function(t,n){var i,r=n,o=n.outerHTML?"outerHTML":"innerHTML";n.outerHTML||(n=jQuery(n).wrap("<div>").parent()[0]),jQuery.isFunction(e)?(i=e.call(r,t,n[o]))!==!1&&(n[o]=i):n[o]=e,n.outerHTML||jQuery(n).children().unwrap()}),this):this[0].outerHTML||(t=this.wrap("<div>").parent().html(),this.unwrap(),t):"undefined"==typeof e?this:null},Oskari=function(){function e(e,t){var n=g[f];return n?n(e,t):h?h+e:e}function t(){return!m[f]}function n(){return v}function i(e){return e+"/build/"+f+".js"}function r(e){return e+"/build/"+f+"-locale-"+c.getLang()+".js"}var o="1.36.0",s=!1,a=window.console&&window.console.debug,u=function(e){s&&a&&window.console.debug(e)},l=function(){this.lang=null,this.localizations={},this.supportedLocales=null};l.prototype={getLocalization:function(e,t,n){var i=t||this.lang;if(null===e||void 0===e)throw new TypeError("getLocalization(): Missing key");return this.localizations?this.localizations[i]&&this.localizations[i][e]?this.localizations[i][e]:n&&this.localizations[Oskari.getDefaultLanguage()]&&this.localizations[Oskari.getDefaultLanguage()][e]?this.localizations[Oskari.getDefaultLanguage()][e]:null:null},setLocalization:function(e,t,n){if(null===e||void 0===e)throw new TypeError("setLocalization(): Missing lang");if(null===t||void 0===t)throw new TypeError("setLocalization(): Missing key");this.localizations[e]||(this.localizations[e]={}),this.localizations[e][t]=n},getLang:function(){return this.lang},setLang:function(e){if(null===e||void 0===e)throw new TypeError("setLang(): Missing lang");this.lang=e},getDecimalSeparator:function(){var e=this,t=e.getLang(),n=e.getSupportedLocales().filter(function(e){return 0===e.indexOf(t)}),i=n.map(function(t){return e.getDecimalSeparators()[t]});return i.length>1&&console&&console.warn&&console.warn("Found more than one separator for "+this.getLang()),i.length&&i[0]?i[0]:","},getDecimalSeparators:function(){return this.decimalSeparators},setDecimalSeparators:function(e){this.decimalSeparators=e},getSupportedLanguages:function(){var e,t,n=[],i=this.getSupportedLocales();for(t=0;t<i.length;t+=1)e=i[t],n.push(e.substring(0,e.indexOf("_")));return n},getSupportedLocales:function(){return this.supportedLocales||[]},setSupportedLocales:function(e){if(null===e||void 0===e)throw new TypeError("setSupportedLocales(): Missing locales");if(!Array.isArray(e))throw new TypeError("setSupportedLocales(): locales is not an array");this.supportedLocales=e},getDefaultLanguage:function(){var e=this.getSupportedLocales();if(0===e.length)return console&&console.warn&&console.warn("Supported locales not set, using current language "+this.getLang()),this.getLang();var t=e[0];return-1!==t.indexOf("_")?t.substring(0,t.indexOf("_")):this.getLang()}};var c=new l,d=!1,f="default",p=(new Date).getTime(),h=null,g={"default":function(e,t){return h?h+e:e},dev:function(e,t){return h?h+e:e}},m={dev:!0,"default":!0,"static":!0},v=!1,y=function(){this.packages={},this.protocols={},this.inheritance={},this.aspects={},this.classcache={},this.globals={}};y.prototype={purge:function(){},protocol:function(e){if(null===e||void 0===e)throw new TypeError("protocol(): Missing protocolName");return this.protocols[e]},_getPackageDefinition:function(e){var t=this.packages[e];return t||(t={},this.packages[e]=t),t},_getClassQName:function(e){var t=e.split(".");return{basePkg:t[0],pkg:t[1],sp:t.slice(2).join(".")}},_getClassInfo:function(e){var t,n=this.classcache[e],i=this._getClassQName(e);return n||(t=this._getPackageDefinition(i.pkg),n=t[i.sp],this.classcache[e]=n),n},_cloneProperties:function(e,t){var n,i,r,o=Array.isArray(t)?t:[t];for(i in e)if(e.hasOwnProperty(i))for(r=e[i],n=o.length-1;n>=0;n-=1)o[n][i]=r},_createEmptyClassDefinition:function(){var e=function(){};return e.prototype={},e},getMetadata:function(e){var t;if(null===e||void 0===e)throw new TypeError("metadata(): Missing className");if(t=this._getClassInfo(e),!t)throw"Class "+e+" does not exist";return t._metadata},_updateMetadata:function(e,t,n,i,r){var o,s,a,u;if(i._metadata||(i._metadata={}),i._metadata.meta=r,u=[e,t,n].join("."),o=r.protocol)for(s=0;s<o.length;s+=1)a=o[s],this.protocols[a]||(this.protocols[a]={}),this.protocols[a][u]=i},_super:function(e,t){var n=this;return function(){return n._._superCategory[e][t].apply(n,arguments)}},define:function(e,t,n,i){var r,o,s,a,u,l,c,d;if(null===e||void 0===e)throw new TypeError("define(): Missing className");if("function"!=typeof t)throw new TypeError("define(): classConstructor is not a function");if(n&&"object"!=typeof n)throw new TypeError("define(): Prototype is not an object");if(o=this._getClassQName(e),a=this._getPackageDefinition(o.pkg),u=a[o.sp],u||(r=this._createEmptyClassDefinition(),s={className:e,superClass:null,subClass:null},u={_class:r,_constructor:t,_category:{},_composition:s},r.prototype._=u,r.prototype._super=this._super,this.inheritance[e]=s,a[o.sp]=u),t&&(u._constructor=t),n&&(this._cloneProperties(n,u._class.prototype),u._category[e]=n),i){for(c=i.extend,l=0;c&&l<c.length;l+=1)d=this.lookup(c[l]),d._composition.subClass||(d._composition.subClass={}),d._composition.subClass[e]=u,u._composition.superClass=d;this._updateMetadata(o.basePkg,o.pkg,o.sp,u,i)}return this._pullDown(u),this._pushDown(u),u},category:function(e,t,n){var i,r,o,s,a,u;if(null===e||void 0===e)throw new TypeError("category(): Missing className");return o=this._getClassQName(e),a=this._getPackageDefinition(o.pkg),r=a[o.sp],r||(i=this._createEmptyClassDefinition(),s={className:e,superClass:null,subClass:null},r={_class:i,_constructor:t,_category:{},_composition:s},i.prototype._=r,i.prototype._super=this._super,this.inheritance[e]=s,a[o.sp]=r),u=r._class.prototype,this._cloneProperties(n,u),n&&(r._category[t]=n),this._pullDown(r),this._pushDown(r),r},lookup:function(e,t){var n,i,r,o,s;if(null===e||void 0===e)throw new TypeError("lookup(): Missing className");return i=this._getClassQName(e),o=this._getPackageDefinition(i.pkg),s=o[i.sp],s||(n=this._createEmptyClassDefinition(),r={className:e,superClass:null,subClass:null},s={_class:n,_constructor:t,_category:{},_composition:r},this.inheritance[e]=r,o[i.sp]=s),s},extend:function(e,t){var n,i;if(null===e||void 0===e)throw new TypeError("extend(): Missing subClassName");if(null===t||void 0===t)throw new TypeError("extend(): Missing superClassName");return n=this.lookup(t),i=this.lookup(e),n._composition.subClass||(n._composition.subClass={}),n._composition.subClass[e]=i,i._composition.superClass=n,this._pullDown(i),i},_pushDown:function(e){var t,n;if(null===e||void 0===e)throw new TypeError("_pushDown(): Missing classInfo");if(e._composition.subClass){for(t in e._composition.subClass)e._composition.subClass.hasOwnProperty(t)&&(n=e._composition.subClass[t],this._pullDown(n),this._pushDown(n));return e}},_pullDown:function(e){var t,n,i,r,o,s,a,u,l,c;if(null===e||void 0===e)throw new TypeError("_pullDown(): Missing classInfo");if(e._composition.superClass){for(r=[],r.push(e),c=e;;){if(c=c._composition.superClass,!c)break;r.push(c)}for(e._constructors=[],e._superCategory={},u=e._class.prototype,t=r.length-1;t>=0;t-=1){i=r[t],o=i._composition.className,s=i._constructor,e._constructors.push(s),a={};for(n in i._category)i._category.hasOwnProperty(n)&&(l=i._category[n],this._cloneProperties(l,[u,a]));e._superCategory[o]=a}return e}},_slicer:Array.prototype.slice,create:function(e){var t,n,i,r,o;if(null===e||void 0===e)throw new TypeError("create(): Missing className");if(o=this._slicer.apply(arguments,[1]),t=this._getClassInfo(e),!t)throw'Class "'+e+'" does not exist';if(n=new t._class,i=t._constructors)for(r=0;r<i.length;r+=1){if(null===i[r]||void 0===i[r])throw new Error("Class "+e+" is missing super constructor "+(r+1)+"/"+i.length);var s=i[r].apply(n,o);s&&(n=s)}else{var s=t._constructor.apply(n,o);s&&(n=s)}return n},createWithClassInfo:function(e,t){var n,i,r;if(null===e||void 0===e)throw new TypeError("createWithClassInfo(): Missing classInfo");if(n=new e._class,i=e._constructors)for(r=0;r<i.length;r+=1){if(null===i[r]||void 0===i[r])throw new Error('createWithClassInfo(): Undefined constructor in class "'+e._composition.className+'"');i[r].apply(n,t)}else e._constructor.apply(n,t);return n},builder:function(e){var t;if(null===e||void 0===e)throw new TypeError("builder(): Missing className");if(t=this._getClassInfo(e),!t)throw'Class "'+e+'" does not exist';return this.getBuilderFromClassInfo(t)},getBuilderFromClassInfo:function(e){if(null===e||void 0===e)throw new TypeError("getBuilderFromClassInfo(): Missing classInfo");return e._builder?e._builder:(e._builder=function(){var t,n=new e._class,i=e._constructors,r=arguments;if(i)for(t=0;t<i.length;t+=1)i[t].apply(n,r);else e._constructor.apply(n,r);return n},e._builder)},_global:function(e,t){return void 0===e?this.globals:(void 0!==t&&(this.globals[e]=t),this.globals[e])}};var b=new y,w=b,_=0,S=function(e,t){_+=1,this.loader_identifier=_,this.manager=e,this.callback=t,this.filesRequested=0,this.filesLoaded=0,this.files=[],this.fileList=[],this.metadata={}};S.prototype={add:function(e,t){var n,i=this,r=i.files.filter(function(t){return t.fn===e});0==r.length&&(n={src:e,type:t&&t.type?t.type:"text/javascript",id:t?t.id:null,state:!1},i.files.push({fn:e,def:n}),"text/javascript"===n.type&&(i.filesRequested+=1),i.fileList.push(n))},getState:function(){return 0===this.filesRequested?1:this.filesLoaded/this.filesRequested},commit:function(){var e,t,i,r,o=document.createDocumentFragment(),s=this,a=s.filesRequested;return void 0===s.head&&(s.head=document.head),0===a||n()?(s.callback(),void s.manager.notifyLoaderStateChanged(s,!0)):(e=function(){s.filesLoaded+=1,s.manager.log("Files loaded "+s.filesLoaded+"/"+s.filesRequested),a===s.filesLoaded?(s.callback(),s.manager.notifyLoaderStateChanged(s,!0)):s.manager.notifyLoaderStateChanged(s,!1)},t=!1,s.fileList.forEach(function(a){i=a.src,r=s._buildScriptTag(i,e,a.type,a.id),r&&(n()?e():(o.appendChild(r),t=!0))}),void(t&&s.head.appendChild(o)))},_buildScriptTag:function(e,t,i,r){var o=document.createElement("script");return r&&(o.id=r),o.type=i,o.charset="utf-8",n()?o.src="/Oskari/empty.js":o.src=e,o.readyState?o.onreadystatechange=function(){"loaded"!==o.readyState&&"complete"!==o.readyState||(o.onreadystatechange=null,t())}:o.onload=t,o}};var x=function(e){var t;this.manager=null;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])};x.prototype={setState:function(e){return this.state=e,this.manager.postChange(this.bundle,this.instance,this.state),this.state},getState:function(){return this.state}};var E=function(e,t,n){this.config=e,this.callback=t,this.fired=!1,this.info=n};E.prototype={execute:function(e,t,n,i){var r,o,s,a=this;if(!a.fired){for(r in a.config["Import-Bundle"])if(a.config["Import-Bundle"].hasOwnProperty(r)&&(o=e.bundleSourceStates[r],!o||1!==o.state))return void e.log("Trigger not fired due "+r+" for "+i||this.info);a.fired=!0,e.log("Posting trigger"),s=this.callback,window.setTimeout(function(){s(e)},0)}}};var C=function(){var e=this;e.serial=0,e.bundleDefinitions={},e.sources={},e.bundleInstances={},e.bundles={},e.bundleDefinitionStates={},e.bundleSourceStates={},e.bundleStates={},e.triggers=[],e.loaderStateListeners=[]};C.prototype={_getSerial:function(){return this.serial+=1,this.serial},_purge:function(){var e,t=this;for(e in t.sources)t.sources.hasOwnProperty(e)&&delete t.sources[e];for(e in t.bundleDefinitionStates)t.bundleDefinitionStates.hasOwnProperty(e)&&delete t.bundleDefinitionStates[e].loader;for(e in t.bundleSourceStates)t.bundleSourceStates.hasOwnProperty(e)&&delete t.bundleSourceStates[e].loader},notifyLoaderStateChanged:function(e,t){var n,i;if(0!==this.loaderStateListeners.length)for(n=0;n<this.loaderStateListeners.length;n+=1)(i=this.loaderStateListeners[n])(e,t);
},registerLoaderStateListener:function(e){this.loaderStateListeners.push(e)},alert:function(e){u(e)},log:function(e){u(e)},_loadCss:function(e,t){this.log("Loading CSS "+e);var i,r,o,s=document.head||document.body;n()||(document.all&&!window.atob?(o=new XMLHttpRequest,o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE){if(200!==o.status)throw new Error(o.statusText);i=document.getElementById("concatenated"),i||(i=document.createElement("style"),i.setAttribute("type","text/css"),i.id="concatenated",s.appendChild(i)),i.styleSheet.cssText+=o.response}},o.open("GET",e,!0),o.responseType="text",o.send()):(r=document.createElement("link"),r.type="text/css",r.rel="stylesheet",r.href=e,s.appendChild(r)))},_loadLink:function(e,t){this.log("Loading link "+e+": "+t);var n,i=document.head||document.body;n=document.createElement("link"),n.rel=e,n.href=t,i.appendChild(n)},_self:function(){return this},_install:function(e,t,n,i){var r,o=this,s=o.bundleDefinitionStates[e];s?(s.state=1,o.log("SETTING STATE FOR BUNDLEDEF "+e+" existing state to "+s.state)):(s={state:1},o.bundleDefinitionStates[e]=s,o.log("SETTING STATE FOR BUNDLEDEF "+e+" NEW state to "+s.state)),s.metadata=i,o.bundleDefinitions[e]=t,o.sources[e]=n,r=o.bundleSourceStates[e],r&&(-1===r.state?(o.log("Triggering loadBundleSources for "+e+" at loadBundleDefinition"),window.setTimeout(function(){o.loadBundleSources(e)},0)):o.log("Source state for "+e+" at loadBundleDefinition is "+r.state)),o.postChange(null,null,"bundle_definition_loaded")},installBundleClass:function(e,t){var n=Oskari.clazz.create(t);n&&(Oskari.bundle(e,{clazz:n,metadata:w.getMetadata(t).meta}),this.installBundleClassOld(e,t))},installBundleClassOld:function(e,t){var n=w.getMetadata(t),i=w.builder(t),r=n.meta.source,o=n.meta.bundle;this._install(e,i,r,o)},installBundleClassInfo:function(e,t){var n=w.getBuilderFromClassInfo(t),i=t._metadata,r={};if(null===e||void 0===e)throw new TypeError("installBundleClassInfo(): Missing biid");if(null===t||void 0===t)throw new TypeError("installBundleClassInfo(): Missing classInfo");this._install(e,n,r,i)},loadBundleDefinition:function(e,t,n){var i,r,o=this,s=o.bundleDefinitionStates[e];return o.log("loadBundleDefinition called with "+e),s?1===s.state?(o.log("Bundle definition already loaded for "+e),void o.postChange(null,null,"bundle_definition_loaded")):void o.log("Bundle definition already loaded OR WHAT?"+e+" "+s.state):(s={state:-1},o.bundleDefinitionStates[e]=s,o.log("Set NEW state for DEFINITION "+e+" to "+s.state),s.bundleSrcPath=t,i=n||t.substring(0,t.lastIndexOf("/")),s.bundlePath=i,r=new S(this,function(){o.log("bundle_def_loaded_callback")}),r.metadata.context="bundleDefinition",s.loader=r,r.add(t),void r.commit())},_handleSourceFiles:function(n,i,r){var o,s,a;r=r||{},r.links&&Array.prototype.push.apply(n.links,r.links),Object.keys(r).forEach(function(u){if("scripts"===u||"locales"===u)for(a=0;a<r[u].length;a+=1)if(l=r[u][a],"text/css"===l.type)o=l.src,s=o,-1===o.indexOf("http")&&(s=i+"/"+o),n.css[s]=l;else if(l.type&&(n.count+=1,o=e(l.src,i),s=o,-1===o.indexOf("http")&&(s=i+"/"+o),"locales"!==u||t()||void 0===l.lang||Oskari.getLang()===l.lang)){var l={p:u,n:a,def:r[u][a]};n.files.push({fn:s,def:l})}})},_feedCSSLoader:function(t,n,i,r){var o,s,a;for(a in r.css)r.css.hasOwnProperty(a)&&(s=a,o=e(s,i),this._loadCss(o,t),this.log("- added css source "+o+" for "+n))},_feedLinkLoader:function(t,i,r){var o=this;!n()&&r.links&&r.links.forEach(function(n){var r=e(n.href,i);o._loadLink(n.rel,r),o.log("- added link source "+r+", for: "+t)})},_feedBundleLoader:function(e,n,o,s,a){var u,l,c,d,f,p=this;u=new S(p,e),u.metadata.context="bundleSources",u.metadata.bundleImpl=n,a.loader=u,t()?(l=s.files.length,l>0&&(d=i(o),u.add(d,"text/javascript"),p.log("- added PACKED javascript source "+d+" for "+n),f=r(o),u.add(f,"text/javascript"),p.log("- added PACKED locale javascript source "+f+" for "+n))):s.files.forEach(function(e){u.add(e.fn,e.def),p.log("- added script source "+c+" for "+n)}),u.commit()},loadBundleSources:function(e){var t,i,r,o,s,a,u=this;if(u.log("loadBundleSources called with "+e),null===e||void 0===e)throw new TypeError("loadBundleSources(): Missing biid");if(t=u.bundleDefinitionStates[e],!t)throw new Error("loadBundleSources(): INVALID_STATE: bundle definition load not requested for "+e);if(u.log("- definition STATE for "+e+" at load sources "+t.state),"static"===f)return void u.postChange(null,null,"bundle_definition_loaded");if(r=u.bundleSourceStates[e]){if(1===r.state)return void u.log("Already loaded sources for : "+e);if(-1!==r.state)throw new Error("loadBundleSources(): INVALID_STATE: at "+e);u.log("Loading previously pending sources for "+e+" "+r.state+" or what?")}else r={state:-1},u.bundleSourceStates[e]=r,u.log("Setting STATE for sources "+e+" to "+r.state);return i={count:0,loaded:0,files:[],css:{},links:[]},a=u.sources[e],s=t.bundlePath,u._handleSourceFiles(i,s,a),n()&&"statsgrid"===e,1!==t.state?void u.log("Pending DEFINITION at sources for "+e+" to "+t.state+" -> postponed"):(u.log("STARTING load for sources "+e),o=function(){u.log("Finished loading "+i.count+" files for "+e+"."),u.bundleSourceStates[e].state=1,u.log("Set NEW state post source load for "+e+" to "+u.bundleSourceStates[e].state),u.postChange(null,null,"bundle_sources_loaded")},u._feedCSSLoader(o,e,s,i),u._feedLinkLoader(e,s,i),void u._feedBundleLoader(o,e,s,i,r))},postChange:function(e,t,n){var i,r,o,s=this;if(null===n||void 0===n)throw new TypeError("postChange(): Missing info");s._update(e,t,n);for(i in s.bundles)s.bundles.hasOwnProperty(i)&&(o=s.bundles[i],o.update(s,e,t,n));for(i in s.bundleInstances)s.bundleInstances.hasOwnProperty(i)&&(r=s.bundleInstances[i],r&&r.update(s,e,t,n))},createBundle:function(e,t){var n,i,r,o=this;if(null===e||void 0===e)throw new TypeError("createBundle(): Missing biid");if(null===t||void 0===t)throw new TypeError("createBundle(): Missing bid");if(r=o.bundleDefinitionStates[e],!r)throw new Error("createBundle(): Couldn't find a definition for bundle "+e+"/"+t+", check spelling and that the bundle has been installed.");return(i=this.bundleDefinitions[e])?(n=i(r),this.bundles[t]=n,this.bundleStates[t]={state:!0,bundlImpl:e},this.postChange(n,null,"bundle_created"),n):void alert("this.bundleDefinitions["+e+"] is null!")},_update:function(e,t,n){var i,r,o=this;for(o.log("Update called with info "+n),i=0;i<o.triggers.length;i+=1)r=o.triggers[i],r.execute(o)},createInstance:function(e){var t,n,i,r=this;if(null===e||void 0===e)throw new TypeError("createInstance(): Missing bid");if(!r.bundleStates[e]||!r.bundleStates[e].state)throw new Error("createInstance(): Couldn't find a definition for bundle "+e+", check spelling and that the bundle has been installed.");if(t=this.bundles[e],null===t||void 0===t)throw new Error("createInstance(): Couldn't find bundle with id"+e);if(n=t.create(),null===n||void 0===n)throw new Error("createInstance(): Couldn't create bundle "+e+" instance. Make sure your bundle's create function returns the instance.");return i=r._getSerial().toString(),n.mediator=new x({bundleId:e,instanceid:i,state:"initial",bundle:t,instance:n,manager:this,clazz:b,requestMediator:{}}),this.bundleInstances[i]=n,this.postChange(t,n,"instance_created"),n},_destroyInstance:function(e){var t,n;if(null===e||void 0===e)throw new TypeError("_destroyInstance(): Missing biid");return t=this.bundleInstances[e],n=t.mediator,n.bundle=null,n.manager=null,n.clazz=null,t.mediator=null,this.bundleInstances[e]=null,t=null},on:function(e,t,n){this.triggers.push(new E(e,t,n))}};var k=function(e){this.manager=e,this.bundles={},this.bundleInstances={},this.bundlePath="../src/mapframework/bundle/",this.appSetup=null,this.appConfig={}};k.prototype={getBundleInstanceByName:function(e){return this.bundleInstances[e]},getBundleInstanceConfigurationByName:function(e){return this.appConfig[e]},setBundlePath:function(e){this.bundlePath=e},playBundle:function(e,t,n){if("object"!=typeof e)throw new Error("Bundle def is not an object");if("function"==typeof t&&(n=t,t=void 0),t){var i=e.bundleinstancename||e.bundlename,r={};r[i]=t,t=r}else t=this.appConfig;var o=Oskari.loader([e],t);o.processSequence(n)},setApplicationSetup:function(e){this.appSetup=e},getApplicationSetup:function(){return this.appSetup},setConfiguration:function(e){this.appConfig=e},getConfiguration:function(){return this.appConfig},startApplication:function(e){var t=Oskari.loader(this.appSetup.startupSequence,this.appConfig);t.processSequence(e)},stopApplication:function(){throw"NYI"}};var L=new C;L.clazz=w;var T=new k(L),M=w._global;w.define("Oskari.DomManager",function(e){this.$=e},{getEl:function(e){return this.$(e)},getElForPart:function(e){throw"N/A"},setElForPart:function(e,t){throw"N/A"},setElParts:function(e){throw"N/A"},getElParts:function(){throw"N/A"},pushLayout:function(e){throw"N/A"},popLayout:function(e){throw"N/A"},getLayout:function(){throw"N/A"}});var N=w.create("Oskari.DomManager",jQuery);T.bundle_dom_manager=N;var D={bundle_manager:L,bundle_facade:T,bundle_locale:c,app:T,clazz:w,VERSION:o,markers:[],$:function(){return M.apply(w,arguments)},setLoaderMode:function(e){if("string"!=typeof e)throw new TypeError("setLoaderMode(): m is not a string");f=e},getLoaderMode:function(){return f},setDebugMode:function(e){if("boolean"!=typeof e)throw new TypeError("setDebugMode(): d is not a boolean");s=e},setSupportBundleAsync:function(e){if("boolean"!=typeof e)throw new TypeError("setSupportBundleAsync(): sba is not a boolean");d=e},getSupportBundleAsync:function(){return d},setBundleBasePath:function(e){if("string"!=typeof e)throw new TypeError("setBundleBasePath(): bp is not a string");h=e},getBundleBasePath:function(){return h},setPreloaded:function(e){if("boolean"!=typeof e)throw new TypeError("setPreloaded(): usep is not a boolean");v=e},setInstTs:function(e){p=e},registerLocalization:function(e,t){var n,i,r;if(null===e||void 0===e)throw new TypeError("registerLocalization(): Missing props");if(e.length)for(n=0;n<e.length;n+=1)i=e[n],t&&t===!0?(i.key&&i.lang&&(r=Oskari.getLocalization(i.key,i.lang)),r&&null!==r&&(i.value=jQuery.extend(!0,{},r,i.value))):(i.key&&i.lang&&(r=Oskari.getLocalization(i.key,i.lang)),r&&null!==r&&(i.value=jQuery.extend(!0,{},i.value,r))),c.setLocalization(i.lang,i.key,i.value);else t&&t===!0?(e.key&&e.lang&&(r=Oskari.getLocalization(e.key,e.lang)),r&&null!==r&&(e.value=jQuery.extend(!0,{},r,e.value))):(e.key&&e.lang&&(r=Oskari.getLocalization(e.key,e.lang)),r&&null!==r&&(e.value=jQuery.extend(!0,{},e.value,r))),c.setLocalization(e.lang,e.key,e.value)},getLocalization:function(e,t,n){return c.getLocalization(e,t,n)},getLang:function(){return c.getLang()},setLang:function(e){return c.setLang(e)},setSupportedLocales:function(e){return c.setSupportedLocales(e)},getSupportedLocales:function(){return c.getSupportedLocales()},getDefaultLanguage:function(){return c.getDefaultLanguage()},getSupportedLanguages:function(){return c.getSupportedLanguages()},getDecimalSeparator:function(){return c.getDecimalSeparator()},setDecimalSeparators:function(e){return c.setDecimalSeparators(e)},purge:function(){L.purge(),w.purge("Oskari")},getDomManager:function(){return N},setDomManager:function(e){N=e},getSandbox:function(e){return M.apply(w,[e||"sandbox"])},setSandbox:function(e,t){return M.apply(w,[e||"sandbox",t])},setMarkers:function(e){this.markers=e},getMarkers:function(){return this.markers||[]}},I=function(){var e={};return{get:function(t){return e[t]?e[t]+=1:e[t]=1,e[t]}}}();w.define("Oskari.ModuleSpec",function(e,t){this.cs=w,this.classInfo=e,this.className=t},{_slicer:Array.prototype.slice,category:function(e,t){var n=w.category(this.className,t||["__",I.get("Category")].join("_"),e);return this.classInfo=n,this},methods:function(e,t){var n=w.category(this.className,t||["__",I.get("Category")].join("_"),e);return this.classInfo=n,this},extend:function(e){var t;if(null===e||void 0===e)throw new TypeError("extend(): Missing clazz");return t=w.extend(this.className,e.length?e:[e]),this.classInfo=t,this},create:function(){return w.createWithClassInfo(this.classInfo,arguments)},name:function(){return this.className},metadata:function(){return w.getMetadata(this.className)},events:function(e){var t=this;return t.category({eventHandlers:e,onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])}},"___events"),t},requests:function(e){var t=this;return t.category({requestHandlers:e,onRequest:function(e){var t=this.requestHandlers[e.getName()];return t?t.apply(this,[e]):void 0}},"___requests"),t},builder:function(){return w.getBuilderFromClassInfo(this.classInfo)}});var q=D;return q.cls=function(e,t,n,i){var r;return e?r=w.lookup(e):e=["Oskari","_",I.get("Class")].join("."),r&&r._constructor&&!t||(r=w.define(e,t||function(){},n,i||{})),w.create("Oskari.ModuleSpec",r,e)},q.loc=function(){return this.registerLocalization.apply(q,arguments)},q.eventCls=function(e,t,n){var i,r;if(null===e||void 0===e)throw new TypeError("eventCls(): Missing eventName");return i="Oskari.event.registry."+e,r=q.cls(i,t,n,{protocol:["Oskari.mapframework.event.Event"]}),r.category({getName:function(){return e}},"___event"),r.eventName=e,r},q.requestCls=function(e,t,n){var i,r;if(null===e||void 0===e)throw new TypeError("requestCls(): Missing requestName");return i="Oskari.request.registry."+e,r=q.cls(i,t,n,{protocol:["Oskari.mapframework.request.Request"]}),r.category({getName:function(){return e}},"___request"),r.requestName=e,r},q._baseClassFor={extension:"Oskari.userinterface.extension.EnhancedExtension",bundle:"Oskari.mapframework.bundle.extension.ExtensionBundle",tile:"Oskari.userinterface.extension.EnhancedTile",flyout:"Oskari.userinterface.extension.EnhancedFlyout",view:"Oskari.userinterface.extension.EnhancedView"},q.extensionCls=function(e){if(null===e||void 0===e)throw new TypeError("extensionCls(): Missing className");return q.cls(e).extend(this._baseClassFor.extension)},q.bundleCls=function(e,t){var n;if(null===t||void 0===t)throw new TypeError("bundleCls(): Missing className");return e||(e=["__",I.get("Bundle")].join("_")),n=q.cls(t,function(){},{update:function(){}},{protocol:["Oskari.bundle.Bundle",this._baseClassFor.bundle],manifest:{"Bundle-Identifier":e}}),L.installBundleClassInfo(e,n.classInfo),n.___bundleIdentifier=e,n.loc=function(e){return e.key=this.___bundleIdentifier,q.registerLocalization(e),n},n.start=function(e){var t,n,i,r,o=this.___bundleIdentifier;if(T.bundles[o]||(t=L.createBundle(o,o),T.bundles[o]=t),n=L.createInstance(o),T.bundleInstances[o]=n,i=T.getBundleInstanceConfigurationByName(o))for(r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);return n.start(),n},n.stop=function(){var e=T.bundleInstances[this.___bundleIdentifier];return e.stop()},n},q.flyoutCls=function(e){if(null===e||void 0===e)throw new TypeError("flyoutCls(): Missing className");return q.cls(e).extend(this._baseClassFor.flyout)},q.tileCls=function(e){if(null===e||void 0===e)throw new TypeError("tileCls(): Missing className");return q.cls(e).extend(this._baseClassFor.tile)},q.viewCls=function(e){if(null===e||void 0===e)throw new TypeError("viewCls(): Missing className");return q.cls(e).extend(this._baseClassFor.view)},M.apply(w,["Oskari",D]),D}(),Oskari.util=function(){function e(e){return"string"==typeof e&&e.length>0&&"0"===e[0]?!(t.isDecimal(e)&&e.length>1&&"."===e[1]):!1}var t={};return t.isNumber=function(t,n){var i,r=new RegExp("^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$"),o=!0;if("object"==typeof t)for(i=0;i<t.length;i++){if(n&&n===!0&&e(t[i]+"")){o=!1;break}if(r.test(t[i])===!1){o=!1;break}}else o=n&&n===!0&&e(t+"")?!1:r.test(t);return o},t.isDecimal=function(t){var n,i,r,o=!0;if(!t||null===t||""===t)return!1;if("object"==typeof t)for(n=0;n<t.length&&(r=String(t[n]),i=r.split("."),o=!(2!==i.length||e(r)||isNaN(i[0])||isNaN(i[1])),o!==!1);n++);else r=t+"",i=r.split("."),o=2===i.length&&!isNaN(i[0])&&!isNaN(i[1])&&(e(i[0])&&1==i[0].length||!e(i[0]));return o},t.decimals=function(e){var t,n=0;if(!e||null===e||""===e||isNaN(e)&&"object"!=typeof e)return null;if("object"==typeof e){for(i=0;i<e.length;i++)t=e[i]+"",t=t.split("."),2===t.length&&n<t[1].length&&(n=t[1].length);return n}return t=e+"",t=t.split("."),2===t.length?t[1].length:0},t.hexToRgb=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,i){return t+t+n+n+i+i});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},t.rgbToHex=function(e){if("#"===e.charAt(0))return e.substring(1);var t,n=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);for(delete n[0],t=1;3>=t;t+=1)n[t]=parseInt(n[t],10).toString(16),1===n[t].length&&(n[t]="0"+n[t]);return n.join("")},t.keyExists=function(e,t){for(var n=e,i=0,r=t.split("."),o=0;n&&o<r.length;o++)r[o]in n&&(n=n[r[o]],i++);return i===r.length},t.naturalSort=function(e,t,n){var i,r,o=/(^([+\-]?(?:\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[\da-fA-F]+$|\d+)/g,s=/^\s+|\s+$/g,a=/\s+/g,u=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,l=/^0x[0-9a-f]+$/i,c=/^0/,d=function(e){return(""+e).toLowerCase().replace(s,"")},f=d(e)||"",p=d(t)||"",h=f.replace(o,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),g=p.replace(o,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),m=parseInt(f.match(l),16)||1!==h.length&&Date.parse(f),v=parseInt(p.match(l),16)||m&&p.match(u)&&Date.parse(p)||null,y=function(e,t){return(!e.match(c)||1==t)&&parseFloat(e)||e.replace(a," ").replace(s,"")||0},b=function(e,t){return isNaN(e)!==isNaN(t)?(w=isNaN(e)?1:-1,!0):(typeof e!=typeof t&&(e+="",t+=""),t>e?(w=-1,!0):e>t?(w=1,!0):void 0)},w=0,_=!1;if(v&&(v>m?(w=-1,_=!0):m>v&&(w=1,_=!0)),!_)for(var S=0,x=h.length,E=g.length,C=Math.max(x,E);C>S&&(i=y(h[S]||"",x),r=y(g[S]||"",E),!(_=b(i,r)));S++);return n&&(w=-1*w),w},t}(),function(){var e=window.console,t=!1,n=function(t){var n=t.shift();e&&window.console[n]&&window.console[n].apply&&window.console[n].apply(window.console,t)},i=function(e,t){var n=Array.prototype.slice.call(t);return n.unshift(e),n},r=function(){if(!t)return"";var e=new Date;return e.toLocaleTimeString()+"."+e.getUTCMilliseconds()+" "},o=function(e,t,o,s,a){var u=r()+e+":",l=i(u,o);l=i(t,l),s&&a&&a.caller&&l.push(a.caller),n(l,a)},s=function(e,t,n){this.name=e||"Logger",this.isDebug=!!t,this.includeCaller=!!n};s.prototype.setInclCaller=function(e){this.includeCaller=!!e},s.prototype.enableDebug=function(e){this.isDebug=!!e},s.prototype.debug=function(){this.isDebug&&o(this.name,"debug",arguments,this.includeCaller,arguments.callee)},s.prototype.info=function(){o(this.name,"log",arguments,this.includeCaller,arguments.callee)},s.prototype.warn=function(){o(this.name,"warn",arguments,this.includeCaller,arguments.callee)},s.prototype.error=function(){o(this.name,"error",arguments,this.includeCaller,arguments.callee)};var a={};Oskari.log=function(e){if(e=e||"Oskari",a[e])return a[e];var t=new s(e);return a[e]=t,t}}(),function(e){if(e){var t={};e.bundle=function(e,n){return n&&(t[e]=n),t[e]}}}(Oskari),function(e){if(e){e.loader;var t=Oskari.log("Loader"),n=function(e,t,n){var i=document.head||document.body,r=document.createElement("link");r.rel=t||"stylesheet",r.type=n||"text/css",r.href=e,i.appendChild(r)},i=function(e,t){var n=e.split("/"),i=t.split("/");n.pop();for(var r=0;r<i.length;r++)"."!=i[r]&&(".."==i[r]?n.pop():n.push(i[r]));return n.join("/")},r=function(e,t){var n=t;return 0!==t.indexOf("/")&&(n=i(e,t)),n.split("//").join("/")},o=function(e,i){var o=[];e&&"function"==typeof e.slice?o=e.slice(0):t.warn("No startupsequence given to loader or sequence is not an array");var s=i||{},a={};return{processSequence:function(e){var n=this;if(0===o.length)return void("function"==typeof e&&e());var i=o.shift();if("object"!=typeof i)return t.warn("StartupSequence item is a "+typeof i+" instead of object. Skipping"),void this.processSequence(e);if("object"!=typeof i.metadata||"object"!=typeof i.metadata["Import-Bundle"])return t.warn('StartupSequence item doesn\'t contain the structure item.metadata["Import-Bundle"]. Skipping ',i),void this.processSequence(e);var r=i.bundlename;if(!r)return t.warn("StartupSequence item doesn't contain bundlename. Skipping ",i),void this.processSequence(e);var a=i.bundleinstancename||r,u=s[a]||{},l=i.metadata["Import-Bundle"],c=[],d=[];for(var f in l){var p=l[f];if("object"==typeof p&&"string"==typeof p.bundlePath){var h=p.bundlePath+"/"+f,g=h+"/bundle.js";c.push(g.split("//").join("/")),d.push({id:f,path:h})}else t.warn("StartupSequence import doesn't contain bundlePath. Skipping! Item is "+r+" import is "+f)}return Oskari.bundle(r)?(t.debug("Bundle preloaded "+r),n.startBundle(r,u),void this.processSequence(e)):void require(c,function(){for(var i=0;i<arguments.length;++i)"undefined"!=typeof arguments[i]&&t.warn("Support for AMD-bundles is not yet implemented",arguments[i]);t.debug("Loaded bundles",d),n.processBundleJS(d,function(){n.startBundle(r,u),n.processSequence(e)})},function(i){t.error("Error loading bundles for "+r,i),n.processSequence(e)})},startBundle:function(e,n){var i=Oskari.bundle(e);if(!i)throw new Error("Bundle not loaded "+e);var r=i.clazz.create();if(!r)throw new Error("Couldn't create an instance of bundle "+e);r.mediator={bundleId:e};for(var o in n)r[o]=n[o];t.debug("Starting bundle "+e);try{r.start()}catch(s){throw new Error("Couldn't start bundle with id "+e+". Error was: "+s)}},processBundleJS:function(e,t){var n=this,i=[],r=function(e){var n=i.indexOf(e);i.splice(n,1),0===i.length&&t()};e.forEach(function(e){var t=Oskari.bundle(e.id);t.clazz&&t.metadata&&t.metadata.source&&(i.push(e.id),n.handleBundleLoad(e.path,t.metadata.source,function(){r(e.id)}))})},handleBundleLoad:function(e,i,o){var s=[];i.locales&&i.locales.forEach(function(t){if((!t.lang||t.lang===Oskari.getLang())&&t.src.endsWith(".js")){var n=r(e,t.src);s.push(n),t.expose&&(a[n]=t.expose)}}),i.resources&&i.resources.forEach(function(t){t.src.endsWith(".js")&&s.push(r(e,t.src))}),i.scripts&&i.scripts.forEach(function(t){var i=r(e,t.src);t.src.endsWith(".js")?(s.push(i),t.expose&&(a[i]=t.expose)):t.src.endsWith(".css")&&n(i)}),i.links&&i.links.forEach(function(t){"import"===t.rel.toLowerCase()&&n(r(e,t.href),t.rel,"text/html")}),require(s,function(){for(var e=0;e<arguments.length;++e)if("undefined"!=typeof arguments[e]){var n=a[s[e]];n?window[n]=arguments[e]:t.warn('Support for AMD-files is not yet implemented. Bundles need to have an "expose" statement in bundle.js to register libs as globals.',s[e])}o()},function(e){t.error("Error loading files",s,e),o()})}}};o.log=t,o.linkFile=n,e.loader=o}}(Oskari);