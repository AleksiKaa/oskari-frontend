/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 12:02:04 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance",function(){this.sandbox=null;this.requestHandlers={};this.extensions=[];this.extensionsByName={};this.templates={}},{getSandbox:function(){return this.sandbox},start:function(){this.createTileTemplate();this.createFlyoutTemplate();var a=Oskari.$("sandbox");this.sandbox=a;this.requestHandlers.add=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",this);this.requestHandlers.remove=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",this);this.requestHandlers.update=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",this);a.addRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add);a.addRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove);a.addRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update)},update:function(){},stop:function(){sandbox.removeRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update);sandbox.removeRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove);sandbox.removeRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add)},createTileTemplate:function(){this.templates["Oskari.userinterface.Tile"]=$('<div style="display:none;" class="oskari-tile"><div class="oskari-tile-title"></div><div class="oskari-tile-status"></div><div class="oskari-tile-close"></div></div>')},createFlyoutTemplate:function(){var a=$('<div class="oskari-flyout attached"><div class="oskari-flyouttoolbar"><div class="oskari-flyout-title"><p></p></div><div class="oskari-flyouttool-attach"></div><div class="oskari-flyouttool-detach"></div><div class="oskari-flyouttool-minimize"></div><div class="oskari-flyouttool-restore"></div><div class="oskari-flyouttool-close"></div></div><div class="oskari-flyoutcontentcontainer"><div class="oskari-flyoutcontent"></div></div></div>');a.css("left","-3195px");a.css("top","-3100px");this.templates["Oskari.userinterface.Flyout"]=a},addExtension:function(m){m.startExtension();var d=m.getPlugins();var h=null;var k=this.extensions;var e=this.extensionsByName;var n={state:"close",extension:m,draggable:null,draggableHandle:null};var i=k.length;var a=m.getName();var g=d["Oskari.userinterface.Flyout"];var l=null;if(g!=null){l=this.createFlyout(m,g,i,n);n.draggableHandle=l.children(".oskari-flyouttoolbar").children(".oskari-flyout-title").get()[0];var f=l.children(".oskari-flyoutcontentcontainer");var c=f.children(".oskari-flyoutcontent");g.setEl(c.get());$(document.body).append(l);g.startPlugin()}var b=d["Oskari.userinterface.Tile"];var j=null;if(b!=null){j=this.createTile(m,b,i,n);b.startPlugin();j.fadeIn(200)}if(j!=null){$("#menubar").append(j)}n.plugins={"Oskari.userinterface.Tile":{plugin:b,el:j},"Oskari.userinterface.Flyout":{plugin:g,el:l}};k.push(n);e[a]=n;return n},createTile:function(h,c,d,j){var f=this;var a=$("#menubar");var e=this.templates["Oskari.userinterface.Tile"].clone(true,true);var g=e.children(".oskari-tile-title");g.append(c.getTitle());var b=e.children(".oskari-tile-status");var i=e.children(".oskari-tile-close");g.click(function(){c.setState();console.log("TOGGLE -----------------------------------------------------------------------------");f.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"toggle"])});i.click(function(){f.getSandbox().postRequestByName("userinterface.RemoveExtensionRequest",[h])});c.setEl(e.get());return e},createFlyout:function(h,f,e,a){var d=this;var b=this.templates["Oskari.userinterface.Flyout"].clone(true,true);var g=b.children(".oskari-flyouttoolbar");var c={attach:g.children(".oskari-flyouttool-attach"),detach:g.children(".oskari-flyouttool-detach"),minimize:g.children(".oskari-flyouttool-minimize"),restore:g.children(".oskari-flyouttool-restore"),close:g.children(".oskari-flyouttool-close")};c.detach.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"detach"])
});c.attach.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"attach"])});c.minimize.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"minimize"])});c.restore.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"restore"])});c.close.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"close"])});return b},removeExtension:function(q){var l=this;var m=l.extensions;var g=this.extensionsByName;var r=g[q.getName()];var f=r.state;var i=r.plugins["Oskari.userinterface.Flyout"];var h=i.plugin;var o=i.el;var d=r.plugins["Oskari.userinterface.Tile"];var c=d.plugin;var k=d.el;var b=this.flyoutOps;var p=b.close;p.apply(this,[o,h,r]);k.remove();o.remove();console.log("NYI","This really does NOT close - just hiding for now");g[q.getName()]=null;var a=[];for(var e=0,j=m.length;e<j;e++){if(m[e]===r){continue}a.push(m[e])}l.extensions=a;q.stopExtension()},updateExtension:function(i,d){var v=this;var u=v.extensions;var a=this.extensionsByName;var k=a[i.getName()];var g=k.state;var e=d.getState();console.log("UPDATE",i,d,u,a);var j=k.plugins["Oskari.userinterface.Flyout"];var p=j.plugin;var t=j.el;var b=this.flyoutOps;var f=b.close;if(e=="toggle"){if(g=="close"){e="attach"}else{if(g=="attach"){e="close"}else{if(g=="detach"){e="close"}else{if(g=="minimize"){e="detach"}}}}}if(e=="attach"){for(var m=0,r=u.length;m<r;m++){var o=u[m];if(o===k){continue}if(o.state!="attach"){continue}var c="close";console.log("CLOSING",o.extension.getName(),o);var q=o.plugins["Oskari.userinterface.Flyout"];var s=q.plugin;var l=q.el;s.setState(c);o.state=c;f.apply(this,[l,s,o]);v.updateFlyoutState(c,l,s,o)}}p.setState(e);k.state=e;var h=b[e];h.apply(this,[t,p,k]);v.updateFlyoutState(e,t,p,k)},updateFlyoutState:function(d,b,c,a){console.log("updateFlyoutState",d,b,c,a)},flyoutOps:{detach:function(b,c,a){var d=this;b.animate({left:"224px"},200,"cubicIn");b.removeClass("oskari-attached");b.addClass("oskari-detached");b.removeClass("oskari-closed");var e=a.draggableHandle;a.draggable=new Draggable(b.get()[0],{handle:e,scroll:false,onStop:function(f,g){d.updateFlyoutState("dragStop",b,c,a)}})},attach:function(b,c,a){b.css("left","195px");b.css("top","100px");b.addClass("oskari-attached");b.removeClass("oskari-detached");b.removeClass("oskari-closed");if(a.draggable){a.draggable.destroy();a.draggable=null}},minimize:function(a){a.css("left","224px");a.css("top","100px");a.addClass("oskari-minimized");a.removeClass("oskari-closed");a.removeClass("oskari-detached")},restore:function(a){a.removeClass("oskari-minimized");a.removeClass("oskari-closed");a.css("top","100px");a.css("left","224px");a.addClass("oskari-detached")},close:function(a){a.removeClass("oskari-attached");a.removeClass("oskari-detached");a.addClass("oskari-closed")}}},{protocol:["Oskari.bundle.BundleInstance"]});Oskari.clazz.define("Oskari.userinterface.request.AddExtensionRequest",function(a){this._extension=a},{__name:"userinterface.AddExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",function(a){this.ui=a},{handleRequest:function(a,b){var c=b.getExtension();this.ui.addExtension(c)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.request.RemoveExtensionRequest",function(a){this._extension=a},{__name:"userinterface.RemoveExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",function(a){this.ui=a},{handleRequest:function(a,b){var c=b.getExtension();this.ui.removeExtension(c)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.request.UpdateExtensionRequest",function(b,a){this._extension=b;
this._state=a},{__name:"userinterface.UpdateExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension},getState:function(){return this._state}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",function(a){this.ui=a},{handleRequest:function(a,b){var c=b.getExtension();this.ui.updateExtension(c,b)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});