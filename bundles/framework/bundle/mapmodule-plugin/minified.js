/*! jQuery UI - v1.9.1 - 2012-11-09
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.slider.js, jquery.ui.tooltip.js
* Copyright (c) 2012 jQuery Foundation and other contributors Licensed MIT */

/** modifications free software  (c) 2009-IV maanmittauslaitos.fi **/

/* Copyright (c) 2006-2008 MetaCarta, Inc., published under the Clear BSD
 * license.  See http://svn.openlayers.org/trunk/openlayers/license.txt for the
 * full text of the license. */

/* 
/* Copyright (c) 2006-2008 MetaCarta, Inc., published under the Clear BSD
 * license.  See http://svn.openlayers.org/trunk/openlayers/license.txt for the
 * full text of the license. 
 */

/**
 * Let's add missing TileMatrixLimits support 
 * (c) 2011-11 NLSFI 
 */

/* Copyright (c) 2006-2011 by OpenLayers Contributors (see authors.txt for 
 * full list of contributors). Published under the Clear BSD license.  
 * See http://svn.openlayers.org/trunk/openlayers/license.txt for the
 * full text of the license. */

/**
 * Let's fix missing tileMatrixSetLimits handling for WMTS layers. (c) 2011-11
 * NLSFI
 */

/*
 * Copyright (c) 2006-2011 by OpenLayers Contributors (see authors.txt for full
 * list of contributors). Published under the Clear BSD license. See
 * http://svn.openlayers.org/trunk/openlayers/license.txt for the full text of
 * the license.
 */

/* Copyright (c) 2006-2011 by OpenLayers Contributors (see authors.txt for
* full list of contributors). Published under the Clear BSD license.
* See http://svn.openlayers.org/trunk/openlayers/license.txt for the
* full text of the license. */

/**
 * Copyright (c) 2011 National Land Survey of Finland.
 */

Oskari.clazz.define("Oskari.mapframework.core.Core",function(){this._selectedLayers=new Array,this._mapLayersHighlighted=new Array,this._map=null,this._sandbox=Oskari.clazz.create("Oskari.mapframework.sandbox.Sandbox",this),Oskari.$("sandbox")||Oskari.$("sandbox",this._sandbox),this._services=[],this._servicesByQName={},this._debug=!1,this._ctrlKeyDown=!1,this._allowMultipleHighlightLayers=!1,this._availableRequestsByName={},this._availableEventsByName={},this.externalHandlerCls={}},{init:function(e,t){this.printDebug("Initializing core...");var n=this._sandbox;this._services=e;if(e)for(var r=0;r<e.length;r++)this.registerService(e[r]);this.printDebug("Sandbox ready, building up domain..."),this._map=Oskari.clazz.create("Oskari.mapframework.domain.Map"),this.enhancements=t,this._doEnhancements(this.enhancements),this.printDebug("Modules started. Core ready.")},dispatch:function(e){this._sandbox.notifyAll(e)},defaultRequestHandlers:{AddMapLayerRequest:function(e){return this._handleAddMapLayerRequest(e),!0},RemoveMapLayerRequest:function(e){return this._handleRemoveMapLayerRequest(e),!0},ShowMapLayerInfoRequest:function(e){return this._handleShowMapLayerInfoRequest(e),!0},RearrangeSelectedMapLayerRequest:function(e){return this._handleRearrangeSelectedMapLayerRequest(e),!0},ChangeMapLayerOpacityRequest:function(e){return this._handleChangeMapLayerOpacityRequest(e),!0},ChangeMapLayerStyleRequest:function(e){return this._handleChangeMapLayerStyleRequest(e),!0},HighlightMapLayerRequest:function(e){return this._handleHighlightMapLayerRequest(e),!0},HighlightWFSFeatureRequest:function(e){return this.handleHighlightWFSFeatureRequest(e),!0},HideMapMarkerRequest:function(e){return this._handleHideMapMarkerRequest(e),!0},DimMapLayerRequest:function(e){return this._handleDimMapLayerRequest(e.getMapLayerId()),!0},CtrlKeyDownRequest:function(e){return this._handleCtrlKeyDownRequest(),!0},CtrlKeyUpRequest:function(e){return this._handleCtrlKeyUpRequest(),!0},__default:function(e){return this.printWarn("!!!"),this.printWarn("  There is no handler for"),this.printWarn("  '"+e.getName()+"'"),!1}},processRequest:function(e){var t=e.getName(),n=this.defaultRequestHandlers[t];if(n)rv=n.apply(this,[e]);else{var r=this.externalHandlerCls[t];r?rv=r.handleRequest(this,e):(n=this.defaultRequestHandlers.__default,rv=n.apply(this,[e]))}return delete e,rv},addRequestHandler:function(e,t){this.externalHandlerCls[e]=t},removeRequestHandler:function(e,t){this.externalHandlerCls[e]===t&&(this.externalHandlerCls[e]=null)},_getQNameForRequest:function(e){var t=this._availableRequestsByName[e];if(!t){this.printDebug("#!#!# ! Updating request metadata...");var n=Oskari.clazz.protocol("Oskari.mapframework.request.Request");for(p in n){var r=n[p],i=r._class.prototype.getName();this._availableRequestsByName[i]=p}this.printDebug("#!#!# ! Finished Updating request metadata..."),t=this._availableRequestsByName[e]}return t},getRequestBuilder:function(e){var t=this._getQNameForRequest(e);return t?Oskari.clazz.builder(t):undefined},_getQNameForEvent:function(e){var t=this._availableEventsByName[e];if(!t){this.printDebug("#!#!# ! Updating event metadata...");var n=Oskari.clazz.protocol("Oskari.mapframework.event.Event");for(p in n){var r=n[p],i=r._class.prototype.getName();this._availableEventsByName[i]=p}this.printDebug("#!#!# ! Finished Updating event metadata..."),t=this._availableEventsByName[e]}return t},getEventBuilder:function(e){var t=this._getQNameForEvent(e);return t?Oskari.clazz.builder(t):undefined},disableDebug:function(){this._debug=!1},enableDebug:function(){this._debug=!0},printDebug:function(e){this._debug&&window.console!=null&&(window.console.debug!=null?console.debug(e):window.console.log!=null&&console.log(e))},printWarn:function(e){window.console!=null&&console.warn(e)},registerService:function(e){this._servicesByQName[e.getQName()]=e},getService:function(e){return this._servicesByQName[e]},getMap:function(){return this._map},getSandbox:function(){return this._sandbox},getRequestParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href);return r==null?null:r[1]},getObjectName:function(e){return e.__name},getObjectCreator:function(e){return e._creator},setObjectCreator:function(e,t){e._creator=t},copyObjectCreatorToFrom:function(e,t){e._creator=t._creator}}),define("bundles/oskari/base/core/core",function(){}),Oskari.clazz.category("Oskari.mapframework.core.Core","enhancement-methods",{_doEnhancements:function(e){for(var t=0;t<e.length;t++)e[t].enhance(this)}}),define("bundles/oskari/base/core/core-enhancement-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.core.Core","feature-key-listener-methods",{_handleCtrlKeyDownRequest:function(){this._ctrlKeyDown=!0},_handleCtrlKeyUpRequest:function(){this._ctrlKeyDown=!1},isCtrlKeyDown:function(){return this._ctrlKeyDown}}),define("bundles/oskari/base/core/core-key-listener-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.core.Core","map-layer-methods",{isLayerAlreadySelected:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),n=t.findMapLayer(e,this._selectedLayers);return n!=null},findMapLayerFromSelectedMapLayers:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),n=t.findMapLayer(e,this._selectedLayers);return n},isMapLayerAlreadyHighlighted:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),n=t.findMapLayer(e,this._mapLayersHighlighted);return n==null&&this.printDebug("[core-map-layer-methods] "+e+" is not yet highlighted."),n!=null},findMapLayerFromAllAvailable:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),n=t.findMapLayer(e);return n==null&&this.printDebug("Cannot find map layer with id '"+e+"' from all available. "+"Check that current user has VIEW permissions to that layer."),n},getAllSelectedLayers:function(){return this._selectedLayers},getAllHighlightedMapLayers:function(){return this._mapLayersHighlighted},allowMultipleHighlightLayers:function(e){this._allowMultipleHighlightLayers=e},_handleAddMapLayerRequest:function(e){var t=e.getMapLayerId(),n=e.getKeepLayersOrder(),r=e.isBasemap();this.printDebug("Trying to add map layer with id '"+t+"' AS "+(r?" BASE ":" NORMAL "));if(this.isLayerAlreadySelected(t)){this.printDebug("Attempt to select already selected layer '"+t+"'");return}var i=this.findMapLayerFromAllAvailable(t);if(!i){this.printDebug("Attempt to select layer that is not available '"+t+"'");return}r==1&&i.setType("BASE_LAYER");if(n!=null&&n)this._selectedLayers.push(i);else if(i.isBaseLayer()||r==1){var s=this._selectedLayers,o=new Array;o.push(i);for(var u=0;u<s.length;u++)o.push(s[u]);delete this._selectedLayers,this._selectedLayers=o}else this._selectedLayers.push(i);var a=this.getEventBuilder("AfterMapLayerAddEvent")(i,n,r);this.copyObjectCreatorToFrom(a,e),this.dispatch(a)},_handleRemoveMapLayerRequest:function(e){var t=e.getMapLayerId();this.printDebug("Trying to remove map layer with id '"+t+"'");if(!this.isLayerAlreadySelected(t)){this.printDebug("Attempt to remove layer '"+t+"' that is not selected.");return}var n=this.findMapLayerFromAllAvailable(t),r=-1;for(var i=0;i<this._selectedLayers.length;i++)if(this._selectedLayers[i]===n){r=i;break}this._selectedLayers.splice(r,1),this.isMapLayerAlreadyHighlighted(t)&&(this.printDebug("Maplayer is also highlighted, removing it from highlight list."),this._handleDimMapLayerRequest(t));var s=this.getEventBuilder("AfterMapLayerRemoveEvent")(n);this.copyObjectCreatorToFrom(s,e),this.dispatch(s)},_handleShowMapLayerInfoRequest:function(e){var t=this.findMapLayerFromAllAvailable(e.getMapLayerId()),n=this.getEventBuilder("AfterShowMapLayerInfoEvent")(t);this.copyObjectCreatorToFrom(n,e),this.dispatch(n)},_handleRearrangeSelectedMapLayerRequest:function(e){var t=e.getToPosition(),n=e.getMapLayerId(),r=null,i=0;if(n!=null&&t!=null){r=this.findMapLayerFromSelectedMapLayers(n);var s=new Array,o=0,u=0;for(var a=0;o<t;a++){u++;var f=this._selectedLayers[a];if(f.getId()==n){i=a;continue}s.push(f),o++}s.push(r);for(var a=u;a<this._selectedLayers.length;a++){var f=this._selectedLayers[a];if(f.getId()==n){i=a;continue}s.push(f)}delete this._selectedLayers,this._selectedLayers=s}var l=this.getEventBuilder("AfterRearrangeSelectedMapLayerEvent")(r,i,t);this.copyObjectCreatorToFrom(l,e),this.dispatch(l)},_handleChangeMapLayerOpacityRequest:function(e){var t=this.findMapLayerFromSelectedMapLayers(e.getMapLayerId());if(!t)return;t.setOpacity(e.getOpacity());var n=this.getEventBuilder("AfterChangeMapLayerOpacityEvent")(t);this.copyObjectCreatorToFrom(n,e),this.dispatch(n)},_handleChangeMapLayerStyleRequest:function(e){var t=this.findMapLayerFromSelectedMapLayers(e.getMapLayerId());if(!t)return;if(e.getStyle()!="!default!"){t.selectStyle(e.getStyle());var n=this.getEventBuilder("AfterChangeMapLayerStyleEvent")(t);this.copyObjectCreatorToFrom(n,e),this.dispatch(n)}},_removeHighLightedMapLayer:function(e){var t=this.getAllHighlightedMapLayers();for(var n=0;n<t.length;n++){var r=t[n];if(!e||r.getId()==e){t.splice(n);var i=this.getEventBuilder("AfterDimMapLayerEvent")(r);this.dispatch(i);return}}},_handleHighlightMapLayerRequest:function(e){var t=this.getObjectCreator(e),n=e.getMapLayerId();this.printDebug("[core-map-layer-methods] Trying to highlight map layer with id '"+n+"'");if(this.isMapLayerAlreadyHighlighted(n)){this.printWarn("[core-map-layer-methods] Attempt to highlight already highlighted wms feature info map layer '"+n+"'");return}this._allowMultipleHighlightLayers==1?this._removeHighLightedMapLayer(n):this._removeHighLightedMapLayer();var r=this.findMapLayerFromSelectedMapLayers(n);if(!r)return;this._mapLayersHighlighted.push(r),this.printDebug("[core-map-layer-methods] Adding "+r+" ("+r.getId()+") to highlighted list.");var i=this.getEventBuilder("AfterHighlightMapLayerEvent")(r);this.copyObjectCreatorToFrom(i,e),this.dispatch(i)},_handleDimMapLayerRequest:function(e){this._allowMultipleHighlightLayers==1?this._removeHighLightedMapLayer(e):this._removeHighLightedMapLayer();var t=this.findMapLayerFromAllAvailable(e);if(!t)return;var n=this.getEventBuilder("AfterDimMapLayerEvent")(t);this.dispatch(n)}}),define("bundles/oskari/base/core/core-map-layer-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.core.Core","map-methods",{_handleHideMapMarkerRequest:function(e){this._map.setMarkerVisible(!1);var t=this.getEventBuilder("AfterHideMapMarkerEvent")();this.copyObjectCreatorToFrom(t,e),this.dispatch(t)}}),define("bundles/oskari/base/core/core-map-methods",function(){}),define("bundles/oskari/base/core/module",["oskari","./core","./core-enhancement-methods","./core-key-listener-methods","./core-map-layer-methods","./core-map-methods"],function(e){e.bundleCls("core-base"),e.bundleCls("core-map")}),Oskari.clazz.define("Oskari.mapframework.event.Event",function(){throw"mapframework.event.Event should not be used"},{getName:function(){throw"Running default implementation of Event.getName(). implement your own!"},setCreator:function(e){this._creator=e},getCreator:function(){return this._creator}}),define("bundles/oskari/base/event/event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.FeaturesAvailableEvent",function(e,t,n,r,i){this._creator=null,this._features=t,this._op=i,this._mapLayer=e,this._mimeType=n,this._projCode=r},{__name:"FeaturesAvailableEvent",getName:function(){return this.__name},getFeatures:function(){return this._features},getOp:function(){return this._op},getMapLayer:function(){return this._mapLayer},getMimeType:function(){return this._mimeType},getProjCode:function(){return this._projCode}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/features-available-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerAddEvent",function(e,t,n){this._creator=null,this._mapLayer=e,this._keepLayersOrder=t,n?this._isBasemap=n:this._isBasemap=!1},{__name:"AfterMapLayerAddEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-map-layer-add-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerRemoveEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterMapLayerRemoveEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-map-layer-remove-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapMoveEvent",function(e,t,n,r,i){this._creator=null,this._centerX=e,this._centerY=t,this._zoom=n,this._marker=r,this._scale=i},{__name:"AfterMapMoveEvent",getName:function(){return this.__name},getCreator:function(){return this._creator},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker},getScale:function(){return this._scale}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-map-move-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.MapMoveStartEvent",function(e,t){this._creator=null,this._x=e,this._y=t},{__name:"MapMoveStartEvent",getName:function(){return this.__name},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-map-move-start-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterShowMapLayerInfoEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterShowMapLayerInfoEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-show-map-layer-info-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterHideMapMarkerEvent",function(){},{__name:"AfterHideMapMarkerEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-hide-map-marker-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.MouseHoverEvent",function(e,t,n){this._creator=null,this._lon=e,this._lat=t,this._paused=n},{__name:"MouseHoverEvent",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},set:function(e,t,n,r,i,n){this._lon=e,this._lat=t,this._paused=n,this._pageX=r,this._pageY=i,this._paused=n},isPaused:function(){return this._paused},getPageX:function(){return this._pageX},getPageY:function(){return this._pageY}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/mouse-hover-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.MapLayerEvent",function(e,t){this._creator=null,this._layerId=e;if(!this.operations[t])throw"Unknown operation '"+t+"'";this._operation=t},{__name:"MapLayerEvent",getName:function(){return this.__name},getLayerId:function(){return this._layerId},getOperation:function(){return this._operation},operations:{add:"add",remove:"remove",sticky:"sticky",update:"update"}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/MapLayerEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterRearrangeSelectedMapLayerEvent",function(e,t,n){this._creator=null,this._movedMapLayer=e,this._fromPosition=t,this._toPosition=n},{__name:"AfterRearrangeSelectedMapLayerEvent",getName:function(){return this.__name},getMovedMapLayer:function(){return this._movedMapLayer},getFromPosition:function(){return this._fromPosition},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-rearrange-selected-map-layer-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerOpacityEvent",function(e){this._mapLayer=e},{__name:"AfterChangeMapLayerOpacityEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-change-map-layer-opacity-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerStyleEvent",function(e){this._mapLayer=e},{__name:"AfterChangeMapLayerStyleEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-change-map-layer-style-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterHighlightMapLayerEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterHighlightMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-highlight-map-layer-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterDimMapLayerEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterDimMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/oskari/base/event/common/after-dim-map-layer-event",function(){}),define("bundles/oskari/base/event/module",["oskari","./event","./common/features-available-event","./common/after-map-layer-add-event","./common/after-map-layer-remove-event","./common/after-map-move-event","./common/after-map-move-start-event","./common/after-show-map-layer-info-event","./common/after-hide-map-marker-event","./common/mouse-hover-event","./common/MapLayerEvent","./common/after-rearrange-selected-map-layer-event","./common/after-change-map-layer-opacity-event","./common/after-change-map-layer-style-event","./common/after-highlight-map-layer-event","./common/after-dim-map-layer-event"],function(e){e.bundleCls("event-base"),e.bundleCls("event-map"),e.bundleCls("event-map-layer")}),Oskari.clazz.define("Oskari.mapframework.domain.AbstractLayer",function(e,t){this._id=null,this._name=null,this._description=null,this._type=null,this._layerType="",this._params=e||{},this._options=t||{},this._metaType=null,this._maxScale=null,this._minScale=null,this._visible=null,this._opacity=null,this._isSticky=null,this._inspireName=null,this._organizationName=null,this._dataUrl=null,this._orderNumber=null,this._subLayers=[],this._styles=[],this._currentStyle=null,this._legendImage=null,this._featureInfoEnabled=null,this._queryable=null,this._queryFormat=null,this._permissions={},this._geometry=[],this._geometryWKT=null,this._tools=[],this._metadataIdentifier=null,this._backendStatus=null},{setId:function(e){this._id=e},getId:function(){return this._id},setQueryFormat:function(e){this._queryFormat=e},getQueryFormat:function(){return this._queryFormat},setName:function(e){this._name=e},getName:function(){return this._name},setType:function(e){this._type=e},getType:function(){return this._type},setDataUrl:function(e){this._dataUrl=e},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(e){this._organizationName=e},getOrganizationName:function(){return this._organizationName},setInspireName:function(e){this._inspireName=e},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(e){this._featureInfoEnabled=e},isFeatureInfoEnabled:function(){return this._featureInfoEnabled===!0?!0:!1},setDescription:function(e){this._description=e},getDescription:function(){return this._description},addSubLayer:function(e){this._subLayers.push(e)},getSubLayers:function(){return this._subLayers},setMaxScale:function(e){this._maxScale=e},getMaxScale:function(){return this._maxScale},setMinScale:function(e){this._minScale=e},getMinScale:function(){return this._minScale},setOrderNumber:function(e){this._orderNumber=e},getOrderNumber:function(){return this._orderNumber},isVisible:function(){return this._visible===!0},setVisible:function(e){this._visible=e},setOpacity:function(e){this._opacity=e},getOpacity:function(){return this._opacity},setGeometryWKT:function(e){this._geometryWKT=e},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(e){this._geometry=e},getGeometry:function(){return this._geometry},addPermission:function(e,t){this._permissions[e]=t},removePermission:function(e){this._permissions[e]=null,delete this._permissions[e]},getPermission:function(e){return this._permissions[e]},getMetadataIdentifier:function(){return this._metadataIdentifier},setMetadataIdentifier:function(e){this._metadataIdentifier=e},getBackendStatus:function(){return this._backendStatus},setBackendStatus:function(e){this._backendStatus=e},setMetaType:function(e){this._metaType=e},getMetaType:function(){return this._metaType},addStyle:function(e){this._styles.push(e)},getStyles:function(){return this._styles},selectStyle:function(e){var t=null;if(!(this._styles.length>0)){t=Oskari.clazz.create("Oskari.mapframework.domain.Style"),t.setName(""),t.setTitle(""),t.setLegend(""),this._currentStyle=t;return}if(e===""){this._styles.length>1?this._currentStyle=this._styles[0]:(t=Oskari.clazz.create("Oskari.mapframework.domain.Style"),t.setName(""),t.setTitle(""),t.setLegend(""),this._currentStyle=t);return}for(var n=0;n<this._styles.length;n++){t=this._styles[n];if(t.getName()==e){this._currentStyle=t,t.getLegend()!=""&&(this._legendImage=t.getLegend());return}}},getCurrentStyle:function(){return this._currentStyle},getTools:function(){return this._tools},setTools:function(e){this._tools=e},addTool:function(e){this._tools.push(e)},getTool:function(e){var t=null;if(this._tools.length>0&&e!=="")for(var n=0;n<this._tools.length;n++){t=this._tools[n];if(t.getName()==e)return t}return t},setLegendImage:function(e){this._legendImage=e},getLegendImage:function(){return this._legendImage},hasLegendImage:function(){if(this._legendImage)return!0;for(var e=0;e<this._styles.length;++e)if(this._styles[e].getLegend())return!0;return!1},setSticky:function(e){this._isSticky=e},isSticky:function(){return this._isSticky},setQueryable:function(e){this._queryable=e},getQueryable:function(){return this._queryable},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setAsGroupLayer:function(){this._type="GROUP_LAYER"},isGroupLayer:function(){return this._type==="GROUP_LAYER"},isBaseLayer:function(){return this._type==="BASE_LAYER"},isInScale:function(e){var t=this.isBaseLayer();if(!e){var n=Oskari.$().sandbox;e=n.getMap().getScale()}return!this.isBaseLayer()&&((e>this.getMaxScale()||!this.getMaxScale())&&e<this.getMinScale()||!this.getMinScale())&&(t=!0),t},getLayerType:function(){return this._layerType.toLowerCase()},isLayerOfType:function(e){return e&&e.toLowerCase()===this.getLayerType()},getIconClassname:function(){return this.isBaseLayer()?"layer-base":this.isGroupLayer()?"layer-group":"layer-"+this.getLayerType()},getParams:function(){return this._params},getOptions:function(){return this._options}}),define("bundles/oskari/base/domain/AbstractLayer",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.WmsLayer",function(){this._wmsLayerName=null,this._wmsUrls=[],this._layerType="WMS"},{addWmsUrl:function(e){this._wmsUrls.push(e)},getWmsUrls:function(){return this._wmsUrls},setWmsName:function(e){this._wmsName=e},getWmsName:function(){return this._wmsName}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),define("bundles/oskari/base/domain/wmslayer",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.VectorLayer",function(){this._sldspec=null,this._layerType="VECTOR"},{setStyledLayerDescriptor:function(e){this._sldspec=e},getStyledLayerDescriptor:function(){return this._sldspec}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),define("bundles/oskari/base/domain/vectorlayer",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.Map",function(){this._centerX=null,this._centerY=null,this._zoom=null,this._scale=null,this._bbox=null,this._markerVisible=null,this.width=null,this.height=null,this.resolution=null,this.extent=null,this.maxExtent=null,this._isMoving=!1,this._projectionCode="EPSG:3067"},{moveTo:function(e,t,n){this._centerX=Math.floor(e),this._centerY=Math.floor(t),this._zoom=n},setMoving:function(e){this._isMoving=e},isMoving:function(){return this._isMoving},getX:function(){return this._centerX},getY:function(){return this._centerY},getZoom:function(){return this._zoom},setScale:function(e){this._scale=e},getScale:function(){return this._scale},setBbox:function(e){this._bbox=e},getBbox:function(){return this._bbox},setMarkerVisible:function(e){this._markerVisible=e},isMarkerVisible:function(){return this._markerVisible==1?!0:!1},setWidth:function(e){this.width=e},getWidth:function(){return this.width},setHeight:function(e){this.height=e},getHeight:function(){return this.height},setResolution:function(e){this.resolution=e},getResolution:function(){return this.resolution},setExtent:function(e){this.extent=e},getExtent:function(){return this.extent},setMaxExtent:function(e){this.maxExtent=e},getMaxExtent:function(){return this.maxExtent},setSrsName:function(e){this._projectionCode=e},getSrsName:function(){return this._projectionCode}}),define("bundles/oskari/base/domain/map",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.Style",function(){this._name=null,this._title=null,this._legend=null},{setName:function(e){this._name=e},getName:function(){return this._name},setTitle:function(e){this._title=e},getTitle:function(){return this._title},setLegend:function(e){this._legend=e},getLegend:function(){return this._legend}}),define("bundles/oskari/base/domain/style",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.Tool",function(){this._name=null,this._title=null,this._tooltip=null,this._iconCls=null,this._callback=null},{setName:function(e){this._name=e},getName:function(){return this._name},setTitle:function(e){this._title=e},getTitle:function(){return this._title},setTooltip:function(e){this._tooltip=e},getTooltip:function(){return this._tooltip},setIconCls:function(e){this._iconCls=e},getIconCls:function(){return this._iconCls},setCallback:function(e){this._callback=e},getCallback:function(){return this._callback}}),define("bundles/oskari/base/domain/tool",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.User",function(e){this._loggedIn=!1,e&&(this._firstName=e.firstName,this._lastName=e.lastName,this._nickName=e.nickName,this._loginName=e.loginName,this._uuid=e.userUUID,e.userUUID&&(this._loggedIn=!0))},{getName:function(){return this._firstName+" "+this._lastName},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getNickName:function(){return this._nickName},getLoginName:function(){return this._loginName},getUuid:function(){return this._uuid},isLoggedIn:function(){return this._loggedIn}}),define("bundles/oskari/base/domain/user",function(){}),define("bundles/oskari/base/domain/module",["oskari","./AbstractLayer","./wmslayer","./vectorlayer","./map","./style","./tool","./user"],function(e){e.bundleCls("domain")}),Oskari.clazz.define("Oskari.mapframework.request.Request",function(){throw this._creator=null,"mapframework.request.Request should not be used"},{getName:function(){throw"Running default implementation of Request.getName(). implement your own!"},setCreator:function(e){this._creator=e},getCreator:function(){return this._creator}}),define("bundles/oskari/base/request/request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.AddMapLayerRequest",function(e,t,n,r){this._creator=null,this._mapLayerId=e,this._keepLayersOrder=t==1,this._isExternal=r==1,this._isBasemap=n==1},{__name:"AddMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap},isExternal:function(){return this._isExternal}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/add-map-layer-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.RemoveMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"RemoveMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/remove-map-layer-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.MapMoveRequest",function(e,t,n,r,i){this._creator=null,this._centerX=e,this._centerY=t,this._zoom=n,this._marker=r,this._projectionCode=i},{__name:"MapMoveRequest",getName:function(){return this.__name},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker},getSrsName:function(){return this._projectionCode}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/map-move-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapLayerInfoRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"ShowMapLayerInfoRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/show-map-layer-info-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.HideMapMarkerRequest",function(){this._creator=null},{__name:"HideMapMarkerRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/hide-map-marker-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyDownRequest",function(){},{__name:"CtrlKeyDownRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/ctrl-key-down-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyUpRequest",function(){},{__name:"CtrlKeyUpRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/ctrl-key-up-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.RearrangeSelectedMapLayerRequest",function(e,t){this._mapLayerId=e,this._toPosition=t},{__name:"RearrangeSelectedMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/rearrange-selected-map-layer-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerOpacityRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._opacity=t},{__name:"ChangeMapLayerOpacityRequest",getName:function(){return this.__name},getOpacity:function(){return this._opacity},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/change-map-layer-opacity-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerStyleRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._style=t},{__name:"ChangeMapLayerStyleRequest",getName:function(){return this.__name},getStyle:function(){return this._style},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/change-map-layer-style-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.HighlightMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"HighlightMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/highlight-map-layer-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.DimMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"DimMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/oskari/base/request/common/dim-map-layer-request",function(){}),define("bundles/oskari/base/request/module",["oskari","./request","./common/add-map-layer-request","./common/remove-map-layer-request","./common/map-move-request","./common/show-map-layer-info-request","./common/hide-map-marker-request","./common/ctrl-key-down-request","./common/ctrl-key-up-request","./common/rearrange-selected-map-layer-request","./common/change-map-layer-opacity-request","./common/change-map-layer-style-request","./common/highlight-map-layer-request","./common/dim-map-layer-request"],function(e){e.bundleCls("request-base"),e.bundleCls("request-map"),e.bundleCls("request-map-layer")}),Oskari.clazz.define("Oskari.mapframework.sandbox.Sandbox",function(e){this._core=e,this._listeners=new Array,this._modules=new Array,this._modulesByName={},this._statefuls={},this.debugRequests=!1,this.debugEvents=!1,this.requestEventLog=[],this.requestEventStack=[],this.gatherDebugRequests=!1,this.maxGatheredRequestsAndEvents=4096,this.requestAndEventGather=[],this._eventLoopGuard=0,this._user=null,this._ajaxUrl=null},{disableDebug:function(){this.debugRequests=!1,this.debugEvents=!1,this.gatherDebugRequests=!1,this._core&&this._core.disableDebug()},enableDebug:function(){this.debugRequests=!0,this.debugEvents=!0,this.gatherDebugRequests=!0,this._core&&this._core.enableDebug()},printDebug:function(e){this._core.printDebug(e)},printWarn:function(e){this._core.printWarn(e)},setUser:function(e){this._user=Oskari.clazz.create("Oskari.mapframework.domain.User",e)},getUser:function(){return this._user||this.setUser(),this._user},setAjaxUrl:function(e){this._ajaxUrl=e},getAjaxUrl:function(){return this._ajaxUrl},registerService:function(e){this._core.registerService(e)},getService:function(e){return this._core.getService(e)},registerAsStateful:function(e,t){this._statefuls[e]=t},unregisterStateful:function(e){this._statefuls[e]=null,delete this._statefuls[e]},getStatefulComponents:function(){return this._statefuls},register:function(e){return this._modules.push(e),this._modulesByName[e.getName()]=e,e.init(this)},unregister:function(e){var t=[];for(var n=0;n<this._modules.length;n++){if(e===this._modules[n])continue;t.push(this._modules[n])}this._modules=t,this._modulesByName[e.getName()]=undefined,delete this._modulesByName[e.getName()]},registerForEventByName:function(e,t){this._core.printDebug("#*#*#* Sandbox is registering module '"+e.getName()+"' to event '"+t+"'");var n=this._listeners[t];n==null&&(n=new Array,this._listeners[t]=n),n.push(e),this._core.printDebug("There are currently "+n.length+" listeners for event '"+t+"'")},unregisterFromEventByName:function(e,t){this._core.printDebug("Sandbox is unregistering module '"+e.getName()+"' from event '"+t+"'");var n=this._listeners[t];if(n==null){this._core.printDebug("Module does not listen to that event, skipping.");return}var r=-1;for(var i=0;i<n.length;i++)if(n[i]==e){r=i;break}r>-1?(n.splice(r,1),this._core.printDebug("Module unregistered successfully from event")):this._core.printDebug("Module does not listen to that event, skipping.")},getRequestBuilder:function(e){return this._core.getRequestBuilder(e)},getEventBuilder:function(e){return this._core.getEventBuilder(e)},request:function(e,t){var n=null;e.getName!=null?n=e.getName():n=e;var r=this.findRegisteredModuleInstance(n);if(r==null)throw"Attempt to create request with unknown component '"+e+"' as creator";this._core.setObjectCreator(t,n),this.printDebug("Module '"+n+"' is requesting for '"+this.getObjectName(t)+"'..."),this.gatherDebugRequests&&this._pushRequestAndEventGather(n+"->Sandbox: ",this.getObjectName(t));var i=null;return this._debugPushRequest(n,t),i=this._core.processRequest(t),this._debugPopRequest(),i},requestByName:function(e,t,n){this.printDebug("#!#!#! --------------> requestByName "+t);var r=this.getRequestBuilder(t),i=r.apply(this,n||[]);return this.request(e,i)},postMasterComponent:"postmaster",postRequestByName:function(e,t){var n=this,r=n.getRequestBuilder(e);if(!r)return;window.setTimeout(function(){var e=r.apply(n,t||[]),i=this.postMasterComponent;n._core.setObjectCreator(e,i),n.gatherDebugRequests&&n._pushRequestAndEventGather(i+"->Sandbox: ",n.getObjectName(e));var s=null;this.debugRequests&&n._debugPushRequest(i,e),s=n._core.processRequest(e),this.debugRequests&&n._debugPopRequest()},0)},_findModulesInterestedIn:function(e){var t=e.getName(),n=this._listeners[t];return n?n:[]},notifyAll:function(e,t){var n;t||(n=e.getName(),this._core.printDebug("Sandbox received notifyall for event '"+n+"'"));var r=this._findModulesInterestedIn(e);t||this._core.printDebug("Found "+r.length+" interested modules");for(var i=0;i<r.length;i++){var s=r[i];t||(this._core.printDebug("Notifying module '"+s.getName()+"'."),this.gatherDebugRequests&&this._pushRequestAndEventGather("Sandbox->"+s.getName()+":",n)),this._debugPushEvent(this.getObjectCreator(e),s,e),s.onEvent(e),this._debugPopEvent()}t||delete e},findRegisteredModuleInstance:function(e){return this._modulesByName[e]},getRequestParameter:function(e){return this._core.getRequestParameter(e)},getBrowserWindowSize:function(){if(jQuery.browser.opera&&window.innerHeight!=null)var e=window.innerHeight;var t=jQuery(window).width(),n={};return n.height=jQuery(window).height(),n.width=t,this.printDebug("Got browser window size is: width: "+n.width+" px, height:"+n.height+" px."),n},getObjectName:function(e){return this._core.getObjectName(e)},getObjectCreator:function(e){return this._core.getObjectCreator(e)},setObjectCreator:function(e,t){return this._core.setObjectCreator(e,t)},copyObjectCreatorToFrom:function(e,t){return this._core.copyObjectCreatorToFrom(e,t)},addRequestHandler:function(e,t){return this._core.addRequestHandler(e,t)},removeRequestHandler:function(e,t){return this._core.removeRequestHandler(e,t)},_debugPushRequest:function(e,t){if(!this.debugRequests)return;var n={from:e,reqName:t.getName()};this.requestEventStack.push(n),this.requestEventLog.push(n),this.requestEventLog.length>64&&this.requestEventLog.shift()},_debugPopRequest:function(){if(!this.debugRequests)return;this.requestEventStack.pop()},_debugPushEvent:function(e,t,n){if(!this.debugEvents)return;this._eventLoopGuard++;if(this._eventLoopGuard>64)throw"Events Looped?";var r={from:e,to:t.getName(),evtName:n.getName()};this.requestEventStack.push(r),this.requestEventLog.push(r),this.requestEventLog.length>64&&this.requestEventLog.shift()},_debugPopEvent:function(){if(!this.debugEvents)return;this._eventLoopGuard--,this.requestEventStack.pop()},_pushRequestAndEventGather:function(e,t){var n={};n.name=e,n.request=t,this.requestAndEventGather.push(n),this.requestAndEventGather.length>this.maxGatheredRequestsAndEvents&&this.requestAndEventGather.shift()},popUpSeqDiagram:function(){var e='<html><head></head><body><div class="wsd" wsd_style="modern-blue"><pre>',t="";for(x in this.requestAndEventGather)t+=this.requestAndEventGather[x].name+this.requestAndEventGather[x].request+"\n";if(t!=""){e+=t+'</pre></div><script type="text/javascript" src="http://www.websequencediagrams.com/service.js"></script></body></html>';var n=window.open();n.document.write(e),this.requestAndEventGather=[]}else alert("No requests in queue")}}),define("bundles/oskari/base/sandbox/sandbox",function(){}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","key-listener-methods",{isCtrlKeyDown:function(){return this._core.isCtrlKeyDown()}}),define("bundles/oskari/base/sandbox/sandbox-key-listener-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-layer-methods",{findMapLayerFromAllAvailable:function(e){var t=this._core.findMapLayerFromAllAvailable(e);return t},findAllSelectedMapLayers:function(){var e=this._core.getAllSelectedLayers();return e.slice(0)},findMapLayerFromSelectedMapLayers:function(e){var t=this._core.findMapLayerFromSelectedMapLayers(e);return t},isLayerAlreadySelected:function(e){return this._core.isLayerAlreadySelected(e)},findAllHighlightedLayers:function(){var e=this._core.getAllHighlightedMapLayers();return e},isMapLayerHighLighted:function(e){var t=this.findAllHighlightedLayers();for(var n=0;n<t.length;n++)if(t[n].getId()==e)return!0;return!1},allowMultipleHighlightLayers:function(e){this._core.allowMultipleHighlightLayers(e)}}),define("bundles/oskari/base/sandbox/sandbox-map-layer-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-methods",{getMap:function(){return this._core.getMap()},syncMapState:function(e,t){var n=this._core.getMap(),r=n.getZoom(),i=n.isMarkerVisible();e===!0&&r==12&&this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(n.getX(),n.getY(),0,!1)),this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(n.getX(),n.getY(),r,i)),e===!0&&this._core.processRequest(this._core.getRequestBuilder("ClearHistoryRequest")())},generateMapLinkParameters:function(e){var t=this.getStatefulComponents().mapfull;if(!t)return;var n=t.getState(),r="zoomLevel="+n.zoom+"&coord="+n.east+"_"+n.north+"&mapLayers=",i="";for(var s=0;s<n.selectedLayers.length;s++)n.selectedLayers[s].hidden||(i!=""&&(i+=","),i+=n.selectedLayers[s].id+"+"+n.selectedLayers[s].opacity,n.selectedLayers[s].style?i+="+"+n.selectedLayers[s].style:i+="+");return r+=i,e?(e.marker==1?r+="&showMarker=true":r+="&showMarker=false",e.forceCache==0?r+="&forceCache=false":r+="&forceCache=true",e.noSavedState==0?r+="&noSavedState=false":r+="&noSavedState=true"):r+="&showMarker=false&forceCache=true&noSavedState=true",r}}),define("bundles/oskari/base/sandbox/sandbox-map-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","abstraction-methods",{domSelector:function(e){return jQuery(e)},ajax:function(e,t,n,r,i){if(jQuery&&jQuery.ajax){var s="GET";r&&(s="POST"),jQuery.ajax({type:s,url:e,beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},data:r,success:t,error:n})}else n()},getDefer:function(){return window.Q&&window.Q.defer?window.Q.defer():undefined}}),define("bundles/oskari/base/sandbox/sandbox-abstraction-methods",function(){}),define("bundles/oskari/base/sandbox/module",["oskari","./sandbox","./sandbox-key-listener-methods","./sandbox-map-layer-methods","./sandbox-map-methods","./sandbox-abstraction-methods"],function(e){e.bundleCls("sandbox-base"),e.bundleCls("sandbox-map")}),Oskari.clazz.define("Oskari.mapframework.service.Service",function(){throw"mapframework.service.Service should not be used"},{getName:function(){throw"Running default implementation of Service.getName(). implement your own!"}}),define("bundles/oskari/base/service/service",function(){}),Oskari.clazz.define("Oskari.mapframework.service.MapLayerService",function(e,t){this._mapLayerUrl=e,this._sandbox=t,this._allLayersAjaxLoaded=!1,this._loadedLayersList=new Array,this._reservedLayerIds={},this._stickyLayerIds=[],this.typeMapping={wmslayer:"Oskari.mapframework.domain.WmsLayer",vectorlayer:"Oskari.mapframework.domain.VectorLayer"},this.modelBuilderMapping={}},{__qname:"Oskari.mapframework.service.MapLayerService",getQName:function(){return this.__qname},__name:"MapLayerService",getName:function(){return this.__name},addLayer:function(e,t){this.checkForDuplicateId(e.getId(),e.getName()),this._reservedLayerIds[e.getId()]=!0,this._loadedLayersList.push(e);if(t!==!0){var n=this._sandbox.getEventBuilder("MapLayerEvent")(e.getId(),"add");this._sandbox.notifyAll(n)}},removeLayer:function(e,t){var n=null;for(var r=0;r<this._loadedLayersList.length;r++)if(this._loadedLayersList[r].getId()==e){n=this._loadedLayersList[r],this._loadedLayersList.splice(r,1);break}if(n&&t!==!0){var i=this._sandbox.getEventBuilder("MapLayerEvent")(n.getId(),"remove");this._sandbox.notifyAll(i)}this._reservedLayerIds[e]=!1},updateLayer:function(e,t){var n=this.findMapLayer(e);if(n){n.setName(t.name);var r=this._sandbox.getEventBuilder("MapLayerEvent")(n.getId(),"update");this._sandbox.notifyAll(r)}},makeLayerSticky:function(e,t){var n=this.findMapLayer(e);this._stickyLayerIds.push(e);if(n){n.setSticky(t);var r=this._sandbox.getEventBuilder("MapLayerEvent")(n.getId(),"sticky");this._sandbox.notifyAll(r)}},loadAllLayersAjax:function(e,t){var n=this;jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:this._mapLayerUrl,success:function(t){n._loadAllLayersAjaxCallBack(t,e)},error:function(e,n){t&&e.status!=0&&t()}})},_loadAllLayersAjaxCallBack:function(e,t){var n=e.layers;for(var r=0;r<n.length;r++){var i=this.createMapLayer(n[r]);if(!i)continue;n[r].admin!=null&&(i.admin=n[r].admin),this._reservedLayerIds[i.getId()]!==!0&&this.addLayer(i,!0)}this._allLayersAjaxLoaded=!0;var s=this._sandbox.getEventBuilder("MapLayerEvent")(null,"add");this._sandbox.notifyAll(s),this._resetStickyLayers(),t&&t()},isAllLayersLoaded:function(){return this._allLayersAjaxLoaded},getAllLayers:function(){return this._loadedLayersList},getAllLayersByMetaType:function(e){var t=[];for(var n=0;n<this._loadedLayersList.length;++n){var r=this._loadedLayersList[n];r.getMetaType&&r.getMetaType()===e&&t.push(r)}return t},registerLayerModel:function(e,t){this.typeMapping[e]=t},unregisterLayerModel:function(e){this.typeMapping[e]=undefined},registerLayerModelBuilder:function(e,t){this._sandbox.printDebug("[MapLayerService] registering handler for type "+e),this.modelBuilderMapping[e]=t},unregisterLayerModelBuilder:function(e){this.modelBuilderMapping[e]=undefined},createMapLayer:function(e){var t=null;return e.type=="base"?t=this._createGroupMapLayer(e,!0):e.type=="groupMap"?t=this._createGroupMapLayer(e,!1):t=this._createActualMapLayer(e),t},_createGroupMapLayer:function(e,t){var n=Oskari.clazz.create("Oskari.mapframework.domain.WmsLayer");t?n.setAsBaseLayer():n.setAsGroupLayer(),n.setVisible(!0),n.setId(e.id),n.setName(e.name),n.setMaxScale(e.maxScale),n.setMinScale(e.minScale),n.setDataUrl(e.dataUrl),n.setMetadataIdentifier(e.dataUrl_uuid);if(!n.getMetadataIdentifier()&&n.getDataUrl()){var r=n.getDataUrl().split("uuid=");r.length==2&&n.setMetadataIdentifier(r[1])}e.orgName?n.setOrganizationName(e.orgName):n.setOrganizationName(""),e.inspire?n.setInspireName(e.inspire):n.setInspireName(""),n.setLegendImage(e.legendImage),n.setDescription(e.info),n.setQueryable(!1);if(e.permissions)for(var i in e.permissions)n.addPermission(i,e.permissions[i]);for(var s=0;s<e.subLayer.length;s++){var o=this._createActualMapLayer(e.subLayer[s]);n.getSubLayers().push(o)}if(e.opacity!=null)n.setOpacity(e.opacity);else if(n.getSubLayers().length>0){var u=n.getSubLayers()[0].getOpacity();u!=null?n.setOpacity(u):n.setOpacity(100)}else n.setOpacity(100);return n},_createActualMapLayer:function(e){var t=null,n=e.id;if(e!=null){if(!this.typeMapping[e.type])return null;t=Oskari.clazz.create(this.typeMapping[e.type],e.params,e.options),e.type=="wmslayer"?this._populateWmsMapLayerAdditionalData(t,e):e.type=="vectorlayer"&&t.setStyledLayerDescriptor(e.styledLayerDescriptor),e.metaType&&t.setMetaType&&t.setMetaType(e.metaType),t.setAsNormalLayer(),t.setId(n),t.setName(e.name),e.opacity!=null?t.setOpacity(e.opacity):t.setOpacity(100),t.setMaxScale(e.maxScale),t.setMinScale(e.minScale),t.setDescription(e.subtitle),t.setQueryable(e.isQueryable==="true"||e.isQueryable===!0),t.setDataUrl(e.dataUrl),t.setMetadataIdentifier(e.dataUrl_uuid);if(!t.getMetadataIdentifier()&&t.getDataUrl()){var r=t.getDataUrl().split("uuid=");r.length==2&&t.setMetadataIdentifier(r[1])}e.backendStatus&&t.setBackendStatus&&t.setBackendStatus(e.backendStatus),e.orgName?t.setOrganizationName(e.orgName):t.setOrganizationName(""),e.inspire?t.setInspireName(e.inspire):t.setInspireName(""),t.setVisible(!0),e.geom&&t.setGeometryWKT&&t.setGeometryWKT(e.geom);if(e.permissions)for(var i in e.permissions)t.addPermission(i,e.permissions[i]);var s=this.modelBuilderMapping[e.type];s&&s.parseLayerData(t,e,this)}return t},_populateWmsMapLayerAdditionalData:function(e,t){e.setWmsName(t.wmsName);if(t.wmsUrl){var n=t.wmsUrl.split(",");for(var r=0;r<n.length;r++)e.addWmsUrl(n[r])}return e.setFeatureInfoEnabled(t.gfi!=="disabled"),this._populateStyles(e,t)},_populateStyles:function(e,t){var n=Oskari.clazz.builder("Oskari.mapframework.domain.Style");if(t.styles){for(var r=0;r<t.styles.length;r++){var i=t.styles,s=!isNaN(r);s&&(i=t.styles[r]);var o=n();o.setName(i.name),o.setTitle(i.title),o.setLegend(i.legend),e.addStyle(o);if(!s)break}e.selectStyle(t.style)}if(e.getStyles().length==0){var o=n();o.setName(""),o.setTitle(""),o.setLegend(""),e.addStyle(o),e.selectStyle("")}return e.setLegendImage(t.legendImage),t.formats&&t.formats.value&&e.setQueryFormat(t.formats.value),e},checkForDuplicateId:function(e,t){if(this._reservedLayerIds[e]===!0){var n=this.findMapLayer(e);throw"Trying to add map layer with id '"+e+" ("+t+")' but that id is already reserved for '"+n.getName()+"'"}},_resetStickyLayers:function(){for(var e in this._stickyLayerIds){var t=this._stickyLayerIds[e];this.makeLayerSticky(t,!0)}},findMapLayer:function(e,t){t||(t=this._loadedLayersList);for(var n=0;n<t.length;n++){var r=t[n];if(r.getId()==e)return r}for(var n=0;n<t.length;n++){var r=t[n],i=r.getSubLayers(),s=this.findMapLayer(e,i);if(s!=null)return s}return null}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/oskari/base/service/map-layer-service",function(){}),define("bundles/oskari/base/service/module",["oskari","./service","./map-layer-service"],function(e){e.bundleCls("service-base"),e.bundleCls("service-map")}),define("bundles/oskari/base/module",["oskari","./core/module","./event/module","./domain/module","./request/module","./sandbox/module","./service/module"],function(e){console.log("here oskari platform is defined...")}),function(e,t){function n(t,n){var i,s,o,u=t.nodeName.toLowerCase();return"area"===u?(i=t.parentNode,s=i.name,!t.href||!s||i.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+s+"]")[0],!!o&&r(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var i=0,s=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.9.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++i)})},removeUniqueId:function(){return this.each(function(){s.test(this.id)&&e(this).removeAttr("id")})}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function i(t,n,r,i){return e.each(s,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),i&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var s=r==="Width"?["Left","Right"]:["Top","Bottom"],o=r.toLowerCase(),u={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?u["inner"+r].call(this):this.each(function(){e(this).css(o,i(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?u["outer"+r].call(this,t):this.each(function(){e(this).css(o,i(this,t,!0,n)+"px")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=parseFloat(t[1],10)===6}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},contains:e.contains,hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})}(jQuery),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a=t.split(".")[0];t=t.split(".")[1],i=a+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[a]=e[a]||{},s=e[a][t],o=e[a][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,i){e.isFunction(i)&&(r[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},r=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=r,s=i.apply(this,arguments),this._super=t,this._superApply=n,s}}())}),o.prototype=e.widget.extend(u,{widgetEventPrefix:u.widgetEventPrefix||t},r,{constructor:o,namespace:a,widgetName:t,widgetBaseClass:i,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():new i(o,this)}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetName,this),e.data(r,this.widgetFullName,this),this._on(this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n){var r,i=this;n?(t=r=e(t),this.bindings=this.bindings.add(t)):(n=t,t=this.element,r=this.widget()),e.each(n,function(n,s){function o(){if(i.options.disabled===!0||e(this).hasClass("ui-state-disabled"))return;return(typeof s=="string"?i[s]:s).apply(i,arguments)}typeof s!="string"&&(o.guid=s.guid=s.guid||o.guid||e.guid++);var u=n.match(/^(\w+)\s*(.*)$/),a=u[1]+i.eventNamespace,f=u[2];f?r.delegate(f,a,o):t.bind(a,o)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&(e.effects.effect[u]||e.uiBackCompat!==!1&&e.effects[u])?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(e,t){var n=!1;e(document).mouseup(function(e){n=!1}),e.widget("ui.mouse",{version:"1.9.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}})}(jQuery),function(e,t){function n(e,t,n){return[parseInt(e[0],10)*(h.test(e[0])?t/100:1),parseInt(e[1],10)*(h.test(e[1])?n/100:1)]}function r(t,n){return parseInt(e.css(t,n),10)||0}e.ui=e.ui||{};var i,s=Math.max,o=Math.abs,u=Math.round,a=/left|center|right/,f=/top|center|bottom/,l=/[\+\-]\d+%?/,c=/^\w+/,h=/%$/,p=e.fn.position;e.position={scrollbarWidth:function(){if(i!==t)return i;var n,r,s=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return e("body").append(s),n=o.offsetWidth,s.css("overflow","scroll"),r=o.offsetWidth,n===r&&(r=s[0].clientWidth),s.remove(),i=n-r},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return p.apply(this,arguments);t=e.extend({},t);var i,h,d,v,m,g=e(t.of),y=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(y),w=g[0],E=(t.collision||"flip").split(" "),S={};return w.nodeType===9?(h=g.width(),d=g.height(),v={top:0,left:0}):e.isWindow(w)?(h=g.width(),d=g.height(),v={top:g.scrollTop(),left:g.scrollLeft()}):w.preventDefault?(t.at="left top",h=d=0,v={top:w.pageY,left:w.pageX}):(h=g.outerWidth(),d=g.outerHeight(),v=g.offset()),m=e.extend({},v),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;e.length===1&&(e=a.test(e[0])?e.concat(["center"]):f.test(e[0])?["center"].concat(e):["center","center"]),e[0]=a.test(e[0])?e[0]:"center",e[1]=f.test(e[1])?e[1]:"center",n=l.exec(e[0]),r=l.exec(e[1]),S[this]=[n?n[0]:0,r?r[0]:0],t[this]=[c.exec(e[0])[0],c.exec(e[1])[0]]}),E.length===1&&(E[1]=E[0]),t.at[0]==="right"?m.left+=h:t.at[0]==="center"&&(m.left+=h/2),t.at[1]==="bottom"?m.top+=d:t.at[1]==="center"&&(m.top+=d/2),i=n(S.at,h,d),m.left+=i[0],m.top+=i[1],this.each(function(){var a,f,l=e(this),c=l.outerWidth(),p=l.outerHeight(),w=r(this,"marginLeft"),x=r(this,"marginTop"),T=c+w+r(this,"marginRight")+b.width,N=p+x+r(this,"marginBottom")+b.height,C=e.extend({},m),k=n(S.my,l.outerWidth(),l.outerHeight());t.my[0]==="right"?C.left-=c:t.my[0]==="center"&&(C.left-=c/2),t.my[1]==="bottom"?C.top-=p:t.my[1]==="center"&&(C.top-=p/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=u(C.left),C.top=u(C.top)),a={marginLeft:w,marginTop:x},e.each(["left","top"],function(n,r){e.ui.position[E[n]]&&e.ui.position[E[n]][r](C,{targetWidth:h,targetHeight:d,elemWidth:c,elemHeight:p,collisionPosition:a,collisionWidth:T,collisionHeight:N,offset:[i[0]+k[0],i[1]+k[1]],my:t.my,at:t.at,within:y,elem:l})}),e.fn.bgiframe&&l.bgiframe(),t.using&&(f=function(e){var n=v.left-C.left,r=n+h-c,i=v.top-C.top,u=i+d-p,a={target:{element:g,left:v.left,top:v.top,width:h,height:d},element:{element:l,left:C.left,top:C.top,width:c,height:p},horizontal:r<0?"left":n>0?"right":"center",vertical:u<0?"top":i>0?"bottom":"middle"};h<c&&o(n+r)<h&&(a.horizontal="center"),d<p&&o(i+u)<d&&(a.vertical="middle"),s(o(n),o(r))>s(o(i),o(u))?a.important="horizontal":a.important="vertical",t.using.call(this,e,a)}),l.offset(e.extend(C,{using:f}))})},e.ui.position={fit:{left:function(e,t){var n=t.within,r=n.isWindow?n.scrollLeft:n.offset.left,i=n.width,o=e.left-t.collisionPosition.marginLeft,u=r-o,a=o+t.collisionWidth-i-r,f;t.collisionWidth>i?u>0&&a<=0?(f=e.left+u+t.collisionWidth-i-r,e.left+=u-f):a>0&&u<=0?e.left=r:u>a?e.left=r+i-t.collisionWidth:e.left=r:u>0?e.left+=u:a>0?e.left-=a:e.left=s(e.left-o,e.left)},top:function(e,t){var n=t.within,r=n.isWindow?n.scrollTop:n.offset.top,i=t.within.height,o=e.top-t.collisionPosition.marginTop,u=r-o,a=o+t.collisionHeight-i-r,f;t.collisionHeight>i?u>0&&a<=0?(f=e.top+u+t.collisionHeight-i-r,e.top+=u-f):a>0&&u<=0?e.top=r:u>a?e.top=r+i-t.collisionHeight:e.top=r:u>0?e.top+=u:a>0?e.top-=a:e.top=s(e.top-o,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,i=n.width,s=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-s,f=u+t.collisionWidth-i-s,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;if(a<0){p=e.left+l+c+h+t.collisionWidth-i-r;if(p<0||p<o(a))e.left+=l+c+h}else if(f>0){d=e.left-t.collisionPosition.marginLeft+l+c+h-s;if(d>0||o(d)<f)e.left+=l+c+h}},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,i=n.height,s=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-s,f=u+t.collisionHeight-i-s,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;a<0?(v=e.top+c+h+p+t.collisionHeight-i-r,e.top+c+h+p>a&&(v<0||v<o(a))&&(e.top+=c+h+p)):f>0&&(d=e.top-t.collisionPosition.marginTop+c+h+p-s,e.top+c+h+p>f&&(d>0||o(d)<f)&&(e.top+=c+h+p))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&i<11,t.innerHTML="",n.removeChild(t)}(),e.uiBackCompat!==!1&&function(e){var n=e.fn.position;e.fn.position=function(r){if(!r||!r.offset)return n.call(this,r);var i=r.offset.split(" "),s=r.at.split(" ");return i.length===1&&(i[1]=i[0]),/^\d/.test(i[0])&&(i[0]="+"+i[0]),/^\d/.test(i[1])&&(i[1]="+"+i[1]),s.length===1&&(/left|center|right/.test(s[0])?s[1]="center":(s[1]=s[0],s[0]="center")),n.call(this,e.extend(r,{at:s[0]+i[0]+" "+s[1]+i[1],offset:t}))}}(jQuery)}(jQuery),function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);var r=this.element[0],i=!1;while(r&&(r=r.parentNode))r==document&&(i=!0);if(!i&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var s=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",t)!==!1&&s._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo),r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[t.containment=="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e(t.containment),r=n[0];if(!r)return;var i=n.offset(),s=e(r).css("overflow")!="hidden";this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else t.containment.constructor==Array&&(this.containment=t.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var a=this.relative_container.offset();u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]}else u=this.containment;t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left),t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top),t.pageX-this.offset.click.left>u[2]&&(s=u[2]+this.offset.click.left),t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top)}if(n.grid){var f=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3]?f-this.offset.click.top<u[1]?f+n.grid[1]:f-n.grid[1]:f:f;var l=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2]?l-this.offset.click.left<u[0]?l+n.grid[0]:l-n.grid[0]:l:l}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("draggable"),i=this,s=function(t){var n=this.offset.click.top,r=this.offset.click.left,i=this.positionAbs.top,s=this.positionAbs.left,o=t.height,u=t.width,a=t.top,f=t.left;return e.ui.isOver(i+n,s+r,a,f,o,u)};e.each(r.sortables,function(s){var o=!1,u=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!=u&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,n){var r=e("body"),i=e(this).data("draggable").options;r.css("cursor")&&(i._cursor=r.css("cursor")),r.css("cursor",i.cursor)},stop:function(t,n){var r=e(this).data("draggable").options;r._cursor&&e("body").css("cursor",r._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(t,n){var r=e(this).data("draggable");r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"&&(r.overflowOffset=r.scrollParent.offset())},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=!1;if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"){if(!i.axis||i.axis!="x")r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed);if(!i.axis||i.axis!="y")r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed)}else{if(!i.axis||i.axis!="x")t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed));if(!i.axis||i.axis!="y")t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))}s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,n){var r=e(this).data("draggable"),i=r.options;r.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e(this),n=t.offset();this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height;for(var l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,d=p+r.snapElements[l].height;if(!(c-s<o&&o<h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=!1;continue}if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s,m=Math.abs(d-a)<=s,g=Math.abs(c-u)<=s,y=Math.abs(h-o)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left)}var b=v||m||g||y;if(i.snapMode!="outer"){var v=Math.abs(p-a)<=s,m=Math.abs(d-f)<=s,g=Math.abs(c-o)<=s,y=Math.abs(h-u)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[l].snapping&&(v||m||g||y||b)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=v||m||g||y||b}}}),e.ui.plugin.add("draggable","stack",{start:function(t,n){var r=e(this).data("draggable").options,i=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!i.length)return;var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})}(jQuery),function(e,t){e.widget("ui.droppable",{version:"1.9.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,n=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];for(var n=0;n<t.length;n++)t[n]==this&&t.splice(n,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,n){t=="accept"&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var r=n||e.ui.ddmanager.current;if(!r||(r.currentItem||r.element)[0]==this.element[0])return!1;var i=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance))return i=!0,!1}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(t,n,r){if(!n.offset)return!1;var i=(t.positionAbs||t.position.absolute).left,s=i+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,u=o+t.helperProportions.height,a=n.offset.left,f=a+n.proportions.width,l=n.offset.top,c=l+n.proportions.height;switch(r){case"fit":return a<=i&&s<=f&&l<=o&&u<=c;case"intersect":return a<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<f&&l<o+t.helperProportions.height/2&&u-t.helperProportions.height/2<c;case"pointer":var h=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,d=e.ui.isOver(p,h,l,a,n.proportions.height,n.proportions.width);return d;case"touch":return(o>=l&&o<=c||u>=l&&u<=c||o<l&&u>c)&&(i>=a&&i<=f||s>=a&&s<=f||i<a&&s>f);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r=e.ui.ddmanager.droppables[t.options.scope]||[],i=n?n.type:null,s=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var o=0;o<r.length;o++){if(r[o].options.disabled||t&&!r[o].accept.call(r[o].element[0],t.currentItem||t.element))continue;for(var u=0;u<s.length;u++)if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e}r[o].visible=r[o].element.css("display")!="none";if(!r[o].visible)continue;i=="mousedown"&&r[o]._activate.call(r[o],n),r[o].offset=r[o].element.offset(),r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight}}},drop:function(t,n){var r=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,n))}),r},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var r=e.ui.intersect(t,this,this.options.tolerance),i=!r&&this.isover==1?"isout":r&&this.isover==0?"isover":null;if(!i)return;var s;if(this.options.greedy){var o=this.options.scope,u=this.element.parents(":data(droppable)").filter(function(){return e.data(this,"droppable").options.scope===o});u.length&&(s=e.data(u[0],"droppable"),s.greedyChild=i=="isover"?1:0)}s&&i=="isover"&&(s.isover=0,s.isout=1,s._out.call(s,n)),this[i]=1,this[i=="isout"?"isover":"isout"]=0,this[i=="isover"?"_over":"_out"].call(this,n),s&&i=="isout"&&(s.isout=0,s.isover=1,s._over.call(s,n))})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),function(e,t){e.widget("ui.resizable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,n=this.options;this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=n.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor==String){this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw");var r=this.handles.split(",");this.handles={};for(var i=0;i<r.length;i++){var s=e.trim(r[i]),o="ui-resizable-"+s,u=e('<div class="ui-resizable-handle '+o+'"></div>');u.css({zIndex:n.zIndex}),"se"==s&&u.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(u)}}this._renderAxis=function(t){t=t||this.element;for(var n in this.handles){this.handles[n].constructor==String&&(this.handles[n]=e(this.handles[n],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var r=e(this.handles[n],this.element),i=0;i=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth();var s=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join("");t.css(s,i),this._proportionallyResize()}if(!e(this.handles[n]).length)continue}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}}),n.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(n.disabled)return;e(this).removeClass("ui-resizable-autohide"),t._handles.show()}).mouseleave(function(){if(n.disabled)return;t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var n=this.element;this.originalElement.css({position:n.css("position"),width:n.outerWidth(),height:n.outerHeight(),top:n.css("top"),left:n.css("left")}).insertAfter(n),n.remove()}return this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var n=!1;for(var r in this.handles)e(this.handles[r])[0]==t.target&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var r=this.options,i=this.element.position(),s=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(s.is(".ui-draggable")||/absolute/.test(s.css("position")))&&s.css({position:"absolute",top:i.top,left:i.left}),this._renderProxy();var o=n(this.helper.css("left")),u=n(this.helper.css("top"));r.containment&&(o+=e(r.containment).scrollLeft()||0,u+=e(r.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:o,top:u},this.size=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.originalPosition={left:o,top:u},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio=typeof r.aspectRatio=="number"?r.aspectRatio:this.originalSize.width/this.originalSize.height||1;var a=e(".ui-resizable-"+this.axis).css("cursor");return e("body").css("cursor",a=="auto"?this.axis+"-resize":a),s.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(e){var t=this.helper,n=this.options,r={},i=this,s=this.originalMousePosition,o=this.axis,u=e.pageX-s.left||0,a=e.pageY-s.top||0,f=this._change[o];if(!f)return!1;var l=f.apply(this,[e,u,a]);this._updateVirtualBoundaries(e.shiftKey);if(this._aspectRatio||e.shiftKey)l=this._updateRatio(l,e);return l=this._respectSize(l,e),this._propagate("resize",e),t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(l),this._trigger("resize",e,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var n=this.options,r=this;if(this._helper){var i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:r.sizeDiff.height,u=s?0:r.sizeDiff.width,a={width:r.helper.width()-u,height:r.helper.height()-o},f=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,l=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;n.animate||this.element.css(e.extend(a,{top:l,left:f})),r.helper.height(r.size.height),r.helper.width(r.size.width),this._helper&&!n.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t=this.options,n,i,s,o,u;u={minWidth:r(t.minWidth)?t.minWidth:0,maxWidth:r(t.maxWidth)?t.maxWidth:Infinity,minHeight:r(t.minHeight)?t.minHeight:0,maxHeight:r(t.maxHeight)?t.maxHeight:Infinity};if(this._aspectRatio||e)n=u.minHeight*this.aspectRatio,s=u.minWidth/this.aspectRatio,i=u.maxHeight*this.aspectRatio,o=u.maxWidth/this.aspectRatio,n>u.minWidth&&(u.minWidth=n),s>u.minHeight&&(u.minHeight=s),i<u.maxWidth&&(u.maxWidth=i),o<u.maxHeight&&(u.maxHeight=o);this._vBoundaries=u},_updateCache:function(e){var t=this.options;this.offset=this.helper.offset(),r(e.left)&&(this.position.left=e.left),r(e.top)&&(this.position.top=e.top),r(e.height)&&(this.size.height=e.height),r(e.width)&&(this.size.width=e.width)},_updateRatio:function(e,t){var n=this.options,i=this.position,s=this.size,o=this.axis;return r(e.height)?e.width=e.height*this.aspectRatio:r(e.width)&&(e.height=e.width/this.aspectRatio),o=="sw"&&(e.left=i.left+(s.width-e.width),e.top=null),o=="nw"&&(e.top=i.top+(s.height-e.height),e.left=i.left+(s.width-e.width)),e},_respectSize:function(e,t){var n=this.helper,i=this._vBoundaries,s=this._aspectRatio||t.shiftKey,o=this.axis,u=r(e.width)&&i.maxWidth&&i.maxWidth<e.width,a=r(e.height)&&i.maxHeight&&i.maxHeight<e.height,f=r(e.width)&&i.minWidth&&i.minWidth>e.width,l=r(e.height)&&i.minHeight&&i.minHeight>e.height;f&&(e.width=i.minWidth),l&&(e.height=i.minHeight),u&&(e.width=i.maxWidth),a&&(e.height=i.maxHeight);var c=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,p=/sw|nw|w/.test(o),d=/nw|ne|n/.test(o);f&&p&&(e.left=c-i.minWidth),u&&p&&(e.left=c-i.maxWidth),l&&d&&(e.top=h-i.minHeight),a&&d&&(e.top=h-i.maxHeight);var v=!e.width&&!e.height;return v&&!e.left&&e.top?e.top=null:v&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){var t=this.options;if(!this._proportionallyResizeElements.length)return;var n=this.helper||this.element;for(var r=0;r<this._proportionallyResizeElements.length;r++){var i=this._proportionallyResizeElements[r];if(!this.borderDif){var s=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],o=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")];this.borderDif=e.map(s,function(e,t){var n=parseInt(e,10)||0,r=parseInt(o[t],10)||0;return n+r})}i.css({height:n.height()-this.borderDif[0]-this.borderDif[2]||0,width:n.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset();if(this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var r=e.ui.ie6?1:0,i=e.ui.ie6?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+i,height:this.element.outerHeight()+i,position:"absolute",left:this.elementOffset.left-r+"px",top:this.elementOffset.top-r+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t,n){return{width:this.originalSize.width+t}},w:function(e,t,n){var r=this.options,i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,n){var r=this.options,i=this.originalSize,s=this.originalPosition;return{top:s.top+n,height:i.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),t!="resize"&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","alsoResize",{start:function(t,n){var r=e(this).data("resizable"),i=r.options,s=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};typeof i.alsoResize=="object"&&!i.alsoResize.parentNode?i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):e.each(i.alsoResize,function(e){s(e)}):s(i.alsoResize)},resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);n&&n>=0&&(s[t]=n||null)}),t.css(s)})};typeof i.alsoResize=="object"&&!i.alsoResize.nodeType?e.each(i.alsoResize,function(e,t){a(e,t)}):a(i.alsoResize)},stop:function(t,n){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","animate",{stop:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r._proportionallyResizeElements,o=s.length&&/textarea/i.test(s[0].nodeName),u=o&&e.ui.hasScroll(s[0],"left")?0:r.sizeDiff.height,a=o?0:r.sizeDiff.width,f={width:r.size.width-a,height:r.size.height-u},l=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,c=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;r.element.animate(e.extend(f,c&&l?{top:c,left:l}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var n={width:parseInt(r.element.css("width"),10),height:parseInt(r.element.css("height"),10),top:parseInt(r.element.css("top"),10),left:parseInt(r.element.css("left"),10)};s&&s.length&&e(s[0]).css({width:n.width,height:n.height}),r._updateCache(n),r._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(t,r){var i=e(this).data("resizable"),s=i.options,o=i.element,u=s.containment,a=u instanceof e?u.get(0):/parent/.test(u)?o.parent().get(0):u;if(!a)return;i.containerElement=e(a);if(/document/.test(u)||u==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var f=e(a),l=[];e(["Top","Right","Left","Bottom"]).each(function(e,t){l[e]=n(f.css("padding"+t))}),i.containerOffset=f.offset(),i.containerPosition=f.position(),i.containerSize={height:f.innerHeight()-l[3],width:f.innerWidth()-l[1]};var c=i.containerOffset,h=i.containerSize.height,p=i.containerSize.width,d=e.ui.hasScroll(a,"left")?a.scrollWidth:p,v=e.ui.hasScroll(a)?a.scrollHeight:h;i.parentData={element:a,left:c.left,top:c.top,width:d,height:v}}},resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.containerSize,o=r.containerOffset,u=r.size,a=r.position,f=r._aspectRatio||t.shiftKey,l={top:0,left:0},c=r.containerElement;c[0]!=document&&/static/.test(c.css("position"))&&(l=o),a.left<(r._helper?o.left:0)&&(r.size.width=r.size.width+(r._helper?r.position.left-o.left:r.position.left-l.left),f&&(r.size.height=r.size.width/r.aspectRatio),r.position.left=i.helper?o.left:0),a.top<(r._helper?o.top:0)&&(r.size.height=r.size.height+(r._helper?r.position.top-o.top:r.position.top),f&&(r.size.width=r.size.height*r.aspectRatio),r.position.top=r._helper?o.top:0),r.offset.left=r.parentData.left+r.position.left,r.offset.top=r.parentData.top+r.position.top;var h=Math.abs((r._helper?r.offset.left-l.left:r.offset.left-l.left)+r.sizeDiff.width),p=Math.abs((r._helper?r.offset.top-l.top:r.offset.top-o.top)+r.sizeDiff.height),d=r.containerElement.get(0)==r.element.parent().get(0),v=/relative|absolute/.test(r.containerElement.css("position"));d&&v&&(h-=r.parentData.left),h+r.size.width>=r.parentData.width&&(r.size.width=r.parentData.width-h,f&&(r.size.height=r.size.width/r.aspectRatio)),p+r.size.height>=r.parentData.height&&(r.size.height=r.parentData.height-p,f&&(r.size.width=r.size.height*r.aspectRatio))},stop:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.position,o=r.containerOffset,u=r.containerPosition,a=r.containerElement,f=e(r.helper),l=f.offset(),c=f.outerWidth()-r.sizeDiff.width,h=f.outerHeight()-r.sizeDiff.height;r._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:l.left-u.left-o.left,width:c,height:h}),r._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:l.left-u.left-o.left,width:c,height:h})}}),e.ui.plugin.add("resizable","ghost",{start:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.size;r.ghost=r.originalElement.clone(),r.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof i.ghost=="string"?i.ghost:""),r.ghost.appendTo(r.helper)},resize:function(t,n){var r=e(this).data("resizable"),i=r.options;r.ghost&&r.ghost.css({position:"relative",height:r.size.height,width:r.size.width})},stop:function(t,n){var r=e(this).data("resizable"),i=r.options;r.ghost&&r.helper&&r.helper.get(0).removeChild(r.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.size,o=r.originalSize,u=r.originalPosition,a=r.axis,f=i._aspectRatio||t.shiftKey;i.grid=typeof i.grid=="number"?[i.grid,i.grid]:i.grid;var l=Math.round((s.width-o.width)/(i.grid[0]||1))*(i.grid[0]||1),c=Math.round((s.height-o.height)/(i.grid[1]||1))*(i.grid[1]||1);/^(se|s|e)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c):/^(ne)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c,r.position.top=u.top-c):/^(sw)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c,r.position.left=u.left-l):(r.size.width=o.width+l,r.size.height=o.height+c,r.position.top=u.top-c,r.position.left=u.left-l)}});var n=function(e){return parseInt(e,10)||0},r=function(e){return!isNaN(parseInt(e,10))}}(jQuery),function(e,t){e.widget("ui.selectable",e.ui.mouse,{version:"1.9.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable"),this.dragged=!1;var n;this.refresh=function(){n=e(t.options.filter,t.element[0]),n.addClass("ui-selectee"),n.each(function(){var t=e(this),n=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=n.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var n=this;this.opos=[t.pageX,t.pageY];if(this.options.disabled)return;var r=this.options;this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=!0,!t.metaKey&&!t.ctrlKey&&(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,n._trigger("unselecting",t,{unselecting:r.element}))}),e(t.target).parents().andSelf().each(function(){var r=e.data(this,"selectable-item");if(r){var i=!t.metaKey&&!t.ctrlKey||!r.$element.hasClass("ui-selected");return r.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting"),r.unselecting=!i,r.selecting=i,r.selected=i,i?n._trigger("selecting",t,{selecting:r.element}):n._trigger("unselecting",t,{unselecting:r.element}),!1}})},_mouseDrag:function(t){var n=this;this.dragged=!0;if(this.options.disabled)return;var r=this.options,i=this.opos[0],s=this.opos[1],o=t.pageX,u=t.pageY;if(i>o){var a=o;o=i,i=a}if(s>u){var a=u;u=s,s=a}return this.helper.css({left:i,top:s,width:o-i,height:u-s}),this.selectees.each(function(){var a=e.data(this,"selectable-item");if(!a||a.element==n.element[0])return;var f=!1;r.tolerance=="touch"?f=!(a.left>o||a.right<i||a.top>u||a.bottom<s):r.tolerance=="fit"&&(f=a.left>i&&a.right<o&&a.top>s&&a.bottom<u),f?(a.selected&&(a.$element.removeClass("ui-selected"),a.selected=!1),a.unselecting&&(a.$element.removeClass("ui-unselecting"),a.unselecting=!1),a.selecting||(a.$element.addClass("ui-selecting"),a.selecting=!0,n._trigger("selecting",t,{selecting:a.element}))):(a.selecting&&((t.metaKey||t.ctrlKey)&&a.startselected?(a.$element.removeClass("ui-selecting"),a.selecting=!1,a.$element.addClass("ui-selected"),a.selected=!0):(a.$element.removeClass("ui-selecting"),a.selecting=!1,a.startselected&&(a.$element.addClass("ui-unselecting"),a.unselecting=!0),n._trigger("unselecting",t,{unselecting:a.element}))),a.selected&&!t.metaKey&&!t.ctrlKey&&!a.startselected&&(a.$element.removeClass("ui-selected"),a.selected=!1,a.$element.addClass("ui-unselecting"),a.unselecting=!0,n._trigger("unselecting",t,{unselecting:a.element})))}),!1},_mouseStop:function(t){var n=this;this.dragged=!1;var r=this.options;return e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,n._trigger("unselected",t,{unselected:r.element})}),e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,n._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e,t){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){t==="disabled"?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(t);var i=null,s=e(t.target).parents().each(function(){if(e.data(this,r.widgetName+"-item")==r)return i=e(this),!1});e.data(t.target,r.widgetName+"-item")==r&&(i=e(t.target));if(!i)return!1;if(this.options.handle&&!n){var o=!1;e(this.options.handle,i).find("*").andSelf().each(function(){this==t.target&&(o=!0)});if(!o)return!1}return this.currentItem=i,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,n,r){var i=this.options;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),i.containment&&this._setContainment(),i.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",i.cursor)),i.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",i.opacity)),i.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",i.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!r)for(var s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var n=this.options,r=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed)),t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var i=this.items.length-1;i>=0;i--){var s=this.items[i],o=s.item[0],u=this._intersectsWithPointer(s);if(!u)continue;if(s.instance!==this.currentContainer)continue;if(o!=this.currentItem[0]&&this.placeholder[u==1?"next":"prev"]()[0]!=o&&!e.contains(this.placeholder[0],o)&&(this.options.type=="semi-dynamic"?!e.contains(this.element[0],o):!0)){this.direction=u==1?"down":"up";if(this.options.tolerance!="pointer"&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(!t)return;e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t);if(this.options.revert){var r=this,i=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c=r+f>u&&r+f<a&&t+l>s&&t+l<o;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a},_intersectsWithPointer:function(t){var n=this.options.axis==="x"||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),r=this.options.axis==="y"||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&o=="right"||s=="down"?2:1:s&&(s=="down"?2:1):!1},_intersectsWithSides:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),r=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?s=="right"&&r||s=="left"&&!r:i&&(i=="down"&&n||i=="up"&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!=0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!=0&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n=[],r=[],i=this._connectWith();if(i&&t)for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);a&&a!=this&&!a.options.disabled&&r.push([e.isFunction(a.options.items)?a.options.items.call(a.element):e(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a])}}r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var s=r.length-1;s>=0;s--)r[s][0].each(function(){n.push(this)});return e(n)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++)if(t[n]==e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n=this.items,r=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],i=this._connectWith();if(i&&this.ready)for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);a&&a!=this&&!a.options.disabled&&(r.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a))}}for(var s=r.length-1;s>=0;s--){var f=r[s][1],l=r[s][0];for(var u=0,c=l.length;u<c;u++){var h=e(l[u]);h.data(this.widgetName+"-item",f),n.push({item:h,instance:f,width:0,height:0,left:0,top:0})}}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var n=this.items.length-1;n>=0;n--){var r=this.items[n];if(r.instance!=this.currentContainer&&this.currentContainer&&r.item[0]!=this.currentItem[0])continue;var i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item;t||(r.width=i.outerWidth(),r.height=i.outerHeight());var s=i.offset();r.left=s.left,r.top=s.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var n=this.containers.length-1;n>=0;n--){var s=this.containers[n].element.offset();this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight()}return this},_createPlaceholder:function(t){t=t||this;var n=t.options;if(!n.placeholder||n.placeholder.constructor==String){var r=n.placeholder;n.placeholder={element:function(){var n=e(document.createElement(t.currentItem[0].nodeName)).addClass(r||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return r||(n.style.visibility="hidden"),n},update:function(e,i){if(r&&!n.forcePlaceholderSize)return;i.height()||i.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),i.width()||i.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}}}t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),n.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var n=null,r=null;for(var i=this.containers.length-1;i>=0;i--){if(e.contains(this.currentItem[0],this.containers[i].element[0]))continue;if(this._intersectsWith(this.containers[i].containerCache)){if(n&&e.contains(this.containers[i].element[0],n.element[0]))continue;n=this.containers[i],r=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0)}if(!n)return;if(this.containers.length===1)this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1;else{var s=1e4,o=null,u=this.containers[r].floating?"left":"top",a=this.containers[r].floating?"width":"height",f=this.positionAbs[u]+this.offset.click[u];for(var l=this.items.length-1;l>=0;l--){if(!e.contains(this.containers[r].element[0],this.items[l].item[0]))continue;if(this.items[l].item[0]==this.currentItem[0])continue;var c=this.items[l].item.offset()[u],h=!1;Math.abs(c-f)>Math.abs(c+this.items[l][a]-f)&&(h=!0,c+=this.items[l][a]),Math.abs(c-f)<s&&(s=Math.abs(c-f),o=this.items[l],this.direction=h?"up":"down")}if(!o&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[r],o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[r].element,!0),this._trigger("change",t,this._uiHash()),this.containers[r]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper=="clone"?this.currentItem.clone():this.currentItem;return r.parents("body").length||e(n.appendTo!="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(r[0].style.width==""||n.forceHelperSize)&&r.width(this.currentItem.width()),(r[0].style.height==""||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)){var n=e(t.containment)[0],r=e(t.containment).offset(),i=e(n).css("overflow")!="hidden";this.containment=[r.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,r.left+(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var s=t.pageX,o=t.pageY;if(this.originalPosition){this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top));if(n.grid){var u=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1];o=this.containment?u-this.offset.click.top<this.containment[1]||u-this.offset.click.top>this.containment[3]?u-this.offset.click.top<this.containment[1]?u+n.grid[1]:u-n.grid[1]:u:u;var a=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0];s=this.containment?a-this.offset.click.left<this.containment[0]||a-this.offset.click.left>this.containment[2]?a-this.offset.click.left<this.containment[0]?a+n.grid[0]:a-n.grid[0]:a:a}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i==this.counter&&this.refreshPositions(!r)})},_clear:function(t,n){this.reverting=!1;var r=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS)if(this._storedCSS[i]=="auto"||this._storedCSS[i]=="static")this._storedCSS[i]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!n&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!n&&r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(n||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(var i=this.containers.length-1;i>=0;i--)n||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",t,this._uiHash());for(var i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}n||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!n){for(var i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery),function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var t,r,i=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",u=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(i.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),i.range&&(i.range===!0&&(i.values||(i.values=[this._valueMin(),this._valueMin()]),i.values.length&&i.values.length!==2&&(i.values=[i.values[0],i.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(i.range==="min"||i.range==="max"?" ui-slider-range-"+i.range:""))),r=i.values&&i.values.length||1;for(t=s.length;t<r;t++)u.push(o);this.handles=s.add(e(u.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){i.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){i.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._on(this.handles,{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);if(r===!1)return}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));i>n&&(i=n,s=e(this),o=t)}),c.range===!0&&this.values(1)===c.min&&(o+=1,s=e(this.handles[o])),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))}})}(jQuery),function(e){function t(t,n){var r=(t.attr("aria-describedby")||"").split(/\s+/);r.push(n),t.data("ui-tooltip-id",n).attr("aria-describedby",e.trim(r.join(" ")))}function n(t){var n=t.data("ui-tooltip-id"),r=(t.attr("aria-describedby")||"").split(/\s+/),i=e.inArray(n,r);i!==-1&&r.splice(i,1),t.removeData("ui-tooltip-id"),r=e.trim(r.join(" ")),r?t.attr("aria-describedby",r):t.removeAttr("aria-describedby")}var r=0;e.widget("ui.tooltip",{version:"1.9.1",options:{content:function(){return e(this).attr("title")},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flipfit"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,n){var r=this;if(t==="disabled"){this[n?"_disable":"_enable"](),this.options[t]=n;return}this._super(t,n),t==="content"&&e.each(this.tooltips,function(e,t){r._updateContent(t)})},_disable:function(){var t=this;e.each(this.tooltips,function(n,r){var i=e.Event("blur");i.target=i.currentTarget=r[0],t.close(i,!0)}),this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var n=this,r=e(t?t.target:this.element).closest(this.options.items);if(!r.length)return;if(this.options.track&&r.data("ui-tooltip-id")){this._find(r).position(e.extend({of:r},this.options.position)),this._off(this.document,"mousemove");return}r.attr("title")&&r.data("ui-tooltip-title",r.attr("title")),r.data("tooltip-open",!0),t&&t.type==="mouseover"&&r.parents().each(function(){var t;e(this).data("tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,n.close(t,!0)),this.title&&(e(this).uniqueId(),n.parents[this.id]={element:this,title:this.title},this.title="")}),this._updateContent(r,t)},_updateContent:function(e,t){var n,r=this.options.content,i=this;if(typeof r=="string")return this._open(t,e,r);n=r.call(e[0],function(n){if(!e.data("tooltip-open"))return;i._delay(function(){this._open(t,e,n)})}),n&&this._open(t,e,n)},_open:function(n,r,i){function s(e){f.of=e;if(o.is(":hidden"))return;o.position(f)}var o,u,a,f=e.extend({},this.options.position);if(!i)return;o=this._find(r);if(o.length){o.find(".ui-tooltip-content").html(i);return}r.is("[title]")&&(n&&n.type==="mouseover"?r.attr("title",""):r.removeAttr("title")),o=this._tooltip(r),t(r,o.attr("id")),o.find(".ui-tooltip-content").html(i),this.options.track&&n&&/^mouse/.test(n.originalEvent.type)?(this._on(this.document,{mousemove:s}),s(n)):o.position(e.extend({of:r},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.show&&this.options.show.delay&&(a=setInterval(function(){o.is(":visible")&&(s(f.of),clearInterval(a))},e.fx.interval)),this._trigger("open",n,{tooltip:o}),u={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var n=e.Event(t);n.currentTarget=r[0],this.close(n,!0)}},remove:function(){this._removeTooltip(o)}};if(!n||n.type==="mouseover")u.mouseleave="close";if(!n||n.type==="focusin")u.focusout="close";this._on(r,u)},close:function(t){var r=this,i=e(t?t.currentTarget:this.element),s=this._find(i);if(this.closing)return;i.data("ui-tooltip-title")&&i.attr("title",i.data("ui-tooltip-title")),n(i),s.stop(!0),this._hide(s,this.options.hide,function(){r._removeTooltip(e(this))}),i.removeData("tooltip-open"),this._off(i,"mouseleave focusout keyup"),i[0]!==this.element[0]&&this._off(i,"remove"),this._off(this.document,"mousemove"),t&&t.type==="mouseleave"&&e.each(this.parents,function(e,t){t.element.title=t.title,delete r.parents[e]}),this.closing=!0,this._trigger("close",t,{tooltip:s}),this.closing=!1},_tooltip:function(t){var n="ui-tooltip-"+r++,i=e("<div>").attr({id:n,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),e.fn.bgiframe&&i.bgiframe(),this.tooltips[n]=t,i},_find:function(t){var n=t.data("ui-tooltip-id");return n?e("#"+n):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(n,r){var i=e.Event("blur");i.target=i.currentTarget=r[0],t.close(i,!0),e("#"+n).remove(),r.data("ui-tooltip-title")&&(r.attr("title",r.data("ui-tooltip-title")),r.removeData("ui-tooltip-title"))})}})}(jQuery),define("bundles/framework/bundle/oskariui/jquery-ui-1.9.1.custom.min",function(){}),jQuery.base64=function(e){function i(e,t){var r=n.indexOf(e.charAt(t));if(r===-1)throw"Cannot decode base64";return r}function s(e){var n=0,r,s,o=e.length,u=[];e=String(e);if(o===0)return e;if(o%4!==0)throw"Cannot decode base64";e.charAt(o-1)===t&&(n=1,e.charAt(o-2)===t&&(n=2),o-=4);for(r=0;r<o;r+=4)s=i(e,r)<<18|i(e,r+1)<<12|i(e,r+2)<<6|i(e,r+3),u.push(String.fromCharCode(s>>16,s>>8&255,s&255));switch(n){case 1:s=i(e,r)<<18|i(e,r+1)<<12|i(e,r+2)<<6,u.push(String.fromCharCode(s>>16,s>>8&255));break;case 2:s=i(e,r)<<18|i(e,r+1)<<12,u.push(String.fromCharCode(s>>16))}return u.join("")}function o(e,t){var n=e.charCodeAt(t);if(n>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return n}function u(e){if(arguments.length!==1)throw"SyntaxError: exactly one argument required";e=String(e);var r,i,s=[],u=e.length-e.length%3;if(e.length===0)return e;for(r=0;r<u;r+=3)i=o(e,r)<<16|o(e,r+1)<<8|o(e,r+2),s.push(n.charAt(i>>18)),s.push(n.charAt(i>>12&63)),s.push(n.charAt(i>>6&63)),s.push(n.charAt(i&63));switch(e.length-u){case 1:i=o(e,r)<<16,s.push(n.charAt(i>>18)+n.charAt(i>>12&63)+t+t);break;case 2:i=o(e,r)<<16|o(e,r+1)<<8,s.push(n.charAt(i>>18)+n.charAt(i>>12&63)+n.charAt(i>>6&63)+t)}return s.join("")}var t="=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="1.0";return{decode:s,encode:u,VERSION:r}}(jQuery),define("libraries/jquery/plugins/jquery.base64.min",function(){}),define("normalize",["require","module"],function(e,t){function o(e,t,n){if(e.indexOf("data:")===0)return e;e=r(e);if(e.match(/^\//)||e.match(s))return e;var i=n.match(s),o=t.match(s);return o&&(!i||i[1]!=o[1]||i[2]!=o[2])?u(e,t):a(u(e,t),n)}function u(e,t){e.substr(0,2)=="./"&&(e=e.substr(2));var n=t.split("/"),r=e.split("/");n.pop();while(curPart=r.shift())curPart==".."?n.pop():n.push(curPart);return n.join("/")}function a(e,t){var n=t.split("/");n.pop(),t=n.join("/")+"/",i=0;while(t.substr(i,1)==e.substr(i,1))i++;while(t.substr(i,1)!="/")i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var r=e.split("/");out="";while(n.shift())out+="../";while(curPart=r.shift())out+=curPart+"/";return out.substr(0,out.length-1)}var n=/([^:])\/+/g,r=function(e){return e.replace(n,"$1/")},s=/[^\:\/]*:\/\/([^\/])*/,f=function(e,t,n,i){t=r(t),n=r(n);var s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/ig,u,a,e;while(u=s.exec(e)){a=u[3]||u[2]||u[5]||u[6]||u[4];var f;i&&a.substr(0,1)=="/"?f=i+a:f=o(a,t,n);var l=u[5]||u[6]?1:0;e=e.substr(0,s.lastIndex-a.length-l-1)+f+e.substr(s.lastIndex-l-1),s.lastIndex=s.lastIndex+(f.length-a.length)}return e};return f.convertURIBase=o,f}),define("css",["./normalize"],function(e){function t(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}if(typeof window=="undefined")return{load:function(e,t,n){n()}};var n=!1,r=document.getElementsByTagName("head")[0],i=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),s=!1;!i||(i[1]||i[7]?(s=parseInt(i[1])<6||parseInt(i[7])<=9,i="trident"):i[2]?(s=!0,i="webkit"):i[3]||(i[4]?(s=parseInt(i[4])<18,i="gecko"):n&&alert("Engine detection failed")));var o={},u=/^\/|([^\:\/]*:)/;o.pluginBuilder="./css-builder";var a=[],f={},l=[];o.addBuffer=function(e){if(t(a,e)!=-1)return;if(t(l,e)!=-1)return;a.push(e),l.push(e)},o.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var s=i.join("/")+"/";s=e.convertURIBase(s,r,"/"),s.match(u)||(s="/"+s),s.substr(s.length-1,1)!="/"&&(s+="/"),o.inject(e(t,s,r));for(var l=0;l<a.length;l++)(n&&a[l].substr(a[l].length-5,5)==".less"||!n&&a[l].substr(a[l].length-4,4)==".css")&&(function(e){f[e]=f[e]||!0,setTimeout(function(){typeof f[e]=="function"&&f[e](),delete f[e]},7)}(a[l]),a.splice(l--,1))},o.attachBuffer=function(e,n){for(var r=0;r<a.length;r++)if(a[r]==e)return f[e]=n,!0;if(f[e]===!0)return f[e]=n,!0;if(t(l,e)!=-1)return n(),!0};var c=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}c(e,t)},10)},h=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}h(e,t)},10)};if(i=="trident"&&s)var p=[],d=[],v=0,m=function(e,t){var n;d.push({url:e,cb:t}),n=p.shift(),!n&&v++<31&&(n=document.createElement("style"),r.appendChild(n)),n&&g(n)},g=function(e){var t=d.shift();if(!t){e.onload=b,p.push(e);return}e.onload=function(){t.cb(t.ss),g(e)};var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]};var y=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},b=function(){};o.linkLoad=function(e,t){var o=setTimeout(function(){n&&alert("timeout"),t()},L*1e3-100),u=function(){clearTimeout(o),a&&(a.onload=b),setTimeout(t,7)};if(!s){var a=y(e);a.onload=u,r.appendChild(a)}else if(i=="webkit"){var a=y(e);c(a,u),r.appendChild(a)}else if(i=="gecko"){var f=document.createElement("style");f.textContent='@import "'+e+'"',h(f,u),r.appendChild(f)}else i=="trident"&&m(e,u)};var w=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],E={},S=function(e,t,n){if(E[e]){t(E[e]);return}var r,i,s;if(typeof XMLHttpRequest!="undefined")r=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){s=w[i];try{r=new ActiveXObject(s)}catch(o){}if(r){w=[s];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(i){var s,o;r.readyState===4&&(s=r.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=r,n(o)):(E[e]=r.responseText,t(r.responseText)))},r.send(null)},x=0,T;o.inject=function(e){x<31&&(T=document.createElement("style"),T.type="text/css",r.appendChild(T),x++),T.styleSheet?T.styleSheet.cssText+=e:T.appendChild(document.createTextNode(e))};var N=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,C=window.location.pathname.split("/");C.pop(),C=C.join("/")+"/";var k=function(t,n,r){t.match(u)||(t="/"+e.convertURIBase(t,C,"/")),S(t,function(i){i=e(i,t,C);var s=[],o=[],u=[],a;while(a=N.exec(i)){var f=a[4]||a[5]||a[7]||a[8]||a[9];s.push(f),o.push(N.lastIndex-a[0].length),u.push(a[0].length)}var l=0;for(var c=0;c<s.length;c++)(function(e){k(s[e],function(t){i=i.substr(0,o[e])+t+i.substr(o[e]+u[e]);var r=t.length-u[e];for(var a=e+1;a<s.length;a++)o[a]+=r;l++,l==s.length&&n(i)},r)})(c);s.length==0&&n(i)},r)};o.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)};var L,A=!1;return o.load=function(e,t,r,i,u){L=L||i.waitSeconds||7;var a=e+(u?".less":".css");if(o.attachBuffer(a,r))return;var f=t.toUrl(a);!A&&n&&(alert(s?"hacking links":"not hacking"),A=!0),u?k(f,function(e){u&&(e=u(e,function(e){o.inject(e),setTimeout(r,7)}))}):o.linkLoad(f,r)},n&&(o.inspect=function(){if(stylesheet.styleSheet)return stylesheet.styleSheet.cssText;if(stylesheet.innerHTML)return stylesheet.innerHTML}),o}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/oskariui/css/jquery-ui-1.9.1.custom.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/oskariui/bootstrap-grid.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.framework.bundle.oskariui.DomManager",function(e,t){this.$=e,this.partsMap=t||{},this.layout=null,this.layouts=[]},{getEl:function(e){return this.$(e)},getElForPart:function(e){return this.$(this.partsMap[e])},setElForPart:function(e,t){this.partsMap[e]=this.$(t)},setElParts:function(e){this.partsMap=e},getElParts:function(){return this.partsMap},pushLayout:function(e){this.layout&&this.layout.removeLayout(this),this.layout=e,this.layouts.push(e),e.applyLayout(this)},popLayout:function(){var e=this.layouts.pop();e&&e.removeLayout(this);if(this.layouts.length==0){this.layout=null;return}var e=this.layouts[this.layouts.length-1];this.layout=e,e.applyLayout(this)},getLayout:function(){return this.layout}},{protocol:["Oskari.dom.DomManager"]}),define("bundles/framework/bundle/oskariui/DomManager",function(){}),Oskari.clazz.define("Oskari.framework.bundle.oskariui.Layout",function(){},{applyLayout:function(e){},removeLayout:function(e){}},{protocol:["Oskari.dom.Layout"]}),define("bundles/framework/bundle/oskariui/Layout",function(){}),define("bundles/framework/bundle/oskariui/module",["oskari","jquery","./jquery-ui-1.9.1.custom.min","libraries/jquery/plugins/jquery.base64.min","css!resources/framework/bundle/oskariui/css/jquery-ui-1.9.1.custom.css","css!resources/framework/bundle/oskariui/bootstrap-grid.css","./DomManager","./Layout"],function(e,t){return e.bundleCls("oskariui").category({create:function(){return this},update:function(e,t,n,r){},start:function(){var n=this.conf.partsMap||{},r=e.clazz.create("Oskari.framework.bundle.oskariui.DomManager",t,n);e.setDomManager(r)},stop:function(){}})}),Oskari.clazz.define("Oskari.mapframework.domain.WfsLayer",function(){this._layerType="WFS"},{},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),define("bundles/framework/bundle/mapwfs/domain/WfsLayer",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.domain.WfsLayerModelBuilder",function(e){this.sandbox=e,this.localization=Oskari.getLocalization("MapWfs")},{parseLayerData:function(e,t,n){var r=this,i=this.localization["object-data"],s=Oskari.clazz.builder("Oskari.mapframework.domain.Tool"),o=s();o.setName("objectData"),o.setTitle(i),o.setTooltip(i),o.setCallback(function(){r.sandbox.postRequestByName("ShowFeatureDataRequest",[e.getId()])}),e.addTool(o)}}),define("bundles/framework/bundle/mapwfs/domain/WfsLayerModelBuilder",function(){}),Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTile",function(e){for(p in e)this[p]=e[p]},{getBounds:function(){return this.bounds}}),define("bundles/framework/bundle/mapwfs/domain/QueuedTile",function(){}),Oskari.clazz.define("Oskari.mapframework.gridcalc.TileQueue",function(){this.queue=[]},{getQueue:function(){return this.queue},getLength:function(){return this.queue.length},popJob:function(){var e=this.queue,t=e.length;if(t===0)return null;if(t<4)return e.shift(-1);var n=null,r=Math.floor(t/2);return n=e[r],this.queue=e.slice(0,r).concat(e.slice(r+1)),n},pushJob:function(e){this.queue.push(e)},flushQueue:function(){this.queue=[]}}),define("bundles/framework/bundle/mapwfs/domain/TileQueue",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.domain.WfsTileRequest",function(e,t,n,r,i,s){this._bbox=t,this._mapWidth=n,this._mapHeight=r,this._mapLayer=e,this._creator=i,this._sequenceNumber=s},{getMapLayer:function(){return this._mapLayer},getBbox:function(){return this._bbox},getMapWidth:function(){return this._mapWidth},getMapHeight:function(){return this._mapHeight},getSequenceNumber:function(){return this._sequenceNumber}}),define("bundles/framework/bundle/mapwfs/domain/WfsTileRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.event.WFSFeaturesSelectedEvent",function(e,t,n){this._wfsFeatureIds=e,this._addToSelection=n,this._mapLayer=t},{__name:"WFSFeaturesSelectedEvent",getName:function(){return this.__name},getWfsFeatureIds:function(){return this._wfsFeatureIds},isKeepSelection:function(){return this._addToSelection?this._addToSelection:!1},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapwfs/event/WFSFeaturesSelectedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.service.WfsTileService",function(e){this.plugin=e,this._TILE_SIZE_IN_PIXELS=256,this._componentName="WfsRequestTiler",this._mapPollingInterval=100,this._simultaneousPngRequest=4,this._wfsMapUpdateRequests={},this._WFSFeaturesSelectedEvent=null,this._tileCount=16,this._doMapLayerReArrange=!1,this.sandbox=e._sandbox,this.pngUrl=this.sandbox.getAjaxUrl()},{__qname:"Oskari.mapframework.bundle.mapwfs.service.WfsTileService",getQName:function(){return this.__qname},__name:"WfsTileService",getName:function(){return this.__name},scheduleMapLayerRearrangeAfterWfsMapTilesAreReady:function(){this._doMapLayerReArrange=!0},removeWFsLayerRequests:function(e){var t=e.getId();this._wfsMapUpdateRequests[t]!==null&&(this._wfsMapUpdateRequests[t]=null,delete this._wfsMapUpdateRequests[t])},removeWFSMapHighlightRequest:function(){this._WFSFeaturesSelectedEvent=null},scheduleWFSMapLayerUpdate:function(e,t,n,r,i){var s=e.getId(),o=this._wfsMapUpdateRequests[s];o!==null&&(this._wfsMapUpdateRequests[s]=null,delete this._wfsMapUpdateRequests[s]),this._wfsMapUpdateRequests[s]=[];var u=this.splitBbox(t,n,r,this._TILE_SIZE_IN_PIXELS);this._tileCount=u.length;var a=Oskari.clazz.builder("Oskari.mapframework.bundle.mapwfs.domain.WfsTileRequest");for(var f=0;f<u.length;f++){var l=a(e,u[f],n,r,i,f);this._wfsMapUpdateRequests[s].push(l)}this._doMapLayerReArrange=!0},scheduleWFSMapHighlightUpdate:function(e){this._WFSFeaturesSelectedEvent=e,this.processHighlightQueue()},splitBbox:function(e,t,n,r){var i=this.sandbox.getMap(),s=[];if(i){var o=this.plugin.getTileQueue();o&&(s=o.getQueue())}return s},processMapQueue:function(){var e=this;this.sandbox.printDebug("[WfsTileService.processMapQueue] Looping this._wfsMapUpdateRequests...");for(var t in this._wfsMapUpdateRequests){var n=this._wfsMapUpdateRequests[t];if(n!==null&&n.length>0){this.sandbox.printDebug("[WfsTileService.processMapQueue] Got requestArray of size "+n.length+" for id "+t);var r=n[0];this.sandbox.printDebug("[WfsTileService.processMapQueue] Creating request for '"+r.getMapLayer().getName()+"'");var i=r.getBbox(),s=this.sandbox.getMap().getZoom(),o=this.pngUrl+"&flow_pm_wfsLayerId="+r.getMapLayer().getId()+"&flow_pm_bbox_min_x="+i.bounds.left+"&flow_pm_bbox_min_y="+i.bounds.bottom+"&flow_pm_bbox_max_x="+i.bounds.right+"&flow_pm_bbox_max_y="+i.bounds.top+"&flow_pm_map_width="+this._TILE_SIZE_IN_PIXELS+"&flow_pm_map_height="+this._TILE_SIZE_IN_PIXELS+"&flow_pm_zoom_level="+s+"&srs="+this.sandbox.getMap().getSrsName()+"&action_route=GET_PNG_MAP",u="WFS_LAYER_IMAGE_"+r.getMapLayer().getId()+"_"+r.getSequenceNumber();e.plugin.drawImageTile(r.getMapLayer(),o,i,u),this.sandbox.printDebug("[WfsTileService.processMapQueue] removing handled element"),n.splice(0,1),n.length===0&&(delete this._wfsMapUpdateRequests[t],this.sandbox.printDebug("[WfsTileService.processMapQueue] deleting empty requestArray"));return}}this.sandbox.printDebug("[WfsTileService.processMapQueue] _doMapLayerReArrange is "+this._doMapLayerReArrange);if(this._doMapLayerReArrange){var a=this.sandbox.getRequestBuilder("RearrangeSelectedMapLayerRequest"),f=a();this.sandbox.request(this.plugin,f),this._doMapLayerReArrange=!1}},processHighlightQueue:function(){var e=this._WFSFeaturesSelectedEvent;if(!e)return;try{var t=e.getMapLayer();if(!t.isLayerOfType("WFS"))throw"Trying to highlight feature from layer that is not WFS layer!";var n=e.getWfsFeatureIds();if(!n||n.length==0){e.isKeepSelection()||this.plugin.removeHighlightOnMapLayer(t.getId());return}var r=this.sandbox.getMap(),i=r.getBbox(),s=r.getWidth(),o=r.getHeight(),u=this,a=u.pngUrl+"&flow_pm_wfsLayerId="+t.getId()+"&flow_pm_bbox_min_x="+i.left+"&flow_pm_bbox_min_y="+i.bottom+"&flow_pm_bbox_max_x="+i.right+"&flow_pm_bbox_max_y="+i.top+"&flow_pm_map_width="+s+"&flow_pm_map_height="+o+"&action_route=GET_HIGHLIGHT_WFS_FEATURE_IMAGE",f=function(r){u.plugin.drawImageTile(t,a+"&wfsFeatureId="+r,i,"HIGHLIGHTED_FEATURE",e.isKeepSelection()||n.length>1)};for(var l=0;l<n.length;++l)f(n[l])}finally{}},startPollers:function(){for(i=0;i<this._tileCount;i++)this.processMapQueue()}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/framework/bundle/mapwfs/service/WfsTileService",function(){}),Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTilesGrid",function(e){this.grid=[],this.map=null,this.tileSize=null,this.maxExtent=null,this.buffer=0,this.numLoadingTiles=0;for(p in e)this[p]=e[p]},{destroy:function(){this.clearGrid(),this.grid=null,this.tileSize=null},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;e<t;e++){var n=this.grid[e];for(var r=0,i=n.length;r<i;r++){var s=n[r];s.destroy()}}this.grid=[]}},moveTo:function(e,t){e=e||this.map.getExtent();if(e!=null){var n=!this.grid.length||t,r=this.getTilesBounds();n||!r.containsBounds(e,!0)?this.initGriddedTiles(e):this.moveGriddedTiles(e)}},setTileSize:function(e){},getTilesBounds:function(){var e=null;if(this.grid.length){var t=this.grid.length-1,n=this.grid[t][0],r=this.grid[0].length-1,i=this.grid[0][r];e=new OpenLayers.Bounds(n.bounds.left,n.bounds.bottom,i.bounds.right,i.bounds.top)}return e},calculateGridLayout:function(e,t,n){var r=n*this.tileSize.w,i=n*this.tileSize.h,s=e.left-t.left,o=Math.floor(s/r)-this.buffer,u=s/r-o,a=-u*this.tileSize.w,f=t.left+o*r,l=e.top-(t.bottom+i),c=Math.ceil(l/i)+this.buffer,h=c-l/i,p=-h*this.tileSize.h,d=t.bottom+c*i;return{tilelon:r,tilelat:i,tileoffsetlon:f,tileoffsetlat:d,tileoffsetx:a,tileoffsety:p}},initGriddedTiles:function(e){var t=this.map.getSize(),n=Math.ceil(t.h/this.tileSize.h)+Math.max(1,2*this.buffer),r=Math.ceil(t.w/this.tileSize.w)+Math.max(1,2*this.buffer),i=this.maxExtent,s=this.map.getResolution(),o=this.calculateGridLayout(e,i,s),u=Math.round(o.tileoffsetx),a=Math.round(o.tileoffsety),f=o.tileoffsetlon,l=o.tileoffsetlat,c=o.tilelon,h=o.tilelat;this.origin=new OpenLayers.Pixel(u,a);var p=u,d=f,v=0,m=parseInt(this.map.layerContainerDiv.style.left),g=parseInt(this.map.layerContainerDiv.style.top);do{var y=this.grid[v++];y||(y=[],this.grid.push(y)),f=d,u=p;var b=0;do{var w=new OpenLayers.Bounds(f,l,f+c,l+h),E=u;E-=m;var S=a;S-=g;var x=new OpenLayers.Pixel(E,S),T=y[b++];T?T.moveTo(w,x,!1):(T=this.addTile(w,x),y.push(T)),f+=c,u+=this.tileSize.w}while(f<=e.right+c*this.buffer||b<r);l-=h,a+=this.tileSize.h}while(l>=e.bottom-h*this.buffer||v<n);this.removeExcessTiles(v,b)},addTile:function(e,t){return new OpenLayers.Tile(this.layer,e,t,"",this.tileSize)},moveGriddedTiles:function(e){var t=this.buffer||1;for(;;){var n=this.grid[0][0].position,r=this.map.getViewPortPxFromLayerPx(n);if(r.x>-this.tileSize.w*(t-1))this.shiftColumn(!0);else if(r.x<-this.tileSize.w*t)this.shiftColumn(!1);else if(r.y>-this.tileSize.h*(t-1))this.shiftRow(!0);else{if(!(r.y<-this.tileSize.h*t))break;this.shiftRow(!1)}}},shiftRow:function(e){var t=e?0:this.grid.length-1,n=this.grid,r=n[t],i=this.map.getResolution(),s=e?-this.tileSize.h:this.tileSize.h,o=i*-s,u=e?n.pop():n.shift();for(var a=0,f=r.length;a<f;a++){var l=r[a],c=l.bounds.clone(),h=l.position.clone();c.bottom=c.bottom+o,c.top=c.top+o,h.y=h.y+s,u[a].moveTo(c,h)}e?n.unshift(u):n.push(u)},shiftColumn:function(e){var t=e?-this.tileSize.w:this.tileSize.w,n=this.map.getResolution(),r=n*t;for(var i=0,s=this.grid.length;i<s;i++){var o=this.grid[i],u=e?0:o.length-1,a=o[u],f=a.bounds.clone(),l=a.position.clone();f.left=f.left+r,f.right=f.right+r,l.x=l.x+t;var c=e?this.grid[i].pop():this.grid[i].shift();c.moveTo(f,l),e?o.unshift(c):o.push(c)}},removeExcessTiles:function(e,t){while(this.grid.length>e){var n=this.grid.pop();for(var r=0,i=n.length;r<i;r++){var s=n[r];s.destroy()}}while(this.grid[0].length>t)for(var r=0,i=this.grid.length;r<i;r++){var n=this.grid[r],s=n.pop();s.destroy()}},onMapResize:function(){},CLASS_NAME:"NLSFI.OpenLayers.Strategy.QueuedTilesGrid"}),define("bundles/framework/bundle/mapwfs/plugin/wfslayer/QueuedTilesGrid",function(){}),Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTilesStrategy",function(e){this.debugGridFeatures=!0,this.options=e,this.tileQueue=e.tileQueue,this.autoActivate=!0,this.autoDestroy=!1,this.grid=null,this.bounds=null;for(p in e)this[p]=e[p];this.active=!1},{setLayer:function(e){this.layer=e},flushTileQueue:function(){var e=this.tileQueue.queue,t=[];for(var n=0;n<e.length;n++)e[n].tileFeature!=null&&(t.push(e[n].tileFeature),e[n].tileFeature=null);t.length>0&&this.layer.destroyFeatures(t),this.tileQueue.flushQueue()},unloadOutOfViewFeatures:function(){},ratio:1,activate:function(){return this.active?!1:(this.active=!0,this.grid=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTilesGrid",{map:this.layer.map,layer:this.layer,maxExtent:this.layer.map.getMaxExtent(),tileSize:this.layer.map.getTileSize()}),this.layer.events.on({refresh:this.updateRefresh,scope:this}),!0)},deactivate:function(){return this.active?(this.layer.events.un({refresh:this.update,scope:this}),this.grid.destroy(),this.grid=null,!0):!1},updateRefresh:function(e){this.update()},updateMoveEnd:function(e){this.update()},update:function(e){var t=this.layer.map.getExtent();this.grid.moveTo(t,!0),this.flushTileQueue();var n=this.layer.map.getZoom();if(n<this.minZoom)return;this.triggerRead()},invalidBounds:function(e){return e||(e=this.layer.map.getExtent()),!this.bounds||!this.bounds.containsBounds(e)},triggerUnload:function(e){this.layer.destroyFeatures()},triggerRead:function(){var e=this.grid.grid,t=[],n=this.debugGridFeatures;for(var r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++){var s=e[r][i].bounds.clone(),o={left:s.left,top:s.top,right:s.right,bottom:s.bottom},u=null;if(n){var a=new OpenLayers.Geometry.Point(s.left,s.bottom),f=new OpenLayers.Geometry.Point(s.right,s.top),l=new OpenLayers.Geometry.Point(s.left,s.top),c=new OpenLayers.Geometry.Point(s.right,s.bottom),h=new OpenLayers.Geometry.LineString([a,c,f,l,a]),u=new OpenLayers.Feature.Vector(h,{featureClassName:this.CLASS_NAME,description:""});u.renderIntent="tile",t.push(u)}var p=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTile",{bounds:o,tileFeature:u});this.tileQueue.pushJob(p)}n&&this.layer.addFeatures(t)},merge:function(e){var t=e.features;t&&t.length>0&&this.layer.addFeatures(t)},CLASS_NAME:"NLSFI.OpenLayers.Strategy.QueuedTilesStrategy"}),define("bundles/framework/bundle/mapwfs/plugin/wfslayer/QueuedTilesStrategy",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.plugin.wfslayer.WfsLayerPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this.service=null,this.config=e},{__name:"WfsLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},init:function(){var e=(this.config?this.config.sandbox:null)||"sandbox",t=Oskari.getSandbox(e),n=t.getService("Oskari.mapframework.service.MapLayerService");if(n){n.registerLayerModel("wfslayer","Oskari.mapframework.domain.WfsLayer");var r=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs.domain.WfsLayerModelBuilder",t);n.registerLayerModelBuilder("wfslayer",r)}},register:function(){this.getMapModule().setLayerPlugin("wfslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wfslayer",null)},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this.createTilesGrid(),this.service=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs.service.WfsTileService",this),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{AfterMapMoveEvent:function(e){var t=this._sandbox.getObjectCreator(e);this._sandbox.printDebug("[WfsLayerPlugin] got AfterMapMoveEvent from "+t),this.afterAfterMapMoveEvent()},AfterMapLayerAddEvent:function(e){this.afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();t.isLayerOfType("WFS")&&this.afterMapLayerRemoveEvent(e)},AfterHighlightWFSFeatureRowEvent:function(e){this.handleAfterHighlightWFSFeatureRowEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)},AfterDimMapLayerEvent:function(e){this.handleAfterDimMapLayerEvent(e)},MapClickedEvent:function(e){if(this._sandbox.getMap().isMoving())return;var t=e.getLonLat(),n=e.getMouseX(),r=e.getMouseY();this._getFeatureIds(t,n,r)},WFSFeaturesSelectedEvent:function(e){this.service.scheduleWFSMapHighlightUpdate(e)},MapLayerVisibilityChangedEvent:function(e){e.getMapLayer().isVisible()&&this.afterAfterMapMoveEvent()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t=this._sandbox;for(var n=0;n<e.length;n++){var r=e[n],i=r.getId();if(!r.isLayerOfType("WFS"))continue;t.printDebug("[WfsLayerPlugin] preselecting "+i),this.addMapLayerToMap(r,!0,r.isBaseLayer())}},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(!t.isLayerOfType("WFS"))return;var n=this.getOLMapLayers(t);for(var r=0;r<n.length;r++)n[r].setOpacity(t.getOpacity()/100)},handleAfterDimMapLayerEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType("WFS")){var n=new RegExp("wfs_layer_"+t.getId()+"_HIGHLIGHTED_FEATURE*","i"),r=this._map.getLayersByName(n);for(var i=0;i<r.length;i++)r[i].destroy()}},afterMapLayerAddEvent:function(e){this.addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap()),this.afterAfterMapMoveEvent()},addMapLayerToMap:function(e,t,n){},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.service.removeWFsLayerRequests(t),this.removeMapLayerFromMap(t)},removeMapLayerFromMap:function(e){var t=this.getOLMapLayers(e);for(var n=0;n<t.length;n++)t[n].destroy()},getOLMapLayers:function(e){if(e&&!e.isLayerOfType("WFS"))return;var t="";e&&(t="_"+e.getId());var n=new RegExp("wfs_layer"+t+"_*","i");return this._map.getLayersByName(n)},drawImageTile:function(e,t,n,r,i){var s="wfs_layer_"+e.getId()+"_"+r,o=null;n.bounds&&n.bounds.left&&n.bounds.right&&n.bounds.top&&n.bounds.bottom?o=new OpenLayers.Bounds(n.bounds.left,n.bounds.bottom,n.bounds.right,n.bounds.top):n.left&&n.right&&n.top&&n.bottom&&(o=new OpenLayers.Bounds(n.left,n.bottom,n.right,n.top));if(!(t&&e&&o))return;var u=this.mapModule.calculateLayerScales(e.getMaxScale(),e.getMinScale()),a=null;if(!i){var f=this._map.getLayersByName(s);for(var l=0;l<f.length;l++)a=this._map.getLayerIndex(f[l]),f[l].destroy()}var c=new OpenLayers.Size(256,256),h=new OpenLayers.Layer.Image(s,t,o,c,{scales:u,transparent:!0,format:"image/png",isBaseLayer:!1,displayInLayerSwitcher:!0,visibility:!0,buffer:0});h.opacity=e.getOpacity()/100,this._map.addLayer(h),h.setVisibility(!0),h.redraw(!0);var p=this._map.layers.length,d=this._map.getLayersByName("Markers");d.length>0&&(this._map.setLayerIndex(d[0],p),p--),a!==null&&h!==null&&this._map.setLayerIndex(h,a);var v=new RegExp("wfs_layer_"+e.getId()+"_WFS_LAYER_IMAGE*","i"),m=this._map.getLayersByName(v);if(m.length>0){var g=this._map.getLayerIndex(m[m.length-1]),y=this._map.getLayersByName(s);y.length>0&&this._map.setLayerIndex(y[0],g)}},handleAfterHighlightWFSFeatureRowEvent:function(e){var t=e.getWfsFeatureIds();if(t.length==0&&!e.isKeepSelection()){var n=e.getMapLayer();this.removeHighlightOnMapLayer(n.getId())}},removeHighlightOnMapLayer:function(e){var t="";e&&(t="wfs_layer_"+e);var n=new RegExp(t+"_HIGHLIGHTED_FEATURE*","i"),r=this._map.getLayersByName(n);for(var i=0;i<r.length;i++)r[i].destroy()},updateWfsImages:function(e){var t=Oskari.$().sandbox.findAllSelectedMapLayers();for(var n=0;n<t.length;n++)t[n].isInScale()&&t[n].isVisible()&&t[n].isLayerOfType("WFS")&&this.doWfsLayerRelatedQueries(t[n])},doWfsLayerRelatedQueries:function(e){if(!e.isInScale())return;var t=this._sandbox.getMap(),n=t.getBbox(),r=t.getWidth(),i=t.getHeight();this.service.scheduleWFSMapLayerUpdate(e,n,r,i,this.getName()),this.service.startPollers()},afterAfterMapMoveEvent:function(){this.tileStrategy.update(),this._tilesLayer.redraw(),this.updateWfsImages(this.getName()),this.service.processHighlightQueue()},createTilesGrid:function(){var e=this,t=e._sandbox,n=Oskari.clazz.create("Oskari.mapframework.gridcalc.TileQueue"),r=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTilesStrategy",{tileQueue:n});r.debugGridFeatures=!1,this.tileQueue=n,this.tileStrategy=r;var i=new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:3,strokeColor:"red",strokeWidth:2,fillColor:"#800000"}),tile:new OpenLayers.Style({strokeColor:"#008080",strokeWidth:5,fillColor:"#ffcc66",fillOpacity:.5}),select:new OpenLayers.Style({fillColor:"#66ccff",strokeColor:"#3399ff"})});this._tilesLayer=new OpenLayers.Layer.Vector("Tiles Layer",{strategies:[r],styleMap:i,visibility:!0}),this._map.addLayer(this._tilesLayer),this._tilesLayer.setOpacity(.3)},getTileQueue:function(){return this.tileQueue},_getFeatureIds:function(e,t,n){var r=this,i=this._sandbox,s=i.findAllHighlightedLayers();if(s.length==0||!s[0]||!s[0].isLayerOfType("WFS"))return;if(s.length!=1){i.printDebug("Trying to highlight WFS feature but there is either too many or none selected WFS layers. Size: "+s.length);return}var o=s[0];if(!o.isInScale()){i.printDebug("Trying to hightlight WFS feature from wfs layer that is not in scale!");return}var u=i.getMap(),a=this._map.getExtent(),f="&flow_pm_wfsLayerId="+o.getId()+"&flow_pm_point_x="+e.lon+"&flow_pm_point_y="+e.lat+"&flow_pm_bbox_min_x="+a.left+"&flow_pm_bbox_min_y="+a.bottom+"&flow_pm_bbox_max_x="+a.right+"&flow_pm_bbox_max_y="+a.top+"&flow_pm_zoom_level="+u.getZoom()+"&flow_pm_map_width="+u.getWidth()+"&flow_pm_map_height="+u.getHeight()+"&srs="+u.getSrsName()+"&action_route=GET_HIGHLIGHT_WFS_FEATURE_IMAGE_BY_POINT",l=i.isCtrlKeyDown();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:i.getAjaxUrl()+f,data:f,success:function(e){r._handleGetFeatureIdsResponse(e,o,l)}})},_handleGetFeatureIdsResponse:function(response,layer,keepCollection){var sandbox=this._sandbox;if(!response||response.error=="true"){sandbox.printWarn("Couldn't get feature id for selected map point.");return}var selectedFeatures=eval("("+response.selectedFeatures+")"),featureIds=[];selectedFeatures!=null&&selectedFeatures.id!=null&&featureIds.push(selectedFeatures.id);var builder=sandbox.getEventBuilder("WFSFeaturesSelectedEvent"),event=builder(featureIds,layer,keepCollection);sandbox.notifyAll(event)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapwfs/plugin/wfslayer/WfsLayerPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.MapWfsBundleInstance",function(){this._localization=null,this._pluginInstances={}},{__name:"MapWFS",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},start:function(){var e=this;if(e.started)return;e.started=!0;var t=this.conf,n=(t?t.sandbox:null)||"sandbox",r=Oskari.getSandbox(n);e.sandbox=r,r.register(e);for(p in e.eventHandlers)r.registerForEventByName(e,p)},update:function(){},stop:function(){var e=this.sandbox;for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);this.sandbox.unregister(this),this.started=!1},init:function(){var e=this;return null},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])},eventHandlers:{MapClickedEvent:function(e){if(this.sandbox.getMap().isMoving())return;var t=e.getLonLat(),n=e.getMouseX(),r=e.getMouseY();this._getFeatureIds(t,n,r)}},_getFeatureIds:function(e,t,n){var r=this,i=this.sandbox,s=i.findAllHighlightedLayers();if(s.length==0||!s[0]||!s[0].isLayerOfType("WFS"))return;if(s.length!=1)throw"Trying to highlight WFS feature but there is either too many or none selected WFS layers. Size: "+s.length;var o=s[0];if(!o.isInScale()){core.printDebug("Trying to hightlight WFS feature from wfs layer that is not in scale!");return}var u=i.getMap(),a=this._map.getExtent(),f="&flow_pm_wfsLayerId="+o.getId()+"&flow_pm_point_x="+e.lon+"&flow_pm_point_y="+e.lat+"&flow_pm_bbox_min_x="+a.left+"&flow_pm_bbox_min_y="+a.bottom+"&flow_pm_bbox_max_x="+a.right+"&flow_pm_bbox_max_y="+a.top+"&flow_pm_zoom_level="+u.getZoom()+"&flow_pm_map_width="+u.getWidth()+"&flow_pm_map_height="+u.getHeight()+"&srs="+u.getSrsName()+"&actionKey=GET_HIGHLIGHT_WFS_FEATURE_IMAGE_BY_POINT",l=i.isCtrlKeyDown();jQuery.ajax({dataType:"json",type:"POST",url:this.endpointUrl+f,data:f,success:function(e){r._handleGetFeatureIdsResponse(e,o,l)}})},_handleGetFeatureIdsResponse:function(response,layer,keepCollection){var sandbox=this.sandbox;response.error=="true"&&sandbox.printWarn("Couldn't get feature id for selected map point.");var selectedFeatures=eval("("+response.selectedFeatures+")"),featureIds=[];selectedFeatures!=null&&selectedFeatures.id!=null&&(featureIds=selectedFeatures.id);var builder=sandbox.getEventBuilder("WFSFeaturesSelectedEvent"),event=builder(featureIds,layer,keepCollection);sandbox.notifyAll(event)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/mapwfs/instance",function(){}),Oskari.registerLocalization({lang:"fi",key:"MapWfs",value:{"object-data":"Kohdetiedot"}}),define("bundles/framework/bundle/mapwfs/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"MapWfs",value:{"object-data":"Objektuppgifter"}}),define("bundles/framework/bundle/mapwfs/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"MapWfs",value:{"object-data":"Object data"}}),define("bundles/framework/bundle/mapwfs/locale/en",function(){}),define("bundles/framework/bundle/mapwfs/module",["oskari","jquery","./domain/WfsLayer","./domain/WfsLayerModelBuilder","./domain/QueuedTile","./domain/TileQueue","./domain/WfsTileRequest","./event/WFSFeaturesSelectedEvent","./service/WfsTileService","./plugin/wfslayer/QueuedTilesGrid","./plugin/wfslayer/QueuedTilesStrategy","./plugin/wfslayer/WfsLayerPlugin","./instance","./locale/fi","./locale/sv","./locale/en"],function(e,t){return e.bundleCls("mapwfs").category({create:function(){return e.clazz.create("Oskari.mapframework.bundle.mapwfs.MapWfsBundleInstance")},update:function(e,t,n,r){e.alert("RECEIVED update notification "+r)}})}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.plugin.StatsLayerPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._statsDrawLayer=null,this._highlightCtrl=null,this._navCtrl=null,this._getFeatureControlHover=null,this._getFeatureControlSelect=null,this._modeVisible=!1,this.config=e,this.ajaxUrl=null,e&&e.ajaxUrl&&(this.ajaxUrl=e.ajaxUrl),e&&e.published&&(this._modeVisible=e.published)},{__name:"StatsLayerPlugin",_layerType:"STATS",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("statslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("statslayer",null)},init:function(e){var t=(this.config?this.config.sandbox:null)||"sandbox",e=Oskari.getSandbox(t),n=e.getService("Oskari.mapframework.service.MapLayerService");if(n){n.registerLayerModel("statslayer","Oskari.mapframework.bundle.mapstats.domain.StatsLayer");var r=Oskari.clazz.create("Oskari.mapframework.bundle.mapstats.domain.StatsLayerModelBuilder",e);n.registerLayerModelBuilder("statslayer",r)}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this.ajaxUrl||(this.ajaxUrl=e.getAjaxUrl()+"action_route=GetStatsTile")},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{AfterMapLayerAddEvent:function(e){this._afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){this._afterMapLayerRemoveEvent(e)},MapLayerVisibilityChangedEvent:function(e){this._mapLayerVisibilityChangedEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this._afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(e){},"MapStats.StatsVisualizationChangeEvent":function(e){this._afterStatsVisualizationChangeEvent(e)},"StatsGrid.ModeChangedEvent":function(e){this._afterModeChangedEvent(e)},"StatsGrid.SelectHilightsModeEvent":function(e){this._hilightFeatures(e)},"StatsGrid.ClearHilightsEvent":function(e){this._clearHilights(e)},"MapStats.HoverTooltipContentEvent":function(e){this._afterHoverTooltipContentEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t=this._sandbox;for(var n=0;n<e.length;n++){var r=e[n],i=r.getId();if(!r.isLayerOfType(this._layerType))continue;t.printDebug("preselecting "+i),this._addMapLayerToMap(r,!0,r.isBaseLayer())}},activateControls:function(){this._getFeatureControlHover.activate(),this._getFeatureControlSelect.activate()},deactivateControls:function(){this._getFeatureControlHover.deactivate(),this._getFeatureControlSelect.deactivate()},_afterMapLayerAddEvent:function(e){this._addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap())},_addMapLayerToMap:function(e,t,n){var r=this,i=r._sandbox.getEventBuilder("MapStats.FeatureHighlightedEvent"),s;if(!e.isLayerOfType(this._layerType))return;var o=this._map.getLayersByName("Markers");if(o)for(var u=0;u<o.length;u++)o[u]&&this._map.removeLayer(o[u],!1);var a=this.getMapModule().calculateLayerScales(e.getMaxScale(),e.getMinScale()),f=new OpenLayers.Layer.WMS("layer_"+e.getId(),this.ajaxUrl+"&LAYERID="+e.getId(),{layers:e.getWmsName(),transparent:!0,format:"image/png"},{scales:a,isBaseLayer:!1,displayInLayerSwitcher:!1,visibility:!0,singleTile:!0,buffer:0});this._statsDrawLayer=new OpenLayers.Layer.Vector("Stats Draw Layer",{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillOpacity:0,strokeOpacity:0}),temporary:new OpenLayers.Style({strokeColor:"#ff6666",strokeOpacity:1,strokeWidth:3,fillColor:"#ff0000",fillOpacity:0,graphicZIndex:2,cursor:"pointer"}),select:new OpenLayers.Style({})})}),this._map.addLayers([this._statsDrawLayer]),this._statsDrawLayer.events.register("moveend",this._statsDrawLayer,function(){r.mapModule.notifyMoveEnd()}),this._highlightCtrl=new OpenLayers.Control.SelectFeature(this._statsDrawLayer,{hover:!0,highlightOnly:!0,renderIntent:"temporary"}),this._map.addControl(this._highlightCtrl),this._highlightCtrl.activate(),this._navCtrl=new OpenLayers.Control.Navigation,this._map.addControl(this._navCtrl);var l=[f];this._getFeatureControlHover=new OpenLayers.Control.WMSGetFeatureInfo({drillDown:!1,hover:!0,handlerOptions:{hover:{delay:0},stopSingle:!1},infoFormat:"application/vnd.ogc.gml",layers:l,eventListeners:{getfeatureinfo:function(e){var t=r._map.getLayersByName("Stats Draw Layer")[0];if(typeof t=="undefined")return;if(e.features.length===0){for(var n=0;n<t.features.length;n++)t.features[n].selected||t.removeFeatures([t.features[n]]);r._removePopup();return}var i=!1,s="kuntakoodi";for(var n=0;n<t.features.length;n++)t.features[n].attributes[s]===e.features[0].attributes[s]?i=!0:t.features[n].selected||t.removeFeatures([t.features[n]]);i||(t.addFeatures([e.features[0]]),r._highlightCtrl.highlight(e.features[0]),r._removePopup(),r._addPopup(e)),t.redraw()},beforegetfeatureinfo:function(e){},nogetfeatureinfo:function(e){}}}),this._map.addControl(this._getFeatureControlHover),this._modeVisible&&this._getFeatureControlHover.activate(),this._getFeatureControlSelect=new OpenLayers.Control.WMSGetFeatureInfo({drillDown:!0,hover:!1,handlerOptions:{click:{delay:0},pixelTolerance:5},infoFormat:"application/vnd.ogc.gml",layers:l,eventListeners:{getfeatureinfo:function(e){if(e.features.length===0)return;var t=e.features[0],n=r._map.getLayersByName("Stats Draw Layer")[0];if(typeof n=="undefined")return;var o=-1,u="kuntakoodi";for(var a=0;a<n.features.length;a++)if(n.features[a].attributes[u]===e.features[0].attributes[u]){o=a;break}var f=OpenLayers.Util.applyDefaults(f,OpenLayers.Feature.Vector.style["default"]);f.fillColor="#ff0000",f.strokeColor="#ff3333",f.strokeWidth=3,f.fillOpacity=.2,o>=0?(n.features[a].selected=!n.features[a].selected,n.features[a].selected?n.features[a].style=f:(n.features[a].style=null,r._highlightCtrl.highlight(n.features[a])),i&&(s=i(n.features[a],n.features[a].selected,"click"))):(n.addFeatures([t]),t.selected=!0,t.style=f,i&&(s=i(t,t.selected,"click"))),n.redraw(),s&&r._sandbox.notifyAll(s)},beforegetfeatureinfo:function(e){},nogetfeatureinfo:function(e){}}}),this._map.addControl(this._getFeatureControlSelect),this._modeVisible&&this._getFeatureControlSelect.activate(),f.opacity=e.getOpacity()/100,this._map.addLayer(f),this._sandbox.printDebug("#!#! CREATED OPENLAYER.LAYER.WMS for StatsLayer "+e.getId()),t?this._map.setLayerIndex(f,this._map.layers.length):this._map.setLayerIndex(f,0);if(o)for(var u=0;u<o.length;u++)o[u]&&this._map.addLayer(o[u])},_afterModeChangedEvent:function(e){this._modeVisible=e.isModeVisible();var t=this._map.getLayersByName("Stats Draw Layer")[0];this._modeVisible?this.activateControls():(this.deactivateControls(),t&&t.removeAllFeatures(),this._removePopup())},_clearHilights:function(e){var t=this._map.getLayersByName("Stats Draw Layer")[0];if(t)for(var n=0;n<t.features.length;n++)t.features[n].style=null,this._highlightCtrl.highlight(t.features[n]);t.redraw(),this._removePopup()},_hilightFeatures:function(e){var t=e.getCodes(),n=this._map.getLayersByName("Stats Draw Layer")[0];if(typeof n=="undefined")return;var r="kuntakoodi",i=OpenLayers.Util.applyDefaults(i,OpenLayers.Feature.Vector.style["default"]);i.fillColor="#ff0000",i.strokeColor="#ff3333",i.strokeWidth=3,i.fillOpacity=.2;for(var s in t)for(var o=0;o<n.features.length;o++)if(n.features[o].attributes[r]===s&&t[s]){n.features[o].style=i,this._highlightCtrl.highlight(n.features[o]);break}n.redraw()},_afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();if(!t.isLayerOfType(this._layerType))return;this._removeMapLayerFromMap(t),this._highlightCtrl.deactivate(),this._getFeatureControlHover.deactivate(),this._getFeatureControlSelect.deactivate(),this._map.removeControl(this._highlightCtrl),this._map.removeControl(this._navCtrl),this._map.removeControl(this._getFeatureControlHover),this._map.removeControl(this._getFeatureControlSelect),this._map.removeLayer(this._statsDrawLayer)},_mapLayerVisibilityChangedEvent:function(e){var t=e.getMapLayer();if(t._layerType!=="STATS")return;this._statsDrawLayer.setVisibility(t.isVisible()),this._modeVisible&&(t.isVisible()?(this._getFeatureControlHover.activate(),this._getFeatureControlSelect.activate()):(this._getFeatureControlHover.deactivate(),this._getFeatureControlSelect.deactivate()))},_removeMapLayerFromMap:function(e){if(!e.isLayerOfType(this._layerType))return;var t=this.getOLMapLayers(e);t[0].destroy()},getOLMapLayers:function(e){return e.isLayerOfType(this._layerType)?this._map.getLayersByName("layer_"+e.getId()):null},_removePopup:function(e){e=e||this._popup,e&&this._map.removePopup(e)},_addPopup:function(e){var t=e.features[0].attributes.kuntanimi;this._popup=new OpenLayers.Popup("mapstatsHover",this._map.getLonLatFromPixel(new OpenLayers.Pixel(e.xy.x+5,e.xy.y+5)),new OpenLayers.Size(100,100),t),this._popup.autoSize=!0,this._popup.opacity=.8,this._map.addPopup(this._popup);var n=this._sandbox.getRequestBuilder("StatsGrid.TooltipContentRequest");if(n){var r=n(e.features[0]);this._sandbox.request(this,r)}},_afterHoverTooltipContentEvent:function(e){var t=e.getContent();this._popup&&this._popup.setContentHTML(t)},_afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(!t.isLayerOfType(this._layerType))return;this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var n=this.getOLMapLayers(t);n[0]!=null&&n[0].setOpacity(t.getOpacity()/100)},_afterChangeMapLayerStyleEvent:function(e){var t=e.getMapLayer(),n=this.getOLMapLayers(t);n!=null&&n[0].mergeNewParams({VIS_ID:t.getCurrentStyle().getName(),VIS_NAME:"ows:Kunnat2013",VIS_ATTR:"Kuntakoodi",VIS_CLASSES:"020,091|186,086,982|111,139,740",VIS_COLORS:"choro:ccffcc|99cc99|669966"})},_afterStatsVisualizationChangeEvent:function(e){var t=e.getLayer(),n=e.getParams(),r=this.getOLMapLayers(t);r!=null&&r[0].mergeNewParams({VIS_ID:n.VIS_ID,VIS_NAME:n.VIS_NAME,VIS_ATTR:n.VIS_ATTR,VIS_CLASSES:n.VIS_CLASSES,VIS_COLORS:n.VIS_COLORS})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapstats/plugin/StatsLayerPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.domain.StatsLayer",function(){this._layerType="STATS"},{setWmsName:function(e){this._wmsName=e},getWmsName:function(){return this._wmsName},setFilterPropertyName:function(e){this._filterPropertyName=e},getFilterPropertyName:function(){return this._filterPropertyName}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),define("bundles/framework/bundle/mapstats/domain/StatsLayer",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.domain.StatsLayerModelBuilder",function(e){this.localization=Oskari.getLocalization("MapStats"),this.sandbox=e},{parseLayerData:function(e,t,n){var r=this;e.setWmsName(t.wmsName),t.visualizations&&e.setFilterPropertyName(t.visualizations[0].filterproperty);var i=Oskari.clazz.builder("Oskari.mapframework.domain.Tool"),s=i(),o=r.localization.tools.table_icon;s.setName("table_icon"),s.setTitle(o.title),s.setTooltip(o.tooltip),s.setCallback(function(){r.sandbox.postRequestByName("StatsGrid.StatsGridRequest",[!0,e])}),e.addTool(s);if(e.getMetadataIdentifier()){var u=i();u.setName("info_icon"),u.setIconCls("icon-info"),u.setCallback(function(){var t="catalogue.ShowMetadataRequest",n=e.getMetadataIdentifier(),i=[],s={};s[n]=!0;var o=e.getSubLayers();if(o&&o.length>0)for(var u=0;u<o.length;u++){var a=o[u].getMetadataIdentifier();a&&a!=""&&!s[a]&&(s[a]=!0,i.push({uuid:a}))}r.sandbox.postRequestByName(t,[{uuid:n},i])})}e.addTool(u)}}),define("bundles/framework/bundle/mapstats/domain/StatsLayerModelBuilder",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.event.StatsVisualizationChangeEvent",function(e,t){this._layer=e,this._params=t},{getName:function(){return"MapStats.StatsVisualizationChangeEvent"},getLayer:function(){return this._layer},getParams:function(){return this._params}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapstats/event/StatsVisualizationChangeEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.event.FeatureHighlightedEvent",function(e,t,n){this._feature=e,this._highlighted=t,this._highlightType=n},{getName:function(){return"MapStats.FeatureHighlightedEvent"},getFeature:function(){return this._feature},isHighlighted:function(){return this._highlighted},getHighlighType:function(){return this._highlightType}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapstats/event/FeatureHighlightedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.event.HoverTooltipContentEvent",function(e){this._content=e},{getName:function(){return"MapStats.HoverTooltipContentEvent"},getContent:function(){return this._content}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapstats/event/HoverTooltipContentEvent",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapstats/css/mapstats.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"MapStats",value:{tools:{table_icon:{tooltip:"Siirry tilastomoodiin",title:"Tilastomoodi"},diagram_icon:{tooltip:"Näytä tiedot diagrammissa",title:"Diagrammi"},statistics:{tooltip:"siirrytään tilastoihin ",title:"Tilastot"}}}}),define("bundles/framework/bundle/mapstats/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"MapStats",value:{tools:{table_icon:{tooltip:"Gå till statistik",title:"Statistik"},diagram_icon:{tooltip:"Öpna diagram",title:"Diagram"},statistics:{tooltip:"Gå till statistik ",title:"Statistik"}}}}),define("bundles/framework/bundle/mapstats/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"MapStats",value:{tools:{table_icon:{tooltip:"Goto Statistics mode",title:"Statistics"},diagram_icon:{tooltip:"Show diagram",title:"Diagram"},statistics:{tooltip:"Goto Statistics mode",title:"Statistics"}}}}),define("bundles/framework/bundle/mapstats/locale/en",function(){}),define("bundles/framework/bundle/mapstats/module",["oskari","jquery","./plugin/StatsLayerPlugin","./domain/StatsLayer","./domain/StatsLayerModelBuilder","./event/StatsVisualizationChangeEvent","./event/FeatureHighlightedEvent","./event/HoverTooltipContentEvent","css!resources/framework/bundle/mapstats/css/mapstats.css","./locale/fi","./locale/sv","./locale/en"],function(e,t){return e.bundleCls("mapstats").category({create:function(){return null},update:function(e,t,n,r){e.alert("RECEIVED update notification "+r)}})}),Oskari.clazz.define("Oskari.mapframework.wmts.mapmodule.plugin.WmtsLayerPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._wmtsLayerClazz=Oskari.clazz.create("Oskari.openlayers.Patch.layer.WMTS"),this.config=e},{__name:"WmtsLayerPlugin",getName:function(){return this.pluginName},getMap:function(){return this._map},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("WmtsLayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("WmtsLayer",null)},init:function(e){var t=(this.config?this.config.sandbox:null)||"sandbox",e=Oskari.getSandbox(t),n=e.getService("Oskari.mapframework.service.MapLayerService");if(n){n.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var r=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");n.registerLayerModelBuilder("wmtslayer",r)}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{AfterMapLayerAddEvent:function(e){this.afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(e){this.afterChangeMapLayerStyleEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t=this._sandbox;for(var n=0;n<e.length;n++){var r=e[n],i=r.getId();if(!r.isLayerOfType("WMTS"))continue;t.printDebug("preselecting "+i),this.addMapLayerToMap(r,!0,r.isBaseLayer())}},afterMapLayerAddEvent:function(e){this.addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap())},addMapLayerToMap:function(e,t,n){if(!e.isLayerOfType("WMTS"))return;var r=this,i=r.getMap(),s=e.getWmtsMatrixSet().matrixIds,o=e.getWmtsLayerDef(),u=null;e.isBaseLayer()||e.isGroupLayer()?u="basemap_"+e.getId():u="layer_"+e.getId();var a=this._sandbox,f=e.getWmtsUrls()[0],l=e.getWmtsMatrixSet(),c={visibility:!0,transparent:!0,format:"image/png",url:f,layer:e.getWmtsName(),style:e.getCurrentStyle().getName(),matrixIds:l.matrixIds,matrixSet:l.identifier,isBaseLayer:e.isBaseLayer(),buffer:0,minScale:e.getMinScale(),maxScale:e.getMaxScale()};a.printDebug("[WmtsLayerPlugin] creating WMTS Layer "+l.identifier+" / "+c.id+"/"+c.layer+"/"+c.url);var h=OpenLayers.Util.applyDefaults(c,{url:f,name:u,style:e.getCurrentStyle().getName(),matrixIds:l.matrixIds,layerDef:o}),p=this._wmtsLayerClazz.getPatch(),d=new p(h);d.opacity=e.getOpacity()/100,a.printDebug("[WmtsLayerPlugin] created WMTS layer "+d),i.addLayers([d])},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},removeMapLayerFromMap:function(e){if(!e.isLayerOfType("WMTS"))return;if(e.isBaseLayer()||e.isGroupLayer()){var t="";if(e.getSubLayers().length>0)for(var n=0;n<e.getSubLayers().length;n++){var r=this._map.getLayersByName("basemap_"+e.getSubLayers()[n].getId());r[0].destroy()}else{var r=this._map.getLayersByName("layer_"+e.getId());r[0].destroy()}}else{var r=this._map.getLayersByName("layer_"+e.getId());r[0].destroy()}},getOLMapLayers:function(e){if(!e.isLayerOfType("WMTS"))return null;if(!e.isBaseLayer()&&!e.isGroupLayer())return this._map.getLayersByName("layer_"+e.getId());var t="";if(e.getSubLayers().length>0){for(var n=0;n<e.getSubLayers().length;n++)return this._map.getLayersByName("basemap_"+e.getSubLayers()[n].getId());return null}return this._map.getLayersByName("layer_"+e.getId())},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(!t.isLayerOfType("WMTS"))return;if(t.isBaseLayer()||t.isGroupLayer())if(t.getSubLayers().length>0)for(var n=0;n<t.getSubLayers().length;n++){var r=this._map.getLayersByName("basemap_"+t.getSubLayers()[n].getId());r[0].setOpacity(t.getOpacity()/100)}else{var r=this._map.getLayersByName("layer_"+t.getId());r[0]!=null&&r[0].setOpacity(t.getOpacity()/100)}else{this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var r=this._map.getLayersByName("layer_"+t.getId());r[0]!=null&&r[0].setOpacity(t.getOpacity()/100)}},afterChangeMapLayerStyleEvent:function(e){var t=e.getMapLayer();if(!t.isLayerOfType("WMTS"))return;if(!t.isBaseLayer()){var n=this._map.getLayersByName("layer_"+t.getId());n!=null&&n[0].mergeNewParams({styles:t.getCurrentStyle().getName()})}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapwmts/plugin/wmtslayer/WmtsLayerPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.wmts.domain.WmtsLayer",function(){this._WmtsLayerName=null,this._WmtsMatrixSet=null,this._WmtsUrls=[],this._layerType="WMTS"},{setWmtsName:function(e){this._WmtsName=e},getWmtsName:function(){return this._WmtsName},setWmtsMatrixSet:function(e){this._WmtsMatrixSet=e},getWmtsMatrixSet:function(){return this._WmtsMatrixSet},setWmtsLayerDef:function(e){this._WmtsLayerDef=e},getWmtsLayerDef:function(){return this._WmtsLayerDef},addWmtsUrl:function(e){this._WmtsUrls.push(e)},getWmtsUrls:function(){return this._WmtsUrls}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),define("bundles/framework/bundle/mapwmts/domain/WmtsLayer",function(){}),Oskari.clazz.define("Oskari.mapframework.wmts.service.WMTSLayerService",function(e){this.mapLayerService=e,this.capabilities={},this.capabilitiesClazz=Oskari.clazz.create("Oskari.openlayers.Patch.WMTSCapabilities_v1_0_0")},{setCapabilities:function(e,t){this.capabilities[e]=t},getCapabilities:function(e){return this.capabilities[e]},readWMTSCapabilites:function(e,t,n){var r=this,i=this.capabilitiesClazz.getPatch(),s=new i;OpenLayers.Request.GET({url:t,params:{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"},success:function(t){var i=t.responseXML;if(!i||!i.documentElement)i=t.responseText;var o=s.read(i);r.setCapabilities(e,o),r.parseCapabilitiesToLayers(e,o,n)},failure:function(){alert("Trouble getting capabilities doc"),OpenLayers.Console.error.apply(OpenLayers.Console,arguments)}})},parseCapabilitiesToLayers:function(e,t,n){var r=this,i=this.mapLayerService,s=null;t.operationsMetadata.GetTile.dcp.http.getArray?s=t.operationsMetadata.GetTile.dcp.http.getArray:s=t.operationsMetadata.GetTile.dcp.http.get;var o=t.contents.layers,u=t.contents,n=u.tileMatrixSets[n];for(var a=0;a<o.length;a++){var f=o[a],l=f.identifier,c=f.identifier,h={wmtsName:l,descriptionLink:"",orgName:"WMTS",type:"wmtslayer",legendImage:"",formats:{value:"text/html"},isQueryable:!0,minScale:1024e4,style:"",dataUrl:"",name:l,opacity:100,inspire:"WMTS",maxScale:1},p=Oskari.clazz.create("Oskari.mapframework.wmts.domain.WmtsLayer");p.setAsNormalLayer(),p.setId(l),p.setName(h.name),p.setWmtsName(h.wmtsName),p.setOpacity(h.opacity),p.setMaxScale(h.maxScale),p.setMinScale(h.minScale),p.setDescription(h.info),p.setDataUrl(h.dataUrl),p.setOrganizationName(h.orgName),p.setInspireName(h.inspire),p.setWmtsMatrixSet(n),p.setWmtsLayerDef(f),p.addWmtsUrl(s);var d=Oskari.clazz.builder("Oskari.mapframework.domain.Style"),v;for(var m=0,g=f.styles.length;m<g;++m){v=f.styles[m];var y=d();y.setName(v.identifier),y.setTitle(v.identifier),p.addStyle(y);if(v.isDefault){p.selectStyle(v.identifier);break}}i.addLayer(p,!1)}}}),define("bundles/framework/bundle/mapwmts/service/WmtsLayerService",function(){}),Oskari.clazz.define("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder",function(){},{parseLayerData:function(e,t,n){e.setWmtsName(t.wmsName);if(t.wmsUrl){var r=t.wmsUrl.split(",");for(var i=0;i<r.length;i++)e.addWmtsUrl(r[i])}var s=Oskari.clazz.builder("Oskari.mapframework.domain.Style"),o;for(var i=0,u=t.styles.length;i<u;++i){o=t.styles[i];var a=s();a.setName(o.identifier),a.setTitle(o.identifier),e.addStyle(a);if(o.isDefault){e.selectStyle(o.identifier);break}}e.setFeatureInfoEnabled(!0),t.tileMatrixSetData&&(e.setWmtsMatrixSet(t.tileMatrixSetData),e.setWmtsLayerDef(t.tileLayerData))}}),define("bundles/framework/bundle/mapwmts/service/WmtsLayerModelBuilder",function(){}),Oskari.clazz.define("Oskari.openlayers.Patch.WMTSCapabilities_v1_0_0",function(){},{getPatch:function(){return this.patch?this.patch:this.buildPatch()},buildPatch:function(){return this.patch=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.options=e;var t=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(t,this.yx)},read:function(e){typeof e=="string"&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&e.nodeType==9&&(e=e.documentElement);var t={};return this.readNode(e,t),t.version=this.version,t},props:{wmts:{TileMatrixLimits:{MinTileRow:["minTileRow",parseInt],MaxTileRow:["maxTileRow",parseInt],MinTileCol:["minTileCol",parseInt],MaxTileCol:["maxTileCol",parseInt],TileMatrix:["tileMatrix",null]}}},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},t.contents.layers=[],t.contents.tileMatrixSets={},this.readChildNodes(e,t.contents)},Layer:function(e,t){var n={styles:[],formats:[],tileMatrixSetLinks:[],tileMatrixSetLinksMap:{}};n.layers=[],this.readChildNodes(e,n),t.layers.push(n)},Style:function(e,t){var n={};n.isDefault=e.getAttribute("isDefault")==="true",this.readChildNodes(e,n),t.styles.push(n)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var n={};this.readChildNodes(e,n),t.tileMatrixSetLinks.push(n),t.tileMatrixSetLinksMap[n.tileMatrixSet]=n},TileMatrixSet:function(e,t){if(t.layers){var n={matrixIds:[]};this.readChildNodes(e,n),t.tileMatrixSets[n.identifier]=n}else t.tileMatrixSet=this.getChildValue(e)},TileMatrix:function(e,t){var n={supportedCRS:t.supportedCRS};this.readChildNodes(e,n),t.matrixIds.push(n)},ScaleDenominator:function(e,t){t.scaleDenominator=parseFloat(this.getChildValue(e))},TopLeftCorner:function(e,t){var n=this.getChildValue(e),r=n.split(" "),i;if(t.supportedCRS){var s=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[s]}i?t.topLeftCorner=new OpenLayers.LonLat(r[1],r[0]):t.topLeftCorner=new OpenLayers.LonLat(r[0],r[1])},TileWidth:function(e,t){t.tileWidth=parseInt(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=parseInt(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=parseInt(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=parseInt(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{},t.resourceUrl[e.getAttribute("resourceType")]={format:e.getAttribute("format"),template:e.getAttribute("template")}},WSDL:function(e,t){t.wsdl={},t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={},t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},TileMatrixSetLimits:function(e,t){var n={tileMatrixLimits:[]};t.tileMatrixSetLimits=n,this.readChildNodes(e,n);var r={};for(var i=0;i<n.tileMatrixLimits.length;i++){var s=n.tileMatrixLimits[i];r[s.tileMatrix]=s}t.tileMatrixSetLimitsMap=r},TileMatrixLimits:function(e,t){var n=this.getElementsByTagNameNS(e,this.namespaces.wmts,"*"),r=this.props.wmts.TileMatrixLimits,i={};for(var s=0;s<n.length;s++){var o=n[s],u=this.getChildValue(o),a=o.localName||o.nodeName.split(":").pop(),f=r[a][0],l=r[a][1];i[f]=l?l(u):u}t.tileMatrixLimits.push(i)}},ows:OpenLayers.Util.applyDefaults({HTTP:function(e,t){t.http={},this.readChildNodes(e,t.http)},Get:function(e,t){var n=this.getAttributeNS(e,this.namespaces.xlink,"href");t.get||(t.get=n),t.getArray||(t.getArray=[]),t.getArray.push(n)}},OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows)},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"}),this.patch}},{protocol:["Oskari.openlayers.Patch"]}),define("bundles/framework/bundle/mapwmts/format/WMTS_1_0_0_capabilities",function(){}),Oskari.clazz.define("Oskari.openlayers.Patch.layer.WMTS",function(){},{getPatch:function(){return this.patch?this.patch:this.buildPatch()},buildPatch:function(){return this.patch=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,layerDef:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var t={url:!0,layer:!0,style:!0,matrixSet:!0};for(var n in t)if(!(n in e))throw new Error("Missing property '"+n+"' in layer configuration.");e.params=OpenLayers.Util.upperCaseObject(e.params);var r=[e.name,e.url,e.params,e];OpenLayers.Layer.Grid.prototype.initialize.apply(this,r),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop());if(this.matrixIds){var i=this.matrixIds.length;if(i&&typeof this.matrixIds[0]=="string"){var s=this.matrixIds;this.matrixIds=new Array(i);for(var o=0;o<i;++o)this.matrixIds[o]={identifier:s[o]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.updateMatrixProperties()},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(e,t,n){return(t||!this.matrix)&&this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(e){return e==null&&(e=new OpenLayers.Layer.WMTS(this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]),e},getMatrix:function(){var e;if(!this.matrixIds||this.matrixIds.length===0)e={identifier:this.map.getZoom()+this.zoomOffset};else if("scaleDenominator"in this.matrixIds[0]){var t=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.map.getResolution()/28e-5,n=Number.POSITIVE_INFINITY,r;for(var i=0,s=this.matrixIds.length;i<s;++i)r=Math.abs(1-this.matrixIds[i].scaleDenominator/t),r<n&&(n=r,e=this.matrixIds[i])}else e=this.matrixIds[this.map.getZoom()+this.zoomOffset];return e},getTileInfo:function(e){var t=this.map.getResolution(),n=(e.lon-this.tileOrigin.lon)/(t*this.tileSize.w),r=(this.tileOrigin.lat-e.lat)/(t*this.tileSize.h),i=Math.floor(n),s=Math.floor(r);return{col:i,row:s,i:Math.floor((n-i)*this.tileSize.w),j:Math.floor((r-s)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var t="";if(!!this.tileFullExtent&&!this.tileFullExtent.intersectsBounds(e))return t;var n=e.getCenterLonLat(),r=this.getTileInfo(n),i=this.matrix.identifier;if(this.layerDef&&this.layerDef.tileMatrixSetLinksMap){var s=this.layerDef.tileMatrixSetLinksMap[this.matrixSet],o=s?s.tileMatrixSetLimitsMap[this.matrix.identifier]:null,u=o?r.row>=o.minTileRow&&r.row<=o.maxTileRow:!1,a=o?r.col>=o.minTileCol&&r.col<=o.maxTileCol:!1;if(!u||!a)return OpenLayers.Util.getImagesLocation()+"blank.gif"}if(this.requestEncoding.toUpperCase()==="REST"){var f=this.version+"/"+this.layer+"/"+this.style+"/";if(this.dimensions)for(var l=0;l<this.dimensions.length;l++)this.params[this.dimensions[l]]&&(f=f+this.params[this.dimensions[l]]+"/");f=f+this.matrixSet+"/"+this.matrix.identifier+"/"+r.row+"/"+r.col+"."+this.formatSuffix,OpenLayers.Util.isArray(this.url)?t=this.selectUrl(f,this.url):t=this.url,t.match(/\/$/)||(t+="/"),t+=f}else if(this.requestEncoding.toUpperCase()==="KVP"){var c={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:r.row,TILECOL:r.col,FORMAT:this.format};t=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[c])}return t},mergeNewParams:function(e){if(this.requestEncoding.toUpperCase()==="KVP")return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(e)])},CLASS_NAME:"OpenLayers.Layer.WMTS"}),this.patch}},{protocol:["Oskari.openlayers.Patch"]}),define("bundles/framework/bundle/mapwmts/layer/WMTS",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.MapWmtsBundleInstance",function(e){this.name="MapWmts",this.mediator=null,this.sandbox=null,this.service=null,this.ui=null},{start:function(){if(this.mediator.getState()=="started")return;var e=this,t=e.conf,n=(t?t.sandbox:null)||"sandbox",r=Oskari.getSandbox(n);this.sandbox=r;var i=r.getService("Oskari.mapframework.service.MapLayerService");i.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var s=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");i.registerLayerModelBuilder("wmtslayer",s);var o=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",i);return this.service=o,this.mediator.setState("started"),this},update:function(e,t,n,r){e.alert("RECEIVED update notification @BUNDLE_INSTANCE: "+r)},stop:function(){return this.mediator.setState("stopped"),this},getName:function(){return this.__name},__name:"Oskari.mapframework.bundle.MapWmtsBundleInstance"},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.Extension"]}),define("bundles/framework/bundle/mapwmts/instance",function(){}),define("bundles/framework/bundle/mapwmts/module",["oskari","jquery","./plugin/wmtslayer/WmtsLayerPlugin","./domain/WmtsLayer","./service/WmtsLayerService","./service/WmtsLayerModelBuilder","./format/WMTS_1_0_0_capabilities","./layer/WMTS","./instance"],function(e,t){return e.bundleCls("mapwmts").category({create:function(){return e.clazz.create("Oskari.mapframework.bundle.MapWmtsBundleInstance")},update:function(e,t,n,r){e.alert("RECEIVED update notification "+r)}})}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/openlayers/theme/default/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.ui.module.common.MapModule",function(e,t,n){this._id=e,this._imageUrl=t,this._options={resolutions:[2e3,1e3,500,200,100,50,20,10,4,2,1,.5,.25],srsName:"EPSG:3067",units:"m"};if(n)for(var r in n)this._options[r]=n[r];this._controls={},this._layerPlugins={},this._supportedFormats={},this._map=null,this._mapScales=[],this._sandbox=null,this._stealth=!1,this._pluginInstances={},this._navigationHistoryTool=new OpenLayers.Control.NavigationHistory,this._navigationHistoryTool.id="navigationhistory",this._localization=null},{getImageUrl:function(){return this._imageUrl?this._imageUrl:"/Oskari/resources"},getControls:function(){return this._controls},getMapControl:function(e){return this._controls[e]},addMapControl:function(e,t){this._controls[e]=t,this._map.addControl(t)},removeMapControl:function(e){this._map.removeControl(this._controls[e]),this._controls[e]=null,delete this._controls[e]},setLayerPlugin:function(e,t){this._layerPlugins[e]=t},getLayerPlugin:function(e){return this._layerPlugins[e]},getLayerPlugins:function(){return this._layerPlugins},clearNavigationHistory:function(){this._navigationHistoryTool.clear()},getName:function(){return this._id+"MapModule"},getSandbox:function(){return this._sandbox},getLocalization:function(e,t){if(!this._localization||t===!0)this._localization=Oskari.getLocalization("MapModule");return e?this._localization[e]:this._localization},init:function(e){e.printDebug("Initializing map module...#############################################"),this._sandbox=e,this._sandbox&&this._sandbox.getMap().setSrsName(this._options.srsName);for(p in this.eventHandlers)e.registerForEventByName(this,p);this.requestHandlers={mapLayerUpdateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequestHandler",e,this),mapMoveRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveRequestHandler",e,this),clearHistoryHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.controls.ClearHistoryHandler",e,this)},e.addRequestHandler("MapModulePlugin.MapLayerUpdateRequest",this.requestHandlers.mapLayerUpdateHandler),e.addRequestHandler("MapMoveRequest",this.requestHandlers.mapMoveRequestHandler),e.addRequestHandler("ClearHistoryRequest",this.requestHandlers.clearHistoryHandler),this._createMap();for(var t=0;t<this._options.resolutions.length;++t){var n=OpenLayers.Util.getScaleFromResolution(this._options.resolutions[t],this._map.units);n*=1e8,n=Math.round(n),n/=1e8,this._mapScales.push(n)}return this._createBaseLayer(),this.addMapControl("navigationHistoryTool",this._navigationHistoryTool),this.getMapControl("navigationHistoryTool").activate(),this._map},getPluginInstances:function(){return this._pluginInstances},getPluginInstance:function(e){return this._pluginInstances[this.getName()+e]},isPluginActivated:function(e){var t=this._pluginInstances[this.getName()+e];return t?!0:!1},registerPlugin:function(e){var t=this._sandbox;e.setMapModule(this);var n=e.getName();t.printDebug("["+this.getName()+"]"+" Registering "+n),e.register(),this._pluginInstances[n]=e},unregisterPlugin:function(e){var t=this._sandbox,n=e.getName();t.printDebug("["+this.getName()+"]"+" Unregistering "+n),e.unregister(),this._pluginInstances[n]=undefined,e.setMapModule(null),delete this._pluginInstances[n]},startPlugin:function(e){var t=this._sandbox,n=e.getName();t.printDebug("["+this.getName()+"]"+" Starting "+n),e.startPlugin(t)},stopPlugin:function(e){var t=this._sandbox,n=e.getName();t.printDebug("["+this.getName()+"]"+" Starting "+n),e.stopPlugin(t)},startPlugins:function(e){for(var t in this._pluginInstances)e.printDebug("["+this.getName()+"]"+" Starting "+t),this._pluginInstances[t].startPlugin(e)},stopPlugins:function(e){for(var t in this._pluginInstances)e.printDebug("["+this.getName()+"]"+" Starting "+t),this._pluginInstances[t].stopPlugin(e)},getStealth:function(){return this._stealth},setStealth:function(e){this._stealth=e==1},notifyAll:function(e,t){if(this._stealth)return;this._sandbox.notifyAll(e,t)},getMap:function(){return this._map},getMapViewPortDiv:function(){return this._map.viewPortDiv},getMapLayersContainerDiv:function(){return this._map.layerContainerDiv},transformCoordinates:function(e,t){return e.transform(new OpenLayers.Projection(t),this.getMap().getProjectionObject())},_createMap:function(){var e=this._sandbox,t=new OpenLayers.LonLat(0,0),n=new OpenLayers.Bounds(0,0,1e7,1e7);return this._options!=null&&this._options.maxExtent!=null&&this._options.maxExtent.left!=null&&this._options.maxExtent.bottom!=null&&this._options.maxExtent.right!=null&&this._options.maxExtent.top!=null&&(n=new OpenLayers.Bounds(this._options.maxExtent.left,this._options.maxExtent.bottom,this._options.maxExtent.right,this._options.maxExtent.top)),this._map=new OpenLayers.Map({controls:[],units:this._options.units,maxExtent:n,resolutions:this._options.resolutions,projection:this._options.srsName,isBaseLayer:!0,center:t,theme:null,zoom:0}),this._map},getProjection:function(){return this._options.srsName},_createBaseLayer:function(){var e=new OpenLayers.Layer("BaseLayer",{layerId:0,isBaseLayer:!0,displayInLayerSwitcher:!1});this._map.addLayer(e)},moveMapToLanLot:function(e,t,n){var r=n===!0;this._map.setCenter(e,this._map.getZoom(),r),t&&this.adjustZoomLevel(t,!0),this._updateDomain()},panMapToLonLat:function(e,t){this._map.setCenter(e,this._map.getZoom()),this._updateDomain(),t!==!0&&this.notifyMoveEnd()},zoomToScale:function(e,t,n){var r=t===!0;this._map.zoomToScale(e,r),this._updateDomain(),n!==!0&&this.notifyMoveEnd()},centerMap:function(e,t,n){this._map.setCenter(e,t,!1),this._updateDomain(),n!==!0&&this.notifyMoveEnd()},zoomIn:function(){this.adjustZoomLevel(1)},zoomOut:function(){this.adjustZoomLevel(-1)},zoomTo:function(e){this.setZoomLevel(e,!1)},panMapEast:function(){var e=this._map.getSize();this.panMapByPixels(.75*e.w,0)},panMapWest:function(){var e=this._map.getSize();this.panMapByPixels(-0.75*e.w,0)},panMapNorth:function(){var e=this._map.getSize();this.panMapByPixels(0,-0.75*e.h)},panMapSouth:function(){var e=this._map.getSize();this.panMapByPixels(0,.75*e.h)},panMapByPixels:function(e,t,n,r,i){this._map.pan(e,t,{dragging:i?!0:!1,animate:!1}),this._updateDomain(),n!==!0&&this.notifyStartMove(),r!==!0&&this.notifyMoveEnd()},moveMapByPixels:function(e,t,n,r){this._map.moveByPx(e,t),this._updateDomain(),n!==!0&&this.notifyStartMove(),r!==!0&&this.notifyMoveEnd()},centerMapByPixels:function(e,t,n,r){var i=new OpenLayers.Pixel(e,t),s=this._map.getLonLatFromViewPortPx(i);if(!this.isValidLonLat(s.lon,s.lat))return;this.moveMapToLanLot(s),n!==!0&&this.notifyStartMove(),r!==!0&&this.notifyMoveEnd()},isValidLonLat:function(e,t){var n=!0;if(t<625e4||t>82e5)return n=!1,n;if(e<0||e>135e4)n=!1;return n},zoomToExtent:function(e,t,n){this._map.zoomToExtent(e),this._updateDomain(),t!==!0&&this.notifyStartMove(),n!==!0&&this.notifyMoveEnd()},adjustZoomLevel:function(e,t){var n=this._getNewZoomLevel(e);this._map.zoomTo(n),this._updateDomain(),t!==!0&&this.notifyMoveEnd()},setZoomLevel:function(e,t){if(e==this._map.getZoom())return;if(e<0||e>this._map.getNumZoomLevels)e=this._map.getZoom();this._map.zoomTo(e),this._updateDomain(),t!==!0&&this.notifyMoveEnd()},_getNewZoomLevel:function(e){var t=this._map.getZoom()+e;return t>=0&&t<=this._map.getNumZoomLevels()?t:this._map.getZoom()},notifyStartMove:function(){if(this.getStealth())return;this._sandbox.getMap().setMoving(!0);var e=this._map.getCenter().lon,t=this._map.getCenter().lat,n=this._sandbox.getEventBuilder("MapMoveStartEvent")(e,t);this._sandbox.notifyAll(n)},notifyMoveEnd:function(){if(this.getStealth())return;var e=this._sandbox;e.getMap().setMoving(!1);var t=this._map.getCenter();this._updateDomain();var n=e.getEventBuilder("AfterMapMoveEvent")(t.lon,t.lat,this._map.getZoom(),!1,this._map.getScale());e.notifyAll(n)},updateSize:function(){this.getMap().updateSize(),this._updateDomain();var e=this._sandbox,t=e.getMap(),n=e.getEventBuilder("MapSizeChangedEvent")(t.getWidth(),t.getHeight());e.notifyAll(n)},_updateDomain:function(){if(this.getStealth())return;var e=this._sandbox,t=e.getMap(),n=this._map.getCenter();t.moveTo(n.lon,n.lat,this._map.getZoom()),t.setScale(this._map.getScale());var r=this._map.getCurrentSize();t.setWidth(r.w),t.setHeight(r.h),t.setResolution(this._map.getResolution()),t.setExtent(this._map.getExtent()),t.setMaxExtent(this._map.getMaxExtent()),t.setBbox(this._map.calculateBounds())},getMapScales:function(){return this._mapScales},calculateLayerScales:function(e,t){var n=[];for(var r=0;r<this._mapScales.length;r++)(!t||t>=this._mapScales[r])&&(!e||e<=this._mapScales[r])&&n.push(this._mapScales[r]);return n},calculateLayerResolutions:function(e,t){var n=[];for(var r=0;r<this._mapScales.length;r++)(!t||t>=this._mapScales[r])&&(!e||e<=this._mapScales[r])&&n.push(this._options.resolutions[r]);return n},getClosestZoomLevel:function(e,t){var n=this._map.getZoom();if(!t||!e)return n;var r=this._map.getScale();if(r<t){for(var i=n;i>0;i--)if(this._mapScales[i]>=t)return i}else if(r>e)for(var i=n;i<this._mapScales.length;i++)if(this._mapScales[i]<=e)return i;return n},start:function(e){if(this.started)return;e.printDebug("Starting "+this.getName()),this.startPlugins(e),this.updateCurrentState(),this.started=!0},stop:function(e){if(!this.started)return;this.stopPlugins(e),this.started=!1},_drawMarker:function(){this._removeMarkers();var e=this._map.getCenter(),t=new OpenLayers.Layer.Markers("Markers");this._map.addLayer(t);var n=new OpenLayers.Size(32,32),r=new OpenLayers.Pixel(-16,-n.h),i=new OpenLayers.Icon(this.getImageUrl()+"/framework/bundle/mapmodule-plugin/images/marker.png",n,r),s=new OpenLayers.Marker(e,i);t.addMarker(s)},_removeMarkers:function(){var e=this._map.getLayersByName("Markers");if(e)for(var t=0;t<e.length;t++)e[t]&&this._map.removeLayer(e[t],!1)},_hasMarkers:function(){var e=this._map.getLayersByName("Markers");if(e)for(var t=0;t<e.length;t++)if(e[t]&&e[t].markers&&e[t].markers.length>0)return!0;return!1},eventHandlers:{SearchClearedEvent:function(e){this._removeMarkers()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])},getOLMapLayers:function(e){var t=this,n=t._sandbox,r=n.findMapLayerFromSelectedMapLayers(e);if(!r)return null;var i=this.getLayerPlugins();for(var s in i){var o=i[s],u=o.getOLMapLayers(r);if(u)return u}return null},updateCurrentState:function(){var e=this,t=e._sandbox,n=t.findAllSelectedMapLayers(),r=this.getLayerPlugins();for(p in r){var i=r[p];t.printDebug("preselecting "+p),i.preselectLayers(n)}}},{protocol:["Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/mapmodule-plugin/ui/module/map-module",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.Plugin",function(){throw"Oskari.mapframework.ui.module.common.mapmodule.Plugin should not be instantiated"},{getName:function(){throw"Implement your own"},setMapModule:function(e){throw"Implement your own"},register:function(){throw"Implement your own"},unregister:function(){throw"Implement your own"},startPlugin:function(e){throw"Implement your own"},stopPlugin:function(e){throw"Implement your own"},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}}),define("bundles/framework/bundle/mapmodule-plugin/plugin/Plugin",function(){}),Oskari.clazz.define("Oskari.mapframework.mapmodule.ControlsPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.conf=e||{}},{__name:"ControlsPlugin",getName:function(){return this.pluginName},hasUI:function(){return!0},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name,this._createMapControls())},register:function(){},unregister:function(){},init:function(e){var t=this,n=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMovementControlsRequestHandler",t.getMapModule());this.requestHandlers={ToolSelectionRequest:Oskari.clazz.create("Oskari.mapframework.mapmodule.ToolSelectionHandler",e,t),EnableMapKeyboardMovementRequest:n,DisableMapKeyboardMovementRequest:n,EnableMapMouseMovementRequest:n,DisableMapMouseMovementRequest:n}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(var t in this.requestHandlers)e.addRequestHandler(t,this.requestHandlers[t]);for(var n in this.eventHandlers)e.registerForEventByName(this,n);this._addMapControls()},stopPlugin:function(e){for(var t in this.requestHandlers)e.removeRequestHandler(t,this.requestHandlers[t]);for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._removeMapControls(),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{"Toolbar.ToolSelectedEvent":function(e){this.conf.zoomBox!==!1&&this._zoomBoxTool.deactivate(),this.conf.measureControls!==!1&&(this._measureControls.line.deactivate(),this._measureControls.area.deactivate())}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_addMapControls:function(){var e=this;this.conf.zoomBox!==!1&&(this.getMapModule().addMapControl("zoomBoxTool",this._zoomBoxTool),this._zoomBoxTool.deactivate()),this.getMapModule().addMapControl("keyboardControls",this._keyboardControls),this.getMapModule().getMapControl("keyboardControls").activate(),this.conf.measureControls!==!1&&(this.getMapModule().addMapControl("measureControls_line",this._measureControls.line),this._measureControls.line.deactivate(),this.getMapModule().addMapControl("measureControls_area",this._measureControls.area),this._measureControls.area.deactivate()),this.getMapModule().addMapControl("mouseControls",this._mouseControls)},_removeMapControls:function(){this.conf.zoomBox!==!1&&(this._zoomBoxTool.deactivate(),this.getMapModule().removeMapControl("zoomBoxTool",this._zoomBoxTool)),this._keyboardControls.deactivate(),this.getMapModule().removeMapControl("keyboardControls",this._keyboardControls),this.conf.measureControls!==!1&&(this._measureControls.line.deactivate(),this._measureControls.area.deactivate(),this.getMapModule().removeMapControl("measureControls_line",this._measureControls.line),this.getMapModule().removeMapControl("measureControls_area",this._measureControls.area)),this._mouseControls.deactivate(),this.getMapModule().removeMapControl("mouseControls",this._mouseControls)},_createMapControls:function(){function i(t,n){var r=e._sandbox,i=t.geometry,s=t.units,o=t.order,u=t.measure,a=null;o===1?a=u.toFixed(3)+" "+s:o===2&&(a=u.toFixed(3)+" "+s+"<sup>2</sup>");var f=null,l=null;if(n&&OpenLayers.Format.GeoJSON){var c=new OpenLayers.Format.GeoJSON;f=c.write(i,!0),l="application/json"}r.request(e,r.getRequestBuilder("ShowMapMeasurementRequest")(a,n,f,l))}var e=this,t=e._sandbox;if(this._zoomBoxTool)return;this.conf.zoomBox!==!1&&(OpenLayers.Control.ZoomBox.prototype.draw=function(){this.handler=new OpenLayers.Handler.Box(this,{done:function(t){this.zoomBox(t),e.getMapModule()&&e.getMapModule().notifyMoveEnd()}},{keyMask:this.keyMask})},this._zoomBoxTool=new OpenLayers.Control.ZoomBox({alwaysZoom:!0})),this.conf.keyboardControls!==!1&&(this._keyboardControls=new OpenLayers.Control.PorttiKeyboard,this._keyboardControls.setup(this.getMapModule()));var n={handlerOptions:{persist:!0},immediate:!0},r={handlerOptions:{persist:!0},immediate:!0};this._measureControls={},this.conf.measureControls!==!1&&(this._measureControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,n),area:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,r)});for(var s in this._measureControls){var o=this._measureControls[s];o.events.on({measure:function(e){i(e,!0)},measurepartial:function(e){i(e,!1)}})}this.conf.mouseControls!==!1&&(this._mouseControls=new OpenLayers.Control.PorttiMouse(this.conf.mouse),this._mouseControls.setup(this.getMapModule()))}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/controls/ControlsPlugin",function(){}),OpenLayers.Control.PorttiKeyboard=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:50,core:null,setup:function(e){this.mapmodule=e,this.sandbox=e.getSandbox()},initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyDown,keyup:this.defaultKeyUp})},defaultKeyDown:function(e){switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.mapmodule.panMapByPixels(-this.slideFactor,0,!1,!0);break;case OpenLayers.Event.KEY_RIGHT:this.mapmodule.panMapByPixels(this.slideFactor,0,!1,!0);break;case OpenLayers.Event.KEY_UP:this.mapmodule.panMapByPixels(0,-this.slideFactor,!1,!0);break;case OpenLayers.Event.KEY_DOWN:this.mapmodule.panMapByPixels(0,this.slideFactor,!1,!0);break;case 17:this.sandbox.postRequestByName("CtrlKeyDownRequest");break;case 27:this.sandbox.postRequestByName("EscPressedEvent");break;case 33:this.mapmodule.notifyStartMove(),this.mapmodule.panMapNorth();break;case 34:this.mapmodule.notifyStartMove(),this.mapmodule.panMapSouth();break;case 35:this.mapmodule.notifyStartMove(),this.mapmodule.panMapEast();break;case 36:this.mapmodule.notifyStartMove(),this.mapmodule.panMapWest();break;case 43:case 61:case 187:case 107:this.mapmodule.zoomIn();break;case 45:case 109:case 189:case 95:this.mapmodule.zoomOut();break;case 70:this.sandbox.postRequestByName("MapFull.MapWindowFullScreenRequest")}},defaultKeyUp:function(e){switch(e.keyCode){case 17:this.sandbox.postRequestByName("CtrlKeyUpRequest");break;case 37:case 38:case 39:case 40:case 33:case 34:case 35:case 36:case 43:case 61:case 187:case 107:case 45:case 109:case 189:case 95:this.mapmodule.notifyMoveEnd()}},CLASS_NAME:"OpenLayers.Control.PorttiKeyboard"}),define("bundles/framework/bundle/mapmodule-plugin/plugin/controls/PorttiKeyboard",function(){}),OpenLayers.Control.PorttiMouse=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,useCenterMapInWheelZoom:!1,useCenterMapInDblClickZoom:!1,initialize:function(e){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},setup:function(e){this.mapmodule=e,this.sandbox=this.mapmodule.getSandbox(),this._hoverEventBuilder=this.sandbox.getEventBuilder("MouseHoverEvent"),this._hoverEvent=this._hoverEventBuilder(),this._mapClickedBuilder=this.sandbox.getEventBuilder("MapClickedEvent")},destroy:function(){this.deactivate(),this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.handlers.drag.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.handlers.hover.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.handlers.drag.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),this.handlers.hover.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.enableKinetic){var e={interval:this.kineticInterval};typeof this.enableKinetic=="object"&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag}),this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var t={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},n={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,t,n);var r={move:this.defaultHoverMove,pause:this.defaultHoverPause},i=this,s={pixelTolerance:1.1,passesTolerance:function(e){var t=!0;if(i.panned)return!1;if(this.pixelTolerance&&this.px){var n=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));n<this.pixelTolerance&&(t=!1)}return t}};this.handlers.hover=new OpenLayers.Handler.Hover(this,r,s),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw(),this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);if(OpenLayers.Control.PinchZoom){var o=this.pinchZoomOptions||{};o.pinchDone=function(e,t,n){this.applyTransform("");var r=this.map.getZoomForResolution(this.map.getResolution()/n.scale,!0);if(r!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var s=this.map.getResolutionForZoom(r),o=this.map.getLonLatFromPixel(this.pinchOrigin),u=this.currentCenter,a=this.map.getSize();o.lon+=s*(a.w/2-u.x),o.lat-=s*(a.h/2-u.y),i.sendMapSetCenter(o,r)}},this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},o))}},defaultClick:function(e){console.log("DEFAULTCLICK",e);if(e.lastTouches&&e.lastTouches.length==2)this.sendMapZoomOut();else{var t=navigator.userAgent.indexOf("MSIE 8.0")!=-1;if(t){var n=(new Date).getTime();this.lastDblClickMs?n-this.lastDblClickMs<1e3||this.sendMapClickEvent(e):this.sendMapClickEvent(e)}else this.sendMapClickEvent(e)}},defaultDblClick:function(e){var t=1,n=this.map.getZoom(),r=this.map.getZoom()+Math.round(t);r=Math.max(r,0),r=Math.min(r,this.map.getNumZoomLevels());if(r===n)return;var i=this.map.getSize(),s=i.w/2-e.xy.x,o=e.xy.y-i.h/2,u=this.map.baseLayer.getResolutionForZoom(r),a=this.map.getLonLatFromPixel(e.xy),f=null;this.useCenterMapInDblClickZoom?f=this.map.getCenter():f=new OpenLayers.LonLat(a.lon+s*u,a.lat+o*u);var l=navigator.userAgent.indexOf("MSIE 8.0")!=-1;l&&(this.lastDblClickMs=(new Date).getTime()),this.sendMapSetCenter(f,r)},defaultDblRightClick:function(e){this.sendMapZoomOut()},wheelChange:function(e,t){var n=this.map.getZoom(),r=this.map.getZoom()+Math.round(t);r=Math.max(r,0),r=Math.min(r,this.map.getNumZoomLevels());if(r===n)return;var i=this.map.getSize(),s=i.w/2-e.xy.x,o=e.xy.y-i.h/2,u=this.map.baseLayer.getResolutionForZoom(r),a=this.map.getLonLatFromPixel(e.xy),f=null;this.useCenterMapInWheelZoom?f=this.map.getCenter():f=new OpenLayers.LonLat(a.lon+s*u,a.lat+o*u),this.sendMapSetCenter(f,r)},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},panMapStart:function(){this.kinetic&&this.kinetic.begin(),this.panned=!1},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.panned||this.mapmodule.notifyStartMove(),this.panned=!0,this.map.pan(this.handlers.drag.last.x-e.x,this.handlers.drag.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;this.kinetic&&(t=this.kinetic.end(e)),this.mapmodule.panMapByPixels(this.handlers.drag.x-e.x,this.handlers.drag.y-e.y,!0,!1,!1);if(t){var n=this;this.kinetic.move(t,function(e,t,r){n.mapmodule.panMapByPixels(e,t,!0,!1,!1)})}this.panned=!1}},defaultHoverMove:function(e){if(this.panned)return;var t=this.map.getLonLatFromViewPortPx(e.xy);this._hoverEvent.set(t.lon,t.lat,!1,e.pageX,e.pageY),this.sandbox.notifyAll(this._hoverEvent,!0)},defaultHoverPause:function(e){if(this.panned)return;var t=this.map.getLonLatFromViewPortPx(e.xy),n=this._hoverEventBuilder();n.set(t.lon,t.lat,!1,e.pageX,e.pageY,!0),this.sandbox.notifyAll(n)},sendMapClickEvent:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy),e=this._mapClickedBuilder(t,e.xy.x,e.xy.y);this.sandbox.notifyAll(e)},sendMapSetCenter:function(e,t){this.mapmodule.centerMap(e,t)},sendMapZoomOut:function(){this.mapmodule.zoomOut()},sendMapZoomIn:function(){this.mapmodule.zoomIn()},CLASS_NAME:"OpenLayers.Control.PorttiMouse"}),define("bundles/framework/bundle/mapmodule-plugin/plugin/controls/PorttiMouse",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.DisableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"DisableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/DisableMapKeyboardMovementRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.DisableMapMouseMovementRequest",function(){this._creator=null},{__name:"DisableMapMouseMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/DisableMapMouseMovementRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.EnableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"EnableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/EnableMapKeyboardMovementRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.EnableMapMouseMovementRequest",function(){this._creator=null},{__name:"EnableMapMouseMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/EnableMapMouseMovementRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMovementControlsRequestHandler",function(e){this.mapModule=e},{handleRequest:function(e,t){if(t.getName()=="EnableMapKeyboardMovementRequest"){var n=this.mapModule.getMapControl("keyboardControls");n&&n.activate()}else if(t.getName()=="DisableMapKeyboardMovementRequest"){var n=this.mapModule.getMapControl("keyboardControls");n&&n.deactivate()}else if(t.getName()=="EnableMapMouseMovementRequest"){var n=this.mapModule.getMapControl("mouseControls");n&&(n.activate(),n.registerMouseEvents())}else if(t.getName()=="DisableMapMouseMovementRequest"){var n=this.mapModule.getMapControl("mouseControls");n&&(n.deactivate(),n.unregisterMouseEvents())}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapMovementControlsRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.getinfo.GetFeatureInfoHandler",function(e){this.getInfoPlugin=e},{handleRequest:function(e,t){t.getName()=="MapModulePlugin.GetFeatureInfoRequest"?this.getInfoPlugin.handleGetInfo({lon:t.getLon(),lat:t.getLat()},t.getX(),t.getY()):t.getName()=="MapModulePlugin.GetFeatureInfoActivationRequest"&&this.getInfoPlugin.setEnabled(t.isEnabled())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetFeatureInfoHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.GetFeatureInfoRequest",function(e,t,n,r){this._lon=e,this._lat=t,this._x=n,this._y=r},{__name:"MapModulePlugin.GetFeatureInfoRequest",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.GetFeatureInfoActivationRequest",function(e){this._enable=e===!0},{__name:"MapModulePlugin.GetFeatureInfoActivationRequest",getName:function(){return this.__name},isEnabled:function(){return this._enable}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoActivationRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.mapmodule.GetInfoPlugin",function(e,t){this.config=e,this._locale=t,this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.enabled=!0,this.infoboxId="getinforesult",this._pendingAjaxQuery={busy:!1,jqhr:null,timestamp:null},this.template={};for(p in this.__templates)this.template[p]=jQuery(this.__templates[p])},{__templates:{wrapper:"<div></div>",getinfo_result_table:'<table class="getinforesult_table"></table>',link_outside:'<a target="_blank"></a>',tableRow:"<tr></tr>",tableCell:"<td></td>",span:"<span></span>",header:'<div class="getinforesult_header"><div class="icon-bubble-left"></div>',headerTitle:'<div class="getinforesult_header_title"></div>'},__name:"GetInfoPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){var t=this;t._sandbox=e,t._sandbox.printDebug("[GetInfoPlugin] init"),t.getGFIHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.getinfo.GetFeatureInfoHandler",t)},register:function(){},unregister:function(){},startPlugin:function(e){var t=this;e&&e.register&&(t._sandbox=e),t._map=t.getMapModule().getMap(),t._sandbox.register(t);for(p in t.eventHandlers)t._sandbox.registerForEventByName(t,p);t._sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoRequest",t.getGFIHandler),t._sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoActivationRequest",t.getGFIHandler)},stopPlugin:function(e){var t=this;t._closeGfiInfo(),e&&e.register&&(t._sandbox=e);for(p in t.eventHandlers)t._sandbox.unregisterFromEventByName(t,p);t._sandbox.unregister(t),t._map=null,t._sandbox=null},start:function(e){},stop:function(e){},setEnabled:function(e){this.enabled=e===!0,this.enabled||this._closeGfiInfo()},eventHandlers:{EscPressedEvent:function(e){this._closeGfiInfo()},MapClickedEvent:function(e){if(!this.enabled)return;var t=e.getLonLat(),n=e.getMouseX(),r=e.getMouseY();this.handleGetInfo(t,n,r)},AfterMapMoveEvent:function(e){this._cancelAjaxRequest()}},onEvent:function(e){var t=this;return this.eventHandlers[e.getName()].apply(this,[e])},_cancelAjaxRequest:function(){var e=this;if(!e._pendingAjaxQuery.busy)return;var t=e._pendingAjaxQuery.jqhr;e._pendingAjaxQuery.jqhr=null;if(!t)return;this._sandbox.printDebug("[GetInfoPlugin] Abort jqhr ajax request"),t.abort(),t=null,e._pendingAjaxQuery.busy=!1},_buildLayerIdList:function(){var e=this,t=e._sandbox.findAllSelectedMapLayers(),n=null,r=e._sandbox.getMap().getScale();for(var i=0;i<t.length;i++){var s=t[i];if(e._isIgnoredLayerType(s))continue;if(!s.getQueryable||!s.getQueryable())continue;if(!s.isInScale(r))continue;if(!s.isVisible())continue;n||(n=""),n!==""&&(n+=","),n+=s.getId()}return n},_isIgnoredLayerType:function(e){if(this.config!=null&&this.config.ignoredLayerTypes)for(var t=0;t<this.config.ignoredLayerTypes.length;t++)if(e.isLayerOfType(this.config.ignoredLayerTypes[t]))return!0;return!1},_startAjaxRequest:function(e){var t=this;t._pendingAjaxQuery.busy=!0,t._pendingAjaxQuery.timestamp=e},_finishAjaxRequest:function(){var e=this;e._pendingAjaxQuery.busy=!1,e._pendingAjaxQuery.jqhr=null,this._sandbox.printDebug("[GetInfoPlugin] finished jqhr ajax request")},_notifyAjaxFailure:function(){var e=this;e._sandbox.printDebug("[GetInfoPlugin] GetFeatureInfo AJAX failed")},_isAjaxRequestBusy:function(){var e=this;return e._pendingAjaxQuery.busy},handleGetInfo:function(e,t,n){var r=this,i=new Date,s=i.getTime();if(r._pendingAjaxQuery.busy&&r._pendingAjaxQuery.timestamp&&s-r._pendingAjaxQuery.timestamp<500){r._sandbox.printDebug("[GetInfoPlugin] GetFeatureInfo NOT SENT (time difference < 500ms)");return}r._cancelAjaxRequest();var o=r._buildLayerIdList();if(!o){var u={fragments:[],lonlat:e,popupid:this.infoboxId,title:""},a=this.getMapModule().getLocalization("plugin",!0),f=a[this.__name];u.title=f.title;var l=r._sandbox.getEventBuilder("GetInfoResultEvent")(u);r._sandbox.notifyAll(l),r._sandbox.printDebug("[GetInfoPlugin] NO layers with featureInfoEnabled, in scale and visible");return}r._startAjaxRequest(s);var c=this._sandbox.getAjaxUrl(),h=e.lon,p=e.lat,d=r._sandbox.getMap();jQuery.ajax({beforeSend:function(e){r._pendingAjaxQuery.jqhr=e,e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(t){if(t.data&&t.data instanceof Array){t.lonlat=e;var n=r._parseGfiResponse(t);if(!n)return;n.popupid=r.infoboxId,n.lonlat=e;if(!r._isAjaxRequestBusy())return;r._showFeatures(n)}r._finishAjaxRequest()},error:function(){r._finishAjaxRequest(),r._notifyAjaxFailure()},always:function(){r._finishAjaxRequest()},complete:function(){r._finishAjaxRequest()},data:{layerIds:o,projection:r.mapModule.getProjection(),x:t,y:n,lon:h,lat:p,width:d.getWidth(),height:d.getHeight(),bbox:d.getBbox().toBBOX(),zoom:d.getZoom(),srs:d.getSrsName()},type:"POST",dataType:"json",url:c+"action_route=GetFeatureInfoWMS"})},_closeGfiInfo:function(){var e=this._sandbox.getRequestBuilder("InfoBox.HideInfoBoxRequest")(this.infoboxId);this._sandbox.request(this,e)},_showGfiInfo:function(e,t){var n=this._sandbox.getRequestBuilder("InfoBox.ShowInfoBoxRequest")("getinforesult","GetInfo Result",e,t,!0);this._sandbox.request(this,n)},_formatResponseForInfobox:function(e){var t=[];if(!e||!e.data)return t;var n=this,r=[];e.data.length?r=e.data:r.push(e.data);for(var i=0;i<r.length;i++){var s=r[i],o=n._formatGfiDatum(s);o!=null&&t.push({html:o})}return t},_parseGfiResponse:function(e){var t=this._sandbox,n=e.data,r=[],i=e.lonlat,s=i.lon+", "+i.lat,o=e.layerCount;if(o!=0&&n.length!=0&&n instanceof Array){for(var u=0;u<n.length;u++){var a=n[u],f=a.layerId,l=t.findMapLayerFromSelectedMapLayers(f),c=l?l.getName():"",h=a.type;if(h=="wfslayer"){var p=a.features;if(!p||!p.length)continue;for(var d=0;d<p.length;d++){var v=p[d],m=v.children;if(!m||!m.length)continue;for(var g=0;g<m.length;g++){var y=m[g],b=y.pnr_PaikanNimi;b&&b["pnr:kirjoitusasu"]&&(s=b["pnr:kirjoitusasu"]);var w=this._json2html(y);r.push({markup:w,layerId:f,layerName:c,type:h})}}}else{var w=this._formatGfiDatum(a);w!=null&&r.push({markup:w,layerId:f,layerName:c,type:h})}}return{fragments:r,title:s}}return},_formatJSONValue:function(e){if(!e)return;var t=this.template.span.clone();if(Object.prototype.toString.call(e)==="[object Array]"){var n="";for(var r=0;r<e.length;++r){var i=e[r];for(objAttr in i){var s=this._formatJSONValue(i[objAttr]);if(!s)continue;var o=this.getMapModule().getLocalization("plugin",!0),u=o[this.__name],a=u[objAttr];t.append(a?a:objAttr),t.append(": "),t.append(s),t.append("<br/>")}}}else if(e.indexOf&&e.indexOf("://")>0&&e.indexOf("://")<7){var f=t,l=this.template.link_outside.clone();l.attr("href",e),l.append(e),t.append(l)}else t.append(e);return t},_formatGfiDatum:function(e){if(!e.presentationType)return null;var t=this,n=t.template.wrapper.clone(),r="",i=typeof e.content,s=!1;i=="string"&&(s=e.content.indexOf("<html>")>=0,s=s||e.content.indexOf("<HTML>")>=0);if(e.presentationType=="JSON"||e.content&&e.content.parsed){var o=!1,u=e.content.parsed,a=[];Object.prototype.toString.call(u)==="[object Array]"?a=u:a.push(u);for(var f=0;f<a.length;++f){var l=a[f],c=t.template.getinfo_result_table.clone();for(var h in l){var p=t._formatJSONValue(l[h]);if(!p)continue;var d=t.template.tableRow.clone();c.append(d),o||d.addClass("odd"),o=!o;var v=t.template.tableCell.clone(),m=this.getMapModule().getLocalization("plugin",!0),g=m[this.__name],y=g[h];v.append(y?y:h),d.append(v);var b=t.template.tableCell.clone();b.append(p),d.append(b)}n.append(c)}return n}return n.append(e.content),n},_json2html:function(e){if(e==null)return"";var t=!0,n=this.template.getinfo_result_table.clone(),r=null,i=null,s=null;for(var o in e){var u=e[o],a=(typeof u).toLowerCase(),f="";switch(a){case"string":u.indexOf("http://")==0?(valpres=this.template.link_outside.clone(),valpres.attr("href",u),valpres.append(u)):valpres=u;break;case"undefined":valpres="n/a";break;case"boolean":valpres=u?"true":"false";break;case"number":valpres=""+u+"";break;case"function":valpres="?";break;case"object":valpres=this._json2html(u);break;default:valpres=""}t=!t,r=this.template.tableRow.clone(),t||r.addClass("odd"),i=this.template.tableCell.clone(),i.append(o),r.append(i),s=this.template.tableCell.clone(),s.append(valpres),r.append(s),n.append(r)}return n},_showFeatures:function(e){var t=this,n={},r=t.template.wrapper.clone();n.html="",n.actions={};for(var i=0;i<e.fragments.length;i++){var s=e.fragments[i],o=s.layerName,u=s.markup,a=t.template.wrapper.clone(),f=t.template.header.clone(),l=t.template.headerTitle.clone();l.append(o),l.attr("title",o),f.append(l),a.append(f),u&&a.append(u),r.append(a)}n.html=r;var c=this.getMapModule().getLocalization("plugin",!0),h=c[this.__name];e.title=h.title;if(!this.config||this.config.infoBox){var p=t._sandbox.getRequestBuilder("InfoBox.ShowInfoBoxRequest")(e.popupid,e.title,[n],e.lonlat,!0);t._sandbox.request(t,p)}var d=t._sandbox.getEventBuilder("GetInfoResultEvent")(e);t._sandbox.notifyAll(d)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetInfoPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/getinfo/css/getinfo.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.mapmodule.MarkersPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null},{__name:"MarkersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){this.requestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MarkerRequestHandler",this)},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this._createMapMarkersLayer(),e.register(this),this._sandbox.addRequestHandler("MapModulePlugin.RemoveMarkerRequest",this.requestHandler);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){this._sandbox.removeRequestHandler("MapModulePlugin.RemoveMarkerRequest",this.requestHandler);for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},removeMapMarkers:function(e){var t=this.getMapModule();t&&t._removeMarkers()},_createMapMarkersLayer:function(){var e=this._sandbox,t=new OpenLayers.Layer.Markers("Markers");this._map.addLayer(t)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/markers/MarkersPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.RemoveMarkerRequest",function(e){this._list=e},{__name:"MapModulePlugin.RemoveMarkerRequest",getName:function(){return this.__name},getMarkerIds:function(){return this._list}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/RemoveMarkerRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MarkerRequestHandler",function(e){this.markersPlugin=e},{handleRequest:function(e,t){t.getName()=="MapModulePlugin.RemoveMarkerRequest"&&this.markersPlugin.removeMapMarkers(t.getMarkerIds())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MarkerRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._conf=e,this.container=null,this.loc=null},{__name:"SearchPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){var t=this.getMapModule().getLocalization("plugin",!0);this.loc=t[this.__name],this.template=jQuery('<div class="search-div"><div class="search-textarea-and-button"><input placeholder="'+this.loc.placeholder+'" type="text" />'+'<input type="button" value="'+this.loc.search+'" name="search" />'+"</div>"+'<div class="results">'+'<div class="header"><div class="close icon-close" title="'+this.loc.close+'"></div></div>'+'<div class="content">&nbsp;</div>'+"</div>"+"</div>"),this.templateResultsTable=jQuery("<table class='search-results'><thead><tr><th>"+this.loc.column_name+"</th>"+"<th>"+this.loc.column_village+"</th>"+"<th>"+this.loc.column_type+"</th>"+"</tr></thead><tbody></tbody></table>"),this.templateResultsRow=jQuery("<tr><td nowrap='nowrap'><a href='JavaScript:void(0);'></a></td><td nowrap='nowrap'></td><td nowrap='nowrap'></td></tr>");var n=null;this.conf&&this.conf.url?n=this.conf.url:n=e.getAjaxUrl()+"action_route=GetSearchResult",this.service=Oskari.clazz.create("Oskari.mapframework.bundle.search.service.SearchService",n)},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this._createUI()},stopPlugin:function(e){this.container.remove();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_createUI:function(){var e=this._sandbox,t=this,n=this.template.clone();this.container=n;var r=jQuery("div.mapplugins.left");if(!r||r.length==0)r=jQuery(this._map.div),n.addClass("mapplugin");var t=this,i=n.find("input[type=text]");i.focus(function(){e.request(t.getName(),e.getRequestBuilder("DisableMapKeyboardMovementRequest")())}),i.blur(function(){e.request(t.getName(),e.getRequestBuilder("EnableMapKeyboardMovementRequest")())}),i.keypress(function(e){t._checkForEnter(e)}),n.find("input[type=button]").click(function(e){t._doSearch()}),n.find("div.close").click(function(e){t._hideSearch()}),n.find("div.results").hide(),r.append(n),this._conf&&this._conf.location&&(this._conf.location.top&&n.css("top",this._conf.location.top),this._conf.location.left&&n.css("left",this._conf.location.left),this._conf.location.right&&n.css("right",this._conf.location.right),this._conf.location.bottom&&n.css("bottom",this._conf.location.bottom))},_checkForEnter:function(e){var t;window.event?t=window.event.keyCode:e&&(t=e.which),e.keyCode==13&&this._doSearch()},_doSearch:function(){if(this._searchInProgess==1)return;var e=this;this._hideSearch(),this._searchInProgess=!0;var t=this.container.find("input[type=text]");t.addClass("search-loading");var n=t.val(),r=function(t){e._showResults(t),e._enableSearch()},i=function(){e._enableSearch()};this.service.doSearch(n,r,i)},_showResults:function(e){var t=e.error,n=this,r=this.container.find("div.results"),i=r.find("div.header"),s=r.find("div.content");if(t!=null){s.html(t),r.show();return}var o=e.totalCount;if(o==0)s.html(this.loc.noresults),r.show();else if(o==1){var u=e.locations[0].lon,a=e.locations[0].lat,f=e.locations[0].zoomLevel;this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("MapMoveRequest")(u,a,f,!1))}else{var l=this.templateResultsTable.clone(),c=l.find("tbody");for(var h=0;h<o;h++){if(h>=100){c.append("<tr><td class='search-result-too-many' colspan='3'>"+this.loc.toomanyresults+"</td></tr>");break}var u=e.locations[h].lon,a=e.locations[h].lat,f=e.locations[h].zoomLevel,p=u+"---"+a+"---"+f,d=this.templateResultsRow.clone();d.attr("data-location",p);var v=e.locations[h].name,m=e.locations[h].village,g=e.locations[h].type,y=d.find("td"),b=jQuery(y[0]).find("a");b.attr("data-location",p),b.append(v),b.click(function(){return n._resultClicked(jQuery(this).attr("data-location")),!1}),jQuery(y[1]).append(m),jQuery(y[2]).append(g),c.append(d)}c.find(":odd").addClass("odd"),s.html(l),r.show()}},_resultClicked:function(e){var t=e.split("---"),n=t[0],r=t[1],i=t[2];this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("MapMoveRequest")(n,r,i,!1))},_enableSearch:function(){this._searchInProgess=!1,jQuery("#search-string").removeClass("search-loading")},_hideSearch:function(){this.container.find("div.results").hide(),this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("HideMapMarkerRequest")())}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/search/SearchPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.search.service.SearchService",function(e){this._searchUrl=e},{__qname:"Oskari.mapframework.bundle.search.service.SearchService",getQName:function(){return this.__qname},__name:"SearchService",getName:function(){return this.__name},doSearch:function(e,t,n){var r=Oskari.getLang();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/json")},url:this._searchUrl,data:"searchKey="+e+"&Language="+r,error:n,success:t})}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/framework/bundle/search/service/searchservice",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/search/css/search.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.element=null},{templates:{main:jQuery("<div class='logoplugin'><div class='icon'></div><div class='terms'><a href='JavaScript:void(0);'></a></div></div>")},__name:"LogoPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){},register:function(){},unregister:function(){},startPlugin:function(e){var t=this;t._sandbox=e,t._map=t.getMapModule().getMap(),e.register(t);for(p in t.eventHandlers)e.registerForEventByName(t,p);t._createUI()},stopPlugin:function(e){var t=this;for(p in t.eventHandlers)e.unregisterFromEventByName(t,p);e.unregister(t),t._map=null,t._sandbox=null,t.element&&(t.element.find("a").unbind("click"),t.element.remove(),t.element=undefined)},start:function(e){},stop:function(e){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_createUI:function(){var e=this,t=e._sandbox,n=jQuery(e._map.div);e.element||(e.element=e.templates.main.clone()),n.append(e.element);var r=e.getMapModule().getLocalization("plugin",!0),i=r[e.__name],s=e.element.find("div.icon");s.bind("click",function(){var e=t.generateMapLinkParameters(),n=i.mapLinkBase+e;return window.open(n,"_blank"),!1});var s=e.element.find("a");s.append(i.terms),s.bind("click",function(){var e=i.termsLink;return window.open(e,"_blank"),!1})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/logo/LogoPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/logo/css/logoplugin.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.DataSourcePlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.template=null,this.element=null,this.sandbox=null,this.tool=null},{__name:"DataSourcePlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){this.template=jQuery("<div class='oskari-datasource'><div class='link'><a href='JavaScript:void(0);'></a></div></div>"),this.templateinfoIcon=jQuery('<div class="icon-info"></div>'),this.templategroupTemplate=jQuery('<ul style="padding: 0 12px;"></ul>'),this.templatecontent=jQuery("<div></div>"),this.templateheading=jQuery("<b></b>")},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this._createUI()},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null,this.element.find("a").unbind("click"),this.element.remove(),this.element=undefined},start:function(e){},stop:function(e){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_layerListComparator:function(e,t){var n=e.getOrganizationName().toLowerCase(),r=t.getOrganizationName().toLowerCase();return n==r&&(n=e.getName().toLowerCase(),r=t.getName().toLowerCase()),n<r?-1:n>r?1:0},_createUI:function(){var e=this,t=e._sandbox,n=jQuery(this._map.div);this.element||(this.element=this.template.clone()),n.append(this.element);var r=this.getMapModule().getLocalization("plugin",!0);this.localization=r[this.__name];var i=this.element.find("a");i.append(this.localization.link),i.bind("click",function(){return e._openDialog(),!1})},_openDialog:function(){var e=this,t=e._sandbox,n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=n.createCloseButton(this.localization.button.close),i=this.templateinfoIcon.clone(),s=this.templategroupTemplate.clone(),o=this._getLayers(),u=null,a=this.templatecontent.clone(),f=null;for(var l=0;l<o.length;++l){var c=o[l];if(u!=c.getOrganizationName()){u=c.getOrganizationName();var h=this.templateheading.clone();u?h.append(u):h.append("N/A"),a.append(h),f=s.clone(),a.append(f)}var p=this._getLayerContainer(c);p&&f.append(p)}n.show(this.localization.popup.title,a,[r]),n.moveTo(this.element.find("a"),"top")},_getLayers:function(){var e=this,t=this._sandbox.findAllSelectedMapLayers();return t.sort(function(t,n){return e._layerListComparator(t,n)}),t},_getLayerContainer:function(e){var t=this,n=this.templateinfoIcon.clone(),r=e.getName();if(r){var i=jQuery("<li>"+r+"</li>"),s=e.getMetadataIdentifier();if(s){var o=n.clone();o.bind("click",function(){t._getMetadataInfoCallback(e)}),i.append(o)}return i}return null},_getMetadataInfoCallback:function(e){var t=this,n=t._sandbox,r=e.getMetadataIdentifier(),i=[],s={};s[r]=!0;var o=e.getSubLayers();if(o&&o.length>0)for(var u=0;u<o.length;u++){var a=o[u].getMetadataIdentifier();a&&a!=""&&!s[a]&&(s[a]=!0,i.push({uuid:a}))}n.postRequestByName("catalogue.ShowMetadataRequest",[{uuid:r},i])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/datasource/DataSourcePlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/datasource/css/datasource.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._conf=e,this._indexMap=null,this._indexMapUrl="/framework/bundle/mapmodule-plugin/plugin/indexmap/images/suomi25m_tm35fin.png"},{__name:"IndexMapPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){},_createUI:function(){var e=new OpenLayers.Layer.Image("Overview map image",this.getMapModule().getImageUrl()+this._indexMapUrl,new OpenLayers.Bounds(26783,6608595,852783,7787250),new OpenLayers.Size(120,173)),t={mapOptions:{maxExtent:new OpenLayers.Bounds(26783,6608595,852783,7787250),units:"m",projection:this._map.getProjection(),numZoomLevels:1},layers:[e],size:new OpenLayers.Size(120,173),autoPan:!1,controls:[]};this._indexMap=new OpenLayers.Control.OverviewMap(t)},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this._createUI(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this.getMapModule().addMapControl("overviewMap",this._indexMap)},stopPlugin:function(e){this.getMapModule().removeMapControl("overviewMap");for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{AfterMapMoveEvent:function(e){this._indexMap&&this._indexMap.update()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/indexmap/IndexMapPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/indexmap/css/indexmap.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._scalebar=null},{__name:"ScaleBarPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){this._scalebar=new OpenLayers.Control.ScaleLine},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this.getMapModule().addMapControl("scaleBar",this._scalebar)},stopPlugin:function(e){this.getMapModule().removeMapControl("scaleBar");for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{AfterMapMoveEvent:function(e){this._scalebar&&this._scalebar.update()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/scalebar/ScaleBarPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.FullScreenPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._fullscreen=null,this.__templates={}},{__name:"FullScreenPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){var t=this,n=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/fullscreen/images/";this.__templates.fullscreen=jQuery('<div class="fullscreenDiv"><img class="fullscreenDivImg" src="'+n+"hide-navigation.png"+'"></img>'+"</div>")},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this.createUI()},stopPlugin:function(e){jQuery("div.fullscreenDiv").remove();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},createUI:function(){var e=this,t=this.__templates.fullscreen.clone(),n=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/fullscreen/images/";t.find(".fullscreenDivImg").bind("click",function(t){t.preventDefault(),e._sandbox.postRequestByName("MapFull.MapWindowFullScreenRequest"),jQuery(this).attr("src").match(/hide-navigation/)?jQuery(this).attr("src",n+"show-navigation.png"):jQuery(this).attr("src",n+"hide-navigation.png")}),jQuery(this._map.div).append(t)},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/fullscreen/FullScreen",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/fullscreen/css/fullscreen.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.element=undefined,this.conf=e,this.initialSetup=!0},{__name:"LayerSelectionPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(e){this.template=jQuery('<div class=\'layerSelectionPlugin\'><div class="header"><div class="header-icon icon-arrow-white-right"></div></div><div class="content"><div class="layers"></div><div class="baselayers"></div></div></div>'),this.templateLayer=jQuery("<div class='layer'><span></span></div>"),this.templateCheckbox=jQuery("<input type='checkbox' />"),this.templateRadiobutton=jQuery("<input type='radio' name='defaultBaselayer'/>"),this.templateBaseLayerHeader=jQuery('<div class="baseLayerHeader"></div>')},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this._createUI()},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this.element&&(this.element.remove(),this.element=undefined,delete this.element)},start:function(e){},stop:function(e){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.removeLayer(e.getMapLayer())},AfterMapLayerAddEvent:function(e){this.addLayer(e.getMapLayer())},MapLayerVisibilityChangedEvent:function(e){this.updateLayer(e.getMapLayer())},AfterMapMoveEvent:function(e){if(this.initialSetup){this.initialSetup=!1;if(this.conf&&this.conf.baseLayers){for(var t=0;t<this.conf.baseLayers.length;++t){var n=this._sandbox.findMapLayerFromSelectedMapLayers(this.conf.baseLayers[t]);this.addBaseLayer(n)}this.conf.defaultBaseLayer&&this.selectBaseLayer(this.conf.defaultBaseLayer)}}}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(){},selectBaseLayer:function(e){var t=this.element.find("div.content div.baselayers");if(!t||t.length==0)return;var n=t.find("input[value="+e+"]");n.attr("checked","checked"),this._changedBaseLayer()},addLayer:function(e){var t=this,n=this.element.find("div.content"),r=n.find("div.layers"),i=this.templateLayer.clone();i.find("span").append(e.getName());var s=this.templateCheckbox.clone();s.attr("value",e.getId()),e.isVisible()?s.attr("checked",!0):s.attr("checked",!1),this._bindCheckbox(s,e),i.find("span").before(s),this.layerRefs[e.getId()]=i,r.append(i)},updateLayer:function(e){var t=this.layerRefs[e.getId()],n=t.find("input"),r=e.isVisible();r?n.is(":checked")||n.attr("checked","checked"):n.is(":checked")&&n.removeAttr("checked")},_bindCheckbox:function(e,t){var n=this;e.change(function(){var e=jQuery(this),r=e.is(":checked");r?n._setLayerVisible(t,!0):n._setLayerVisible(t,!1)})},_setLayerVisible:function(e,t){var n=this._sandbox,r=n.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),i=r(e.getId(),t);n.request(this,i)},removeLayer:function(e){var t=this.layerRefs[e.getId()];t.remove(),delete this.layerRefs[e.getId()]},addBaseLayer:function(e){if(!e||!e.getId)return;var t=this.layerRefs[e.getId()];t.remove();var n=t.find("input");n.remove(),n=this.templateRadiobutton.clone(),n.attr("value",e.getId());var r=this;n.bind("change",function(e){r._changedBaseLayer()}),t.find("span").before(n);var i=this.element.find("div.content div.baselayers");if(i.find("div.layer").length==0){var s=this.getMapModule().getLocalization("plugin"),o=s[this.__name],u=this.templateBaseLayerHeader.clone();u.append(o.chooseDefaultBaseLayer),i.before(u),n.attr("checked","checked")}i.append(t),r._changedBaseLayer()},removeBaseLayer:function(e){var t=this.layerRefs[e.getId()];t.remove();var n=t.find("input");n.remove(),n=this.templateCheckbox.clone(),n.attr("value",e.getId()),this._bindCheckbox(n,e),t.find("span").before(n);var r=this.element.find("div.content div.layers");r.append(t),this._setLayerVisible(e,!0);var i=this.element.find("div.content div.baselayers"),s=i.find("div.layer");if(s.length==0){var o=this.element.find("div.content div.baseLayerHeader");o.remove()}else{var u=s.find("input:checked");u.length==0&&(jQuery(s.find("input").get(0)).attr("checked","checked"),this._changedBaseLayer())}},_changedBaseLayer:function(){var e=this.getBaseLayers();for(var t=0;t<e.baseLayers.length;++t){var n=e.baseLayers[t],r=this._sandbox.findMapLayerFromSelectedMapLayers(n);this._setLayerVisible(r,e.defaultBaseLayer==n)}var i=this._sandbox,s="RearrangeSelectedMapLayerRequest",o=i.getRequestBuilder(s),u=o(e.defaultBaseLayer,0);i.request(this,u)},setupLayers:function(){var e=this;delete this.layerRefs,this.layerRefs={};var t=this._sandbox.findAllSelectedMapLayers();for(var n=0;n<t.length;++n)e.addLayer(t[n])},openSelection:function(){var e=this.element.find("div.header div.header-icon");e.removeClass("icon-arrow-white-right"),e.addClass("icon-arrow-white-down");var t=this.element.find("div.content").show()},closeSelection:function(){var e=this.element.find("div.header div.header-icon");e.removeClass("icon-arrow-white-down"),e.addClass("icon-arrow-white-right");var t=this.element.find("div.content").hide()},getBaseLayers:function(){var e=this.element.find("div.content div.baselayers div.layer input"),t=[],n=null;for(var r=0;r<e.length;++r){var i=jQuery(e[r]);t.push(i.val()),i.is(":checked")&&(n=i.val())}return{baseLayers:t,defaultBaseLayer:n}},_createUI:function(){var e=this;this.element||(this.element=this.template.clone());var t=this.getMapModule().getLocalization("plugin",!0),n=t[this.__name],r=this.element.find("div.header");r.append(n.title),r.bind("click",function(){var t=e.element.find("div.content");t.is(":hidden")?e.openSelection():e.closeSelection()}),this.closeSelection(),this.setupLayers();var i=jQuery("div.mapplugins.left");if(!i||i.length==0){i=jQuery(this._map.div);var s=this.element.find("div.content");s.addClass("mapplugin"),i.append(this.element)}else{var o=i.find("div");!o||o.length==0?i.append(this.element):o.first().before(this.element)}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayerSelectionPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/layers/css/layersselection.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayersPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._visibilityPollingInterval=1500,this._visibilityCheckOrder=0,this._previousTimer=null},{__name:"LayersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(e){this.requestHandlers={layerVisibilityHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",e,this),layerContentHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",e,this)}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);e.addRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler),e.addRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler)},stopPlugin:function(e){e.removeRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler),e.removeRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler);for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{AfterRearrangeSelectedMapLayerEvent:function(e){this._afterRearrangeSelectedMapLayerEvent(e)},MapMoveStartEvent:function(){this._visibilityCheckOrder++,this._previousTimer&&(clearTimeout(this._previousTimer),this._previousTimer=null)},AfterMapMoveEvent:function(){this._scheduleVisiblityCheck()},AfterMapLayerAddEvent:function(e){this._parseGeometryForLayer(e.getMapLayer()),this._scheduleVisiblityCheck()}},_scheduleVisiblityCheck:function(){var e=this;this._previousTimer&&(clearTimeout(this._previousTimer),this._previousTimer=null),this._visibilityCheckOrder++,this._previousTimer=setTimeout(function(){e._checkLayersVisibility(e._visibilityCheckOrder)},this._visibilityPollingInterval)},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){},_parseGeometryForLayer:function(e){if(e.getGeometry&&e.getGeometry().length==0){var t=e.getGeometryWKT();if(!t)return;var n=new OpenLayers.Format.WKT,r=n.read(t);if(r){r.constructor!=Array&&(r=[r]);var i=[];for(var s=0;s<r.length;++s)i.push(r[s].geometry);e.setGeometry(i)}}},_checkLayersVisibility:function(e){if(e!=this._visibilityCheckOrder)return;var t=this._sandbox.findAllSelectedMapLayers();for(var n=0;n<t.length;++n){var r=t[n];if(!r.isVisible())continue;this.notifyLayerVisibilityChanged(r)}this._visibilityCheckScheduled=!1},_isInScale:function(e){var t=this._sandbox.getMap().getScale();return e.isInScale(t)},isInGeometry:function(e){var t=e.getGeometry();if(!t)return!0;if(t.length==0)return!0;var n=this.getMap().getExtent();for(var r=0;r<t.length;++r){var i=t[r].getBounds();if(!i)continue;if(i.intersectsBounds(n))return!0}return!1},notifyLayerVisibilityChanged:function(e){var t=e.isVisible(),n=e.isVisible();e.isVisible()&&(t=this._isInScale(e),n=this.isInGeometry(e));var r=this.getMap(),i=this.getMapModule().getOLMapLayers(e.getId()),s=i.length?i[0]:null;t&&n&&e.isVisible()?s&&!s.getVisibility()&&(s.setVisibility(!0),s.display(!0)):s&&s.getVisibility()&&(s.setVisibility(!1),s.display(!1));var o=this._sandbox.getEventBuilder("MapLayerVisibilityChangedEvent")(e,t,n);this._sandbox.notifyAll(o)},_afterRearrangeSelectedMapLayerEvent:function(e){var t=this._sandbox.findAllSelectedMapLayers(),n=0,r=this._map.layers.length,i=this._map.getLayersByName("Markers");i.length>0&&(this._map.setLayerIndex(i[0],r),r--);for(var s=0,o=t.length;s<o;s++){var u=this.getMapModule().getOLMapLayers(t[s].getId());for(var a=0,f=u.length;a<f;a++)this._map.setLayerIndex(u[a],n),n++}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayersPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._visible=t},{__name:"MapModulePlugin.MapLayerVisibilityRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getVisible:function(){return this._visible}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",function(e,t){this.sandbox=e,this.layersPlugin=t},{handleRequest:function(e,t){var n=t.getMapLayerId(),r=this.sandbox.findMapLayerFromSelectedMapLayers(n);if(!r||r.isVisible()==t.getVisible())return;r.setVisible(t.getVisible());var i=this.layersPlugin.getMap(),s=this.layersPlugin.getMapModule(),o=s.getOLMapLayers(r.getId());for(var u=0;u<o.length;u++)o[u].setVisibility(r.isVisible()),o[u].display(r.isVisible());this.layersPlugin.notifyLayerVisibilityChanged(r)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"MapModulePlugin.MapMoveByLayerContentRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",function(e,t){this.sandbox=e,this.layersPlugin=t},{handleRequest:function(e,t){var n=t.getMapLayerId(),r=this.sandbox.findMapLayerFromSelectedMapLayers(n);if(!r)return;var i=this.layersPlugin.getMapModule().getClosestZoomLevel(r.getMinScale(),r.getMaxScale());this.layersPlugin.getMapModule().setZoomLevel(i,!0);if(r.getGeometry().length>0){var s=this.layersPlugin.isInGeometry(r);if(!s){var o=r.getGeometry()[0].getCentroid();this.layersPlugin.getMapModule().moveMapToLanLot(new OpenLayers.LonLat(o.x,o.y))}}this.layersPlugin.getMapModule().notifyMoveEnd(),this.layersPlugin._checkLayersVisibility(this.layersPlugin._visibilityCheckOrder)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapLayerVisibilityChangedEvent",function(e,t,n){this._mapLayer=e,this._inScale=t==1,this._geomMatch=n!=0},{__name:"MapLayerVisibilityChangedEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},isInScale:function(){return this._inScale},isGeometryMatch:function(){return this._geomMatch}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/MapLayerVisibilityChangedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.mapmodule.WmsLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={}},{__name:"WmsLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("wmslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wmslayer",null)},init:function(e){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{AfterMapLayerAddEvent:function(e){this._afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){this._afterMapLayerRemoveEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this._afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(e){this._afterChangeMapLayerStyleEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t=this._sandbox;for(var n=0;n<e.length;n++){var r=e[n],i=r.getId();if(!r.isLayerOfType("WMS"))continue;t.printDebug("preselecting "+i),this._addMapLayerToMap(r,!0,r.isBaseLayer())}},_afterMapLayerAddEvent:function(e){this._addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap())},_addMapLayerToMap:function(e,t,n){if(!e.isLayerOfType("WMS"))return;var r=this._map.getLayersByName("Markers");if(r)for(var i=0;i<r.length;i++)r[i]&&this._map.removeLayer(r[i],!1);var s=[],o="layer_";(e.isGroupLayer()||e.isBaseLayer()||n==1)&&e.getSubLayers().length>0?(s=e.getSubLayers(),o="basemap_"):s.push(e);for(var u=0,a=s.length;u<a;u++){var f=s[u],l={layers:f.getWmsName(),transparent:!0,id:f.getId(),styles:f.getCurrentStyle().getName(),format:"image/png"},c={layerId:f.getWmsName(),isBaseLayer:!1,displayInLayerSwitcher:!1,visibility:!0,buffer:0},h=f.getParams(),p=f.getOptions();if(f.getMaxScale()||f.getMinScale()){var d=this.getMapModule().calculateLayerResolutions(f.getMaxScale(),f.getMinScale());c.resolutions=d}for(var v in h)l[v]=h[v];for(var v in p)c[v]=p[v];var m=new OpenLayers.Layer.WMS(o+f.getId(),f.getWmsUrls(),l,c);m.opacity=f.getOpacity()/100,this._map.addLayer(m),this._sandbox.printDebug("#!#! CREATED OPENLAYER.LAYER.WMS for "+f.getId()),t?this._map.setLayerIndex(m,this._map.layers.length):this._map.setLayerIndex(m,0)}if(r)for(var i=0;i<r.length;i++)r[i]&&this._map.addLayer(r[i])},_afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this._removeMapLayerFromMap(t)},_removeMapLayerFromMap:function(e){if(!e.isLayerOfType("WMS"))return;if(e.isBaseLayer()||e.isGroupLayer()){var t="";if(e.getSubLayers().length>0)for(var n=0;n<e.getSubLayers().length;n++){var r=e.getSubLayers()[n],i=this._map.getLayersByName("basemap_"+r.getId());i&&i[0]&&i[0].destroy&&i[0].destroy()}else{var i=this._map.getLayersByName("layer_"+e.getId());i[0].destroy()}}else{var i=this._map.getLayersByName("layer_"+e.getId());i[0].destroy()}},getOLMapLayers:function(e){if(!e.isLayerOfType("WMS"))return null;if(e.isBaseLayer()||e.isGroupLayer()){var t="";if(e.getSubLayers().length>0){var n=[];for(var r=0;r<e.getSubLayers().length;r++){var i=this._map.getLayersByName("basemap_"+e.getSubLayers()[r].getId());n.push(i[0])}return n}return this._map.getLayersByName("layer_"+e.getId())}return this._map.getLayersByName("layer_"+e.getId())},_afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(!t.isLayerOfType("WMS"))return;if(t.isBaseLayer()||t.isGroupLayer())if(t.getSubLayers().length>0)for(var n=0;n<t.getSubLayers().length;n++){var r=this._map.getLayersByName("basemap_"+t.getSubLayers()[n].getId());r[0].setOpacity(t.getOpacity()/100)}else{var r=this._map.getLayersByName("layer_"+t.getId());r[0]!=null&&r[0].setOpacity(t.getOpacity()/100)}else{this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var r=this._map.getLayersByName("layer_"+t.getId());r[0]!=null&&r[0].setOpacity(t.getOpacity()/100)}},_afterChangeMapLayerStyleEvent:function(e){if(e.getMapLayer().isLayerOfType("WMS")){var t=e.getMapLayer();if(!t.isBaseLayer()){var n=this._map.getLayersByName("layer_"+t.getId());n!=null&&n[0].mergeNewParams({styles:t.getCurrentStyle().getName()})}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/wmslayer/WmsLayerPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.mapmodule.VectorLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._sldFormat=new OpenLayers.Format.SLD({multipleSymbolizers:!1,namedLayersAsArray:!0})},{__name:"VectorLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("vectorlayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("vectorlayer",null)},init:function(e){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this.registerVectorFormats(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{AfterMapLayerAddEvent:function(e){this.afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},FeaturesAvailableEvent:function(e){this.handleFeaturesAvailableEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this._afterChangeMapLayerOpacityEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t=this._sandbox;for(var n=0;n<e.length;n++){var r=e[n],i=r.getId();if(!r.isLayerOfType("VECTOR"))continue;t.printDebug("preselecting "+i),this.addMapLayerToMap(r,!0,r.isBaseLayer())}},afterMapLayerAddEvent:function(e){this.addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap())},registerVectorFormat:function(e,t){this._supportedFormats[e]=t},registerVectorFormats:function(){this.registerVectorFormat("application/json",new OpenLayers.Format.GeoJSON({})),this.registerVectorFormat("application/nlsfi-x-openlayers-feature",new function(){this.read=function(e){return e}})},addMapLayerToMap:function(e,t,n){if(!e.isLayerOfType("VECTOR"))return;var r=this._map.getLayersByName("Markers");this._map.removeLayer(r[0],!1);var i=new OpenLayers.StyleMap,s={styleMap:i},o=e.getStyledLayerDescriptor();if(o){this._sandbox.printDebug(o);var u=this._sldFormat.read(o);window.styleInfo=u;var a=u.namedLayers[0].userStyles,f=a[0];i.styles["default"]=f}var l=new OpenLayers.Layer.Vector("layer_"+e.getId(),s);l.opacity=e.getOpacity()/100,this._map.addLayer(l),this._sandbox.printDebug("#!#! CREATED VECTOR / OPENLAYER.LAYER.VECTOR for "+e.getId()),t?this._map.setLayerIndex(l,this._map.layers.length):this._map.setLayerIndex(l,0),this._map.addLayer(r[0])},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},_afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(!t.isLayerOfType("VECTOR"))return;this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var n=this._map.getLayersByName("layer_"+t.getId());n[0]!=null&&n[0].setOpacity(t.getOpacity()/100)},removeMapLayerFromMap:function(e){if(!e.isLayerOfType("VECTOR"))return;var t=this._map.getLayersByName("layer_"+e.getId());t[0].destroy()},getOLMapLayers:function(e){if(!e.isLayerOfType("VECTOR"))return;return this._map.getLayersByName("layer_"+e.getId())},handleFeaturesAvailableEvent:function(e){var t=e.getMapLayer(),n=e.getMimeType(),r=e.getFeatures(),i=e.getOp(),s=this._map.getLayersByName("layer_"+t.getId())[0];if(!s)return;i&&i=="replace"&&s.removeFeatures(s.features);var o=this._supportedFormats[n];if(!o)return;var u=o.read(r);s.addFeatures(u)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/vectorlayer/VectorLayerPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.GeoLocationPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._locationIsSet=!1},{__name:"GeoLocationPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!1},init:function(e){},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this),this._setupLocation()},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},hasSetLocation:function(){return this._locationIsSet},_setupLocation:function(){var e=this,t=function(t,n){var r=e.getMapModule().transformCoordinates(new OpenLayers.LonLat(t,n),"EPSG:4326");e.getMapModule().centerMap(r,6),e._locationIsSet=!0};if(navigator.geolocation)navigator.geolocation.getCurrentPosition(function(e){var n=e.coords.latitude,r=e.coords.longitude;t(r,n)},function(e){},{maximumAge:36e5,timeout:6e3});else if(typeof window.geoip_latitude=="function"&&typeof window.geoip_longitude=="function"){var n=geoip_latitude(),r=geoip_longitude();t(r,n)}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/location/GeoLocationPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.ToolSelectionRequest",function(e){this._toolId=e},{tools:{navigate:"map_control_navigate_tool",zoom:"map_control_zoom_tool",previous:"map_control_tool_prev",next:"map_control_tool_prev",measure:"map_control_measure_tool",measure_area:"map_control_measure_area_tool",select:"map_control_select_tool",draw_area:"map_control_draw_area_tool"},__name:"ToolSelectionRequest",getName:function(){return this.__name},getToolId:function(){return this._toolId},setToolId:function(e){this._toolId=e},getNamespace:function(){return this._toolId.indexOf(".")==-1?"":this._toolId.substring(0,this._toolId.lastIndexOf("."))},getToolName:function(){return this._toolId.indexOf(".")==-1?this._toolId:this._toolId.substring(this._toolId.lastIndexOf("."))}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/ToolSelectionRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.mapmodule.ToolSelectionHandler",function(e,t){this.sandbox=e,this.controlsPlugin=t},{handleRequest:function(e,t){var n=t.getToolId(),r=t.getNamespace(),i=t.getToolName();if(i=="map_control_tool_prev"){var s=this.sandbox.findRegisteredModuleInstance("StateHandler");s&&s.historyMovePrevious()}else if(i=="map_control_tool_next"){var s=this.sandbox.findRegisteredModuleInstance("StateHandler");s&&s.historyMoveNext()}else if(i=="map_control_select_tool"){var o=this.sandbox.findRegisteredModuleInstance("SketchLayerPlugin");o&&o.clearBbox()}else i=="map_control_zoom_tool"&&this.controlsPlugin._zoomBoxTool?this.controlsPlugin._zoomBoxTool.activate():i=="map_control_measure_tool"&&this.controlsPlugin._measureControls?this.controlsPlugin._measureControls.line.activate():i=="map_control_measure_area_tool"&&this.controlsPlugin._measureControls&&this.controlsPlugin._measureControls.area.activate()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/controls/ToolSelectionHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequest",function(e,t,n){this._layerId=e,this._forced=t==1,this._parameters=n},{__name:"MapModulePlugin.MapLayerUpdateRequest",getName:function(){return this.__name},getLayerId:function(){return this._layerId},isForced:function(){return this._forced},getParameters:function(){return this._parameters},setParameters:function(e){this._parameters=e}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequestHandler",function(e,t){this.sandbox=e,this.mapModule=t},{handleRequest:function(e,t){var n=t.getLayerId(),r=t.isForced(),i=t.getParameters(),s=this.sandbox,o=s.findMapLayerFromSelectedMapLayers(n);if(!o)return;if(i&&o.isLayerOfType("WMS")){var u=this.mapModule.getOLMapLayers(n),a=0;if(u){a=u.length;for(var f=0;f<u.length;++f)u[f].mergeNewParams(i)}this.sandbox.printDebug("[MapLayerUpdateRequestHandler] WMS layer / merge new params: "+n+", found "+a)}else{var u=this.mapModule.getOLMapLayers(n),a=0;if(u){a=u.length;for(var f=0;f<u.length;++f)u[f].redraw(r)}this.sandbox.printDebug("[MapLayerUpdateRequestHandler] Layer / update layer "+n+", found "+a)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveRequestHandler",function(e,t){this.sandbox=e,this.mapModule=t},{handleRequest:function(e,t){var n=t.getCenterX(),r=t.getCenterY(),i=t.getMarker(),s=t.getZoom(),o=t.getSrsName(),u=new OpenLayers.LonLat(n,r);if(o&&this.mapModule.getProjection()!==o){var a=Proj4js.defs[o];if(!a)throw"SrsName not supported!";u=this.mapModule.transformCoordinates(u,o)}this.mapModule.moveMapToLanLot(u,s,!1);if(s||s===0)s.CLASS_NAME==="OpenLayers.Bounds"?this.mapModule._map.zoomToExtent(s):this.mapModule._map.zoomTo(s);this.mapModule._updateDomain(),i&&this.mapModule._drawMarker(),this.mapModule.notifyMoveEnd(),this.sandbox.printDebug("[MapMoveRequestHandler] map moved")}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapMoveRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapClickedEvent",function(e,t,n){this._lonlat=e,this._mouseX=t,this._mouseY=n},{__name:"MapClickedEvent",getName:function(){return this.__name},getLonLat:function(){return this._lonlat},getMouseX:function(){return this._mouseX},getMouseY:function(){return this._mouseY}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/MapClickedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.EscPressedEvent",function(){},{__name:"EscPressedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/EscPressedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.GetInfoResultEvent",function(e,t){this._data=e},{__name:"GetInfoResultEvent",getName:function(){return this.__name},getData:function(){return this._data}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/GetInfoResultEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapSizeChangedEvent",function(e,t){this._width=e,this._height=t},{__name:"MapSizeChangedEvent",getName:function(){return this.__name},getWidth:function(){return this._width},getHeight:function(){return this._height}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/MapSizeChangedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.ClearHistoryRequest",function(){},{__name:"ClearHistoryRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/ClearHistoryRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.controls.ClearHistoryHandler",function(e,t){this.mapModule=t,this.sandbox=e},{handleRequest:function(e,t){this.mapModule.clearNavigationHistory()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/controls/ClearHistoryHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.__templates={},this.__elements={},this.__parent=null,this._slider=null,this._zoombar_messages={},this._suppressEvents=!1,this._conf=e},{__name:"Portti2Zoombar",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},hasUI:function(){return!0},setMapModule:function(e){this.mapModule=e,e&&(this._map=e.getMap(),this.pluginName=e.getName()+this.__name)},init:function(){var e=this;this.__templates.zoombar=jQuery('<div class="oskariui mapplugin pzbDiv"><div class="pzbDiv-plus"  title="Katu"></div><input type=\'hidden\' /><div class="slider"></div><div class="pzbDiv-minus"  title="Koko Maa"></div></div>')},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this._draw(),this._setZoombarValue(this._map.getZoom())},stopPlugin:function(e){this.__elements.zoombarSlider&&(this.__elements.zoombarSlider.remove(),this._slider.remove(),delete this.__elements.zoombarSlider),e.unregister(this),this._sandbox=null},_draw:function(){var e=this;e.__parent||(e.__parent=this._map.div),e.__elements.zoombarSlider||(e.__elements.zoombarSlider=e.__templates.zoombar.clone());var t="pzb-input-"+this.getName(),n="pzb-slider-"+this.getName(),r=e.__elements.zoombarSlider.find("div.slider");e.__elements.zoombarSlider.find("input").attr("id",t),r.attr("id",n),e.__elements.zoombarSlider.mousedown(function(e){e.stopPropagation()}),jQuery(e.__parent).append(e.__elements.zoombarSlider);var r=e.__elements.zoombarSlider.find("div.slider");r.css("height",this._map.getNumZoomLevels()*11+"px"),e._slider=r.slider({orientation:"vertical",range:"min",min:0,max:this._map.getNumZoomLevels()-1,value:this._map.getZoom(),slide:function(t,n){e.getMapModule().zoomTo(n.value)}});var i=e.__elements.zoombarSlider.find(".pzbDiv-plus");i.bind("click",function(t){e._slider.slider("value")<e._map.getNumZoomLevels()&&e.getMapModule().zoomTo(e._slider.slider("value")+1)});var s=e.__elements.zoombarSlider.find(".pzbDiv-minus");s.bind("click",function(t){e._slider.slider("value")>0&&e.getMapModule().zoomTo(e._slider.slider("value")-1)}),this._conf&&this._conf.location&&e.setZoombarLocation(this._conf.location,e.__elements.zoombarSlider)},_setZoombarValue:function(e){var t=this;t._slider&&(this._suppressEvents=!0,t._slider.slider("value",e),this._suppressEvents=!1)},setZoombarLocation:function(e,t){t||(t=this.__elements.zoombarSlider),e.top&&(t.css("bottom","auto"),t.css("top",e.top)),e.left&&(t.css("right","auto"),t.css("left",e.left)),e.right&&(t.css("left","auto"),t.css("right",e.right)),e.bottom&&(t.css("top","auto"),t.css("bottom",e.bottom))},eventHandlers:{AfterMapMoveEvent:function(e){if(this._sandbox){var t=this;t._setZoombarValue(e.getZoom())}}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},start:function(e){},stop:function(e){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/zoombar/Portti2Zoombar",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/css/porttizoombar.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.PanButtons",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.__templates={},this.__elements={},this.__parent=null,this.__conf=e,this.__prestart=null},{__name:"PanButtons",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},hasUI:function(){return!0},setMapModule:function(e){this.mapModule=e,e&&(this._map=e.getMap(),this.pluginName=e.getName()+this.__name)},init:function(){var e=this,t=(new Date).getTime()+"";this.__templates.pan=jQuery('<div class="mapplugin panbuttonDiv"><div>  <img class="panbuttonDivImg" usemap="#panbuttons_'+t+'">'+'    <map name="panbuttons_'+t+'">'+'      <area shape="circle" '+'class="panbuttons_center" '+'coords="45,45,20" href="#">'+'      <area shape="polygon" '+'class="panbuttons_left" '+'coords="13,20,25,30,20,45,27,65,13,70,5,45" '+'href="#">'+'      <area shape="polygon" '+'class="panbuttons_up" '+'coords="30,8,45,4,60,8,60,23,45,20,30,23" '+'href="#">'+'      <area shape="polygon" '+'class="panbuttons_right" '+'coords="79,20,67,30,72,45,65,65,79,70,87,45" '+'href="#">'+'      <area shape="polygon" '+'class="panbuttons_down" '+'coords="30,82,45,86,60,82,60,68,45,70,30,68" '+'href="#">'+"    </map>"+"  </img>"+"</div>"+"</div>")},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);var t=null;this._map.div&&(t=jQuery(this._map.div).find(".pzbDiv"));if(this.__conf&&this.__conf.location&&this.__conf.location.top&&t){var n=this,r=n.__conf.location.top;r=="auto"?r=10:r.indexOf("px")>=0&&(r=r.substring(0,r.indexOf("px")));var i=jQuery(n._map.div).height(),s="auto",o=90,u=10,a=185,f=t.css("top"),l=t.css("bottom");f||(f="auto"),l||(l="auto"),n.__prestart==null&&(n.__prestart={zbtop:f,zbbtm:l}),r=10,s="auto",f=110,l="auto",f!=="auto"&&(f+="px"),l!=="auto"&&(l+="px"),t.css("top",f),t.css("bottom",l),r!=="auto"&&(r+="px"),s!=="auto"&&(s+="px"),n.__conf.location.top=r,n.__conf.location.bottom=s,window.setTimeout(function(){var e=n.__elements.panbuttons;e&&(e.css("top",r),e.css("bottom","auto"))},50)}this._draw()},stopPlugin:function(e){this.__elements.panbuttons&&(this.__elements.panbuttons.remove(),delete this.__elements.panbuttons),this._map.div&&this.__prestart&&(zb=jQuery(this._map.div).find(".pzbDiv"),zb&&(zb.css("top",this.__prestart.zbtop),zb.css("bottom",this.__prestart.zbbtm))),e.unregister(this)},_draw:function(){var e=this;e.__parent||(e.__parent=this._map.div),e.__elements.panbuttons||(e.__elements.panbuttons=e.__templates.pan.clone());var t=e.__elements.panbuttons;jQuery(e.__parent).append(t),e.__conf&&e.__conf.location&&(e.__conf.location.top&&(t.css("bottom","auto"),t.css("top",e.__conf.location.top)),e.__conf.location.left&&(t.css("right","auto"),t.css("left",e.__conf.location.left)),e.__conf.location.right&&(t.css("left","auto"),t.css("right",e.__conf.location.right)),e.__conf.location.bottom&&(t.css("top","auto"),t.css("bottom",e.__conf.location.bottom)));var n=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/",r=t.find(".panbuttonDivImg");r.attr("src",n+"empty.png");var i=t.find(".panbuttons_center");i.bind("mouseover",function(e){r.addClass("root")}),i.bind("mouseout",function(e){r.removeClass("root")}),i.bind("click",function(t){var n="StateHandler.SetStateRequest",r=e.getMapModule(),i=r.getSandbox(),s=i.getRequestBuilder(n);s?i.request(e,s()):i.resetState()});var s=t.find(".panbuttons_left");s.bind("mouseover",function(e){r.addClass("left")}),s.bind("mouseout",function(e){r.removeClass("left")}),s.bind("click",function(t){e.getMapModule().panMapByPixels(-100,0,!0)});var o=t.find(".panbuttons_right");o.bind("mouseover",function(e){r.addClass("right")}),o.bind("mouseout",function(e){r.removeClass("right")}),o.bind("click",function(t){e.getMapModule().panMapByPixels(100,0,!0)});var u=t.find(".panbuttons_up");u.bind("mouseover",function(e){r.addClass("up")}),u.bind("mouseout",function(e){r.removeClass("up")}),u.bind("click",function(t){e.getMapModule().panMapByPixels(0,-100,!0)});var a=t.find(".panbuttons_down");a.bind("mouseover",function(e){r.addClass("down")}),a.bind("mouseout",function(e){r.removeClass("down")}),a.bind("click",function(t){e.getMapModule().panMapByPixels(0,100,!0)}),t.mousedown(function(e){var t=Math.round(.5*r[0].width),n=r.offset(),i=n.left+t,s=n.top+t;Math.sqrt(Math.pow(i-e.pageX,2)+Math.pow(s-e.pageY,2))<t&&e.stopPropagation()})},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},start:function(e){},stop:function(e){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/panbuttons/PanButtons",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/css/panbuttons.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/css/mapmodule.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"MapModule",value:{status_update_map:"Päivitetään karttaa",zoombar_tooltip:{"zoomLvl-0":"Taustakartta","zoomLvl-1":"Koko maa","zoomLvl-2":"Maakunta","zoomLvl-3":"","zoomLvl-4":"Kunta","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Kunnan osa","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Katu","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Käyttöehdot",termsLink:"http://www.paikkatietoikkuna.fi/web/fi/kayttoehdot",mapLinkBase:"http://www.paikkatietoikkuna.fi/web/fi/kartta?"},DataSourcePlugin:{link:"Aineistolähde",popup:{title:"Tietolähteet",content:" "},button:{close:"Sulje"}},LayerSelectionPlugin:{title:"Karttatasot",chooseDefaultBaseLayer:"Valitse karttapohja"},SearchPlugin:{placeholder:"Hae paikkoja/osoitteita",search:"Hae",close:"Sulje hakutulokset",noresults:"Haulla ei löytynyt tuloksia",toomanyresults:"Löytyi yli 100 tulosta, tarkenna hakua.",column_name:"Nimi",column_village:"Kunta",column_type:"Tyyppi"},GetInfoPlugin:{title:"Kohdetiedot",layer:"Taso",places:"Kohteet",description:"Kuvaus",link:"URL-osoite",name:"Nimi"}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"MapModule",value:{status_update_map:"Uppdaterar kartan",zoombar_tooltip:{"zoomLvl-0":"Bakgrundskarta","zoomLvl-1":"Hela landet","zoomLvl-2":"Landskap","zoomLvl-3":"","zoomLvl-4":"Kommun","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Stadsdel","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Gata","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Användningsvillkor",termsLink:"http://www.paikkatietoikkuna.fi/web/sv/anvandningsvillkor",mapLinkBase:"http://www.paikkatietoikkuna.fi/web/sv/kartfonstret?"},DataSourcePlugin:{link:"Datakälla",popup:{title:"Datakällor",content:" "},button:{close:"Stäng"}},LayerSelectionPlugin:{title:"Kartlager",chooseDefaultBaseLayer:"Välj bottenkarta"},SearchPlugin:{placeholder:"Sök plats/adress",search:"Sök",close:"Stäng sökresultat",noresults:"Inga träffar",toomanyresults:"Över 100 träffar, avgränsa sökningen.",column_name:"Namn",column_village:"Kommun",column_type:"Typ"},GetInfoPlugin:{title:"Objektuppgifter",layer:"Lagret",places:"Object",description:"Beskrivning",link:"URL-address",name:"Namn"}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"MapModule",value:{status_update_map:"Updating map",zoombar_tooltip:{"zoomLvl-0":"Background map","zoomLvl-1":"Country","zoomLvl-2":"Province","zoomLvl-3":"","zoomLvl-4":"Town","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Part of town","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Street","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Terms of Use",termsLink:"http://www.paikkatietoikkuna.fi/web/en/terms-and-conditions",mapLinkBase:"http://www.paikkatietoikkuna.fi/web/en/map-window?"},DataSourcePlugin:{link:"Data Source",popup:{title:"Data Sources",content:" "},button:{close:"Close"}},LayerSelectionPlugin:{title:"Object data",chooseDefaultBaseLayer:"Select background map layer"},SearchPlugin:{placeholder:"Find places",search:"Find",close:"Close search results",noresults:"No results found",toomanyresults:"Over 100 results found. Please refine your search.",column_name:"Name",column_village:"Municipality",column_type:"Type"},GetInfoPlugin:{title:"Map layers",layer:"Layer",places:"Places",description:"Description",link:"URL-address",name:"Name"}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/en",function(){}),define("bundles/framework/bundle/mapmodule-plugin/module",["oskari","jquery","bundles/oskari/base/module","bundles/framework/bundle/oskariui/module","bundles/framework/bundle/mapwfs/module","bundles/framework/bundle/mapstats/module","bundles/framework/bundle/mapwmts/module","css!resources/openlayers/theme/default/style.css","./ui/module/map-module","./plugin/Plugin","./plugin/controls/ControlsPlugin","./plugin/controls/PorttiKeyboard","./plugin/controls/PorttiMouse","./request/DisableMapKeyboardMovementRequest","./request/DisableMapMouseMovementRequest","./request/EnableMapKeyboardMovementRequest","./request/EnableMapMouseMovementRequest","./request/MapMovementControlsRequestHandler","./plugin/getinfo/GetFeatureInfoHandler","./request/GetFeatureInfoRequest","./request/GetFeatureInfoActivationRequest","./plugin/getinfo/GetInfoPlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/getinfo/css/getinfo.css","./plugin/markers/MarkersPlugin","./request/RemoveMarkerRequest","./request/MarkerRequestHandler","./plugin/search/SearchPlugin","bundles/framework/bundle/search/service/searchservice","css!resources/framework/bundle/mapmodule-plugin/plugin/search/css/search.css","./plugin/logo/LogoPlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/logo/css/logoplugin.css","./plugin/datasource/DataSourcePlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/datasource/css/datasource.css","./plugin/indexmap/IndexMapPlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/indexmap/css/indexmap.css","./plugin/scalebar/ScaleBarPlugin","./plugin/fullscreen/FullScreen","css!resources/framework/bundle/mapmodule-plugin/plugin/fullscreen/css/fullscreen.css","./plugin/layers/LayerSelectionPlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/layers/css/layersselection.css","./plugin/layers/LayersPlugin","./request/MapLayerVisibilityRequest","./request/MapLayerVisibilityRequestHandler","./request/MapMoveByLayerContentRequest","./request/MapMoveByLayerContentRequestHandler","./event/MapLayerVisibilityChangedEvent","./plugin/wmslayer/WmsLayerPlugin","./plugin/vectorlayer/VectorLayerPlugin","./plugin/location/GeoLocationPlugin","./request/ToolSelectionRequest","./plugin/controls/ToolSelectionHandler","./request/MapLayerUpdateRequest","./request/MapLayerUpdateRequestHandler","./request/MapMoveRequestHandler","./event/MapClickedEvent","./event/EscPressedEvent","./event/GetInfoResultEvent","./event/MapSizeChangedEvent","./request/ClearHistoryRequest","./plugin/controls/ClearHistoryHandler","./plugin/zoombar/Portti2Zoombar","css!resources/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/css/porttizoombar.css","./plugin/panbuttons/PanButtons","css!resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/css/panbuttons.css","css!resources/framework/bundle/mapmodule-plugin/css/mapmodule.css","./locale/fi","./locale/sv","./locale/en"],function(e,t){return e.bundleCls("mapmodule-plugin").category({create:function(){return this},update:function(e,t,n,r){e.alert("RECEIVED update notification "+r)}})}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.setBuffer('/*! jQuery UI - v1.9.1 - 2012-11-09\r\n* http://jqueryui.com\r\n* Includes: jquery.ui.core.css, jquery.ui.resizable.css, jquery.ui.selectable.css, jquery.ui.slider.css, jquery.ui.tooltip.css\r\n* To view and modify this theme, visit http://jqueryui.com/themeroller/?ffDefault=Segoe%20UI%2CArial%2Csans-serif&fwDefault=bold&fsDefault=1.1em&cornerRadius=6px&bgColorHeader=333333&bgTextureHeader=12_gloss_wave.png&bgImgOpacityHeader=25&borderColorHeader=333333&fcHeader=ffffff&iconColorHeader=ffffff&bgColorContent=000000&bgTextureContent=05_inset_soft.png&bgImgOpacityContent=25&borderColorContent=666666&fcContent=ffffff&iconColorContent=cccccc&bgColorDefault=555555&bgTextureDefault=02_glass.png&bgImgOpacityDefault=20&borderColorDefault=666666&fcDefault=eeeeee&iconColorDefault=cccccc&bgColorHover=0078a3&bgTextureHover=02_glass.png&bgImgOpacityHover=40&borderColorHover=59b4d4&fcHover=ffffff&iconColorHover=ffffff&bgColorActive=f58400&bgTextureActive=05_inset_soft.png&bgImgOpacityActive=30&borderColorActive=ffaf0f&fcActive=ffffff&iconColorActive=222222&bgColorHighlight=eeeeee&bgTextureHighlight=03_highlight_soft.png&bgImgOpacityHighlight=80&borderColorHighlight=cccccc&fcHighlight=2e7db2&iconColorHighlight=4b8e0b&bgColorError=ffc73d&bgTextureError=02_glass.png&bgImgOpacityError=40&borderColorError=ffb73d&fcError=111111&iconColorError=a83300&bgColorOverlay=5c5c5c&bgTextureOverlay=01_flat.png&bgImgOpacityOverlay=50&opacityOverlay=80&bgColorShadow=cccccc&bgTextureShadow=01_flat.png&bgImgOpacityShadow=30&opacityShadow=60&thicknessShadow=7px&offsetTopShadow=-7px&offsetLeftShadow=-7px&cornerRadiusShadow=8px\r\n* Copyright (c) 2012 jQuery Foundation and other contributors Licensed MIT */\r\n\r\n/* Layout helpers\r\n----------------------------------*/\r\n.oskariui .ui-helper-hidden { display: none; }\r\n.oskariui .ui-helper-hidden-accessible { position: absolute !important; clip: rect(1px,1px,1px,1px); clip: rect(1px,1px,1px,1px); }\r\n.oskariui .ui-helper-reset { margin: 0; padding: 0; border: 0; outline: 0; line-height: 1.3; text-decoration: none; font-size: 100%; list-style: none; }\r\n.oskariui .ui-helper-clearfix:before, .ui-helper-clearfix:after { content: ""; display: table; }\r\n.oskariui .ui-helper-clearfix:after { clear: both; }\r\n.oskariui .ui-helper-clearfix { zoom: 1; }\r\n.oskariui .ui-helper-zfix { width: 100%; height: 100%; top: 0; left: 0; position: absolute; opacity: 0; filter:Alpha(Opacity=0); }\r\n\r\n\r\n/* Interaction Cues\r\n----------------------------------*/\r\n.oskariui .ui-state-disabled { cursor: default !important; }\r\n\r\n\r\n/* Icons\r\n----------------------------------*/\r\n\r\n/* states and images */\r\n.oskariui .ui-icon { display: block; text-indent: -99999px; overflow: hidden; background-repeat: no-repeat; }\r\n\r\n\r\n/* Misc visuals\r\n----------------------------------*/\r\n\r\n/* Overlays */\r\n.oskariui .ui-widget-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }\r\n.oskariui .ui-resizable { position: relative;}\r\n.oskariui .ui-resizable-handle { position: absolute;font-size: 0.1px; display: block; }\r\n.oskariui .ui-resizable-disabled .ui-resizable-handle, .ui-resizable-autohide .ui-resizable-handle { display: none; }\r\n.oskariui .ui-resizable-n { cursor: n-resize; height: 7px; width: 100%; top: -5px; left: 0; }\r\n.oskariui .ui-resizable-s { cursor: s-resize; height: 7px; width: 100%; bottom: -5px; left: 0; }\r\n.oskariui .ui-resizable-e { cursor: e-resize; width: 7px; right: -5px; top: 0; height: 100%; }\r\n.oskariui .ui-resizable-w { cursor: w-resize; width: 7px; left: -5px; top: 0; height: 100%; }\r\n.oskariui .ui-resizable-se { cursor: se-resize; width: 12px; height: 12px; right: 1px; bottom: 1px; }\r\n.oskariui .ui-resizable-sw { cursor: sw-resize; width: 9px; height: 9px; left: -5px; bottom: -5px; }\r\n.oskariui .ui-resizable-nw { cursor: nw-resize; width: 9px; height: 9px; left: -5px; top: -5px; }\r\n.oskariui .ui-resizable-ne { cursor: ne-resize; width: 9px; height: 9px; right: -5px; top: -5px;}.ui-selectable-helper { position: absolute; border:1px dotted black; }\r\n\r\n.oskariui .ui-slider { position: relative; text-align: left; }\r\n.oskariui .ui-slider .ui-slider-handle { position: absolute; width: 16px; height: 17px; cursor: default; }\r\n.oskariui .ui-slider .ui-slider-range { position: absolute; font-size: .7em; display: block; border: 0; background-position: 0 0; }\r\n\r\n.oskariui .ui-slider-horizontal { height: 14px; }\r\n.oskariui .ui-slider-horizontal .ui-slider-handle { background-image: url(\'/Oskari/resources/framework/bundle/oskariui/images/horizontal_handle.png\'); background-repeat: no-repeat;}\r\n\r\n.oskariui .ui-slider-horizontal .ui-slider-range { top: 0; height: 100%; }\r\n.oskariui .ui-slider-horizontal .ui-slider-range-min { left: 0; }\r\n.oskariui .ui-slider-horizontal .ui-slider-range-max { right: 0; }\r\n\r\n.oskariui .ui-slider-vertical { margin-left: 2px; width: 24px; background-image: url(\'/Oskari/resources/framework/bundle/oskariui/images/zoombar_part.png\'); background-repeat: repeat-y; }\r\n.oskariui .ui-slider-vertical .ui-slider-handle { margin-left: 0; background-image: url(\'/Oskari/resources/framework/bundle/oskariui/images/zoombar_cursor.png\'); background-repeat: no-repeat;}\r\n.oskariui .ui-slider-vertical .ui-slider-range { left: 0; width: 100%; }\r\n.oskariui .ui-slider-vertical .ui-slider-range-min { bottom: 0; }\r\n.oskariui .ui-slider-vertical .ui-slider-range-max { top: 0; }.ui-tooltip {\r\n	padding: 8px;\r\n	position: absolute;\r\n	z-index: 9999;\r\n	max-width: 300px;\r\n	-webkit-box-shadow: 0 0 5px #aaa;\r\n	box-shadow: 0 0 5px #aaa;\r\n}\r\n/* Fades and background-images don\'t work well together in IE6, drop the image */\r\n* html .ui-tooltip {\r\n	background-image: none;\r\n}\r\nbody .oskariui .ui-tooltip { border-width: 2px; }\r\n\r\n/* Component containers\r\n----------------------------------*/\r\n.oskariui .ui-widget { font-family: Segoe UI,Arial,sans-serif; font-size: 1.1em; }\r\n.oskariui .ui-widget .ui-widget { font-size: 1em; }\r\n.oskariui .ui-widget input, .oskariui .ui-widget select, .oskariui .ui-widget textarea, .oskariui .ui-widget button { font-family: Segoe UI,Arial,sans-serif; font-size: 1em; }\r\n.oskariui .ui-widget-content {  }\r\n.oskariui .ui-widget-content a {  }\r\n.oskariui .ui-widget-header {  }\r\n.oskariui .ui-widget-header a {  }\r\n\r\n/* Interaction states\r\n----------------------------------*/\r\n.oskariui .ui-state-default, .oskariui .ui-widget-content .ui-state-default, .oskariui .ui-widget-header .ui-state-default {  }\r\n.oskariui .ui-state-default a, .oskariui .ui-state-default a:link, .oskariui .ui-state-default a:visited {  }\r\n.oskariui .ui-state-hover, .oskariui .ui-widget-content .ui-state-hover, .oskariui .ui-widget-header .ui-state-hover, .oskariui .ui-state-focus, .oskariui .ui-widget-content .ui-state-focus, .oskariui .ui-widget-header .ui-state-focus {  }\r\n.oskariui .ui-state-hover a, .oskariui .ui-state-hover a:hover, .oskariui .ui-state-hover a:link, .oskariui .ui-state-hover a:visited { }\r\n.oskariui .ui-state-active, .oskariui .ui-widget-content .ui-state-active, .oskariui .ui-widget-header .ui-state-active {  }\r\n.oskariui .ui-state-active a, .oskariui .ui-state-active a:link, .oskariui .ui-state-active a:visited {  }\r\n\r\n/* Interaction Cues\r\n----------------------------------*/\r\n.oskariui .ui-state-highlight, .oskariui .ui-widget-content .ui-state-highlight, .oskariui .ui-widget-header .ui-state-highlight  { }\r\n.oskariui .ui-state-highlight a, .oskariui .ui-widget-content .ui-state-highlight a,.oskariui .ui-widget-header .ui-state-highlight a { }\r\n.oskariui .ui-state-error, .oskariui .ui-widget-content .ui-state-error, .oskariui .ui-widget-header .ui-state-error { }\r\n.oskariui .ui-state-error a, .oskariui .ui-widget-content .ui-state-error a, .oskariui .ui-widget-header .ui-state-error a { }\r\n.oskariui .ui-state-error-text, .oskariui .ui-widget-content .ui-state-error-text, .oskariui .ui-widget-header .ui-state-error-text {  }\r\n.oskariui .ui-priority-primary, .oskariui .ui-widget-content .ui-priority-primary, .oskariui .ui-widget-header .ui-priority-primary {  }\r\n.oskariui .ui-priority-secondary, .oskariui .ui-widget-content .ui-priority-secondary,  .oskariui .ui-widget-header .ui-priority-secondary { }\r\n.oskariui .ui-state-disabled, .oskariui .ui-widget-content .ui-state-disabled, .oskariui .ui-widget-header .ui-state-disabled {  }\r\n.oskariui .ui-state-disabled .ui-icon { filter:Alpha(Opacity=35); } /* For IE8 - See #6059 */\r\n\r\n/* Icons\r\n----------------------------------*/\r\n\r\n/* states and images */\r\n.oskariui .ui-icon { width: 16px; height: 16px; }\r\n.oskariui .ui-widget-content .ui-icon { }\r\n.oskariui .ui-widget-header .ui-icon { }\r\n.oskariui .ui-state-default .ui-icon {  }\r\n.oskariui .ui-state-hover .ui-icon, .oskariui .ui-state-focus .ui-icon {}\r\n.oskariui .ui-state-active .ui-icon { }\r\n.oskariui .ui-state-highlight .ui-icon { }\r\n.oskariui .ui-state-error .ui-icon, .oskariui .ui-state-error-text .ui-icon { }\r\n\r\n\r\n/* Misc visuals\r\n----------------------------------*/\r\n\r\n/* Corner radius */\r\n.oskariui .ui-corner-all, .oskariui .ui-corner-top, .oskariui .ui-corner-left, .oskariui .ui-corner-tl { -moz-border-radius-topleft: 6px; -webkit-border-top-left-radius: 6px; -khtml-border-top-left-radius: 6px; border-top-left-radius: 6px; }\r\n.oskariui .ui-corner-all, .oskariui .ui-corner-top, .oskariui .ui-corner-right, .oskariui .ui-corner-tr { -moz-border-radius-topright: 6px; -webkit-border-top-right-radius: 6px; -khtml-border-top-right-radius: 6px; border-top-right-radius: 6px; }\r\n.oskariui .ui-corner-all, .oskariui .ui-corner-bottom, .oskariui .ui-corner-left, .oskariui .ui-corner-bl { -moz-border-radius-bottomleft: 6px; -webkit-border-bottom-left-radius: 6px; -khtml-border-bottom-left-radius: 6px; border-bottom-left-radius: 6px; }\r\n.oskariui .ui-corner-all, .oskariui .ui-corner-bottom, .oskariui .ui-corner-right, .oskariui .ui-corner-br { -moz-border-radius-bottomright: 6px; -webkit-border-bottom-right-radius: 6px; -khtml-border-bottom-right-radius: 6px; border-bottom-right-radius: 6px; }\r\n\r\n/* Overlays */\r\n.oskariui .ui-widget-overlay { background: #5c5c5c url(resources/framework/bundle/oskariui/css/images/ui-bg_flat_50_5c5c5c_40x100.png) 50% 50% repeat-x; opacity: .8;filter:Alpha(Opacity=80); }\r\n.oskariui .ui-widget-shadow { margin: -7px 0 0 -7px; padding: 7px; background: #cccccc url(resources/framework/bundle/oskariui/css/images/ui-bg_flat_30_cccccc_40x100.png) 50% 50% repeat-x; opacity: .6;filter:Alpha(Opacity=60); -moz-border-radius: 8px; -khtml-border-radius: 8px; -webkit-border-radius: 8px; border-radius: 8px; }\r\n/*!\r\n * Bootstrap v2.3.1\r\n *\r\n * Copyright 2012 Twitter, Inc\r\n * Licensed under the Apache License v2.0\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Designed and built with all the love in the world @twitter by @mdo and @fat.\r\n */\r\n.oskariui .clearfix {\r\n  *zoom: 1;\r\n}\r\n.oskariui .clearfix:before,\r\n.oskariui .clearfix:after {\r\n  display: table;\r\n  content: "";\r\n  line-height: 0;\r\n}\r\n.oskariui .clearfix:after {\r\n  clear: both;\r\n}\r\n.oskariui .hide-text {\r\n  font: 0/0 a;\r\n  color: transparent;\r\n  text-shadow: none;\r\n  background-color: transparent;\r\n  border: 0;\r\n}\r\n.oskariui .input-block-level {\r\n  display: block;\r\n  width: 100%;\r\n  min-height: 30px;\r\n  -webkit-box-sizing: border-box;\r\n  -moz-box-sizing: border-box;\r\n  box-sizing: border-box;\r\n}\r\n.oskariui .row {\r\n  margin-left: -20px;\r\n  *zoom: 1;\r\n}\r\n.oskariui .row:before,\r\n.oskariui .row:after {\r\n  display: table;\r\n  content: "";\r\n  line-height: 0;\r\n}\r\n.oskariui .row:after {\r\n  clear: both;\r\n}\r\n[class*="span"] {\r\n  float: left;\r\n  min-height: 1px;\r\n  margin-left: 20px;\r\n}\r\n.oskariui .container,\r\n.oskariui .navbar-static-top .container,\r\n.oskariui .navbar-fixed-top .container,\r\n.oskariui .navbar-fixed-bottom .container {\r\n  width: 940px;\r\n}\r\n.oskariui .span12 {\r\n  width: 940px;\r\n}\r\n.oskariui .span11 {\r\n  width: 860px;\r\n}\r\n.oskariui .span10 {\r\n  width: 780px;\r\n}\r\n.oskariui .span9 {\r\n  width: 700px;\r\n}\r\n.oskariui .span8 {\r\n  width: 620px;\r\n}\r\n.oskariui .span7 {\r\n  width: 540px;\r\n}\r\n.oskariui .span6 {\r\n  width: 460px;\r\n}\r\n.oskariui .span5 {\r\n  width: 380px;\r\n}\r\n.oskariui .span4 {\r\n  width: 300px;\r\n}\r\n.oskariui .span3 {\r\n  width: 220px;\r\n}\r\n.oskariui .span2 {\r\n  width: 140px;\r\n}\r\n.oskariui .span1 {\r\n  width: 60px;\r\n}\r\n.oskariui .offset12 {\r\n  margin-left: 980px;\r\n}\r\n.oskariui .offset11 {\r\n  margin-left: 900px;\r\n}\r\n.oskariui .offset10 {\r\n  margin-left: 820px;\r\n}\r\n.oskariui .offset9 {\r\n  margin-left: 740px;\r\n}\r\n.oskariui .offset8 {\r\n  margin-left: 660px;\r\n}\r\n.oskariui .offset7 {\r\n  margin-left: 580px;\r\n}\r\n.oskariui .offset6 {\r\n  margin-left: 500px;\r\n}\r\n.oskariui .offset5 {\r\n  margin-left: 420px;\r\n}\r\n.oskariui .offset4 {\r\n  margin-left: 340px;\r\n}\r\n.oskariui .offset3 {\r\n  margin-left: 260px;\r\n}\r\n.oskariui .offset2 {\r\n  margin-left: 180px;\r\n}\r\n.oskariui .offset1 {\r\n  margin-left: 100px;\r\n}\r\n.oskariui .row-fluid {\r\n  width: 100%;\r\n  *zoom: 1;\r\n}\r\n.oskariui .row-fluid:before,\r\n.oskariui .row-fluid:after {\r\n  display: table;\r\n  content: "";\r\n  line-height: 0;\r\n}\r\n.oskariui .row-fluid:after {\r\n  clear: both;\r\n}\r\n.oskariui .row-fluid [class*="span"] {\r\n  display: block;\r\n  width: 100%;\r\n  min-height: 30px;\r\n  -webkit-box-sizing: border-box;\r\n  -moz-box-sizing: border-box;\r\n  box-sizing: border-box;\r\n  float: left;\r\n  margin-left: 2.127659574468085%;\r\n  *margin-left: 2.074468085106383%;\r\n}\r\n.oskariui .row-fluid [class*="span"]:first-child {\r\n  margin-left: 0;\r\n}\r\n.oskariui .row-fluid .controls-row [class*="span"] + [class*="span"] {\r\n  margin-left: 2.127659574468085%;\r\n}\r\n.oskariui .row-fluid .span12 {\r\n  width: 100%;\r\n  *width: 99.94680851063829%;\r\n}\r\n.oskariui .row-fluid .span11 {\r\n  width: 91.48936170212765%;\r\n  *width: 91.43617021276594%;\r\n}\r\n.oskariui .row-fluid .span10 {\r\n  width: 82.97872340425532%;\r\n  *width: 82.92553191489361%;\r\n}\r\n.oskariui .row-fluid .span9 {\r\n  width: 74.46808510638297%;\r\n  *width: 74.41489361702126%;\r\n}\r\n.oskariui .row-fluid .span8 {\r\n  width: 65.95744680851064%;\r\n  *width: 65.90425531914893%;\r\n}\r\n.oskariui .row-fluid .span7 {\r\n  width: 57.44680851063829%;\r\n  *width: 57.39361702127659%;\r\n}\r\n.oskariui .row-fluid .span6 {\r\n  width: 48.93617021276595%;\r\n  *width: 48.88297872340425%;\r\n}\r\n.oskariui .row-fluid .span5 {\r\n  width: 40.42553191489362%;\r\n  *width: 40.37234042553192%;\r\n}\r\n.oskariui .row-fluid .span4 {\r\n  width: 31.914893617021278%;\r\n  *width: 31.861702127659576%;\r\n}\r\n.oskariui .row-fluid .span3 {\r\n  width: 23.404255319148934%;\r\n  *width: 23.351063829787233%;\r\n}\r\n.oskariui .row-fluid .span2 {\r\n  width: 14.893617021276595%;\r\n  *width: 14.840425531914894%;\r\n}\r\n.oskariui .row-fluid .span1 {\r\n  width: 6.382978723404255%;\r\n  *width: 6.329787234042553%;\r\n}\r\n.oskariui .row-fluid .offset12 {\r\n  margin-left: 104.25531914893617%;\r\n  *margin-left: 104.14893617021275%;\r\n}\r\n.oskariui .row-fluid .offset12:first-child {\r\n  margin-left: 102.12765957446808%;\r\n  *margin-left: 102.02127659574467%;\r\n}\r\n.oskariui .row-fluid .offset11 {\r\n  margin-left: 95.74468085106382%;\r\n  *margin-left: 95.6382978723404%;\r\n}\r\n.oskariui .row-fluid .offset11:first-child {\r\n  margin-left: 93.61702127659574%;\r\n  *margin-left: 93.51063829787232%;\r\n}\r\n.oskariui .row-fluid .offset10 {\r\n  margin-left: 87.23404255319149%;\r\n  *margin-left: 87.12765957446807%;\r\n}\r\n.oskariui .row-fluid .offset10:first-child {\r\n  margin-left: 85.1063829787234%;\r\n  *margin-left: 84.99999999999999%;\r\n}\r\n.oskariui .row-fluid .offset9 {\r\n  margin-left: 78.72340425531914%;\r\n  *margin-left: 78.61702127659572%;\r\n}\r\n.oskariui .row-fluid .offset9:first-child {\r\n  margin-left: 76.59574468085106%;\r\n  *margin-left: 76.48936170212764%;\r\n}\r\n.oskariui .row-fluid .offset8 {\r\n  margin-left: 70.2127659574468%;\r\n  *margin-left: 70.10638297872339%;\r\n}\r\n.oskariui .row-fluid .offset8:first-child {\r\n  margin-left: 68.08510638297872%;\r\n  *margin-left: 67.9787234042553%;\r\n}\r\n.oskariui .row-fluid .offset7 {\r\n  margin-left: 61.70212765957446%;\r\n  *margin-left: 61.59574468085106%;\r\n}\r\n.oskariui .row-fluid .offset7:first-child {\r\n  margin-left: 59.574468085106375%;\r\n  *margin-left: 59.46808510638297%;\r\n}\r\n.oskariui .row-fluid .offset6 {\r\n  margin-left: 53.191489361702125%;\r\n  *margin-left: 53.085106382978715%;\r\n}\r\n.oskariui .row-fluid .offset6:first-child {\r\n  margin-left: 51.063829787234035%;\r\n  *margin-left: 50.95744680851063%;\r\n}\r\n.oskariui .row-fluid .offset5 {\r\n  margin-left: 44.68085106382979%;\r\n  *margin-left: 44.57446808510638%;\r\n}\r\n.oskariui .row-fluid .offset5:first-child {\r\n  margin-left: 42.5531914893617%;\r\n  *margin-left: 42.4468085106383%;\r\n}\r\n.oskariui .row-fluid .offset4 {\r\n  margin-left: 36.170212765957444%;\r\n  *margin-left: 36.06382978723405%;\r\n}\r\n.oskariui .row-fluid .offset4:first-child {\r\n  margin-left: 34.04255319148936%;\r\n  *margin-left: 33.93617021276596%;\r\n}\r\n.oskariui .row-fluid .offset3 {\r\n  margin-left: 27.659574468085104%;\r\n  *margin-left: 27.5531914893617%;\r\n}\r\n.oskariui .row-fluid .offset3:first-child {\r\n  margin-left: 25.53191489361702%;\r\n  *margin-left: 25.425531914893618%;\r\n}\r\n.oskariui .row-fluid .offset2 {\r\n  margin-left: 19.148936170212764%;\r\n  *margin-left: 19.04255319148936%;\r\n}\r\n.oskariui .row-fluid .offset2:first-child {\r\n  margin-left: 17.02127659574468%;\r\n  *margin-left: 16.914893617021278%;\r\n}\r\n.oskariui .row-fluid .offset1 {\r\n  margin-left: 10.638297872340425%;\r\n  *margin-left: 10.53191489361702%;\r\n}\r\n.oskariui .row-fluid .offset1:first-child {\r\n  margin-left: 8.51063829787234%;\r\n  *margin-left: 8.404255319148938%;\r\n}\r\n[class*="span"].hide,\r\n.oskariui .row-fluid [class*="span"].hide {\r\n  display: none;\r\n}\r\n[class*="span"].pull-right,\r\n.oskariui .row-fluid [class*="span"].pull-right {\r\n  float: right;\r\n}\r\n.oskariui .container {\r\n  margin-right: auto;\r\n  margin-left: auto;\r\n  *zoom: 1;\r\n}\r\n.oskariui .container:before,\r\n.oskariui .container:after {\r\n  display: table;\r\n  content: "";\r\n  line-height: 0;\r\n}\r\n.oskariui .container:after {\r\n  clear: both;\r\n}\r\n.oskariui .container-fluid {\r\n  padding-right: 20px;\r\n  padding-left: 20px;\r\n  *zoom: 1;\r\n}\r\n.oskariui .container-fluid:before,\r\n.oskariui .container-fluid:after {\r\n  display: table;\r\n  content: "";\r\n  line-height: 0;\r\n}\r\n.oskariui .container-fluid:after {\r\n  clear: both;\r\n}\r\n#mapstatsHover_contentDiv {\n  padding: 5px; }\ndiv.olMap {\r\n    z-index: 0;\r\n    padding: 0 !important;\r\n    margin: 0 !important;\r\n    cursor: default;\r\n}\r\n\r\ndiv.olMapViewport {\r\n    text-align: left;\r\n}\r\n\r\ndiv.olLayerDiv {\r\n   -moz-user-select: none;\r\n   -khtml-user-select: none;\r\n}\r\n\r\n.olLayerGoogleCopyright {\r\n    left: 2px;\r\n    bottom: 2px;\r\n}\r\n.olLayerGoogleV3.olLayerGoogleCopyright {\r\n    right: auto !important;\r\n}\r\n.olLayerGooglePoweredBy {\r\n    left: 2px;\r\n    bottom: 15px;\r\n}\r\n.olLayerGoogleV3.olLayerGooglePoweredBy {\r\n    bottom: 15px !important;\r\n}\r\n.olControlAttribution {\r\n    font-size: smaller;\r\n    right: 3px;\r\n    bottom: 4.5em;\r\n    position: absolute;\r\n    display: block;\r\n}\r\n.olControlScale {\r\n    right: 3px;\r\n    bottom: 3em;\r\n    display: block;\r\n    position: absolute;\r\n    font-size: smaller;\r\n}\r\n.olControlScaleLine {\r\n   display: block;\r\n   position: absolute;\r\n   left: 10px;\r\n   bottom: 15px;\r\n   font-size: xx-small;\r\n}\r\n.olControlScaleLineBottom {\r\n   border: solid 2px black;\r\n   border-bottom: none;\r\n   margin-top:-2px;\r\n   text-align: center;\r\n}\r\n.olControlScaleLineTop {\r\n   border: solid 2px black;\r\n   border-top: none;\r\n   text-align: center;\r\n}\r\n\r\n.olControlPermalink {\r\n    right: 3px;\r\n    bottom: 1.5em;\r\n    display: block;\r\n    position: absolute;\r\n    font-size: smaller;\r\n}\r\n\r\ndiv.olControlMousePosition {\r\n    bottom: 0;\r\n    right: 3px;\r\n    display: block;\r\n    position: absolute;\r\n    font-family: Arial;\r\n    font-size: smaller;\r\n}\r\n\r\n.olControlOverviewMapContainer {\r\n    position: absolute;\r\n    bottom: 0;\r\n    right: 0;\r\n}\r\n\r\n.olControlOverviewMapElement {\r\n    padding: 10px 18px 10px 10px;\r\n    background-color: #00008B;\r\n    -moz-border-radius: 1em 0 0 0;\r\n}\r\n\r\n.olControlOverviewMapMinimizeButton,\r\n.olControlOverviewMapMaximizeButton {\r\n    height: 18px;\r\n    width: 18px;\r\n    right: 0;\r\n    bottom: 80px;\r\n    cursor: pointer;\r\n}\r\n\r\n.olControlOverviewMapExtentRectangle {\r\n    overflow: hidden;\r\n    background-image: url("resources/openlayers/theme/default/img/blank.gif");\r\n    cursor: move;\r\n    border: 2px dotted red;\r\n}\r\n.olControlOverviewMapRectReplacement {\r\n    overflow: hidden;\r\n    cursor: move;\r\n    background-image: url("resources/openlayers/theme/default/img/overview_replacement.gif");\r\n    background-repeat: no-repeat;\r\n    background-position: center;\r\n}\r\n\r\n.olLayerGeoRSSDescription {\r\n    float:left;\r\n    width:100%;\r\n    overflow:auto;\r\n    font-size:1.0em;\r\n}\r\n.olLayerGeoRSSClose {\r\n    float:right;\r\n    color:gray;\r\n    font-size:1.2em;\r\n    margin-right:6px;\r\n    font-family:sans-serif;\r\n}\r\n.olLayerGeoRSSTitle {\r\n    float:left;font-size:1.2em;\r\n}\r\n\r\n.olPopupContent {\r\n    padding:5px;\r\n    overflow: auto;\r\n}\r\n\r\n.olControlNavigationHistory {\r\n   background-image: url("resources/openlayers/theme/default/img/navigation_history.png");\r\n   background-repeat: no-repeat;\r\n   width:  24px;\r\n   height: 24px;\r\n\r\n}\r\n.olControlNavigationHistoryPreviousItemActive {\r\n  background-position: 0 0;\r\n}\r\n.olControlNavigationHistoryPreviousItemInactive {\r\n   background-position: 0 -24px;\r\n}\r\n.olControlNavigationHistoryNextItemActive {\r\n   background-position: -24px 0;\r\n}\r\n.olControlNavigationHistoryNextItemInactive {\r\n   background-position: -24px -24px;\r\n}\r\n\r\ndiv.olControlSaveFeaturesItemActive {\r\n    background-image: url(resources/openlayers/theme/default/img/save_features_on.png);\r\n    background-repeat: no-repeat;\r\n    background-position: 0 1px;\r\n}\r\ndiv.olControlSaveFeaturesItemInactive {\r\n    background-image: url(resources/openlayers/theme/default/img/save_features_off.png);\r\n    background-repeat: no-repeat;\r\n    background-position: 0 1px;\r\n}\r\n\r\n.olHandlerBoxZoomBox {\r\n    border: 2px solid red;\r\n    position: absolute;\r\n    background-color: white;\r\n    opacity: 0.50;\r\n    font-size: 1px;\r\n    filter: alpha(opacity=50);\r\n}\r\n.olHandlerBoxSelectFeature {\r\n    border: 2px solid blue;\r\n    position: absolute;\r\n    background-color: white;\r\n    opacity: 0.50;\r\n    font-size: 1px;\r\n    filter: alpha(opacity=50);\r\n}\r\n\r\n.olControlPanPanel {\r\n    top: 10px;\r\n    left: 5px;\r\n}\r\n\r\n.olControlPanPanel div {\r\n    background-image: url(resources/openlayers/theme/default/img/pan-panel.png);\r\n    height: 18px;\r\n    width: 18px;\r\n    cursor: pointer;\r\n    position: absolute;\r\n}\r\n\r\n.olControlPanPanel .olControlPanNorthItemInactive {\r\n    top: 0;\r\n    left: 9px;\r\n    background-position: 0 0;\r\n}\r\n.olControlPanPanel .olControlPanSouthItemInactive {\r\n    top: 36px;\r\n    left: 9px;\r\n    background-position: 18px 0;\r\n}\r\n.olControlPanPanel .olControlPanWestItemInactive {\r\n    position: absolute;\r\n    top: 18px;\r\n    left: 0;\r\n    background-position: 0 18px;\r\n}\r\n.olControlPanPanel .olControlPanEastItemInactive {\r\n    top: 18px;\r\n    left: 18px;\r\n    background-position: 18px 18px;\r\n}\r\n\r\n.olControlZoomPanel {\r\n    top: 71px;\r\n    left: 14px;\r\n}\r\n\r\n.olControlZoomPanel div {\r\n    background-image: url(resources/openlayers/theme/default/img/zoom-panel.png);\r\n    position: absolute;\r\n    height: 18px;\r\n    width: 18px;\r\n    cursor: pointer;\r\n}\r\n\r\n.olControlZoomPanel .olControlZoomInItemInactive {\r\n    top: 0;\r\n    left: 0;\r\n    background-position: 0 0;\r\n}\r\n\r\n.olControlZoomPanel .olControlZoomToMaxExtentItemInactive {\r\n    top: 18px;\r\n    left: 0;\r\n    background-position: 0 -18px;\r\n}\r\n\r\n.olControlZoomPanel .olControlZoomOutItemInactive {\r\n    top: 36px;\r\n    left: 0;\r\n    background-position: 0 18px;\r\n}\r\n\r\n/*\r\n * When a potential text is bigger than the image it move the image\r\n * with some headers (closes #3154)\r\n */\r\n.olControlPanZoomBar div {\r\n    font-size: 1px;\r\n}\r\n\r\n.olPopupCloseBox {\r\n  background: url("resources/openlayers/theme/default/img/close.gif") no-repeat;\r\n  cursor: pointer;\r\n}\r\n\r\n.olFramedCloudPopupContent {\r\n    padding: 5px;\r\n    overflow: auto;\r\n}\r\n\r\n.olControlNoSelect {\r\n -moz-user-select: none;\r\n -khtml-user-select: none;\r\n}\r\n\r\n.olImageLoadError {\r\n    background-color: pink;\r\n    opacity: 0.5;\r\n    filter: alpha(opacity=50); /* IE */\r\n}\r\n\r\n/**\r\n * Cursor styles\r\n */\r\n\r\n.olCursorWait {\r\n    cursor: wait;\r\n}\r\n.olDragDown {\r\n    cursor: move;\r\n}\r\n.olDrawBox {\r\n    cursor: crosshair;\r\n}\r\n.olControlDragFeatureOver {\r\n    cursor: move;\r\n}\r\n.olControlDragFeatureActive.olControlDragFeatureOver.olDragDown {\r\n    cursor: -moz-grabbing;\r\n}\r\n\r\n/**\r\n * Layer switcher\r\n */\r\n.olControlLayerSwitcher {\r\n    position: absolute;\r\n    top: 25px;\r\n    right: 0;\r\n    width: 20em;\r\n    font-family: sans-serif;\r\n    font-weight: bold;\r\n    margin-top: 3px;\r\n    margin-left: 3px;\r\n    margin-bottom: 3px;\r\n    font-size: smaller;\r\n    color: white;\r\n    background-color: transparent;\r\n}\r\n\r\n.olControlLayerSwitcher .layersDiv {\r\n    padding-top: 5px;\r\n    padding-left: 10px;\r\n    padding-bottom: 5px;\r\n    padding-right: 10px;\r\n    background-color: darkblue;\r\n}\r\n\r\n.olControlLayerSwitcher .layersDiv .baseLbl,\r\n.olControlLayerSwitcher .layersDiv .dataLbl {\r\n    margin-top: 3px;\r\n    margin-left: 3px;\r\n    margin-bottom: 3px;\r\n}\r\n\r\n.olControlLayerSwitcher .layersDiv .baseLayersDiv,\r\n.olControlLayerSwitcher .layersDiv .dataLayersDiv {\r\n    padding-left: 10px;\r\n}\r\n\r\n.olControlLayerSwitcher .maximizeDiv,\r\n.olControlLayerSwitcher .minimizeDiv {\r\n    width: 18px;\r\n    height: 18px;\r\n    top: 5px;\r\n    right: 0;\r\n    cursor: pointer;\r\n}\r\n\r\n.olBingAttribution {\r\n    color: #DDD;\r\n}\r\n.olBingAttribution.road {\r\n    color: #333;\r\n}\r\n\r\n.olGoogleAttribution.hybrid, .olGoogleAttribution.satellite {\r\n    color: #EEE;\r\n}\r\n.olGoogleAttribution {\r\n    color: #333;\r\n}\r\nspan.olGoogleAttribution a {\r\n    color: #77C;\r\n}\r\nspan.olGoogleAttribution.hybrid a, span.olGoogleAttribution.satellite a {\r\n    color: #EEE;\r\n}\r\n\r\n/**\r\n * Editing and navigation icons.\r\n * (using the editing_tool_bar.png sprint image)\r\n */\r\n.olControlNavToolbar ,\r\n.olControlEditingToolbar {\r\n    margin: 5px 5px 0 0;\r\n}\r\n.olControlNavToolbar div,\r\n.olControlEditingToolbar div {\r\n    background-image: url("resources/openlayers/theme/default/img/editing_tool_bar.png");\r\n    background-repeat: no-repeat;\r\n    margin: 0 0 5px 5px;\r\n    width: 24px;\r\n    height: 22px;\r\n    cursor: pointer\r\n}\r\n/* positions */\r\n.olControlEditingToolbar {\r\n    right: 0;\r\n    top: 0;\r\n}\r\n.olControlNavToolbar {\r\n    top: 295px;\r\n    left: 9px;\r\n}\r\n/* layouts */\r\n.olControlEditingToolbar div {\r\n    float: right;\r\n}\r\n/* individual controls */\r\n.olControlNavToolbar .olControlNavigationItemInactive,\r\n.olControlEditingToolbar .olControlNavigationItemInactive {\r\n    background-position: -103px -1px;\r\n}\r\n.olControlNavToolbar .olControlNavigationItemActive ,\r\n.olControlEditingToolbar .olControlNavigationItemActive  {\r\n    background-position: -103px -24px;\r\n}\r\n.olControlNavToolbar .olControlZoomBoxItemInactive {\r\n    background-position: -128px -1px;\r\n}\r\n.olControlNavToolbar .olControlZoomBoxItemActive  {\r\n    background-position: -128px -24px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePointItemInactive {\r\n    background-position: -77px -1px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePointItemActive {\r\n    background-position: -77px -24px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePathItemInactive {\r\n    background-position: -51px -1px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePathItemActive {\r\n    background-position: -51px -24px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePolygonItemInactive{\r\n    background-position: -26px -1px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePolygonItemActive {\r\n    background-position: -26px -24px;\r\n}\r\n\r\ndiv.olControlZoom {\r\n    position: absolute;\r\n    top: 8px;\r\n    left: 8px;\r\n    background: rgba(255,255,255,0.4);\r\n    border-radius: 4px;\r\n    padding: 2px;\r\n}\r\ndiv.olControlZoom a {\r\n    display: block;\r\n    margin: 1px;\r\n    padding: 0;\r\n    color: white;\r\n    font-size: 18px;\r\n    font-family: \'Lucida Grande\', Verdana, Geneva, Lucida, Arial, Helvetica, sans-serif;\r\n    font-weight: bold;\r\n    text-decoration: none;\r\n    text-align: center;\r\n    height: 22px;\r\n    width:22px;\r\n    line-height: 19px;\r\n    background: #130085; /* fallback for IE - IE6 requires background shorthand*/\r\n    background: rgba(0, 60, 136, 0.5);\r\n    filter: alpha(opacity=80);\r\n}\r\ndiv.olControlZoom a:hover {\r\n    background: #130085; /* fallback for IE */\r\n    background: rgba(0, 60, 136, 0.7);\r\n    filter: alpha(opacity=100);\r\n}\r\n@media only screen and (max-width: 600px) {\r\n    div.olControlZoom a:hover {\r\n        background: rgba(0, 60, 136, 0.5);\r\n    }\r\n}\r\na.olControlZoomIn {\r\n    border-radius: 4px 4px 0 0;\r\n}\r\na.olControlZoomOut {\r\n    border-radius: 0 0 4px 4px;\r\n}\r\n\r\n\r\n/**\r\n * Animations\r\n */\r\n\r\n.olLayerGrid .olTileImage {\r\n    -webkit-transition: opacity 0.2s linear;\r\n    -moz-transition: opacity 0.2s linear;\r\n    -o-transition: opacity 0.2s linear;\r\n    transition: opacity 0.2s linear;\r\n}\r\n.getinforesult_table tr {\r\n  padding: 5px; }\r\n  .getinforesult_table tr.odd {\r\n    background-color: #EEEEEE; }\r\n.getinforesult_table td {\r\n  padding: 2px; }\r\n\r\n.getinforesult_header {\r\n  border: 1pt solid navy;\r\n  background-color: #424343;\r\n  margin-top: 14px;\r\n  margin-bottom: 10px;\r\n  height: 15px; }\r\n  .getinforesult_header .icon-bubble-left {\r\n    height: 15px;\r\n    display: inline;\r\n    float: left; }\r\n\r\n.getinforesult_header_title {\r\n  color: #FFF;\r\n  float: left;\r\n  display: inline;\r\n  margin-left: 8px;\r\n  max-width: 85%;\r\n  overflow: hidden;\r\n  white-space: nowrap;\r\n  text-overflow: ellipsis; }\r\ndiv.mapplugin.search-div {\n  top: 10px;\n  right: 10px; }\n\ndiv.search-div div.close {\n  float: right; }\n\ndiv.search-div input[type=text] {\n  width: 124px !important; }\n\ndiv.search-div input[type=button] {\n  width: 35px;\n  margin-left: 3px; }\n\ndiv.search-div div.results {\n  border: 1px solid #f3f3f3;\n  background: white;\n  max-width: 255px;\n  width: 255px;\n  overflow: scroll;\n  margin-top: 5px;\n  padding: 4px; }\n\ndiv.search-div div.results div.header {\n  background: #DDDDDD; }\n\ndiv.search-div div.results div.content table {\n  width: 100%;\n  text-align: center;\n  border-spacing: 2px; }\n\ndiv.search-div div.results div.content table tr {\n  cursor: pointer; }\n\n/* IE8 Cleared */\ntable.search-results td {\n  text-align: left;\n  padding: 2px;\n  padding-left: 4px;\n  padding-right: 12px; }\n\ntable.search-results tr.odd {\n  background-color: #f3f3f3; }\n\ntable.search-results {\n  width: 100%;\n  margin: 4px; }\n\ntable.search-results a {\n  color: #0085D1; }\n\ntable.search-results th {\n  text-align: left;\n  padding: 2px;\n  padding-left: 4px;\n  padding-right: 12px;\n  font-weight: bold; }\n\n/*\r\n#search-loading-image {\r\n    position: absolute;\r\n    right: 56px;\r\n    top: 6px;\r\n    z-index: 10001;\r\n}\r\n*/\n.logoplugin {\r\n  background-color: #FFF;\r\n  background-repeat: no-repeat;\r\n  display: block;\r\n  position: absolute;\r\n  bottom: 0px;\r\n  left: 0px;\r\n  z-index: 100000000 !important;\r\n  filter: alpha(opacity=80);\r\n  /* unquote for libsass bug */\r\n  opacity: 0.8 !important; }\r\n  .logoplugin a, .logoplugin a:hover, .logoplugin a:active, .logoplugin a:visited {\r\n    color: #333333 !important; }\r\n  .logoplugin .icon {\r\n    background-image: url(\'/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/logo/images/logo_pieni.png\');\r\n    display: inline-block;\r\n    height: 25px;\r\n    width: 25px;\r\n    vertical-align: bottom; }\r\n  .logoplugin .terms {\r\n    display: inline-block;\r\n    margin: 5px; }\r\n\r\n/* Force measurement bar up a notch so it isn\'t occluded by the logo */\r\n#mapdiv .olControlScaleLine {\r\n  bottom: 30px; }\r\n.oskari-datasource .link {\r\n  background-color: none;\r\n  background-repeat: no-repeat;\r\n  display: block;\r\n  font-size: 13px;\r\n  position: fixed;\r\n  bottom: 15px;\r\n  right: 70px;\r\n  z-index: 100000000 !important;\r\n  filter: alpha(opacity=80);\r\n  /* unquote for libsass bug */\r\n  opacity: 0.8 !important; }\r\n\r\n.oskari-datasource a, .oskari-datasource a:hover, .oskari-datasource:active, .oskari-datasource a:visited {\r\n  color: blue !important; }\r\n.olControlOverviewMapElement  {\r\n    padding: 5px !important;\r\n    background-color: #FFFFFF !important;\r\n    border-color: #D0D0D0 !important;\r\n    border-style: solid;\r\n    border-left-width: 2px;\r\n    border-top-width: 2px;\r\n    \r\n}\r\n#olControlOverviewMapMaximizeButton\r\n{\r\n    position: absolute !important;\r\n    right: 10px;\r\n    bottom: 2px;\r\n}\r\n\r\n#OpenLayers_Control_minimizeDiv\r\n{\r\n    width: 46px !important;\r\n    height: 46px !important;\r\n    right: 0px;\r\n    bottom: 0px;\r\n    cursor: default;\r\n    background: url(\'/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/indexmap/images/component-indexmap_hover.png\')  !important;\r\n    \r\n}\r\n\r\n#olControlOverviewMapMaximizeButton_innerImage, #OpenLayers_Control_minimizeDiv_innerImage{\r\n    display: none !important;\r\n}\r\n\r\n#olControlOverviewMapMaximizeButton{\r\n    width: 46px !important;\r\n    height: 46px !important;\r\n    right: 0px;\r\n    bottom: 0px;\r\n    cursor: default;\r\n    background: url(\'/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/indexmap/images/component-indexmap.png\') 0px 0px !important;\r\n}\r\n\r\n#olControlOverviewMapMaximizeButton:hover\r\n{\r\n    background: url(\'/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/indexmap/images/component-indexmap_hover.png\') !important;\r\n}\r\n\r\n#OpenLayers_Control_minimizeDiv{\r\n    position: absolute !important;\r\n    right: 0px;\r\n    bottom: 0px;\r\n}\r\n\r\n.olControlOverviewMapExtentRectangle  {\r\n    border:2px dashed #f47729 !important;\r\n}\r\n.fullscreenDiv {\r\n  position: absolute;\r\n  top: 10px;\r\n  left: 10px;\r\n  display: block;\r\n  color: black;\r\n  background: transparent;\r\n  z-index: 15000; }\r\n\r\n.fullscreenDiv .fullscreenDivImg {\r\n  cursor: pointer; }\r\ndiv.mapplugin.layerSelectionPlugin {\r\n  position: absolute;\r\n  top: 20px;\r\n  right: 20px;\r\n  z-index: 100000000 !important; }\r\n\r\n.layerSelectionPlugin {\r\n  max-width: 200px; }\r\n\r\n.layerSelectionPlugin div.header {\r\n  background-color: #333333 !important;\r\n  color: white !important;\r\n  padding: 8px; }\r\n\r\n.layerSelectionPlugin div.content {\r\n  background-color: white; }\r\n\r\n.layerSelectionPlugin div.header div.header-icon {\r\n  display: inline-block;\r\n  margin-right: 10px;\r\n  vertical-align: middle; }\r\n\r\n.layerSelectionPlugin div.content div.layers, .layerSelectionPlugin div.content div.baselayers {\r\n  padding: 10px; }\r\n\r\n.layerSelectionPlugin div.content div.layer {\r\n  margin: 5px 0;\r\n  text-align: left; }\r\n\r\n.layerSelectionPlugin div.content div.layer input {\r\n  margin-right: 10px;\r\n  float: left; }\r\n\r\n.layerSelectionPlugin div.content div.baseLayerHeader {\r\n  background-color: #DDDDDD;\r\n  padding: 10px; }\r\ndiv.pzbDiv.mapplugin {\r\n    top : 140px;\r\n    right : 64px;\r\n    background : transparent;\r\n    z-index: 15000;\r\n}\r\ndiv.pzbDiv div.pzbDiv-plus {\r\n    width : 18px;\r\n    height : 46px;\r\n    background-image : url(\'/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/images/zoombar_plus_patched.png\');\r\n}\r\n\r\ndiv.pzbDiv div.pzbDiv-minus {\r\n    width : 18px;\r\n    height : 18px;\r\n    background-image : url(\'/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/images/zoombar_minus.png\');\r\n}\r\ndiv.pzbDiv div.rui-slider-vertical {\r\n    background-color : transparent;\r\n    background-image : url(\'/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/images/zoombar.png\');\r\n    height : 148px;\r\n    width : 18px;\r\n    border : 0;\r\n    margin : 0;\r\n}\r\n\r\n\r\n\r\n\r\n.panbuttonDiv.mapplugin {\r\n  top: 10px;\r\n  right: 36px;\r\n  display: block;\r\n  color: black;\r\n  background: transparent;\r\n  font-size: 12px;\r\n  z-index: 15000;\r\n  /*64738;*/\r\n  font-weight: bold;\r\n  /*background-image: url(\'/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/default.png\');*/\r\n  height: 90px;\r\n  width: 90px; }\r\n\r\n.panbuttonDivImg {\r\n  background-image: url(\'/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/sprite.png\'); }\r\n\r\n.panbuttonDivImg.root {\r\n  background-position: 0px -90px; }\r\n\r\n.panbuttonDivImg.left {\r\n  background-position: 0px -180px; }\r\n\r\n.panbuttonDivImg.right {\r\n  background-position: 0px -270px; }\r\n\r\n.panbuttonDivImg.up {\r\n  background-position: 0px -360px; }\r\n\r\n.panbuttonDivImg.down {\r\n  background-position: 0px -450px; }\r\n\r\n.panbutton_left {\r\n  float: left; }\r\n\r\n.panbutton_right {\r\n  float: right; }\r\n.olMap {\r\n  position: relative; }\r\n\r\ndiv.mapplugin {\r\n  position: absolute;\r\n  z-index: 15000; }\r\n\r\ndiv.mapplugins.left {\r\n  position: absolute;\r\n  z-index: 15000;\r\n  top: 20px;\r\n  right: 20px;\r\n  text-align: right;\r\n  max-width: 85%; }\r\n\r\ndiv.mapplugins.left > div {\r\n  display: inline-block;\r\n  margin: 5px;\r\n  vertical-align: top; }\r\n')}),requirejs.s.contexts._.nextTick=requirejs.nextTick;