/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 12:23:19 GMT+0300 (Suomen kesäaika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance",function(){this.sandbox=null;this.started=false;this.buttons={};this.selectedButton=null;this.container=null},{__name:"Toolbar",getName:function(){return this.__name},setSandbox:function(a){this.sandbox=a},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var b=this;if(b.started){return}b.started=true;var a=Oskari.$("sandbox");a.register(b);b.setSandbox(a);this.container=jQuery("#toolbar");for(var c in b.eventHandlers){if(c){a.registerForEventByName(b,c)}}a.addRequestHandler("Toolbar.AddToolButtonRequest",this.requestHandlers.toolButtonRequestHandler);a.addRequestHandler("Toolbar.RemoveToolButtonRequest",this.requestHandlers.toolButtonRequestHandler);a.addRequestHandler("Toolbar.ToolButtonStateRequest",this.requestHandlers.toolButtonRequestHandler);a.registerAsStateful(this.mediator.bundleId,this);if(this._addDefaultButtons){this._addDefaultButtons()}},init:function(){var a=this;this.templateGroup=jQuery('<div class="toolrow"></div>');this.templateTool=jQuery('<div class="tool"></div>');this.requestHandlers={toolButtonRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",a)}},getToolbarContainer:function(){return this.container},onEvent:function(c){var b=this;var a=b.eventHandlers[c.getName()];if(!a){return}return a.apply(this,[c])},eventHandlers:{},stop:function(){var b=this;var a=b.sandbox();for(var c in b.eventHandlers){if(c){a.unregisterFromEventByName(b,c)}}this.sandbox.unregisterStateful(this.mediator.bundleId);b.sandbox.unregister(b);b.started=false},setState:function(d){if(!d){return}if(d.selected){this.selectedButton=d.selected;var a=d.selected.id;var f=d.selected.group;var c=this.getToolbarContainer();this._removeToolSelections();var e=c.find("div.toolrow[tbgroup="+f+"]");if(e.length>0){var b=e.find("div.tool[tool="+a+"]");if(b.length>0){b.addClass("selected");this.buttons[f][a].callback()}}}else{this.selectedButton=null}},getState:function(){var a={};if(this.selectedButton){a.selected=this.selectedButton}return a}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]});Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","button-methods",{addToolButton:function(c,a,g){if(!c||!a||!g||!g.callback){return}var e=this;var d=this.getToolbarContainer();var f=null;if(!this.buttons[a]){this.buttons[a]={};f=this.templateGroup.clone();f.attr("tbgroup",a);d.append(f)}else{f=d.find("div.toolrow[tbgroup="+a+"]")}if(this.buttons[a][c]){return}this.buttons[a][c]=g;var b=this.templateTool.clone();b.attr("tool",c);b.attr("title",g.tooltip);b.addClass(g.iconCls);if(this.selectedButton){if(this.selectedButton.id==c&&this.selectedButton.group==a){b.addClass("selected");g.callback()}}else{if(g.selected){b.addClass("selected");e.selectedButton={id:c,group:a}}}b.bind("click",function(h){if(e.buttons[a][c].enabled==false){return}if(g.sticky==true){e._removeToolSelections();b.addClass("selected");e.selectedButton={id:c,group:a}}g.callback()});f.append(b)},_removeToolSelections:function(){var a=this.getToolbarContainer();var b=a.find("div.tool");b.removeClass("selected")},removeToolButton:function(c,a){if(!a){return}if(this.buttons[a]){var d=this.getToolbarContainer();var e=d.find("div.toolrow[tbgroup="+a+"]");if(c){var b=e.find("div.tool[tool="+c+"]");b.remove();this.buttons[a][c]=null;delete this.buttons[a][c]}else{e.remove();this.buttons[a]=null;delete this.buttons[a]}}},changeToolButtonState:function(f,d,c){if(!d){return}if(this.buttons[d]){var g=this.getToolbarContainer();var i=g.find("div.toolrow[tbgroup="+d+"]");if(f){var e=i.find("div.tool[tool="+f+"]");this.buttons[d][f].enabled=c;if(c){e.removeClass("disabled")}else{e.addClass("disabled")}}else{var h=i.find("div.tool");if(c){h.removeClass("disabled")}else{h.addClass("disabled")}for(var a in this.buttons[d]){this.buttons[d][a].enabled=c}}}}});Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","default-buttons",{_addDefaultButtons:function(){var b=this;
var a=this.getSandbox().getRequestBuilder("ToolSelectionRequest");this.addToolButton("reset","history",{iconCls:"tool-reset",tooltip:"Paluu aloitusnäkymään",sticky:false,callback:function(){var d=b.getSandbox().getRequestBuilder("StateHandler.SetStateRequest");if(d){b.getSandbox().request(b,d())}var c=b.getSandbox().getRequestBuilder("ClearHistoryRequest")();b.getSandbox().request(b,c)}});this.addToolButton("history_back","history",{iconCls:"tool-history-back",tooltip:"Taaksepäin historiassa",sticky:false,callback:function(){b.getSandbox().request(b,a("map_control_tool_prev"))}});this.addToolButton("history_forward","history",{iconCls:"tool-history-forward",tooltip:"Eteenpäin historiassa",sticky:false,callback:function(){b.getSandbox().request(b,a("map_control_tool_next"))}});this.addToolButton("zoombox","basictools",{iconCls:"tool-zoombox",tooltip:"Zoom",sticky:true,callback:function(){b.getSandbox().request(b,a("map_control_zoom_tool"))}});this.addToolButton("select","basictools",{iconCls:"tool-pan",tooltip:"Pan",selected:true,sticky:true,callback:function(){b.getSandbox().request(b,a("map_control_navigate_tool"))}});this.addToolButton("measureline","measuretools",{iconCls:"tool-measure-line",tooltip:"Measure line",sticky:true,callback:function(){b.getSandbox().request(b,a("map_control_measure_tool"))}});this.addToolButton("measurearea","measuretools",{iconCls:"tool-measure-area",tooltip:"Measure area",sticky:true,callback:function(){b.getSandbox().request(b,a("map_control_measure_area_tool"))}})}});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.AddToolButtonRequest",function(c,b,a){this._id=c;this._group=b;this._config=a},{__name:"Toolbar.AddToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getConfig:function(){return this._config}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.RemoveToolButtonRequest",function(b,a){this._id=b;this._group=a},{__name:"Toolbar.RemoveToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonStateRequest",function(c,b,a){this._id=c;this._group=b;this._state=(a==true)},{__name:"Toolbar.ToolButtonStateRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getState:function(){return this._state}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",function(a){this._toolbar=a},{handleRequest:function(b,c){var a=b.getSandbox();if(c.getName()=="Toolbar.AddToolButtonRequest"){this._handleAdd(a,c)}else{if(c.getName()=="Toolbar.RemoveToolButtonRequest"){this._handleRemove(a,c)}else{if(c.getName()=="Toolbar.ToolButtonStateRequest"){this._handleState(a,c)}}}},_handleAdd:function(a,b){this._toolbar.addToolButton(b.getId(),b.getGroup(),b.getConfig())},_handleRemove:function(a,b){this._toolbar.removeToolButton(b.getId(),b.getGroup())},_handleState:function(a,b){this._toolbar.changeToolButtonState(b.getId(),b.getGroup(),b.getState())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});