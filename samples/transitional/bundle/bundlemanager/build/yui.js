/* This is a packed Oskari bundle (bundle script version Thu Dec 08 2011 10:08:11 GMT+0200 (Suomen normaaliaika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.BundleManagerUI",function(b,a){this.libs=b;this.form=null;this.ui=null;this.store=null;this.form=null;this.grid=null;this.bundle=a;this.lang=null},{clear:function(){this.store=null;this.form=null;this.libs=null;this.ui=null;this.grid=null},setLibs:function(a){this.libs=a},get:function(){return this.form},setStore:function(a){this.store=a},getStore:function(){return this.store},getGrid:function(){return this.grid},setLang:function(a){this.lang=a},getLang:function(){return this.lang},playBundle:function(a){this.bundle.playBundle(a)},pauseBundle:function(a){this.bundle.pauseBundle(a)},resumeBundle:function(a){this.bundle.resumeBundle(a)},stopBundle:function(a){this.bundle.stopBundle(a)},refresh:function(){this.grid.getView().refresh()},create:function(){var a=this.libs.ext;var a=this.libs.ext;var d=this;var f=d.lang;var e={xtype:"actioncolumn",width:64,items:[{text:"Play",icon:"../../map-application-framework/resource/silk-icons/control_play.png",handler:function(h,j,g){var i=d.getStore().getAt(j);d.playBundle(i)},getClass:function(h,i,k){var g=k.get("bundleinstancename");var j=k.get("metadata")["Singleton"];if(j&&d.bundle.bundleInstances[g]){return"hidden"}return""}},{text:"Stop",icon:".../../map-application-framework/resource/silk-icons/control_eject.png",handler:function(h,j,g){var i=d.getStore().getAt(j);d.stopBundle(i)},getClass:function(h,i,k){var j=k.get("metadata")["Singleton"];if(!j){return"hidden"}var g=k.get("bundleinstancename");if(!d.bundle.bundleInstances[g]){return"hidden"}return""}}]};var b=a.create("Ext.grid.Panel",{defaults:{bodyPadding:4},store:d.getStore(),title:"Bundles",columns:[e,{text:"Title",flex:1,dataIndex:"title",hidden:true},{text:"fi",flex:1,dataIndex:"fi",hidden:f!="fi"},{text:"sv",flex:1,dataIndex:"sv",hidden:f!="sv"},{text:"en",flex:1,dataIndex:"en",hidden:f!="en"},{text:"bundlename",dataIndex:"bundlename",hidden:true},{text:"bundleinstancename",dataIndex:"bundleinstancename",hidden:true}]});this.grid=b;var c=new a.create("Ext.Panel",{bodyStyle:"padding:5px 5px 5px 5px",height:384,layout:"fit",defaults:{bodyPadding:4},items:[b]});this.form=c;return c}});Oskari.clazz.define("Oskari.mapframework.bundle.BundleManagerInstance",function(a){this.name="bundlemanagerModule";this.mediator=null;this.sandbox=null;this.layerId=null;this.layer=null;this.ui=null;this.bundles={};this.bundleInstances={}},{getStore:function(){return this.store},getUI:function(){return this.ui},playBundle:function(f){var b=f.get("metadata");var d=f.get("bundlename");var a=f.get("bundleinstancename");var e=Oskari.bundle_facade;var c={title:a,fi:a,sv:"?",en:a,bundlename:d,bundleinstancename:a,metadata:b};e.playBundle(c,function(){})},pauseBundle:function(a){},resumeBundle:function(a){},stopBundle:function(a){},clear:function(){this.store.clearData();this.store.destroyStore();this.store=null},start:function(){if(this.mediator.getState()=="started"){return}this.libs={ext:Oskari.$("Ext")};this.facade=Oskari.$("UI.facade");this.projs={"EPSG:4326":new Proj4js.Proj("EPSG:4326"),"EPSG:3067":new Proj4js.Proj("EPSG:3067")};var a=this.libs.ext;var b=this;this.createModels();this.createStores();var b=this;this.func=a.Function.createThrottled(function(f,d){this.processQuery(f,d)},1000,b);var c=this.facade.appendExtensionModule(this,this.name,this.eventHandlers,this,"E",{fi:{title:" bundlemanager"},sv:{title:"?"},en:{title:" bundlemanager"}});this.def=c;this.mediator.setState("started");return this},getStore:function(){return this.store},createModels:function(){var a=this.libs.ext;var b=this;if(!a.ClassManager.get("Bundle")){a.define("Bundle",{extend:"Ext.data.Model",fields:["title","fi","en","sv","bundlename","bundleinstancename","metadata"]})}},createStores:function(){var d=this.defaultBundleData;var b=this.libs.ext;var c=this;var a=b.create("Ext.data.Store",{model:"Bundle",autoLoad:false,data:d,proxy:{type:"memory",reader:{type:"json",model:"Bundle",root:"bundles"}}});this.store=a},init:function(a){this.sandbox=a;var b=Oskari.clazz.create("Oskari.mapframework.bundle.BundleManagerUI",this.libs,this);var c=a.getLanguage();b.setLang(c);this.ui=b;b.setLibs(this.libs);b.setStore(this.getStore());b.create();return b.get()},update:function(d,a,c,e){d.alert("RECEIVED update notification @BUNDLE_INSTANCE: "+e)},stop:function(){this.facade.removeExtensionModule(this,this.name,this.eventHandlers,this,this.def);this.def=null;this.sandbox.printDebug("Clearing STORE etc");this.ui.clear();this.ui=null;this.clear();this.mediator.setState("stopped");return this},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},defaults:{minScale:40000,maxScale:1},eventHandlers:{},processResponse:function(b){var a=this.libs.ext;var c=this},defaultBundleData:{bundles:[{title:"Location Info",fi:"Location Info",sv:"?",en:"?",bundlename:"positioninfo",bundleinstancename:"positioninfo",metadata:{"Import-Bundle":{positioninfo:{bundlePath:"../complexbundle/bundle/"}}}},{title:"Wikipedia",fi:"Wikipedia",sv:"?",en:"Wikipedia",bundlename:"wikipedia",bundleinstancename:"wikipedia",metadata:{"Import-Bundle":{mapmodule:{},wikipedia:{bundlePath:"../complexbundle/bundle/"},mapoverlaypopup:{},layerhandler:{}}}},{title:"Sade From Demo 3",fi:"SADE Lomakedemo 3",sv:"?",en:"SADE Form Demo 3",bundlename:"sade3",bundleinstancename:"sade3",metadata:{Singleton:true,"Import-Bundle":{sade3:{bundlePath:"../example-bundles/bundle/"},mapmodule:{},layerhandler:{}},"Require-Bundle-Instance":[]}},{title:"Trains GeoRSS",fi:"Trains GeoRSS",sv:"?",en:"Trains GeoRSS",bundlename:"trains",bundleinstancename:"trains",metadata:{"Import-Bundle":{mapmodule:{},layerhandler:{},trains:{bundlePath:"../complexbundle/bundle/"}},"Require-Bundle-Instance":[]}}]},getName:function(){return this.__name},__name:"Oskari.mapframework.bundle.BundleManagerInstance"},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.mapframework.bundle.extension.Extension","Oskari.mapframework.bundle.extension.EventListener"]});