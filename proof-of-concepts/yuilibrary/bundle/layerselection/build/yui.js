/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 11:30:12 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.poc.yuilibrary.bundle.LayerSelectionBundleInstance",function(){this.map=null;this.core=null;this.sandbox=null;this.mapmodule=null;this.started=false;this.template=null;this.plugins={};this.yuilibrary=null},{__name:"YUILibraryLayerSelection",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},start:function(){var c=this;if(c.started){return}c.started=true;var a=Oskari.$("sandbox");c.sandbox=a;a.register(c);for(p in c.eventHandlers){a.registerForEventByName(c,p)}var b=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,b);c.mediator.bundle.require(function(d){c.yuilibrary=d;c.refresh()})},init:function(){return null},update:function(){},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{AfterMapLayerAddEvent:function(a){this.refresh()},AfterMapLayerRemoveEvent:function(a){this.refresh()},AfterMapMoveEvent:function(a){},AfterChangeMapLayerOpacityEvent:function(a){if(this.sandbox.getObjectCreator(a)!=this.getName()){this.plugins["Oskari.userinterface.Flyout"].updateLayer(a.getMapLayer())}}},stop:function(){var a=this.sandbox();for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);a.request(this,b);this.sandbox.unregister(this);this.started=false},setSandbox:function(a){this.sandbox=null},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.poc.yuilibrary.layerselection.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.poc.yuilibrary.layerselection.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getTitle:function(){return"Layer Selection"},getDescription:function(){return"Sample"},getPlugins:function(){return this.plugins},refresh:function(){var a=this;if(!a.yuilibrary){return}this.plugins["Oskari.userinterface.Flyout"].setYUILibrary(a.yuilibrary);this.plugins["Oskari.userinterface.Flyout"].refresh();this.plugins["Oskari.userinterface.Tile"].setYUILibrary(a.yuilibrary);this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.poc.yuilibrary.layerselection.Flyout",function(a){this.instance=a;this.container=null;this.template=null;this.state=null;this.yuilibrary=null;this.layercontrols={}},{setYUILibrary:function(a){this.yuilibrary=a},getName:function(){return"Oskari.poc.yuilibrary.layerselection.Flyout"},setEl:function(c,b,a){this.container=c[0]},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return"Valitut karttatasot"},getDescription:function(){},getOptions:function(){},setState:function(a){this.state=a;console.log("Flyout.setState",this,a)},updateLayer:function(b){var d=this.layercontrols[b.getId()];if(!d){return}var c=d.slider;if(!c){return}var a=b.getOpacity();c.setValue(a)},refresh:function(){var q=this;var b=q.yuilibrary;var t=q.template;if(!t){t=b.Node.create('<div class="layer selectedLayer"><div class="layer-title"><p></p></div><div class="slider"></div></div>');q.template=t}var a=b.one(this.container);a.empty();var o=b.Node.create('<div id="selectedLayerList"></div>');a.appendChild(o);var t=this.template;var d=q.instance.getSandbox();var e=d.getRequestBuilder("ChangeMapLayerOpacityRequest");var g=d.findAllSelectedMapLayers();q.layercontrols={};for(var i=0,m=g.length;i<m;i++){var r=g[i];var h=r.getId();var j=r.getOpacity();var l=t.cloneNode(true);var s=l.one(".layer-title p");s.setContent(r.getName());var f=l.one(".slider");var k=new b.Slider({min:0,max:100,value:j,length:"200px"});q.layercontrols[h]={slider:k};l.setData({sandbox:d,instance:q.instance,layerId:h});k.after("valueChange",function(x){var w=this.getData();var v=w.instance;var u=w.layerId;var n=w.sandbox;n.request(v,e(u,x.newVal))},l);k.render(f);o.appendChild(l)}if(g.length>1){var c=new b.Sortable({container:"#selectedLayerList",nodes:"div.selectedLayer",opacity:".1"});
c.on("moved",function(n){console.log("Item Moved! - "+n.drag.get("node").get("id"))})}}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.poc.yuilibrary.layerselection.Tile",function(a){this.instance=a;this.container=null;this.template=null;this.yuilibrary=null},{setYUILibrary:function(a){this.yuilibrary=a},getName:function(){return"Oskari.poc.yuilibrary.layerselection.Tile"},setEl:function(c,b,a){this.container=$(c)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return"Valitut tasot YUI"},getDescription:function(){},getOptions:function(){},setState:function(a){console.log("Tile.setState",this,a)},refresh:function(){var f=this;var a=f.instance;var e=this.container;var d=this.template;var c=a.getSandbox();var g=c.findAllSelectedMapLayers();var b=e.children(".oskari-tile-status");b.empty();b.append("("+g.length+")")}},{protocol:["Oskari.userinterface.Tile"]});