<link rel="import"
      href="libs/polymer/polymer.html">

<dom-module id="oskari-grid">

  <template>
    <table class="oskari-grid">
      <thead>
        <tr>
          <template is="dom-if" if="[[selection]]">
            <th><input type="checkbox" checked="{{allSelected::change}}" disabled="{{allCheckboxDisabled}}"
                id="allSelectedCheckbox"></input></th>
          </template>
          <template is="dom-repeat" items="[[headers]]" as="header" id="headersTemplate">
            <th>
              <span on-tap="onSort" index="[[index]]" header="[[header]]">[[header.title]]</span>
              <template is="dom-if" if="[[header.filter]]">
                <div on-tap="onFilter" class="icon-funnel" title="[[onFilterTitle]]"
                  index="[[index]]" header="[[header]]"></div>
              </template>
              <template is="dom-if" if="[[header.delete]]">
                <div on-tap="onDelete" class="icon-close-dark statsgrid-remove-indicator"
                  title="[[onDeleteTitle]]" index="[[index]]" header="[[header]]"></div>
              </template>
            </th>
          </template>
        </tr>
      </thead>
      <tbody>
        <template is="dom-repeat" items="[[rows]]" as="row" id="rowsTemplate">
          <tr>
            <template is="dom-if" if="[[selection]]">
              <td><input type="checkbox" checked="{{row.selected::change}}" on-change="selectionsChanged"></input></td>
            </template>
            <template is="dom-repeat" items="[[row.data]]" as="datum">
              <td>
                <span>[[datum]]</span>
              </td>
            </template>
          </tr>
        </template>
      </tbody>
    </table>
    <content></content>
  </template>

  <script>
    Polymer({
      "is": "oskari-grid",
      "properties": {
          "rows": {
              "type": Array,
              "notify": true
          },
          "allSelected": {
              "type": Boolean,
              "notify": true,
              "value": true
          },
          "allCheckboxDisabled": {
              "type": Boolean,
              "notify": true,
              "value": true
          }
      },
      "observers": [
          "allSelectedChanged(allSelected)"
      ],
      "allSelectedChanged": function(allSelected) {
          var me = this;
          if (allSelected && me.rows) {
              me.rows.forEach(function (row, index) {
                  me.set("rows." + index + ".selected", true);
              });
              // Disabling checkbox if it's on.
              me.allCheckboxDisabled = true;
          }
      },
      "selectionsChanged": function() {
          var me = this;
          me.allSelected = true;
          // Disabling checkbox if it's on.
          me.allCheckboxDisabled = true;
          me.rows.forEach(function (row, index) {
              if (!row.selected) {
                  me.allSelected = false;
                  // Enabling checkbox if it's off.
                  me.allCheckboxDisabled = false;
              }
          });
      },
      /**
       * This is just used for sorting.
       */
      "refresh": function() {
          this.$.headersTemplate.render();
          this.$.rowsTemplate.render();
      },
      "onSort": function(event) {
          this.fire("onSort", {index: event.target.index, header: event.target.header});
      },
      "onDelete": function(event) {
          this.fire("onDelete", {index: event.target.index, header: event.target.header});
      },
      "onFilter": function(event) {
          this.fire("onFilter", {index: event.target.index, header: event.target.header});
      }
    });
  </script>

</dom-module>

