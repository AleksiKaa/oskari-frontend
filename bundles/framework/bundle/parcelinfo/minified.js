Oskari.clazz.define("Oskari.mapframework.bundle.parcelinfo.ParcelInfoInstance",function(){this.sandbox=null,this.started=!1,this._localization=null,this._plugin=null},{getName:function(){return"parcelinfo"},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},update:function(){},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(e.started)return;e.started=!0;var t=Oskari.$("sandbox");e.setSandbox(t);var n=t.findRegisteredModuleInstance("MainMapModule"),r={},i=this.getLocalization("display"),s=Oskari.clazz.create("Oskari.mapframework.bundle.parcelinfo.plugin.ParcelInfoPlugin",r,i);n.registerPlugin(s),n.startPlugin(s),this._plugin=s},stop:function(){this.sandbox=null,this.started=!1}},{protocol:["Oskari.bundle.BundleInstance"]}),define("bundles/framework/bundle/parcelinfo/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.parcelinfo.plugin.ParcelInfoPlugin",function(e,t){this._conf=e,this._locale=t,this._mapModule=null,this._sandbox=null,this._map=null,this._elements={},this._templates={},this._layers=[],this._selectedFeature=null},{getName:function(){return"ParcelInfoPlugin"},getMapModule:function(){return this._mapModule},setMapModule:function(e){this._mapModule=e},hasUI:function(){return!0},init:function(e){this._templates.infodiv=jQuery('<div><table class="piMain"><tr><td class="piHeaderLabel" colspan="3"></td></tr><tr><td class="piLabel piLabelName" infotype="name"></td><td class="piLabelValue" infotype="name" colspan="2"></td></tr><tr><td class="piLabel piLabelArea" infotype="area"></td><td class="piValue" infotype="area"></td><td class="piUnit" infotype="area"></td></tr><tr><td class="piLabel piLabelLength" infotype="length"></td><td class="piValue" infotype="length"></td><td class="piUnit" infotype="length"></td></tr></table></div>')},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this),this._createUI();for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);this._elements.display&&(this._elements.display.remove(),delete this._elements.display),e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){},_createUI:function(){var e=this._sandbox,t=this,n=jQuery(this._map.div),r=t._elements.display;t._elements.display||(r=t._elements.display=t._templates.infodiv.clone()),r.find(".piHeaderLabel").html(t._locale.header),r.find(".piLabelName").html(t._locale.info.name),r.find(".piLabelArea").html(t._locale.info.area),r.find(".piLabelLength").html(t._locale.info.length),n.append(r),this.update(),r.show()},update:function(e){if(!e||!e.info)e={info:{name:"",area:"",length:""}};var t=this,n=e.info,r=t._elements.display,i=r.find('.piLabelValue[infotype="name"]'),s=r.find('.piValue[infotype="area"]'),o=r.find('.piUnit[infotype="area"]'),u=r.find('.piValue[infotype="length"]'),a=r.find('.piUnit[infotype="length"]');i&&s&&u&&(i.text(n.name),s.text(n.area),o.html(t._map.units+"&sup2;"),u.text(n.length),a.text(t._map.units))},eventHandlers:{"ParcelInfo.ParcelLayerRegisterEvent":function(e){var t=this;e&&e.getLayer()&&t._registerLayer(e.getLayer())},"ParcelInfo.ParcelLayerUnregisterEvent":function(e){var t=this;e&&e.getLayer()&&t._unregisterLayer(e.getLayer())}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_registerLayer:function(e){var t=this;e.length>1&&(jQuery.inArray(e[0],t._layers)===-1&&(e[0].events.register("featureselected",t,t._updateInfoSelected),e[0].events.register("featureunselected",t,t._updateInfoUnselected),this._layers.push(e[0])),jQuery.inArray(e[1],t._layers)===-1&&(e[1].events.register("featuremodified",t,t._updateInfo),e[1].events.register("vertexmodified",t,t._updateInfo),this._layers.push(e[1])))},_unregisterLayer:function(e){var t=this;if(e.length>1){var n=jQuery.inArray(e[0],t._layers);n!=-1&&(e[0].events.unregister("featureselected",t,t._updateInfoSelected),e[0].events.unregister("featureunselected",t,t._updateInfoUnselected),this_layers.splice(n,1));var n=jQuery.inArray(e[1],t._layers);n!=-1&&(e[1].events.unregister("featuremodified",t,t._updateInfo),e[1].events.unregister("vertexmodified",t,t._updateInfo),this_layers.splice(n,1))}},_updateInfoSelected:function(e){this._selectedFeature=null,e&&(this._selectedFeature=e.feature),this._updateInfo(e)},_updateInfoUnselected:function(e){this._selectedFeature=null,this.update()},_updateInfo:function(e){var t=this;e&&e.feature&&e.feature.geometry&&e.feature===t._selectedFeature?t.update({info:{name:e.feature.attributes.nimi||e.feature.attributes.name||"",area:e.feature.geometry.getArea().toFixed(0),length:e.feature.geometry.getLength().toFixed(0)}}):t._selectedFeature&&t.update({info:{name:t._selectedFeature.attributes.nimi||t._selectedFeature.attributes.name||"",area:t._selectedFeature.geometry.getArea().toFixed(0),length:t._selectedFeature.geometry.getLength().toFixed(0)}})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/parcelinfo/plugin/ParcelInfoPlugin",function(){}),define("normalize",["require","module"],function(e,t){function o(e,t,n){if(e.indexOf("data:")===0)return e;e=r(e);if(e.match(/^\//)||e.match(s))return e;var i=n.match(s),o=t.match(s);return o&&(!i||i[1]!=o[1]||i[2]!=o[2])?u(e,t):a(u(e,t),n)}function u(e,t){e.substr(0,2)=="./"&&(e=e.substr(2));var n=t.split("/"),r=e.split("/");n.pop();while(curPart=r.shift())curPart==".."?n.pop():n.push(curPart);return n.join("/")}function a(e,t){var n=t.split("/");n.pop(),t=n.join("/")+"/",i=0;while(t.substr(i,1)==e.substr(i,1))i++;while(t.substr(i,1)!="/")i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var r=e.split("/");out="";while(n.shift())out+="../";while(curPart=r.shift())out+=curPart+"/";return out.substr(0,out.length-1)}var n=/([^:])\/+/g,r=function(e){return e.replace(n,"$1/")},s=/[^\:\/]*:\/\/([^\/])*/,f=function(e,t,n,i){t=r(t),n=r(n);var s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/ig,u,a,e;while(u=s.exec(e)){a=u[3]||u[2]||u[5]||u[6]||u[4];var f;i&&a.substr(0,1)=="/"?f=i+a:f=o(a,t,n);var l=u[5]||u[6]?1:0;e=e.substr(0,s.lastIndex-a.length-l-1)+f+e.substr(s.lastIndex-l-1),s.lastIndex=s.lastIndex+(f.length-a.length)}return e};return f.convertURIBase=o,f}),define("css",["./normalize"],function(e){function t(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}if(typeof window=="undefined")return{load:function(e,t,n){n()}};var n=!1,r=document.getElementsByTagName("head")[0],i=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),s=!1;!i||(i[1]||i[7]?(s=parseInt(i[1])<6||parseInt(i[7])<=9,i="trident"):i[2]?(s=!0,i="webkit"):i[3]||(i[4]?(s=parseInt(i[4])<18,i="gecko"):n&&alert("Engine detection failed")));var o={},u=/^\/|([^\:\/]*:)/;o.pluginBuilder="./css-builder";var a=[],f={},l=[];o.addBuffer=function(e){if(t(a,e)!=-1)return;if(t(l,e)!=-1)return;a.push(e),l.push(e)},o.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var s=i.join("/")+"/";s=e.convertURIBase(s,r,"/"),s.match(u)||(s="/"+s),s.substr(s.length-1,1)!="/"&&(s+="/"),o.inject(e(t,s,r));for(var l=0;l<a.length;l++)(n&&a[l].substr(a[l].length-5,5)==".less"||!n&&a[l].substr(a[l].length-4,4)==".css")&&(function(e){f[e]=f[e]||!0,setTimeout(function(){typeof f[e]=="function"&&f[e](),delete f[e]},7)}(a[l]),a.splice(l--,1))},o.attachBuffer=function(e,n){for(var r=0;r<a.length;r++)if(a[r]==e)return f[e]=n,!0;if(f[e]===!0)return f[e]=n,!0;if(t(l,e)!=-1)return n(),!0};var c=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}c(e,t)},10)},h=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}h(e,t)},10)};if(i=="trident"&&s)var p=[],d=[],v=0,m=function(e,t){var n;d.push({url:e,cb:t}),n=p.shift(),!n&&v++<31&&(n=document.createElement("style"),r.appendChild(n)),n&&g(n)},g=function(e){var t=d.shift();if(!t){e.onload=b,p.push(e);return}e.onload=function(){t.cb(t.ss),g(e)};var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]};var y=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},b=function(){};o.linkLoad=function(e,t){var o=setTimeout(function(){n&&alert("timeout"),t()},L*1e3-100),u=function(){clearTimeout(o),a&&(a.onload=b),setTimeout(t,7)};if(!s){var a=y(e);a.onload=u,r.appendChild(a)}else if(i=="webkit"){var a=y(e);c(a,u),r.appendChild(a)}else if(i=="gecko"){var f=document.createElement("style");f.textContent='@import "'+e+'"',h(f,u),r.appendChild(f)}else i=="trident"&&m(e,u)};var w=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],E={},S=function(e,t,n){if(E[e]){t(E[e]);return}var r,i,s;if(typeof XMLHttpRequest!="undefined")r=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){s=w[i];try{r=new ActiveXObject(s)}catch(o){}if(r){w=[s];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(i){var s,o;r.readyState===4&&(s=r.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=r,n(o)):(E[e]=r.responseText,t(r.responseText)))},r.send(null)},x=0,T;o.inject=function(e){x<31&&(T=document.createElement("style"),T.type="text/css",r.appendChild(T),x++),T.styleSheet?T.styleSheet.cssText+=e:T.appendChild(document.createTextNode(e))};var N=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,C=window.location.pathname.split("/");C.pop(),C=C.join("/")+"/";var k=function(t,n,r){t.match(u)||(t="/"+e.convertURIBase(t,C,"/")),S(t,function(i){i=e(i,t,C);var s=[],o=[],u=[],a;while(a=N.exec(i)){var f=a[4]||a[5]||a[7]||a[8]||a[9];s.push(f),o.push(N.lastIndex-a[0].length),u.push(a[0].length)}var l=0;for(var c=0;c<s.length;c++)(function(e){k(s[e],function(t){i=i.substr(0,o[e])+t+i.substr(o[e]+u[e]);var r=t.length-u[e];for(var a=e+1;a<s.length;a++)o[a]+=r;l++,l==s.length&&n(i)},r)})(c);s.length==0&&n(i)},r)};o.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)};var L,A=!1;return o.load=function(e,t,r,i,u){L=L||i.waitSeconds||7;var a=e+(u?".less":".css");if(o.attachBuffer(a,r))return;var f=t.toUrl(a);!A&&n&&(alert(s?"hacking links":"not hacking"),A=!0),u?k(f,function(e){u&&(e=u(e,function(e){o.inject(e),setTimeout(r,7)}))}):o.linkLoad(f,r)},n&&(o.inspect=function(){if(stylesheet.styleSheet)return stylesheet.styleSheet.cssText;if(stylesheet.innerHTML)return stylesheet.innerHTML}),o}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/parcelinfo/css/parcelinfo.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"parcelinfo",value:{title:"",desc:"",display:{header:"Valitun paikan info",info:{name:"Nimi: ",area:"Pinta-ala: ",length:"Piiri: "}}}}),define("bundles/framework/bundle/parcelinfo/locale/fi",function(){}),define("bundles/framework/bundle/parcelinfo/module",["oskari","jquery","./instance","./plugin/ParcelInfoPlugin","css!resources/framework/bundle/parcelinfo/css/parcelinfo.css","./locale/fi"],function(e,t){return e.bundleCls("parcelinfo").category({create:function(){var t=this,n=e.clazz.create("Oskari.mapframework.bundle.parcelinfo.ParcelInfoInstance");return n},update:function(e,t,n,r){}})}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.setBuffer(".piMain {\r\n  position: absolute;\r\n  bottom: 30px;\r\n  right: 30px;\r\n  display: block;\r\n  color: #3C3C3C;\r\n  background: white;\r\n  font-size: 12px;\r\n  z-index: 64738;\r\n  border: 1px solid #c4c4c4;\r\n  padding: 5px 10px 5px 10px;\r\n  width: auto;\r\n  border-collapse: separate; }\r\n\r\n.piHeaderLabel {\r\n  text-align: center;\r\n  font-weight: bold; }\r\n\r\n.piLabel {\r\n  font-weight: bold;\r\n  text-align: left; }\r\n\r\n.piLabelValue {\r\n  text-align: left; }\r\n\r\n.piValue {\r\n  text-align: right; }\r\n\r\n.piUnit {\r\n  text-align: left;\r\n  padding-left: 4px; }\r\n")}),requirejs.s.contexts._.nextTick=requirejs.nextTick;