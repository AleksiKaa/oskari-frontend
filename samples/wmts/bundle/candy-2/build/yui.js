/* This is a packed Oskari bundle (bundle script version Thu Jan 12 2012 12:28:07 GMT+0200 (Suomen normaaliaika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.Candy2BundleInstance",function(){this.map=null;this.mapster=null;this.ui=null;this.sandbox=null},{getUserInterface:function(){return this.ui},start:function(){var a=null;if(document.location.search.length>1){a=Ext.urlDecode(document.location.search.substring(1))}else{a={}}var d=Oskari.clazz.create("Oskari.mapframework.candy-2.Sample");var c=Oskari.clazz.create("Oskari.mapframework.wmts.NlsFiLayerConfig",{default_wms_url:"http://wms.a.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?,http://wms.b.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?,http://wms.c.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?,http://wms.d.paikkatietoikkuna.fi/gwc/mml-rasteriaineistot?"});var b=c.create();d.setMapConfiguration(b);Oskari.$("pageArgs",a);Oskari.$("startup",c.getMapConfiguration());Oskari.$("Ext",Ext);d.startFramework();this.app=d},getApp:function(){return this.app},update:function(){},stop:function(){alert("Stopped!")}},{protocol:["Oskari.bundle.BundleInstance"]});Oskari.clazz.define("Oskari.mapframework.candy-2.Sample",function(){this._core=null;this.mapConfiguration=null;this.ui=null},{setMapConfiguration:function(a){this.mapConfiguration=a},getMapConfiguration:function(){return this.mapConfiguration},getWmtsService:function(){return this.wmtsService},startFramework:function(){var b=this.getMapConfiguration();var a=Oskari.clazz.create("Oskari.mapframework.core.Core");this._core=a;var c=this.createServices(b);var e=this.createEnhancements(b);var d=this.createUserInterface(b);this.ui=d;this.createDefaultExtensionModules(b,d);this.createExtensionBundles(b,d);this.createCoreQuirks(b,a);a.init(d,c,e,b.layers,b.userInterfaceLanguage,b.mapPublisherWizardUrl)},getSandbox:function(){return this._core.getSandbox()},getUserInterface:function(){return this.ui},createCoreQuirks:function(b,a){if(b.disableDevelopmentMode=="true"){var c=Oskari.clazz.create("Oskari.mapframework.enhancement.common.DisableDevelopmentModeEnhancement",true);c.enhance(a)}},createServices:function(b){var c=[];c.push(Oskari.clazz.create("Oskari.mapframework.service.SearchService",b.globalMapAjaxUrl,b.globalPortletNameSpace));var a=Oskari.clazz.create("Oskari.mapframework.service.MapLayerService",null,this._core.getSandbox());c.push(a);a.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var d=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");a.registerLayerModelBuilder("wmtslayer",d);var e=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",a);this.wmtsService=e;c.push(Oskari.clazz.create("Oskari.mapframework.service.GetFeatureInfoService",b.globalMapAjaxUrl));c.push(Oskari.clazz.create("Oskari.mapframework.service.LanguageService",b.userInterfaceLanguage));c.push(Oskari.clazz.create("Oskari.mapframework.service.UsageSnifferService",2,"/log/"));return c},createEnhancements:function(a){var d=[];var c=false;var b=(a.netServiceCenterAvailable==true);d.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithConfigurationsEnhancement",a.preSelectedLayers,a.mapConfigurations));d.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement"));return d},createUserInterface:function(a){return Oskari.clazz.create("Oskari.mapframework.oskari.ui.Candy2FullUiManager",a)},createDefaultExtensionModules:function(d,f){var b=Oskari.clazz.create("Oskari.mapframework.ui.module.layerselector.AllLayersModule");f.addExtensionModule(b,"allLayersModule","NW");var g=Oskari.clazz.create("Oskari.mapframework.ui.module.layerselector.SelectedLayersModule");f.addExtensionModule(g,"selectedLayersModule","W");var c=Oskari.clazz.create("Oskari.mapframework.ui.module.searchservice.SearchModule");f.addExtensionModule(c,"searchModule","E");var e=Oskari.clazz.create("Oskari.mapframework.ui.module.searchservice.MetadataModule");f.addExtensionModule(e,"metadataModule","E");if(d.bundles){for(bundleIndex in d.bundles){var a=d.bundles[bundleIndex];f.addExtensionModule(Oskari.clazz.create(a.type,a.config),a.ident,a.location)}}return f},createExtensionBundles:function(a,b){}});Oskari.clazz.define("Oskari.mapframework.oskari.ui.Candy2Facade",function(a,b,c){this.sandbox=a;this.manager=b;this.parts=c},{registerPart:function(a,b){this.parts[a]=b},getSandbox:function(){return this.sandbox},getManager:function(){return this.manager},getParts:function(){return this.parts},appendExtensionModule:function(e,l,a,i,g,k,j){var d=this.sandbox.getLanguage();var c=this.manager.addExtensionModule(e,l,g,k,j);c.bundleInstance=i;if(c.module){if(c.component){c.initialisedComponent=this.getSandbox().register(c.module)}else{c.component=this.getSandbox().register(c.module)}}if(c.component){var n=null;var h=true;if(typeof g=="string"){n=g}var o=this.parts[n];var b=null;if(k&&k[d]){b=k[d].title}var f={title:b,layout:"fit",items:[c.component]};var m=o.add(f);c.host=o;c.cmp=m;c.component=null}for(p in a){this.sandbox.registerForEventByName(e,p)}return c},removeExtensionModule:function(b,a,e,d,c){for(p in e){this.sandbox.unregisterFromEventByName(b,p)}this.sandbox.unregister(b)},collapseDirections:{N:Ext.Component.DIRECTION_TOP,E:Ext.Component.DIRECTION_RIGHT,S:Ext.Component.DIRECTION_BOTTOM,W:Ext.Component.DIRECTION_LEFT},collapsePart:function(a){if(this.parts.Drawer[a]){this.parts.Drawer[a].collapse(this.collapseDirections[a],false)}else{this.parts[a].collapse(true)}},expandPart:function(a){if(this.parts.Drawer[a]){this.parts.Drawer[a].expand(false)}else{this.parts[a].expand(true)}}},{protocol:["Oskari.mapframework.ui.manager.Facade"]});Oskari.clazz.define("Oskari.mapframework.oskari.ui.Candy2FullUiManager",function(a){this._sandbox;this._conf=a;this._mapModuleDom;this._mapPositionModuleDom;this._overlayPopupModuleExt;this._mapControlsDom;this._uimodules=[];this._uimodulesByName={}},{createModulesAndUi:function(k){k.printDebug("[Candy2FullUiManager] Creating UI for Map full...");this._sandbox=k;var h=this._conf;var l=h.mapConfigurations.index_map;var j=h.mapConfigurations.zoom_bar;var b=h.mapConfigurations.scala_bar;var c=h.mapConfigurations.pan;var a=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",l,j,b,c);this._mapModuleDom=k.register(a);var d=[];d.push("Oskari.mapframework.mapmodule.LayersPlugin");d.push("Oskari.mapframework.mapmodule.WmsLayerPlugin");d.push("Oskari.mapframework.mapmodule.MarkersPlugin");d.push("Oskari.mapframework.mapmodule.VectorLayerPlugin");d.push("Oskari.mapframework.mapmodule.TilesGridPlugin");d.push("Oskari.mapframework.mapmodule.ControlsPlugin");d.push("Oskari.mapframework.mapmodule.WfsLayerPlugin");d.push("Oskari.mapframework.mapmodule.GetInfoPlugin");for(var f=0;f<d.length;f++){var g=Oskari.clazz.create(d[f]);a.registerPlugin(g)}k.printDebug("[Candy2FullUiManager] creating default ui modules...");var e=h.mapConfigurations.map_function;if(e){var a=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapControlsModule");this._mapControlsDom=k.register(a)}else{this._mapControlsDom=""}var m=false;if(m){var a=Oskari.clazz.create("Oskari.mapframework.ui.module.mapfull.MapPositionModule");this._mapPositionModuleDom=k.register(a)}else{this._mapPositionModuleDom=null}this.setupExtensionModules(k);k.printDebug("[Candy2FullUiManager] All modules created, next build up EXTJs frame...");this.createUi(k);k.printDebug("[Candy2FullUiManager] Map full UI construction completed.")},setupExtensionModules:function(a){a.printDebug("[Candy2FullUiManager] setupExtensionModules...");for(var c=0;c<this._uimodules.length;c++){var b=this._uimodules[c];a.printDebug("[Candy2FullUiManager] Registering "+b.identifier);b.component=a.register(b.module)}},addExtensionModule:function(b,a,d){var c={module:b,identifier:a,region:d,component:null};this._uimodules.push(c);this._uimodulesByName[a]=c;return c},getExtensionModule:function(a){return this._uimodulesByName[a].module},getExtensionModuleDefinition:function(a){return this._uimodulesByName[a]},getExtensionModuleComponentsByRegion:function(d){var a=this._sandbox;var b=[];var f="";for(p in d){f+=p+"="+d[p]+" "}a.printDebug("[Candy2FullUiManager] getExtensionModulesByRegion called with "+f);for(var e=0;e<this._uimodules.length;e++){var c=this._uimodules[e];if(d[c.region]){b.push(c.component);a.printDebug("[Candy2FullUiManager] - module "+c.identifier+" matched")}}return b},getExtensionModuleDefinitionsByRegion:function(c){var a=[];for(var d=0;d<this._uimodules.length;d++){var b=this._uimodules[d];if(c[b.region]){a.push(b)}}return a},createMapContainer:function(a){var b=Ext.createWidget("nlsfimappanel",{olmap:a,layout:"absolute",bodyBorder:false,flex:1,bodyCls:"mapster"});return b},createUi:function(d){var g=Oskari.$().startup.mapConfigurations;var j=300;var i=this.getExtensionModuleComponentsByRegion({NW:true});var a=[];if(i.length>0){a.push(Ext.create("Ext.Panel",{anchor:"100%, 50%",id:"left_upper",border:false,frame:false,layout:"fit",items:i}))}var t=this.getExtensionModuleComponentsByRegion({W:true});for(var r=0;r<t.length;r++){a.push(t[r])}var c=null;if(this._mapModuleDom){c=Ext.create("Ext.Panel",{region:"center",layout:"fit",flex:1,bodyBorder:false,items:[]})}var v=this._uimodulesByName.searchModule;if(v){var o=v.component;a.push(o)}var w='<em id="{id}-btnWrap" class="menubutton"><button class="menubutton" id="{id}-btnEl" type="{type}" hidefocus="true"<tpl if="tabIndex"> tabIndex="{tabIndex}"</tpl> role="button" autocomplete="off"><span id="{id}-btnInnerEl" class="{baseCls}-inner" style="{innerSpanStyle}">{text}</span><span id="{id}-btnIconEl" class="{baseCls}-icon {iconCls}">&#160;</span></button></em>';var k={toolsMenuRight:null,toolsMenu:null,toolsMenuShown:false};var f=Ext.create("Ext.panel.Panel",{layout:{type:"card"},itemCls:"toolsmenuitem",activeItem:2,flex:1,height:412,items:a,bodyFrame:false,bodyCls:"toolsmenu_right"});
k.toolsMenuRight=f;var b=Ext.create("Ext.panel.Panel",{layout:{type:"hbox",align:"top"},hideMode:"offsets",floating:true,shadow:"sides",frame:false,autoShow:false,preventHeader:true,width:768,height:480,x:40+120,y:96,closable:false,resizable:true,resizeHandles:"se",bodyBorder:false,border:0,items:[f],bodyCls:"toolsmenu"});k.toolsMenu=b;var l=[];var u=this;var e='<em id="{id}-btnWrap" class="toolsbar"><button class="toolsbar" id="{id}-btnEl" type="{type}" hidefocus="true"<tpl if="tabIndex"> tabIndex="{tabIndex}"</tpl> role="button" autocomplete="off"><span id="{id}-btnInnerEl" class="{baseCls}-inner" style="{innerSpanStyle}">{text}</span><span id="{id}-btnIconEl" class="{baseCls}-icon {iconCls}">&#160;</span></button></em>';l.push({xtype:"button",width:40,flex:0,baseCls:"toolsbar",iconCls:"toolsbarIcon",renderTpl:e,tooltip:"close_menu",handler:function(){k.lastOpener=null;b.hide()}});var h='<em id="{id}-btnWrap" class="bndlsbar-btn"><button class="bndlsbar-btn  {iconCls}" id="{id}-btnEl" type="{type}" hidefocus="true"<tpl if="tabIndex"> tabIndex="{tabIndex}"</tpl> role="button" autocomplete="off"><span id="{id}-btnInnerEl" class="{baseCls}-inner" style="{innerSpanStyle}">{text}</span><span id="{id}-btnIconEl" class="{baseCls}-icon">&#160;</span></button></em>';l.push({xtype:"panel",width:120,baseCls:"bndlsbar",layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",height:96,baseCls:"bndlsplaceholder"},{xtype:"button",text:"Haku",height:64,baseCls:"bndlsbar",iconCls:"bndls-searchservice",renderTpl:h,tooltip:"show_searcservice",handler:function(){if(k.lastOpener==2){b.hide();k.lastOpener=null}else{b.show();k.toolsMenuRight.getLayout().setActiveItem(2);k.lastOpener=2}}},{xtype:"button",text:"Karttatasot",height:64,baseCls:"bndlsbar",iconCls:"bndls-layerselector",renderTpl:h,tooltip:"show_layerselector",handler:function(){if(k.lastOpener==0){b.hide();k.lastOpener=null}else{b.show();k.toolsMenuRight.getLayout().setActiveItem(0);k.lastOpener=0}}},{xtype:"button",text:"Valitut karttatasot",height:64,baseCls:"bndlsbar",iconCls:"bndls-layerselection",renderTpl:h,tooltip:"show_layerselection",handler:function(){if(k.lastOpener==1){b.hide();k.lastOpener=null}else{b.show();k.toolsMenuRight.getLayout().setActiveItem(1);k.lastOpener=1}}}]});l.push(c);var s=Ext.create("Ext.Panel",{layout:{type:"hbox",align:"stretch"},id:"main-app",bodyCls:"main-app",bodyBorder:false,items:l});var m=Ext.create("Ext.container.Viewport",{layout:"fit",items:[s]});var q=this.createMapContainer(this._mapModuleDom);c.add(q);if(this._mapControlsDom){q.add(this._mapControlsDom)}this._facade=Oskari.clazz.create("Oskari.mapframework.oskari.ui.Candy2Facade",d,this,{Viewport:s,ToolMenu:b});Oskari.$("UI.facade",this._facade);this._uiReady=true},getFacade:function(){return this._facade}});