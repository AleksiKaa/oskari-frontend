/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 12:02:04 GMT+0300 (Suomen kesÃ¤aika)) */ 
Oskari.clazz.define("Oskari.poc.dojo.bundle.LayerSelectionBundleInstance",function(){this.map=null;this.core=null;this.sandbox=null;this.mapmodule=null;this.started=false;this.template=null;this.plugins={};this.dojo=null},{__name:"DojoLayerSelection",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},start:function(){var c=this;if(c.started){return}c.started=true;var a=Oskari.$("sandbox");c.sandbox=a;a.register(c);for(p in c.eventHandlers){a.registerForEventByName(c,p)}var b=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,b);c.mediator.bundle.require(function(d){c.dojo=d;c.refresh()})},init:function(){return null},update:function(){},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{AfterMapLayerAddEvent:function(a){this.refresh()},AfterMapLayerRemoveEvent:function(a){this.refresh()},AfterMapMoveEvent:function(a){},AfterChangeMapLayerOpacityEvent:function(a){if(this.sandbox.getObjectCreator(a)!=this.getName()){this.plugins["Oskari.userinterface.Flyout"].updateLayer(a.getMapLayer())}}},stop:function(){var a=this.sandbox();for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);a.request(this,b);this.sandbox.unregister(this);this.started=false},setSandbox:function(a){this.sandbox=null},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.poc.dojo.layerselection.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.poc.dojo.layerselection.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getTitle:function(){return"Layer Selection"},getDescription:function(){return"Sample"},getPlugins:function(){return this.plugins},refresh:function(){var a=this;if(!a.dojo){return}this.plugins["Oskari.userinterface.Flyout"].setDojo(a.dojo);this.plugins["Oskari.userinterface.Flyout"].refresh();this.plugins["Oskari.userinterface.Tile"].setDojo(a.dojo);this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.poc.dojo.layerselection.Flyout",function(a){this.instance=a;this.container=null;this.template=null;this.state=null;this.dojo=null;this.layercontrols={}},{setDojo:function(a){this.dojo=a;var b=this.dojo.dojo;b.extend(this.dojo["dojo/dnd/Source"],{copyState:function(c,d){return false}})},getName:function(){return"Oskari.poc.dojo.layerselection.Flyout"},setEl:function(c,b,a){this.container=c[0]},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return"Valitut karttatasot"},getDescription:function(){},getOptions:function(){},setState:function(a){this.state=a;console.log("Flyout.setState",this,a)},updateLayer:function(b){var d=this.layercontrols[b.getId()];if(!d){return}var c=d.slider;var a=b.getOpacity();c.set("value",a)},refresh:function(){var i=this;var d=i.dojo.dojo;var e=i.dojo["dojo/dom-construct"];var i=this;var j=i.instance.getSandbox();e.empty(this.container);var k=e.create("div",{className:"selectedLayerList"},this.container);i.layercontrols={};var b=new i.dojo["dojo/dnd/Source"](k,{accept:["selectedLayer"],singular:true});var f=j.findAllSelectedMapLayers();var a=[];for(var c=f.length-1;c>=0;--c){var g=f[c];var h=this.createLayerContainer(g);a.push(h)}b.insertNodes(false,a);d.connect(b,"onDndDrop",function(m,l,o,n){i._layerOrderChanged(m,l,o,n)})},_layerOrderChanged:function(a,d,b,k){var h=d[0].id;var c=k.getAllNodes();var m=-1;for(var f=0,g=c.length;f<g;++f){if(c[f].id==h){m=f;break}}if(m>-1){m=(c.length-1)-m;var j=h.substring("selected_".length);var l=this.instance.getSandbox();var e=l.getRequestBuilder("RearrangeSelectedMapLayerRequest")(j,m);l.request(this.instance.getName(),e)}},getLayerContainer:function(a){var b=this;var c=b.dojo["dojo/dom"];return c.byId("selected_"+a)},createLayerContainer:function(h){var l=this;var n=l.instance.getSandbox();
var a=n.getRequestBuilder("ChangeMapLayerOpacityRequest");var k=l.dojo["dojo/query"];var c=l.dojo.dojo;var d=l.dojo["dojo/dom-construct"];var f=l.dojo["dojo/dom"];var e=h.getId();var m=h.getOpacity();var j=d.create("div",{className:"selectedLayer",id:"selected_"+e,style:{border:"solid; 2px"}});var g=d.create("p",{innerHTML:h.getName()},j);var i=d.create("div",{className:"slider",style:{}},j);var b=new l.dojo["dijit/form/HorizontalSlider"]({minimum:0,maximum:100,pageIncrement:20,value:m,intermediateChanges:true,style:"width: 200px;",layer:h,moduleName:l.instance.getName()},i);l.layercontrols[e]={slider:b};c.connect(b,"onChange",function(r){var q=this.moduleName;var o=this.layer.getId();n.request(q,a(o,r))});b.startup();return j}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.poc.dojo.layerselection.Tile",function(a){this.instance=a;this.container=null;this.template=null;this.dojo=null},{setDojo:function(a){this.dojo=a},getName:function(){return"Oskari.poc.dojo.layerselection.Tile"},setEl:function(c,b,a){this.container=$(c)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return"Valitut tasot DOJO"},getDescription:function(){},getOptions:function(){},setState:function(a){console.log("Tile.setState",this,a)},refresh:function(){var f=this;var a=f.instance;var e=this.container;var d=this.template;var c=a.getSandbox();var g=c.findAllSelectedMapLayers();var b=e.children(".oskari-tile-status");b.empty();b.append("("+g.length+")")}},{protocol:["Oskari.userinterface.Tile"]});