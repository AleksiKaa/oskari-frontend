/* This is a packed Oskari bundle (bundle script version Thu Dec 08 2011 10:07:15 GMT+0200 (Suomen normaaliaika)) */ 
Oskari.clazz.define("Oskari.mapframework.ui.manager.mapportal.MapPortalUiManager",function(a){this._sandbox;this._conf=a;this._uimodules=[];this._uimodulesByName={};this.facadeParts={Portlet:{},Drawer:{}}},{createModulesAndUi:function(a){a.printDebug("Creating UI for Map full...");this._sandbox=a;var b=this._conf;this.setupExtensionModules(a);a.printDebug("All modules created, next build up EXTJs frame...");this.createUi(a);a.printDebug("Map full UI construction completed.")},setupExtensionModules:function(a){a.printDebug("setupExtensionModules...");for(var c=0;c<this._uimodules.length;c++){var b=this._uimodules[c];if(!b.module){continue}a.printDebug("#*+---- registering ----+*#"+b.identifier);b.component=a.register(b.module)}},addExtensionModule:function(c,b,d,f,a){var e={module:c,identifier:b,region:d,loc:f,component:a};this._uimodules.push(e);this._uimodulesByName[b]=e;return e},getExtensionModule:function(a){return this._uimodulesByName[a].module},getExtensionModuleDefinition:function(a){return this._uimodulesByName[a]},getExtensionModuleComponentsByRegion:function(d){var a=this._sandbox;var b=[];var f="";for(p in d){f+=p+"="+d[p]+" "}a.printDebug("getExtensionModulesByRegion called with "+f);for(var e=0;e<this._uimodules.length;e++){var c=this._uimodules[e];if(!c.component){continue}if(d[c.region]){b.push(c.component);a.printDebug("- module "+c.identifier+" matched")}}return b},getExtensionModuleDefinitionsByRegion:function(c){var a=[];for(var d=0;d<this._uimodules.length;d++){var b=this._uimodules[d];if(c[b.region]){a.push(b)}}return a},createSouthPanel:function(a,e,b){var d=this.getExtensionModuleComponentsByRegion({S:true});var c=Ext.create("Ext.Panel",{region:"south",split:true,layout:"fit",region:"south",collapsed:true,collapsible:true,animCollapse:false,titleCollapse:false,collapseMode:"mini",height:b,boxMinHeight:b,animCollapse:false,titleCollapse:false,frame:true,header:false,items:d});this.facadeParts.S=c;return c},createEastPanel:function(g,d){var e=this.getExtensionModuleDefinitionsByRegion({E:true});var h=[];for(var b=0;b<e.length;b++){var a=e[b];h.push({title:a.loc?a.loc[lang].title:"?",height:256,items:a.component})}var c=Ext.create("Ext.app.PortalPanel",{xtype:"portalpanel",items:[{items:h}]});var f=[c];var i=Ext.create("Ext.Panel",{region:"east",width:312,collapsible:true,collapsed:true,split:true,layout:"fit",items:f,collapseMode:"mini",animCollapse:false});this.facadeParts.Portlet["E"]=c;this.facadeParts.Drawer["E"]=i;return i},createWestPanel:function(k,f){var e=[];var j=this.getExtensionModuleDefinitionsByRegion({NW:true});var c=Ext.create("Ext.Panel",{height:256,layout:"fit",items:j});this.facadeParts.NW=c;e.push(c);var h=this.getExtensionModuleDefinitionsByRegion({W:true});var i=[];for(var d=0;d<h.length;d++){var b=h[d];if(!b.component){continue}i.push({title:b.loc?b.loc[lang].title:"?",height:512,items:b.component})}var g=Ext.create("Ext.app.PortalPanel",{flex:1,xtype:"portalpanel",items:[{items:i}]});e.push(g);var a=Ext.create("Ext.panel.Panel",{region:"west",split:true,layout:{type:"vbox",align:"stretch",pack:"start"},items:e,collapseMode:"mini",collapsed:true,border:false,frame:false,width:312,region:"west",collapsible:true,animCollapse:false,split:true,animCollapse:false,titleCollapse:false,autoHeight:false,boxMaxWidth:600,boxMinWidth:220,hidden:!f.plane_list,title:k.getText("leftpanel_maplevels_title")});this.facadeParts.Portlet["W"]=g;this.facadeParts.Drawer["W"]=a;return a},createCenterPanel:function(c,d){var b=this.getExtensionModuleComponentsByRegion({Center:true});var a=Ext.create("Ext.Panel",{region:"center",items:b,layout:"fit",header:false,collapsible:false,animCollapse:false,titleCollapse:false});this.facadeParts.Center=a;return a},createStatusBar:function(a,d){var c=[];c.push("-");var b=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom",items:c});return b},createUi:function(h){var b=h.getLanguage();var e=Oskari.$().startup.mapConfigurations;var l=300;var k=this.createSouthPanel(h,e,l);var m=this.createEastPanel(h,e);var a=this.createWestPanel(h,e);var i=this.createCenterPanel(h,e);var g=[];
if(a){g.push(a)}g.push(i);if(m){g.push(m)}var j=this.createStatusBar(h,e);this.facadeParts.StatusRegion=j;var d=Ext.create("Ext.Panel",{layout:"border",region:"center",items:g,bbar:j});this.facadeParts.ViewportCenter=d;var c=this.getBundleMenu();var f=Ext.create("Ext.Panel",{layout:"border",items:[d,k],tbar:[{xtype:"splitbutton",text:"Bundle",scale:"large",minWidth:64,iconAlign:"top",arrowAlign:"bottom",menu:c}]});this.facadeParts.Viewport=f;Ext.create("Ext.container.Viewport",{style:{padding:"8px",overflow:"hidden"},layout:"fit",items:[f]});this._facade=Oskari.clazz.create("Oskari.mapframework.ui.manager.mapportal.Facade",h,this,this.facadeParts);Oskari.$("UI.facade",this._facade);this._uiReady=true},getFacade:function(){return this._facade},getBundleMenu:function(){return[{text:"Load Bundle: Bundle Manager",handler:function(){var a=Oskari.bundle_facade;a.require({"Import-Bundle":{bundlemanager:{bundlePath:"../example-bundles/bundle/"}}},function(b){Oskari.bundle_facade.requireBundle("bundlemanager","BundleManager",function(){var c=b.createInstance("BundleManager");c.start()})})}}]}});Oskari.clazz.define("Oskari.mapframework.ui.manager.mapportal.Facade",function(a,b,c){this.sandbox=a;this.manager=b;this.parts=c;this.additionalComponents={}},{registerPart:function(a,b){this.parts[a]=b},getSandbox:function(){return this.sandbox},getManager:function(){return this.manager},getParts:function(){return this.parts},appendExtensionModule:function(d,j,a,g,e,i,h){var c=this.sandbox.getLanguage();var b=this.manager.addExtensionModule(d,j,e,i,h);b.bundleInstance=g;if(b.module){if(b.component){b.initialisedComponent=this.getSandbox().register(b.module)}else{b.component=this.getSandbox().register(b.module)}}if(b.component){var m=null;var f=true;if(typeof e=="string"){m=e}f=this.parts.Portlet[m];if(f){var n={border:false,title:b.loc[c].title,xtype:"portlet",layout:"fit",items:[b.component],tools:[{type:"gear",handler:function(s,r,q){b.bundleInstance.config()}}],listeners:{close:function(){b.bundleInstance.stop();var r=b.bundleInstance.mediator.manager;var q=b.bundleInstance.mediator.instanceid;r.destroyInstance(q);b.bundleInstance=null}}};var k=this.parts.Drawer[m];k.expand(false);var o=null;o=this.parts.Portlet[m].getComponent(0);var l=o.add(n);b.host=o;b.cmp=l}else{var o=this.parts[m];var l=o.add(b.component);b.host=o;b.cmp=l}b.component=null}for(p in a){this.sandbox.registerForEventByName(d,p)}return b},addUIComponent:function(b,a,d){this.parts[d].add(a);var c={ident:b,region:d,comp:a};this.additionalComponents[b]=c},removeUIComponent:function(a){var b=this.additionalComponents[identtifier];this.parts[b.region].remove(b.comp)},removeExtensionModule:function(b,a,e,d,c){for(p in e){this.sandbox.unregisterFromEventByName(b,p)}this.sandbox.unregister(b)},collapseDirections:{N:Ext.Component.DIRECTION_TOP,E:Ext.Component.DIRECTION_RIGHT,S:Ext.Component.DIRECTION_BOTTOM,W:Ext.Component.DIRECTION_LEFT},collapsePart:function(a){this.parts.Drawer[a].collapse(this.collapseDirections[a],false)},expandPart:function(a){this.parts.Drawer[a].expand(false)}},{protocol:["Oskari.mapframework.ui.manager.Facade"]});