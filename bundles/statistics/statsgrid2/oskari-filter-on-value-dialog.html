<link rel="import"
      href="libs/polymer/polymer.html">
<link href="libs/paper-dialog/paper-dialog.html" rel="import">

<dom-module id="oskari-filter-on-value-dialog">

  <template>
    <paper-dialog id="oskari-filter-on-value-dialog" class="popup">
      <p class="filter-desc">[[locale.indicatorFilterDesc]]</p>
      <div class="filter-row">
        <div class="filter-label">[[locale.filterIndicator]]</div>
        <div class="filter-value">[[label]]</div>
      </div>
      <div class="filter-row">
        <div class="filter-label">[[locale.filterCondition]]</div>
        <div class="filter-value">
          <div>
            <select class="filter-select" value="{{filterValue}}">
              <template is="dom-repeat" items="[[filterConditions]]" as="filterCondition">
                <option value="[[filterCondition.value]]">[[filterCondition.text]]</option>
              </template>
            </select>
            <div class="filter-inputs-container">
              <input type="text" class="filter-input filter-input1" value="{{input1}}"/>
              <div hidden="[[!isRange(filterValue)]]">
                <span class="filter-between">-</span>
                <input type="text" class="filter-input filter-input2" value="{{input2}}"/>
              </div>
          </div>
        </div>
      </div>
      <content></content>
    </paper-dialog>
  </template>

  <script>
    Polymer({
      is: "oskari-filter-on-value-dialog",
      properties: {
          "filterValue": {
              "type": String,
              "notify": true,
              "value": ""
          },
          "input1": {
              "type": String,
              "notify": true,
              "value": ""
          },
          "input2": {
              "type": String,
              "notify": true,
              "value": ""
          },
          "locale": Object,
          "id": String
      },
      "filterConditions": {
          "type": Object,
          "notify": true
      },
      "observers": [
          "localeReady(locale)"
      ],
      "isRange": function(filterValue) {
          return filterValue == "...";
      },
      "localeReady": function(locale) {
          this.set("filterConditions", [
              {
                  val: "",
                  text: locale.filterSelectCondition
              },
              {
                  val: ">",
                  text: locale.filterGT
              },
              {
                  val: ">=",
                  text: locale.filterGTOE
              },
              {
                  val: "=",
                  text: locale.filterE
              },
              {
                  val: "<=",
                  text: locale.filterLTOE
              },
              {
                  val: "<",
                  text: locale.filterLT
              },
              {
                  val: "...",
                  text: locale.filterBetween
              }
          ]);
      },
      "ready": function() {
          this.$["oskari-filter-on-value-dialog"].toggle();
      }
    /*
            'filterByRegion': '<div id="statsgrid-filter-by-region"><p class="filter-desc"></p><div class="filter-container"></div></div>',
        if (selected === '...') {
            filterValue.find('.filter-between').css('display', 'block');
            filterValue.find('.filter-input2').css('display', 'block');
        } else {
            filterValue.find('.filter-input2').css('display', 'none');
            filterValue.find('.filter-between').css('display', 'none');
        }
    });

    popup.find('.filter-container').append(condition);
    var filterInputs = jQuery(me.templates.filterInputs);
    popup.find('.filter-inputs-container').append(filterInputs);

    // dialog with cancel and filter buttons
    var dialog = Oskari.clazz.create(
        'Oskari.userinterface.component.Popup'
    );

    // cancel
    var cancelBtn = Oskari.clazz.create(
        'Oskari.userinterface.component.buttons.CancelButton'
    );
    cancelBtn.setHandler(function () {
        headerMenuPlugin.hide();
        me._destroyPopup('filterPopup');
    });

    // filter
    var filterBtn = Oskari.clazz.create(
        'Oskari.userinterface.component.Button'
    );
    filterBtn.setTitle(me._locale.buttons.filter);
    filterBtn.addClass('primary');
    filterBtn.setHandler(function (e) {
        var inputArray = [];
        var divmanazerpopup = jQuery(e.target)
            .parents('.divmanazerpopup');

        var input1 = divmanazerpopup.find('.filter-input1');
        inputArray.push(input1.val());

        if (select.val() === '...') {
            var input2 = divmanazerpopup.find('.filter-input2');
            inputArray.push(input2.val());
        }

        // me._state.filterMethod = select.val();
        // me._state.filterInput = inputArray;

        me.filterColumn(column, select.val(), inputArray);
        headerMenuPlugin.hide();
        me._destroyPopup('filterPopup');
    });

    // show the dialog
    dialog.show(me._locale.filterTitle, popup, [cancelBtn, filterBtn]);
    // keydown
    popup.on('keydown', function (e) {
        e.stopPropagation();
    });
    me.popups.push({
        name: 'filterPopup',
        popup: dialog,
        content: popup
    });

    REGION:
        var me = this,
        dialog = Oskari.clazz.create(
            'Oskari.userinterface.component.Popup'
        ),
        dialogTitle = me._locale.filterTitle,
        cancelBtn = Oskari.clazz.create(
            'Oskari.userinterface.component.buttons.CancelButton'
        ),
        filterBtn = Oskari.clazz.create(
            'Oskari.userinterface.component.Button'
        ),
        filterLoc = me._locale.buttons.filter,
        content = jQuery(me.templates.filterByRegion).clone(),
        regionCatCont = jQuery(me.templates.filterRow).clone(),
        regionCat = jQuery(me.templates.regionCatSelect).clone(),
        labelsCont = jQuery(me.templates.filterRow).clone(),
        regionIds,
        key,
        regionCatOption,
        regionCatLoc;

    // destroy possible open instance
    me._destroyPopup('filterByRegionPopup');

    cancelBtn.setHandler(function () {
        headerMenuPlugin.hide();
        me._destroyPopup('filterByRegionPopup');
    });

    filterBtn.setTitle(filterLoc);
    filterBtn.addClass('primary');
    filterBtn.setHandler(function (e) {
        regionIds = content.find('div.filter-region-select select').val();
        // me._state.filterRegion = regionIds;
        me.filterColumnByRegion(column, regionIds);
        headerMenuPlugin.hide();
        me._destroyPopup('filterByRegionPopup');
    });

    // Description text
    content.find('.filter-desc').text(me._locale.indicatorFilterDesc);

    // Show the column name
    labelsCont.find('.filter-label').text(me._locale.filterIndicator);
    labelsCont.find('.filter-value').text(column.name);
    content.find('.filter-container').append(labelsCont);

    // Show the region category select
    // Create an empty option first
    regionCatOption = jQuery(me.templates.filterOption).clone();
    regionCatLoc = me._locale.regionCatPlaceholder;
    regionCatOption.val('').text(regionCatLoc);
    regionCat.find('select').append(regionCatOption);

    for (key in me.regionCategories) {
        if (me.regionCategories.hasOwnProperty(key)) {
            regionCatOption = jQuery(me.templates.filterOption).clone();
            regionCatLoc = me._locale.regionCategories[key];
            regionCatOption.val(key).text(regionCatLoc);
            regionCat.find('select').append(regionCatOption);
        }
    }
    regionCatCont.find('.filter-label').text(
        me._locale.selectRegionCategory
    );
    regionCatCont.find('.filter-value').append(regionCat);
    content.find('.filter-container').append(regionCatCont);
    regionCat.change(function (e) {
        me._createFilterByRegionSelect(content, e.target.value);
    });

    dialog.show(dialogTitle, content, [cancelBtn, filterBtn]);
    me.popups.push({
        name: 'filterByRegionPopup',
        popup: dialog,
        content: content
    });

		   */
    });
  </script>

</dom-module>

